<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>NFS存储 | DevOps</title><meta name="author" content="Metta"><meta name="copyright" content="Metta"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、nfs 概述 nfs 是什么？  单纯的存储：硬盘、u 盘等等  nfs：共享存储（network filesystem）网络文件系统  nfs 主要用于 Linux 系统之间 samba：可用于 linux 与 windows 共享存储 ftp：windows、linux、mac 之间共享   分布式存储：FastDFS、GlusterFS（GFS），HDFS（大数据）  为什么使用[如果没">
<meta property="og:type" content="article">
<meta property="og:title" content="NFS存储">
<meta property="og:url" content="https://mettafy.github.io/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%AD%98%E5%82%A8/02-NFS%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1/index.html">
<meta property="og:site_name" content="DevOps">
<meta property="og:description" content="一、nfs 概述 nfs 是什么？  单纯的存储：硬盘、u 盘等等  nfs：共享存储（network filesystem）网络文件系统  nfs 主要用于 Linux 系统之间 samba：可用于 linux 与 windows 共享存储 ftp：windows、linux、mac 之间共享   分布式存储：FastDFS、GlusterFS（GFS），HDFS（大数据）  为什么使用[如果没">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mettafy.github.io/img/touxiang.png">
<meta property="article:published_time" content="2024-07-29T16:10:00.000Z">
<meta property="article:modified_time" content="2024-08-01T10:59:34.935Z">
<meta property="article:author" content="Metta">
<meta property="article:tag" content="文档">
<meta property="article:tag" content="基础">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mettafy.github.io/img/touxiang.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://mettafy.github.io/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%AD%98%E5%82%A8/02-NFS%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'NFS存储',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-01 18:59:34'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/touxiang.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="DevOps"><span class="site-name">DevOps</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">NFS存储</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-07-29T16:10:00.000Z" title="发表于 2024-07-30 00:10:00">2024-07-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-01T10:59:34.935Z" title="更新于 2024-08-01 18:59:34">2024-08-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/">综合架构</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4668</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>21分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="NFS存储"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="一、nfs-概述"><a href="#一、nfs-概述" class="headerlink" title="一、nfs 概述"></a>一、nfs 概述</h1><ul>
<li><p>nfs 是什么？</p>
</li>
<li><p>单纯的存储：硬盘、u 盘等等</p>
</li>
<li><p><strong>nfs：共享存储（network filesystem）网络文件系统</strong></p>
<ul>
<li><strong>nfs 主要用于 Linux 系统之间</strong></li>
<li>samba：可用于 linux 与 windows 共享存储</li>
<li>ftp：windows、linux、mac 之间共享</li>
</ul>
</li>
<li><p>分布式存储：FastDFS、<strong>GlusterFS（GFS）</strong>，HDFS（大数据）</p>
</li>
<li><p>为什么使用<br>[如果没有 nfs 共享]</p>
</li>
<li><p>A 上传以后，只有 web01 有图片，而此时用户 B 访问的是 web02 就会找不到 A 上传的图片</p>
</li>
</ul>
<p><img src="/images/202403291245681.png"></p>
<p>[如果使用了 nfs]</p>
<ul>
<li>此时无论是哪个用户，都可以看到 A 上传的图片</li>
</ul>
<p><img src="/images/202403291245117.png"></p>
<ul>
<li>nfs 存放什么？</li>
<li>存放用户上传的数据（图片、视频等等）</li>
</ul>
<h1 id="二、nfs-的工作原理"><a href="#二、nfs-的工作原理" class="headerlink" title="二、nfs 的工作原理"></a>二、nfs 的工作原理</h1><p><strong>- RPC 和 nfs 的关系</strong></p>
<blockquote>
<p>👺： 什么是 RPC？</p>
<ul>
<li>RPC 是 NFS 的守护进程，由于 NFS 没有固定的端口，每启动一个功能就需要启动一个端口进行传输数据，它会随机启用一些未被使用的端口进行传输，所以需要调用RPC服务</li>
<li>RPC 的主要功能就是记录 NFS 功能所对应的端口，并将 NFS 客户端请求时将对应的信息传递给客户端，从而使客户端可以正确连接到 NFS 服务</li>
</ul>
</blockquote>
<ul>
<li>NFS 工作流程</li>
</ul>
<p><img src="/images/202403291246254.png"></p>
<h1 id="三、实战"><a href="#三、实战" class="headerlink" title="三、实战"></a>三、实战</h1><table>
<thead>
<tr>
<th align="left">主机</th>
<th align="left">ip</th>
<th align="left">角色</th>
</tr>
</thead>
<tbody><tr>
<td align="left">nfs01</td>
<td align="left">192.168.1.40</td>
<td align="left">服务端</td>
</tr>
<tr>
<td align="left">web01</td>
<td align="left">192.168.1.20</td>
<td align="left">客户端</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nfs服务端和客户端都安装上nfs、rpc</span></span><br><span class="line">yum install -y nfs-utils rpcbind</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##先启动rpcbind</span></span><br><span class="line">[root@nfs01 ~]# systemctl start rpcbind</span><br><span class="line"></span><br><span class="line"><span class="comment">###查看rpc信息，此时并没有nfs信息</span></span><br><span class="line">[root@nfs01 ~]# rpcinfo -p</span><br><span class="line">   program vers proto   port  service</span><br><span class="line">    100000    4   tcp    111  portmapper</span><br><span class="line">    100000    3   tcp    111  portmapper</span><br><span class="line">    100000    2   tcp    111  portmapper</span><br><span class="line">    100000    4   udp    111  portmapper</span><br><span class="line">    100000    3   udp    111  portmapper</span><br><span class="line">    100000    2   udp    111  portmapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###启动NFS</span></span><br><span class="line">[root@nfs01 ~]# systemctl start nfs</span><br><span class="line"></span><br><span class="line"><span class="comment">## 再次查看rpc信息，会多了一些nfs的信息</span></span><br><span class="line">[root@nfs01 ~]# rpcinfo -p</span><br><span class="line">   program vers proto   port  service</span><br><span class="line">    100000    4   tcp    111  portmapper</span><br><span class="line">    100000    3   tcp    111  portmapper</span><br><span class="line">    100000    2   tcp    111  portmapper</span><br><span class="line">    100000    4   udp    111  portmapper</span><br><span class="line">    100000    3   udp    111  portmapper</span><br><span class="line">    100000    2   udp    111  portmapper</span><br><span class="line">    100024    1   udp  55257  status</span><br><span class="line">    100024    1   tcp  51640  status</span><br><span class="line">    100005    1   udp  20048  mountd</span><br><span class="line">    100005    1   tcp  20048  mountd</span><br><span class="line">    100005    2   udp  20048  mountd</span><br><span class="line">    100005    2   tcp  20048  mountd</span><br><span class="line">    100005    3   udp  20048  mountd</span><br><span class="line">    100005    3   tcp  20048  mountd</span><br><span class="line">    100003    3   tcp   2049  nfs</span><br><span class="line">    100003    4   tcp   2049  nfs</span><br><span class="line">    100227    3   tcp   2049  nfs_acl</span><br><span class="line">    100003    3   udp   2049  nfs</span><br><span class="line">    100003    4   udp   2049  nfs</span><br><span class="line">    100227    3   udp   2049  nfs_acl</span><br><span class="line">    100021    1   udp  49965  nlockmgr</span><br><span class="line">    100021    3   udp  49965  nlockmgr</span><br><span class="line">    100021    4   udp  49965  nlockmgr</span><br><span class="line">    100021    1   tcp  42359  nlockmgr</span><br><span class="line">    100021    3   tcp  42359  nlockmgr</span><br><span class="line">    100021    4   tcp  42359  nlockmgr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置开机自启</span></span><br><span class="line">[root@nfs01 ~]# systemctl <span class="built_in">enable</span> rpcbind nfs</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/nfs-server.service to /usr/lib/systemd/system/nfs-server.service.</span><br></pre></td></tr></table></figure>




<p><code>命令格式：/data 192.168.168.1.0/24(rw)</code></p>
<blockquote>
<p>注意：挂载目录和 ip 之间有空格，ip 和括号之间没有空格</p>
</blockquote>
<p><img src="/images/202403291247408.png"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改nfs配置文件</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line">/data 192.168.1.0/24(rw)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装完成后，会自动生成一个默认用户</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">id</span> nfsnobody</span><br><span class="line">uid=65534(nfsnobody) gid=65534(nfsnobody) <span class="built_in">groups</span>=65534(nfsnobody)</span><br><span class="line"></span><br><span class="line"><span class="comment">##此时不要重启nfs，还没有创建共享目录</span></span><br><span class="line"><span class="comment">###创建目录，修改用户和组</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">mkdir</span> /data</span><br><span class="line">[root@nfs01 ~]# <span class="built_in">chown</span> -R nfsnobody.nfsnobody /data/</span><br><span class="line">[root@nfs01 ~]# ll -d /data/</span><br><span class="line">drwxr-xr-x 2 nfsnobody nfsnobody 6 Aug 22 19:41 /data/</span><br><span class="line"></span><br><span class="line">[root@nfs01 ~]# systemctl restart nfs</span><br><span class="line"></span><br><span class="line"><span class="comment">## 加ip查看指定ip下是否有共享目录</span></span><br><span class="line"><span class="comment">## 不加ip查看当前机器下有没有共享目录</span></span><br><span class="line">[root@nfs01 ~]# showmount -e 192.168.1.40</span><br><span class="line">Export list <span class="keyword">for</span> 192.168.1.40:</span><br><span class="line">/data 192.168.1.0/24</span><br><span class="line">[root@nfs01 ~]# showmount -e </span><br><span class="line">Export list <span class="keyword">for</span> nfs01:</span><br><span class="line">/data 192.168.1.0/24</span><br></pre></td></tr></table></figure>

<p><code>[测试]</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端本地挂载</span></span><br><span class="line">[root@nfs01 ~]# ll /mnt/</span><br><span class="line">total 0</span><br><span class="line">[root@nfs01 ~]# mount -t nfs 192.168.1.40:/data /mnt</span><br><span class="line">[root@nfs01 ~]# <span class="built_in">touch</span> /mnt/1.txt</span><br><span class="line">[root@nfs01 ~]# ll /mnt/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:46 1.txt</span><br><span class="line">[root@nfs01 ~]# ll /data/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:46 1.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 客户端web01挂载</span></span><br><span class="line">[root@web01 script]# showmount -e 192.168.1.40</span><br><span class="line">Export list <span class="keyword">for</span> 192.168.1.40:</span><br><span class="line">/data 192.168.1.0/24</span><br><span class="line"></span><br><span class="line">[root@web01 script]# mount -t nfs 192.168.1.40:/data /server/bbz</span><br><span class="line">[root@web01 script]# ll -d /server/bbz/</span><br><span class="line">drwxr-xr-x 2 nfsnobody nfsnobody 19 Aug 22 19:46 /server/bbz/</span><br><span class="line"></span><br><span class="line">[root@web01 script]# ll /server/bbz/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:46 1.txt</span><br><span class="line"></span><br><span class="line">[root@web01 script]# <span class="built_in">touch</span> /server/bbz/&#123;2..100&#125;.txt</span><br><span class="line">[root@web01 script]# ll /server/bbz/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 100.txt</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 10.txt</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 11.txt</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 12.txt</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"><span class="comment">## 我们去nfs机器上看看是不是也有</span></span><br><span class="line">[root@nfs01 ~]# ll /data/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 100.txt</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 10.txt</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 11.txt</span><br><span class="line">....</span><br></pre></td></tr></table></figure>



<h1 id="四、服务端参数"><a href="#四、服务端参数" class="headerlink" title="四、服务端参数"></a>四、服务端参数</h1><p><img src="/images/202403291247408.png"></p>
<blockquote>
<p>本节主要讲解最后面的参数（rw、sync….）</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">nfs 服务端，共享参数</th>
<th align="left"></th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">rw</td>
<td align="left">可读写</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">ro</td>
<td align="left">只读&nbsp; read only</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">sync</td>
<td align="left">同步写入</td>
<td align="left">同时将数据写入内存和磁盘中，不会丢失数据</td>
</tr>
<tr>
<td align="left">async</td>
<td align="left">异步写入</td>
<td align="left">优先将数据写入内存，再写入磁盘，效率更高，但可能会丢失数据</td>
</tr>
<tr>
<td align="left">anonuid</td>
<td align="left">anonymous：指定用户uid</td>
<td align="left">指定客户端映射到服务端使用的用户</td>
</tr>
<tr>
<td align="left">anongid</td>
<td align="left">指定用户gid</td>
<td align="left">指定客户端映射到服务端使用的用户组</td>
</tr>
<tr>
<td align="left">root_squash</td>
<td align="left">NFS 客户端以 root 管理员访问时，映射为 NFS 的匿名用户（不常用）</td>
<td align="left">root&nbsp; –&gt; nfsnobody</td>
</tr>
<tr>
<td align="left">no_root_squash</td>
<td align="left">NFS客户端以root访问时，映射为NFS服务端的root用户（不常用）</td>
<td align="left">客户端root&nbsp; –&gt;&nbsp; 服务端root</td>
</tr>
<tr>
<td align="left">all_squash</td>
<td align="left">无论NFS客户端使用什么用户访问，均映射为匿名用户</td>
<td align="left">all –&gt;&nbsp; nfsnobody</td>
</tr>
<tr>
<td align="left">no_all_squash</td>
<td align="left">无论客户端使用什么用户访问，都不进行压缩</td>
<td align="left">all&nbsp; –&gt;&nbsp; all</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nfs挂载，rw与ro</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line">/data/blog 192.168.1.0/24(rw)</span><br><span class="line">/data/rw   192.168.1.0/24(rw)</span><br><span class="line">/data/ro   192.168.1.0/24(ro)</span><br><span class="line"></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">mkdir</span> -p /data/&#123;rw,ro&#125;</span><br><span class="line"></span><br><span class="line">[root@nfs01 ~]# systemctl restart nfs</span><br><span class="line">[root@nfs01 ~]# showmount -e</span><br><span class="line">Export list <span class="keyword">for</span> nfs01:</span><br><span class="line">/data/ro   192.168.1.0/24</span><br><span class="line">/data/rw   192.168.1.0/24</span><br><span class="line">/data/blog 192.168.1.0/24</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 本地挂载一下</span></span><br><span class="line"><span class="comment">### rw正常写入</span></span><br><span class="line">[root@nfs01 ~]# mount -t nfs 192.168.1.40:/data/rw /mnt</span><br><span class="line">[root@nfs01 ~]# <span class="built_in">chown</span> -R nfsnobody.nfsnobody /data</span><br><span class="line">[root@nfs01 ~]# <span class="built_in">touch</span> /mnt/1.txt</span><br><span class="line">[root@nfs01 ~]# ll /mnt/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 25 19:08 1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">### 去掉挂载点</span></span><br><span class="line">[root@nfs01 ~]# umount -v /mnt/</span><br><span class="line">/mnt: nfs4 mount point detected</span><br><span class="line">/mnt: umounted</span><br><span class="line"></span><br><span class="line"><span class="comment">## 挂载ro可读目录，无法写入文件</span></span><br><span class="line">[root@nfs01 ~]# mount -t nfs 192.168.1.40:/data/ro /mnt/</span><br><span class="line">[root@nfs01 ~]# <span class="built_in">touch</span> /mnt/1.txt</span><br><span class="line"><span class="built_in">touch</span>: cannot <span class="built_in">touch</span> ‘/mnt/1.txt’: Read-only file system</span><br></pre></td></tr></table></figure>



<p>[sync 和 async]</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 如果我们不配置，则默认使用sync</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /var/lib/nfs/etab </span><br><span class="line">/data/rw	192.168.1.0/24(rw,<span class="built_in">sync</span>,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=65534,anongid=65534,sec=sys,rw,secure,root_squash,no_all_squash)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除所有数据，进行测试</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">rm</span> -rf /data/rw/*</span><br><span class="line"><span class="comment"># 动态查看目录内容</span></span><br><span class="line">[root@nfs01 ~]# watch <span class="built_in">ls</span> -l /data/rw/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端写入大文件</span></span><br><span class="line">[root@web01 ~]# <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/tmp/big bs=1M count=500</span><br><span class="line">500+0 records <span class="keyword">in</span></span><br><span class="line">500+0 records out</span><br><span class="line">524288000 bytes (524 MB) copied, 5.18806 s, 101 MB/s</span><br><span class="line">[root@web01 ~]# <span class="built_in">cp</span> /tmp/big /mnt/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 你会发现服务端目录下的文件并不是直接全部写入磁盘，而是在慢慢变大</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/202403291249497.png"></p>
<p><img src="/images/202403291250570.png"></p>
<p>[anonuid 和 anongid]</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###  默认使用了自动创建的nfsnobody用户和组</span></span><br><span class="line"><span class="comment">###  anonuid=65534,anongid=65534</span></span><br><span class="line"></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /var/lib/nfs/etab </span><br><span class="line">/data/rw	192.168.1.0/24(rw,<span class="built_in">sync</span>,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=65534,anongid=65534,sec=sys,rw,secure,root_squash,no_all_squash)</span><br></pre></td></tr></table></figure>



<ul>
<li>用户压缩</li>
<li>默认：root_squash, no_all_squash</li>
</ul>
<p><img src="/images/202403291250686.png"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## nfs默认的设置，当客户端使用root访问时压缩为匿名用户</span></span><br><span class="line"><span class="comment">## 其他用户访问时，不进行压缩</span></span><br><span class="line">/data/rw	192.168.1.0/24(rw,<span class="built_in">sync</span>,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=65534,anongid=65534,sec=sys,rw,secure,root_squash,no_all_squash)</span><br><span class="line"></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line">/data/blog 192.168.1.0/24(rw)</span><br><span class="line">/data/rw   192.168.1.0/24(rw)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 其他用户只有访问权限，没有写权限</span></span><br><span class="line">[zzz@web01 ~]$ <span class="built_in">touch</span> /mnt/3.txt</span><br><span class="line"><span class="built_in">touch</span>: cannot <span class="built_in">touch</span> ‘/mnt/3.txt’: Permission denied</span><br><span class="line">[zzz@web01 ~]$ ll /mnt/</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 25 22:00 1.txt</span><br><span class="line">-rw-rw-r-- 1 nfsnobody nfsnobody 0 Aug 25 22:00 2.txt</span><br></pre></td></tr></table></figure>


<ul>
<li><strong>all_squash</strong> （常用）</li>
<li>不论什么用户都进行压缩<br><img src="/images/202403291251648.png"></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 客户端使用root用户创建文件</span></span></span><br><span class="line">[root@nfs01 ~]# touch /mnt/1.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务端查看创建的文件uid、gid，会发现被压缩了</span></span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 25 22:00 1.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 客户端使用普通用户创建文件</span></span></span><br><span class="line">[root@nfs01 ~]# su - zzz</span><br><span class="line">[zzz@nfs01 ~]$ touch /mnt/2.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 服务端查看</span></span></span><br><span class="line">-rw-rw-r-- 1 nfsnobody nfsnobody 0 Aug 25 22:00 2.txt</span><br></pre></td></tr></table></figure>


<ul>
<li><strong>all_squash, anonuid+anongid</strong> （常用）</li>
<li>压缩为指定用户，防止一些用户权限问题</li>
</ul>
<p><img src="/images/202403291252397.png"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端、客户端创建指定用户</span></span><br><span class="line">groupadd -g 888 www</span><br><span class="line">useradd -s /sbin/nologin -M -u 888 -g 888 www</span><br><span class="line"><span class="built_in">id</span> www</span><br><span class="line">uid=888(www) gid=888(www) <span class="built_in">groups</span>=888(www)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置共享目录为指定用户，否则客户端没有写入权限</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">chown</span> -R www.www /data/rw</span><br><span class="line">[root@nfs01 ~]# ll -d /data/rw</span><br><span class="line">drwxr-xr-x 2 www www 32 Aug 25 22:00 /data/rw</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line">/data/blog 192.168.1.0/24(rw)</span><br><span class="line">/data/rw   192.168.1.0/24(rw,all_squash,anonuid=888,anongid=888)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 测试</span></span><br><span class="line">[root@web01 ~]# <span class="built_in">touch</span> /mnt/q.txt</span><br><span class="line">[root@web01 ~]# su - zzz</span><br><span class="line">Last login: Fri Aug 25 22:43:04 CST 2023 on pts/0</span><br><span class="line">[zzz@web01 ~]$ <span class="built_in">touch</span> /mnt/as.txt</span><br><span class="line"></span><br><span class="line">[root@nfs01 ~]# ll  /data/rw</span><br><span class="line">-rw-rw-r-- 1 www www 0 Aug 25 22:46 as.txt</span><br><span class="line">-rw-r--r-- 1 www www 0 Aug 25 22:46 q.txt</span><br></pre></td></tr></table></figure>




<h1 id="五、客户端挂载参数"><a href="#五、客户端挂载参数" class="headerlink" title="五、客户端挂载参数"></a>五、客户端挂载参数</h1><ul>
<li>客户端挂载：mount 命令</li>
<li>挂载信息文件路径：&#x2F;proc&#x2F;mounts</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 ~]# grep 192.168.1.40 /proc/mounts </span><br><span class="line">192.168.1.40:/data/rw /mnt nfs4 rw,relatime,vers=4.1,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.1.20,local_lock=none,addr=192.168.1.40 0 0</span><br></pre></td></tr></table></figure>


<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">-t</td>
<td align="left">指定文件系统类型</td>
<td align="left">本地：xfs、ext4&#x2F;ext3<div>远程：nfs 等等</div></td>
</tr>
<tr>
<td align="left">-o</td>
<td align="left">指定挂载详细参数</td>
<td align="left"></td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#有时候卸载共享目录会出现卡住和报错，我们可以使用 `-lf` 参数强制卸载 </span></span><br><span class="line">[root@web01 ~]# umount -lf /mnt/</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nfs客户端挂载时，可以使用 `-o`将可读写目录挂载为只读</span></span><br><span class="line"><span class="comment">## ro 则为只读</span></span><br><span class="line">[root@web01 ~]# mount -t nfs -o ro 192.168.1.40:/data/rw /mnt</span><br><span class="line">[root@web01 ~]# <span class="built_in">df</span> -h</span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs                 898M     0  898M   0% /dev</span><br><span class="line">tmpfs                    910M     0  910M   0% /dev/shm</span><br><span class="line">tmpfs                    910M  9.6M  901M   2% /run</span><br><span class="line">tmpfs                    910M     0  910M   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root   17G  7.2G  9.9G  43% /</span><br><span class="line">/dev/sda1               1014M  151M  864M  15% /boot</span><br><span class="line">tmpfs                    182M     0  182M   0% /run/user/0</span><br><span class="line">192.168.1.40:/data/rw     17G  1.9G   16G  11% /mnt</span><br><span class="line"></span><br><span class="line">[root@web01 ~]# grep 192.168.1.40 /proc/mounts </span><br><span class="line">192.168.1.40:/data/rw /mnt nfs4 ro,relatime,vers=4.1,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.1.20,local_lock=none,addr=192.168.1.40 0 0</span><br><span class="line"></span><br><span class="line">[root@web01 ~]# <span class="built_in">ls</span> /mnt/</span><br><span class="line">as.txt  q.txt</span><br><span class="line">[root@web01 ~]# <span class="built_in">touch</span> /mnt/3.txt</span><br><span class="line"><span class="built_in">touch</span>: cannot <span class="built_in">touch</span> ‘/mnt/3.txt’: Read-only file system</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 将上面的ro修改为rw</span></span><br><span class="line">[root@web01 ~]# mount -o rw,remount /mnt</span><br><span class="line">[root@web01 ~]# grep 192.168.1.40 /proc/mounts </span><br><span class="line">192.168.1.40:/data/rw /mnt nfs4 rw,relatime,vers=4.1,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.1.20,local_lock=none,addr=192.168.1.40 0 0</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>故障案例：</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 背景：以为内一些原因磁盘故障，整个磁盘（文件系统）变为只读模式，报错为：Read-only file system</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排查：查询具体是哪个分区变为只读，例如/mnt分区只读</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解决：mount -o  rw,remount /mnt</span></span><br></pre></td></tr></table></figure>

</li>
<li><p><code>永久挂载</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我们现在使用命令挂载，都是临时的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法1: 写入/etc/rc.local</span></span><br><span class="line"><span class="comment">## 注意：/etc/rc.d/rc.local必须有执行权限 chown +x</span></span><br><span class="line">[root@web01 ~]# <span class="built_in">chmod</span> +x /etc/rc.d/rc.local </span><br><span class="line">[root@web01 ~]# ll /etc/rc.d/rc.local </span><br><span class="line">-rwxr-xr-x. 1 root root 473 Oct  2  2020 /etc/rc.d/rc.local</span><br><span class="line">[root@web01 ~]# <span class="built_in">tail</span> -1 /etc/rc.local </span><br><span class="line">mount -t nfs -o rw 192.168.1.40:/data/rw /mnt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法2：写入/etc/fstab里</span></span><br><span class="line">[root@web01 ~]# <span class="built_in">tail</span> -1 /etc/fstab </span><br><span class="line"><span class="comment"># 远程共享目录ip+路径    #本地挂载目录  #挂载文件系统类型  #参数（以后可以写rw等等） #0 0</span></span><br><span class="line">192.168.1.40:/data/rw  /code/blog  nfs defaults 0 0</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="六、-NFS-存储小结"><a href="#六、-NFS-存储小结" class="headerlink" title="六、 NFS 存储小结"></a>六、 NFS 存储小结</h1><h2 id="1-NFS-存储优点"><a href="#1-NFS-存储优点" class="headerlink" title="1. NFS 存储优点"></a>1. NFS 存储优点</h2><ul>
<li>01：NFS 文件系统简单易用、方便部署、数据可靠、服务稳定，适合中小型企业</li>
<li>02：NFS 文件系统内存放的数据都在文件系统之上，所有数据都看得见</li>
</ul>
<h2 id="2-NFS-存储局限"><a href="#2-NFS-存储局限" class="headerlink" title="2. NFS 存储局限"></a>2. NFS 存储局限</h2><ul>
<li>01：存在单点故障，如果构建高可用维护麻烦</li>
<li>02：NFS 数据明文，并不对数据做任何校验</li>
<li>03：客户端挂载 NFS 服务没有密码验证，安全性一般（只推荐内网使用）</li>
</ul>
<h2 id="3-NFS-应用建议"><a href="#3-NFS-应用建议" class="headerlink" title="3. NFS 应用建议"></a>3. NFS 应用建议</h2><ul>
<li>01：生产场景应将静态数据尽可能往前端推，减少后端压力</li>
<li>02：必须将存储里的静态资源通过 CDN 缓存（jpg|png|mp4|css|js）</li>
<li>03：如果没有缓存或架构本身历史遗留问题太大，再多存储也没用</li>
</ul>
<h1 id="七、优化设置"><a href="#七、优化设置" class="headerlink" title="七、优化设置"></a>七、优化设置</h1><h2 id="a-安全优化-（掌握）"><a href="#a-安全优化-（掌握）" class="headerlink" title="a.安全优化 （掌握）"></a>a.安全优化 （掌握）</h2><blockquote>
<p>客户端挂载时选择一些优化参数</p>
<ul>
<li>nosuid</li>
<li>nodev</li>
<li>noexec</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">suid<div>nosuid</div></td>
<td align="left">当挂载的文件系统上有 SUID 的程序时，只要使用 nosuid 就能取消设置 SUID 的功能</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">rw<div>ro</div></td>
<td align="left">可以指定文件系统是只读（ro）或读写（rw）</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">dev<div>nodev</div></td>
<td align="left">是否可以保留某些文件的特殊功能</td>
<td align="left">一般来说只有&#x2F;dev 才有特殊的文件，因此可以选择 nodev</td>
</tr>
<tr>
<td align="left">exec<div>noexec</div></td>
<td align="left">是否具有执行文件的权限</td>
<td align="left">如果挂载的只是普通文件（图片、视频、…）那么可以选择 noexec</td>
</tr>
<tr>
<td align="left">user<div>nouser</div></td>
<td align="left">是否允许用户进行文件的挂载与卸载功能</td>
<td align="left">如果要保护文件系统，最好不要提供用户进行挂载与卸载，可以选择 nouser</td>
</tr>
<tr>
<td align="left">auto<div>noauto</div></td>
<td align="left">这个 auto 指的是 <code>mount -a</code> 时会不会被挂载的项目</td>
<td align="left">如果不需要某个分区随时被挂载，可以设置为 noauto<div>例如：&#x2F;etc&#x2F;fstab&nbsp; auto</div></td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<h2 id="b-性能优化-了解"><a href="#b-性能优化-了解" class="headerlink" title="b. 性能优化 (了解)"></a>b. 性能优化 (了解)</h2><table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">rsize<div>wsize</div></td>
<td align="left">设置读（rsize）与写入（wsize）的区块大小（block size）</td>
<td align="left">这个值可以影响客户端与服务端传输数据的缓冲存储量，一般来说如果在局域网内，并且客户端与服务端都有足够的内存，可以设置的大一点，比如 65535，提升缓冲区可提升 nfs 文件系统的传输能力，但设置的不能太大，最好以网络能够传输的最大值为限</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## rsize=131072,wsize=131072</span></span><br><span class="line">[root@web01 ~]# grep 192.168.1.40 /proc/mounts </span><br><span class="line">192.168.1.40:/data/rw /mnt nfs4 rw,relatime,vers=4.1,rsize=131072,wsize=131072,n168.1.20,local_lock=none,addr=192.168.1.40 0 0</span><br></pre></td></tr></table></figure>

<h2 id="c-内核参数优化"><a href="#c-内核参数优化" class="headerlink" title="c. 内核参数优化"></a>c. 内核参数优化</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 ~]# <span class="built_in">cat</span> /proc/sys/net/core/rmem_max </span><br><span class="line">212992</span><br><span class="line">[root@web01 ~]# <span class="built_in">cat</span> /proc/sys/net/core/rmem_default </span><br><span class="line">212992</span><br><span class="line">[root@web01 ~]# <span class="built_in">cat</span> /proc/sys/net/core/wmem_default </span><br><span class="line">212992</span><br><span class="line">[root@web01 ~]# <span class="built_in">cat</span> /proc/sys/net/core/wmem_max </span><br><span class="line">212992</span><br></pre></td></tr></table></figure>

<ul>
<li>上述文件如何修改内容，命令如下：<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt;/etc/sysctl.conf&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">net.core.wmem_default = 8388608</span></span><br><span class="line"><span class="string">net.core.rmem_default = 8388608</span></span><br><span class="line"><span class="string">net.core.rmem_max = 16777216</span></span><br><span class="line"><span class="string">net.core.wmem_max = 16777216</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##加载配置文件</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="八、优化小结"><a href="#八、优化小结" class="headerlink" title="八、优化小结"></a>八、优化小结</h1><table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">rsize<div>wsize</div></td>
<td align="left">设置读（rsize）与写入（wsize）的区块大小（block size）</td>
<td align="left">这个值可以影响客户端与服务端传输数据的缓冲存储量，一般来说如果在局域网内，并且客户端与服务端都有足够的内存，可以设置的大一点，比如 65535，提升缓冲区可提升 nfs 文件系统的传输能力，但设置的不能太大，最好以网络能够传输的最大值为限</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<ul>
<li>添加硬件（最简单）：sas&#x2F;ssd 硬盘，买多块组成 raid，制作 raid5 或 raid10.</li>
<li>NFS 服务器端配置<ul>
<li>&#x2F;data xxxx&#x2F;24 (rw, sync, all_squash, anonuid&#x3D;65534, anongid&#x3D;65534)  xxxx&#x2F;24</li>
</ul>
</li>
<li>NFS 客户端挂载命令优化：<ul>
<li>mount -t nfs -o <span style="background:rgba(28, 210, 16, 0.55)">nosuid,noexec,nodev</span>,<span style="background:#40a9ff">noatime,nodiratime,rsize&#x3D;131072,wsize&#x3D;131072</span>  192.168.1.40&#x2F;24:&#x2F;data &#x2F;mnt</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nosuid，noexec，nodev：安全相关选项</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">noatime，nodiratime，rsize，wsize：性能选项</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#noatime，nodiratime：时间相关</span></span></span><br><span class="line">1、关于文件的几个时间</span><br><span class="line"></span><br><span class="line">我们通过stat命令查看文件的信息，</span><br><span class="line"></span><br><span class="line">[root@CentOS-6-5 /home]# stat a</span><br><span class="line">  File: `a</span><br><span class="line">  Size: 12552     	Blocks: 32         IO Block: 4096   regular file</span><br><span class="line">Device: 802h/2050d	Inode: 1177548     Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2019-10-23 16:54:55.259130660 +0800</span><br><span class="line">Modify: 2019-10-23 16:54:55.259130660 +0800</span><br><span class="line">Change: 2019-10-23 16:54:55.259130660 +0800</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">其中有三个时间，</span><br><span class="line">access：文件上次被读取的时间，文件被读取，执行，打开都会触发更新</span><br><span class="line">modify：文件上次被修改的时间，</span><br><span class="line">change：文件上次权限属主被修改的时间</span><br><span class="line"></span><br><span class="line">2、noatime选项</span><br><span class="line"></span><br><span class="line">对于文件系统，有时候为了提供性能，会设置noatime选项，这个选项的意思是不更新文件的access时间。所以在读取、打开、执行文件时都不会修改，这在一定程度上就降低了系统的IO，尤其是对于读取居多的服务器。</span><br><span class="line"></span><br><span class="line">未设置noatime</span><br><span class="line"></span><br><span class="line">[root@CentOS-6-5 /home]# mount | grep sda2</span><br><span class="line">/dev/sda2 on / type ext4 (rw)</span><br><span class="line">[root@CentOS-6-5 /home]# stat a</span><br><span class="line">  File: `a</span><br><span class="line">  Size: 6         	Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: 802h/2050d	Inode: 1177548     Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2019-10-23 16:54:55.259130660 +0800</span><br><span class="line">Modify: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line">Change: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line">[root@CentOS-6-5 /home]# cat a</span><br><span class="line">hello</span><br><span class="line">[root@CentOS-6-5 /home]# stat a</span><br><span class="line">  File: `a</span><br><span class="line">  Size: 6         	Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: 802h/2050d	Inode: 1177548     Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2019-10-26 22:25:14.722556455 +0800</span><br><span class="line">Modify: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line">Change: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">此时文件系统未设置noatime，读取文件后，文件的access时间发生更新。</span><br><span class="line"></span><br><span class="line">现在我们通过remount添加noatime选项，</span><br><span class="line"></span><br><span class="line">[root@CentOS-6-5 /home]# mount -o remount,noatime /dev/sda2</span><br><span class="line">[root@CentOS-6-5 /home]# mount  | grep sda2</span><br><span class="line">/dev/sda2 on / type ext4 (rw,noatime)</span><br><span class="line">[root@CentOS-6-5 /home]# stat a</span><br><span class="line">  File: `a</span><br><span class="line">  Size: 6         	Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: 802h/2050d	Inode: 1177548     Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2019-10-26 22:25:14.722556455 +0800</span><br><span class="line">Modify: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line">Change: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line">[root@CentOS-6-5 /home]# cat a</span><br><span class="line">hello</span><br><span class="line">[root@CentOS-6-5 /home]# stat a</span><br><span class="line">  File: `a</span><br><span class="line">  Size: 6         	Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: 802h/2050d	Inode: 1177548     Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2019-10-26 22:25:14.722556455 +0800</span><br><span class="line">Modify: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line">Change: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">可见，添加noatime后，执行同样的读取文件操作，文件的access时间并没有更新，因此就可以节约大量的IO，提供系统性能。</span><br><span class="line"></span><br><span class="line">3、nodiratime选项</span><br><span class="line"></span><br><span class="line">noatime是对于文件而言，那对于目录呢。其实在linux上，目录也是一种文件，毕竟在 linux上everything is a file。因此当设置noatime时，对于目录也是一样的效果。如果想要单独对目录有此效果，就可以使用nodiratime。因此noatime设置后，就无需再设置nodiratime。</span><br></pre></td></tr></table></figure>

<ul>
<li>如果<span style="background:rgba(28, 210, 16, 0.55)">卸载</span>的时候提示“umount &#x2F;mnt: device is busy”<ul>
<li>需要退出挂载目录再进行卸载</li>
<li>如果是 NFS 服务端宕机，需要强制卸载，<code>umount -lf /mnt </code></li>
</ul>
</li>
<li>大型网站 NFS 网络文件系统的替代软件为&#x3D;&#x3D;分布式文件系统&#x3D;&#x3D;Moosefs（MFS），GlusterFS (大文件)、FastDFS.</li>
</ul>
<h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><h2 id="1-重启后无敌时间"><a href="#1-重启后无敌时间" class="headerlink" title="1. 重启后无敌时间"></a>1. 重启后无敌时间</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在我们使用restart重启nfs后，默认会有90秒的无敌时间，此时客户端挂载会卡住无法操作</span></span><br><span class="line"><span class="comment">## 解决：使用reload加载配置文件：systemctl reload nfs</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端重启nfs</span></span><br><span class="line">[root@nfs01 ~]# systemctl restart nfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端进行挂载会处于等待状态</span></span><br><span class="line">[root@web01 ~]# mount -t nfs 192.168.1.40:/data/ro /mnt/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@web01 ~]# </span><br></pre></td></tr></table></figure>

<p><img src="/images/202403291252635.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://mettafy.github.io">Metta</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://mettafy.github.io/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%AD%98%E5%82%A8/02-NFS%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1/">https://mettafy.github.io/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%AD%98%E5%82%A8/02-NFS%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mettafy.github.io" target="_blank">DevOps</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%96%87%E6%A1%A3/">文档</a><a class="post-meta__tags" href="/tags/%E5%9F%BA%E7%A1%80/">基础</a></div><div class="post_share"><div class="social-share" data-image="/img/touxiang.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%AD%98%E5%82%A8/01-Rsync%E5%A4%87%E4%BB%BD/" title="Rsync备份服务"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Rsync备份服务</div></div></a></div><div class="next-post pull-right"><a href="/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1/Openssh/" title="OpenSSH远程服务"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">OpenSSH远程服务</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/07/29/Linux%E5%9F%BA%E7%A1%80/Linux%E5%9F%BA%E7%A1%80/" title="Linux基础"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-30</div><div class="title">Linux基础</div></div></a></div><div><a href="/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%AD%98%E5%82%A8/01-Rsync%E5%A4%87%E4%BB%BD/" title="Rsync备份服务"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-30</div><div class="title">Rsync备份服务</div></div></a></div><div><a href="/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1/Openssh/" title="OpenSSH远程服务"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-30</div><div class="title">OpenSSH远程服务</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/touxiang.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Metta</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Mettafy/mettafy.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81nfs-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">一、nfs 概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81nfs-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">二、nfs 的工作原理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%AE%9E%E6%88%98"><span class="toc-number">3.</span> <span class="toc-text">三、实战</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%82%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">四、服务端参数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8C%82%E8%BD%BD%E5%8F%82%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">五、客户端挂载参数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81-NFS-%E5%AD%98%E5%82%A8%E5%B0%8F%E7%BB%93"><span class="toc-number">6.</span> <span class="toc-text">六、 NFS 存储小结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-NFS-%E5%AD%98%E5%82%A8%E4%BC%98%E7%82%B9"><span class="toc-number">6.1.</span> <span class="toc-text">1. NFS 存储优点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-NFS-%E5%AD%98%E5%82%A8%E5%B1%80%E9%99%90"><span class="toc-number">6.2.</span> <span class="toc-text">2. NFS 存储局限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-NFS-%E5%BA%94%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">6.3.</span> <span class="toc-text">3. NFS 应用建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E4%BC%98%E5%8C%96%E8%AE%BE%E7%BD%AE"><span class="toc-number">7.</span> <span class="toc-text">七、优化设置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#a-%E5%AE%89%E5%85%A8%E4%BC%98%E5%8C%96-%EF%BC%88%E6%8E%8C%E6%8F%A1%EF%BC%89"><span class="toc-number">7.1.</span> <span class="toc-text">a.安全优化 （掌握）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#b-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E4%BA%86%E8%A7%A3"><span class="toc-number">7.2.</span> <span class="toc-text">b. 性能优化 (了解)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#c-%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96"><span class="toc-number">7.3.</span> <span class="toc-text">c. 内核参数优化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E4%BC%98%E5%8C%96%E5%B0%8F%E7%BB%93"><span class="toc-number">8.</span> <span class="toc-text">八、优化小结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">9.</span> <span class="toc-text">注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%87%8D%E5%90%AF%E5%90%8E%E6%97%A0%E6%95%8C%E6%97%B6%E9%97%B4"><span class="toc-number">9.1.</span> <span class="toc-text">1. 重启后无敌时间</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%AD%98%E5%82%A8/01-Rsync%E5%A4%87%E4%BB%BD/" title="Rsync备份服务">Rsync备份服务</a><time datetime="2024-07-29T16:10:00.000Z" title="发表于 2024-07-30 00:10:00">2024-07-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%AD%98%E5%82%A8/02-NFS%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1/" title="NFS存储">NFS存储</a><time datetime="2024-07-29T16:10:00.000Z" title="发表于 2024-07-30 00:10:00">2024-07-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1/Openssh/" title="OpenSSH远程服务">OpenSSH远程服务</a><time datetime="2024-07-29T16:00:20.000Z" title="发表于 2024-07-30 00:00:20">2024-07-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/29/Linux%E5%9F%BA%E7%A1%80/Linux%E5%9F%BA%E7%A1%80/" title="Linux基础">Linux基础</a><time datetime="2024-07-29T16:00:00.000Z" title="发表于 2024-07-30 00:00:00">2024-07-30</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v7.3.0" title=""><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.13.0" title=""><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="/js/bottom.js"></script><!-- hexo injector body_end end --></body></html>