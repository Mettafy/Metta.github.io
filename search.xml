<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Rsync备份服务</title>
      <link href="/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%AD%98%E5%82%A8/01-Rsync%E5%A4%87%E4%BB%BD/"/>
      <url>/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%AD%98%E5%82%A8/01-Rsync%E5%A4%87%E4%BB%BD/</url>
      
        <content type="html"><![CDATA[<p><img src="https://jsd.cdn.zzko.cn/gh/Tripitz/Markdown-img@main/Rsync+NFS/202403281337589.png" alt="服务使用流程"></p><h1 id="0-配置文件详解"><a href="#0-配置文件详解" class="headerlink" title="0. 配置文件详解"></a>0. 配置文件详解</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@backup01 ~]# <span class="built_in">cat</span> /etc/rsyncd.conf </span><br><span class="line"><span class="comment">###全局配置</span></span><br><span class="line">fake super = <span class="built_in">yes</span>  </span><br><span class="line">uid = rsync   </span><br><span class="line">gid = rsync   </span><br><span class="line">use <span class="built_in">chroot</span> = no   </span><br><span class="line">max connections = 2000</span><br><span class="line"><span class="built_in">timeout</span> = 600</span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">lock file = /var/run/rsync.lock</span><br><span class="line"></span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log</span><br><span class="line">ignore errors</span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span></span><br><span class="line">list = <span class="literal">false</span></span><br><span class="line">hosts allow = x.x.x.x/24</span><br><span class="line">hosts deny = x.x.x.x/32</span><br><span class="line">auth <span class="built_in">users</span> = rsync_backup</span><br><span class="line">secrets file = /etc/rsync.password</span><br><span class="line"></span><br><span class="line"><span class="comment">### 局部配置（模块）</span></span><br><span class="line">[xxxx]</span><br><span class="line">comment = xxxx</span><br><span class="line">path = /xxx</span><br></pre></td></tr></table></figure><table><thead><tr><th>全局配置</th><th>含义</th></tr></thead><tbody><tr><td>fake super</td><td>不开启，则 centos7 传输报错<br>（伪装成 root 权限）</td></tr><tr><td>uid</td><td>rsync 运行时所有者</td></tr><tr><td>gid</td><td>rsync 运行时所属组</td></tr><tr><td>use chroot</td><td>实现额外的安全防护，一般不开启</td></tr><tr><td>max connections</td><td>最大连接数</td></tr><tr><td>timeout</td><td>连接超时时间</td></tr><tr><td>pid file</td><td>pid 文件存放目录</td></tr><tr><td>lock file</td><td>进程&#x2F;服务的锁文件，防止重复运行</td></tr><tr><td>log file</td><td>rsync 服务端日志</td></tr><tr><td>ignore errors</td><td>忽略一些错误（IO 错误）</td></tr><tr><td>read only</td><td>可以进行读写</td></tr><tr><td>list</td><td>关闭 rsync 服务端列表功能</td></tr><tr><td>hosts allow</td><td>允许哪个 ip 或网段访问，白名单</td></tr><tr><td>hosts deny</td><td>拒绝某个 ip 或网段访问，黑名单</td></tr><tr><td>auth users</td><td>rsync 服务端用于验证的用户</td></tr><tr><td>secrets file</td><td>rsync 服务端用于验证的密码文件</td></tr></tbody></table><table><thead><tr><th>局部（模块）</th><th>含义</th></tr></thead><tbody><tr><td>[xxxx]</td><td>模块名字，用户访问服务端时指定</td></tr><tr><td>comment</td><td>注释说明</td></tr><tr><td>path</td><td>模块对应的目录</td></tr></tbody></table><h1 id="1-备份服务概述"><a href="#1-备份服务概述" class="headerlink" title="1.   备份服务概述"></a>1.   备份服务概述</h1><ul><li>备份服务：rsyncd 服务，可以在不同主机之间传输数据</li><li>特点：<ul><li>rsync 是个服务也是命令</li><li>使用方便，具有多种模式（本地模式、远程模式、守护进程模式）</li><li>传输数据时使用的是增量传输</li></ul></li></ul><blockquote><p>增量与全量：</p><ul><li><p>全量：无论多少数据，旧的数据与新的数据 <code>全部</code> 推送到指定主机（例如 scp）</p></li><li><p>增量：第一次全量备份，之后只会把 <code>修改、新建</code> 的数据推送到指定主机（例如 rsync）</p></li></ul></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将/etc/sysconfig/ 推送到目标主机的/mnt/下</span></span><br><span class="line"></span><br><span class="line">全量（通过scp）：</span><br><span class="line">scp -r /etc/sysconfig/  root@192.168.1.103:/mnt</span><br><span class="line"><span class="comment">## 传输结果不展示</span></span><br><span class="line">结论：无论源数据与目标数据是否重复，依旧是全部推送</span><br><span class="line"></span><br><span class="line">增量（通过rsync）:</span><br><span class="line"><span class="comment"># 第一次传输时由于目标无文件，所以是全量推送</span></span><br><span class="line">rsync -avz /etc/sysconfig/ root@192.168.1.103:/mnt</span><br><span class="line">root@192.168.1.103 password: </span><br><span class="line">sending incremental file list</span><br><span class="line">./</span><br><span class="line">anaconda</span><br><span class="line">authconfig</span><br><span class="line">chronyd</span><br><span class="line">cpupower</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二次传输，有重复文件且无新文件，则没有推送任何文件到指定主机</span></span><br><span class="line">rsync -avz /etc/sysconfig/ root@192.168.1.103:/mnt</span><br><span class="line">root@192.168.1.103 password: </span><br><span class="line">sending incremental file list</span><br><span class="line"></span><br><span class="line">sent 1,340 bytes  received 16 bytes  542.40 bytes/sec</span><br><span class="line">total size is 169,720  speedup is 125.16</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="2-Rsync-企业应用场景"><a href="#2-Rsync-企业应用场景" class="headerlink" title="2.  Rsync 企业应用场景"></a>2.  Rsync 企业应用场景</h1><table><thead><tr><th>应用场景</th><th>应用建议</th></tr></thead><tbody><tr><td>rsync 作为命令使用</td><td>临时拉取、推送数据。（可以使用 scp 代替）</td></tr><tr><td><code>定时备份：rsync服务+定时任务</code></td><td>定时备份。（案例：定时任务进行备份+rsync 推送备份）</td></tr><tr><td>实时同步：rsync 服务+sersync&#x2F;lsyncd</td><td>解决存储服务单点问题</td></tr><tr><td>rsync 服务进行异地容灾</td><td>通过 rsync 将备份推送到异地</td></tr></tbody></table><blockquote><p>单点问题：一个服务只有 1 个节点，一旦出问题，该服务将无法使用</p></blockquote><h1 id="3-推送与拉取的区别"><a href="#3-推送与拉取的区别" class="headerlink" title="3. 推送与拉取的区别"></a>3. 推送与拉取的区别</h1><blockquote><p>两者之间的区别在于：进行的什么操作</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 推送</span></span><br><span class="line">[root@backup01 ~]# rsync /etc/hostname 192.168.1.103:/root/</span><br><span class="line">root@192.168.1.103 password: </span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取</span></span><br><span class="line">[root@backup01 ~]# rsync 192.168.1.103:/etc/hostname .</span><br><span class="line">root@192.168.1.103 password: </span><br><span class="line">[root@backup01 ~]# <span class="built_in">ls</span></span><br><span class="line">hostname</span><br><span class="line">[root@backup01 ~]# <span class="built_in">cat</span> hostname </span><br><span class="line">nfs01</span><br></pre></td></tr></table></figure><p><img src="https://jsd.cdn.zzko.cn/gh/Tripitz/Markdown-img@main/Rsync+NFS/202403291244249.png"></p><h1 id="4-应用场景（使用模式）"><a href="#4-应用场景（使用模式）" class="headerlink" title="4.  应用场景（使用模式）"></a>4.  应用场景（使用模式）</h1><table><thead><tr><th>模式</th><th>应用场景</th></tr></thead><tbody><tr><td>本地模式（了解）</td><td>一台机器本地进行传输（不推荐使用）</td></tr><tr><td>远程模式</td><td>两台之间传输数据（临时使用可以使用 scp 代替）</td></tr><tr><td><code>rsync守护进程模式(daemon)</code></td><td>多台之间传输数据 (不需要密码)，用于定时备份、定时同步</td></tr></tbody></table><h2 id="4-1-本地模式（不推荐）"><a href="#4-1-本地模式（不推荐）" class="headerlink" title="4.1  本地模式（不推荐）"></a>4.1  本地模式（不推荐）</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -a 源数据目录  目标数据目录</span><br></pre></td></tr></table></figure><blockquote><p>👺  注意：源数据目录 <code>/etc</code> 和 <code>/etc/</code> 是不同的<br><code>/etc</code>：指的是 etc 目录以及下面的所有文件<br><code>/etc/</code> ：仅指 etc 目录下的文件</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@backup01 ~]# ll /mnt/</span><br><span class="line">total 0</span><br><span class="line"></span><br><span class="line"><span class="comment">## &#x27;/etc&#x27; 把etc目录也复制了</span></span><br><span class="line">[root@backup01 ~]# rsync -a /etc /mnt</span><br><span class="line">[root@backup01 ~]# ll /mnt/</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 75 root root 8192 Mar  6 18:34 etc</span><br><span class="line"></span><br><span class="line"><span class="comment">## 只复制了etc目录下的文件</span></span><br><span class="line">[root@backup01 ~]# rsync -a /etc/ /mnt</span><br><span class="line">[root@backup01 ~]# ll /mnt/</span><br><span class="line">total 1060</span><br><span class="line">-rw-r--r--  1 root root       16 Jul 28  2023 adjtime</span><br><span class="line">-rw-r--r--  1 root root     1529 Apr  1  2020 aliases</span><br><span class="line">-rw-r--r--  1 root root    12288 Jul 28  2023 aliases.db</span><br><span class="line">drwxr-xr-x  2 root root      236 Jul 28  2023 alternatives</span><br><span class="line">-rw-------  1 root root      541 Aug  9  2019 anacrontab</span><br><span class="line">-rw-r--r--  1 root root       55 Aug  8  2019 asound.conf</span><br><span class="line">drwxr-x---  3 root root       43 Jul 28  2023 audisp</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h2 id="4-2-远程模式⭐"><a href="#4-2-远程模式⭐" class="headerlink" title="4.2 远程模式⭐"></a>4.2 远程模式⭐</h2><table><thead><tr><th align="center"></th><th align="left">格式</th><th align="center"></th><th align="center"></th></tr></thead><tbody><tr><td align="center"></td><td align="left">rsync -a</td><td align="center">源文件</td><td align="center">目标</td></tr><tr><td align="center">推送</td><td align="left">rsync</td><td align="center">&#x2F;etc&#x2F;hostname</td><td align="center">192.168.1.103:&#x2F;root</td></tr><tr><td align="center">拉取</td><td align="left">rsync</td><td align="center">192.168.1.103:&#x2F;etc&#x2F;hostname</td><td align="center">&#x2F;root</td></tr></tbody></table><ul><li>简单案例<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 将hostname推送到103的/tmp目录下</span></span><br><span class="line">[root@backup01 ~]# rsync -av /etc/hostname 192.168.1.103:/tmp</span><br><span class="line">sending incremental file list</span><br><span class="line">hostname</span><br><span class="line">sent 103 bytes  received 35 bytes  92.00 bytes/sec</span><br><span class="line">total size is 9  speedup is 0.07</span><br><span class="line"></span><br><span class="line">[root@nfs01 ~]# ll /tmp/</span><br><span class="line">-rw-r--r-- 1 root root  9 Mar  6 18:31 hostname</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 推送/etc 目录及内容 到103的/tmp下</span></span><br><span class="line"><span class="comment">### 第一次推送是全量</span></span><br><span class="line">[root@backup01 ~]# rsync -a /etc 192.168.1.103:/tmp/</span><br><span class="line"></span><br><span class="line">[root@nfs01 tmp]# ll</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 75 root root 8192 Mar  6 18:34 etc</span><br><span class="line"></span><br><span class="line"><span class="comment">### 推送第二次，会发现并未进行推送</span></span><br><span class="line">[root@backup01 ~]# rsync -av /etc 192.168.1.103:/tmp/</span><br><span class="line">sending incremental file list</span><br><span class="line"></span><br><span class="line">sent 45,814 bytes  received 634 bytes  18,579.20 bytes/sec</span><br><span class="line">total size is 28,357,060  speedup is 610.51</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 创建新文件并再次推送</span></span><br><span class="line">[root@backup01 ~]# <span class="built_in">touch</span> /etc/aaa1111111111111 </span><br><span class="line"></span><br><span class="line"><span class="comment">## - 会发现推送了刚创建的新文件</span></span><br><span class="line">[root@backup01 ~]# rsync -av /etc 192.168.1.103:/tmp/</span><br><span class="line">sending incremental file list</span><br><span class="line">etc/</span><br><span class="line">etc/aaa1111111111111</span><br><span class="line"></span><br><span class="line">sent 45,880 bytes  received 648 bytes  31,018.67 bytes/sec</span><br><span class="line">total size is 28,357,060  speedup is 609.46</span><br></pre></td></tr></table></figure><ul><li>上面演示了 rsync 会增量推送，接下来使用 scp 进行推送</li><li>临时传输数据，使用 scp 即可<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@backup01 ~]# scp -r /etc 192.168.1.103:/tmp/</span><br><span class="line">....</span><br><span class="line">fstab                                          100%  465   687.7KB/s   00:00    </span><br><span class="line">crypttab                                       100%    0     0.0KB/s   00:00    </span><br><span class="line">mtab                                           100%    0     0.0KB/s   00:00    </span><br><span class="line">resolv.conf                                    100%   72   127.8KB/s   00:00    </span><br><span class="line">00_header                                      100% 8702    11.5MB/s   00:00    </span><br><span class="line">01_users                                       100%  232   483.5KB/s   00:00    </span><br><span class="line">10_linux                                       100%   11KB  13.0MB/s   00:00    </span><br><span class="line">20_linux_xen                                   100%   10KB  12.5MB/s   00:00    </span><br><span class="line">20_ppc_terminfo                                100% 2559     3.9MB/s   00:00    </span><br><span class="line">30_os-prober                                   100%   11KB  15.4MB/s   00:00    </span><br><span class="line">40_custom                                      100%  214   412.8KB/s   00:00    </span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">👺 <span class="comment">### 会发现，虽然有重复文件，但是scp依旧会全量推送</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="4-3-守护进程模式（daemon）⭐🌟"><a href="#4-3-守护进程模式（daemon）⭐🌟" class="headerlink" title="4.3 守护进程模式（daemon）⭐🌟"></a>4.3 守护进程模式（daemon）⭐🌟</h2><h3 id="a）配置文件内容"><a href="#a）配置文件内容" class="headerlink" title="a）配置文件内容"></a>a）配置文件内容</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###配置文件</span></span><br><span class="line">fake super = <span class="built_in">yes</span>  </span><br><span class="line">uid = rsync   </span><br><span class="line">gid = rsync   </span><br><span class="line">use <span class="built_in">chroot</span> = no   </span><br><span class="line">max connections = 2000</span><br><span class="line"><span class="built_in">timeout</span> = 600</span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">lock file = /var/run/rsync.lock</span><br><span class="line"></span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log</span><br><span class="line">ignore errors</span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span></span><br><span class="line">list = <span class="literal">false</span></span><br><span class="line"><span class="comment">##hosts allow = 192.168.1.0/24</span></span><br><span class="line"><span class="comment">##hosts deny = 192.168.1.0/32</span></span><br><span class="line">auth <span class="built_in">users</span> = rsync_backup</span><br><span class="line">secrets file = /etc/rsync.password</span><br><span class="line"></span><br><span class="line"><span class="comment">#############          </span></span><br><span class="line">[data]</span><br><span class="line">comment = my rsync</span><br><span class="line">path = /data</span><br></pre></td></tr></table></figure><h3 id="b）安装、部署"><a href="#b）安装、部署" class="headerlink" title="b）安装、部署"></a>b）安装、部署</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">01.# 安装</span><br><span class="line">[root@backup01 ~]# yum install rsync</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">Package rsync-3.1.2-12.el7_9.x86_64 already installed and latest version</span><br><span class="line">Nothing to <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">02.## 修改配置文件</span><br><span class="line">[root@backup01 ~]# <span class="built_in">cp</span> /etc/rsyncd.conf /etc/rsyncd.conf.bak</span><br><span class="line"></span><br><span class="line">[root@backup01 ~]# <span class="built_in">cat</span> /etc/rsyncd.conf</span><br><span class="line">fake super = <span class="built_in">yes</span>  </span><br><span class="line">uid = rsync   </span><br><span class="line">gid = rsync   </span><br><span class="line">use <span class="built_in">chroot</span> = no   </span><br><span class="line">max connections = 2000</span><br><span class="line"><span class="built_in">timeout</span> = 600</span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">lock file = /var/run/rsync.lock</span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log</span><br><span class="line">ignore errors</span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span></span><br><span class="line">list = <span class="literal">false</span></span><br><span class="line"><span class="comment">##hosts allow = 192.168.1.0/24</span></span><br><span class="line"><span class="comment">###hosts deny = 192.168.1.0/32</span></span><br><span class="line">auth <span class="built_in">users</span> = rsync_backup</span><br><span class="line">secrets file = /etc/rsync.password</span><br><span class="line"><span class="comment">##############          </span></span><br><span class="line">[data]</span><br><span class="line">comment = my rsync</span><br><span class="line">path = /data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">03.## 部署一些配置</span><br><span class="line"><span class="comment">## 创建用户</span></span><br><span class="line">[root@backup01 ~]# <span class="built_in">id</span> rsync</span><br><span class="line"><span class="built_in">id</span>: rsync: no such user</span><br><span class="line">[root@backup01 ~]# useradd -s /sbin/nologin -M rsync</span><br><span class="line">[root@backup01 ~]# <span class="built_in">id</span> rsync</span><br><span class="line">uid=1000(rsync) gid=1000(rsync) <span class="built_in">groups</span>=1000(rsync)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建验证密码文件，修改权限</span></span><br><span class="line">[root@backup01 ~]# <span class="built_in">echo</span> <span class="string">&#x27;rsync_backup:1&#x27;</span> &gt;/etc/rsync.password</span><br><span class="line">[root@backup01 ~]# <span class="built_in">chmod</span> 600 /etc/rsync.password </span><br><span class="line">[root@backup01 ~]# ll /etc/rsync.password </span><br><span class="line">-rw------- 1 root root 15 Mar  6 22:31 /etc/rsync.password</span><br><span class="line">[root@backup01 ~]# <span class="built_in">cat</span> /etc/rsync.password </span><br><span class="line">rsync_backup:1</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建备份目录，修改所有者和所属组</span></span><br><span class="line">[root@backup01 ~]# <span class="built_in">mkdir</span> /data</span><br><span class="line">[root@backup01 ~]# <span class="built_in">chown</span> -R rsync.rsync /data/</span><br><span class="line">[root@backup01 ~]# ll -d /data/</span><br><span class="line">drwxr-xr-x 2 rsync rsync 6 Mar  6 22:32 /data/</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="c）启动、开机自启"><a href="#c）启动、开机自启" class="headerlink" title="c）启动、开机自启"></a>c）启动、开机自启</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">01.## 启动、开机自启</span><br><span class="line">[root@backup01 ~]# systemctl start rsyncd</span><br><span class="line">[root@backup01 ~]# systemctl status rsyncd</span><br><span class="line">● rsyncd.service - fast remote file copy program daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/rsyncd.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Wed 2024-03-06 22:34:55 CST; 1s ago</span><br><span class="line"> Main PID: 11541 (rsync)</span><br><span class="line">   CGroup: /system.slice/rsyncd.service</span><br><span class="line">           └─11541 /usr/bin/rsync --daemon --no-detach</span><br><span class="line"></span><br><span class="line">Mar 06 22:34:55 backup01 systemd[1]: Started fast remote file copy program daemon.</span><br><span class="line">[root@backup01 ~]# systemctl <span class="built_in">enable</span> rsyncd</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/rsyncd.service to /usr/lib/systemd/system/rsyncd.service.</span><br></pre></td></tr></table></figure><h3 id="d）验证（本地、远程）"><a href="#d）验证（本地、远程）" class="headerlink" title="d）验证（本地、远程）"></a>d）验证（本地、远程）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######### 登录验证   ############</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### ①. 这里使用本机进行验证</span></span><br><span class="line">[root@backup01 ~]# rsync -av  /etc/hostname  rsync_backup@192.168.1.100::data</span><br><span class="line">Password: </span><br><span class="line">sending incremental file list</span><br><span class="line">hostname</span><br><span class="line"></span><br><span class="line">sent 107 bytes  received 43 bytes  9.68 bytes/sec</span><br><span class="line">total size is 9  speedup is 0.06</span><br><span class="line"></span><br><span class="line">[root@backup01 ~]# ll /data/</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 rsync rsync 9 Mar  6 18:31 hostname</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### ②. 远程进行登录验证</span></span><br><span class="line">[root@nfs01 ~]# rsync -avz /etc/hosts rsync_backup@192.168.1.100::data</span><br><span class="line">Password: </span><br><span class="line">sending incremental file list</span><br><span class="line">hosts</span><br><span class="line"></span><br><span class="line">sent 140 bytes  received 43 bytes  122.00 bytes/sec</span><br><span class="line">total size is 158  speedup is 0.86</span><br><span class="line"></span><br><span class="line">[root@backup01 ~]# ll /data/</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 rsync rsync 158 Jun  7  2013 hosts</span><br></pre></td></tr></table></figure><h1 id="5-守护模式补充"><a href="#5-守护模式补充" class="headerlink" title="5. 守护模式补充"></a>5. 守护模式补充</h1><h2 id="5-1-客户端免密码登录"><a href="#5-1-客户端免密码登录" class="headerlink" title="5.1  客户端免密码登录"></a>5.1  客户端免密码登录</h2><blockquote><p>只需要客户端将密码保存到本地即可</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">01. <span class="comment">### 客户端将密码写入空文件内（文件名自己定义）</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">echo</span> <span class="string">&#x27;1&#x27;</span> &gt; /etc/rsync.client</span><br><span class="line"></span><br><span class="line">02. <span class="comment">### 修改权限</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">chmod</span> 600 /etc/rsync.client </span><br><span class="line"></span><br><span class="line">03. <span class="comment">### 传输时使用 &#x27;--password-file&#x27; 参数指定密码文件</span></span><br><span class="line">[root@nfs01 ~]# rsync -avz etc.tar.gz rsync_backup@192.168.1.100::data --password-file=/etc/rsync.client </span><br><span class="line">sending incremental file list</span><br><span class="line">etc.tar.gz</span><br><span class="line"></span><br><span class="line">sent 10,230,350 bytes  received 43 bytes  20,460,786.00 bytes/sec</span><br><span class="line">total size is 10,433,130  speedup is 1.02</span><br><span class="line"></span><br><span class="line">04. <span class="comment">### 服务端查看文件是否成功</span></span><br><span class="line">[root@backup01 ~]# ll /data/</span><br><span class="line">total 10200</span><br><span class="line">-rw-r--r-- 1 rsync rsync 10433130 Mar  7 17:15 etc.tar.gz</span><br><span class="line">-rw-r--r-- 1 rsync rsync        9 Mar  6 18:31 hostname</span><br><span class="line">-rw-r--r-- 1 rsync rsync      158 Jun  7  2013 hosts</span><br></pre></td></tr></table></figure><h2 id="5-2-访问控制-安全措施"><a href="#5-2-访问控制-安全措施" class="headerlink" title="5.2  访问控制-安全措施"></a>5.2  访问控制-安全措施</h2><ul><li><p>hosts allow：只允许某个 ip 或网段访问</p></li><li><p>hosts deny：拒绝某个 ip 或网段访问</p></li><li><p>案例：只允许 10.0.0.0&#x2F;24 网段访问</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@backup01 ~]# grep <span class="string">&#x27;hosts allow&#x27;</span> /etc/rsyncd.conf</span><br><span class="line">hosts allow = 10.0.0.0/24</span><br><span class="line"></span><br><span class="line">[root@backup01 ~]# systemctl restart rsyncd</span><br><span class="line"></span><br><span class="line"><span class="comment">### 此时客户端访问，会直接报错</span></span><br><span class="line">[root@nfs01 ~]# rsync -avz etc.tar.gz rsync_backup@192.168.1.100::data --password-file=/etc/rsync.client </span><br><span class="line">@ERROR: Unknown module <span class="string">&#x27;data&#x27;</span></span><br><span class="line">rsync error: error starting client-server protocol (code 5) at main.c(1656) [sender=3.1.2]</span><br><span class="line"></span><br><span class="line"><span class="comment">####改回允许局域网网段访问</span></span><br><span class="line">[root@backup01 ~]# grep <span class="string">&#x27;hosts allow&#x27;</span> /etc/rsyncd.conf</span><br><span class="line">hosts allow = 192.168.1.0/24</span><br><span class="line"></span><br><span class="line">[root@backup01 ~]# systemctl restart rsyncd</span><br><span class="line"></span><br><span class="line"><span class="comment">## 此时正常访问</span></span><br><span class="line">[root@nfs01 ~]# rsync -avz etc.tar.gz rsync_backup@192.168.1.100::data --password-file=/etc/rsync.client </span><br><span class="line">sending incremental file list</span><br><span class="line"></span><br><span class="line">sent 54 bytes  received 20 bytes  148.00 bytes/sec</span><br><span class="line">total size is 10,433,130  speedup is 140,988.24</span><br></pre></td></tr></table></figure></li></ul><h1 id="6-Rsync-选项"><a href="#6-Rsync-选项" class="headerlink" title="6. Rsync 选项"></a>6. Rsync 选项</h1><table><thead><tr><th>rsync 选项</th><th>含义</th></tr></thead><tbody><tr><td><code>-a</code> <br>包含了[-rlptogD]</td><td>-r：递归复制 <br>-l：复制软链接<br>-p：保持权限不变<br>-t：保持文件时间不变<br>-o：所有者不变<br>-g：所属组不变<br>-D：–devices –specials  设备与特殊文件，保持设备文件信息</td></tr><tr><td><code>-v</code></td><td>显示传输过程详细信息</td></tr><tr><td><code>-z</code></td><td>传输数据时压缩<br>（一般公网传输使用，会自动解压缩）<br>–compress-level&#x3D;num：可按级别压缩</td></tr><tr><td>-P</td><td>–progress  显示同步的过程及传输时的进度等信息（一般不与-z 使用）</td></tr><tr><td><code>--bwlimit</code></td><td>限速</td></tr><tr><td>–exclude<br>–exclude-from</td><td>排除</td></tr><tr><td>–delete</td><td>一般用于实时同步，备份时不使用<br>使双方数据一致，多余的文件全部删除</td></tr></tbody></table><h2 id="6-1-P-更加详细的信息"><a href="#6-1-P-更加详细的信息" class="headerlink" title="6.1  -P 更加详细的信息"></a>6.1  <code>-P</code> 更加详细的信息</h2><blockquote><p>比 <code>-v</code> 输出的信息更加详细，显示传输速度与进度等</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 tmp]# rsync -av -P . rsync_backup@192.168.1.100::data --password-file=/etc/rsync.client </span><br><span class="line">sending incremental file list</span><br><span class="line">./</span><br><span class="line">100m </span><br><span class="line">    104,857,600 100%   58.77MB/s    0:00:01 (xfr#1, to-chk=5/7)</span><br><span class="line"></span><br><span class="line">sent 104,883,455 bytes  received 70 bytes  41,953,410.00 bytes/sec</span><br><span class="line">total size is 104,857,600  speedup is 1.00</span><br></pre></td></tr></table></figure><h2 id="6-2-bwlimit-限速"><a href="#6-2-bwlimit-限速" class="headerlink" title="6.2 --bwlimit 限速"></a>6.2 <code>--bwlimit</code> 限速</h2><blockquote><p>公网传输时为了不占用太多宽带，一般会限速传输</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 限速到100kb/s</span></span><br><span class="line">[root@nfs01 tmp]# rsync -avP --bwlimit=100kb . rsync_backup@192.168.1.100::data --password-file=/etc/rsync.client </span><br><span class="line">sending incremental file list</span><br><span class="line">./</span><br><span class="line">100m-v2</span><br><span class="line">        425,984   0%  103.31kB/s    0:16:50  </span><br></pre></td></tr></table></figure><h2 id="6-3-排除指定文件"><a href="#6-3-排除指定文件" class="headerlink" title="6.3 排除指定文件"></a>6.3 排除指定文件</h2><blockquote><p>传输时可以指定哪些文件不进行备份【–exclude】</p></blockquote><ul><li><ol><li><h2 id="创建一些文件"><a href="#创建一些文件" class="headerlink" title="创建一些文件"></a>创建一些文件</h2></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 tmp]# <span class="built_in">mkdir</span> xue</span><br><span class="line">[root@nfs01 tmp]# <span class="built_in">cd</span> xue/</span><br><span class="line">[root@nfs01 xue]# <span class="built_in">touch</span> xuexi-&#123;1..10&#125;.txt</span><br><span class="line">[root@nfs01 xue]# ll</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-10.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-1.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-2.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-3.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-4.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-5.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-6.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-7.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-8.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-9.txt</span><br></pre></td></tr></table></figure></li><li><ol start="2"><li><h3 id="传输时排除-xuexi-【1-2-3】文件"><a href="#传输时排除-xuexi-【1-2-3】文件" class="headerlink" title="传输时排除 xuexi-【1,2,3】文件"></a>传输时排除 xuexi-【1,2,3】文件</h3></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 xue]# rsync -avz . rsync_backup@192.168.1.100::data --password-file=/etc/rsync.client --exclude=xuexi-&#123;1,2,3&#125;.txt</span><br><span class="line">sending incremental file list</span><br><span class="line">./</span><br><span class="line">xuexi-10.txt</span><br><span class="line">xuexi-4.txt</span><br><span class="line">xuexi-5.txt</span><br><span class="line">xuexi-6.txt</span><br><span class="line">xuexi-7.txt</span><br><span class="line">xuexi-8.txt</span><br><span class="line">xuexi-9.txt</span><br><span class="line"></span><br><span class="line">sent 424 bytes  received 160 bytes  1,168.00 bytes/sec</span><br><span class="line">total size is 0  speedup is 0.00</span><br><span class="line"></span><br><span class="line">[root@backup01 data]# ll</span><br><span class="line">total 112600</span><br><span class="line">-rw-r--r-- 1 rsync rsync 104857600 Mar  7 17:46 100m</span><br><span class="line">-rw-r--r-- 1 rsync rsync  10433130 Mar  7 17:15 etc.tar.gz</span><br><span class="line">-rw-r--r-- 1 rsync rsync         9 Mar  6 18:31 hostname</span><br><span class="line">-rw-r--r-- 1 rsync rsync       158 Jun  7  2013 hosts</span><br><span class="line">-rw-r--r-- 1 rsync rsync         0 Mar  7 17:54 xuexi-10.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync         0 Mar  7 17:54 xuexi-4.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync         0 Mar  7 17:54 xuexi-5.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync         0 Mar  7 17:54 xuexi-6.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync         0 Mar  7 17:54 xuexi-7.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync         0 Mar  7 17:54 xuexi-8.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync         0 Mar  7 17:54 xuexi-9.txt</span><br></pre></td></tr></table></figure></li><li><ol start="3"><li><h3 id="也可以排除-xuexi-1-3-txt-范围内文件"><a href="#也可以排除-xuexi-1-3-txt-范围内文件" class="headerlink" title="也可以排除 xuexi-{1.. 3}.txt 范围内文件"></a>也可以排除 xuexi-{1.. 3}.txt 范围内文件</h3></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 xue]# rsync -avz . rsync_backup@192.168.1.100::data --password-file=/etc/rsync.client --exclude=xuexi-&#123;1..3&#125;.txt</span><br><span class="line">sending incremental file list</span><br><span class="line">./</span><br><span class="line">xuexi-10.txt</span><br><span class="line">xuexi-4.txt</span><br><span class="line">xuexi-5.txt</span><br><span class="line">xuexi-6.txt</span><br><span class="line">xuexi-7.txt</span><br><span class="line">xuexi-8.txt</span><br><span class="line">xuexi-9.txt</span><br><span class="line"></span><br><span class="line">sent 424 bytes  received 160 bytes  1,168.00 bytes/sec</span><br><span class="line">total size is 0  speedup is 0.00</span><br></pre></td></tr></table></figure></li></ul><h2 id="6-4-delete-数据一致"><a href="#6-4-delete-数据一致" class="headerlink" title="6.4  -delete  数据一致"></a>6.4  <code>-delete</code>  数据一致</h2><blockquote><p>👺 注意：该选项会强制使双方数据一致，服务端多余的数据会直接删除<br>    一般用于实时同步，备份时一般情况下不要使用</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 先查看服务端的数据有哪些</span></span></span><br><span class="line">[root@backup01 data]# ls</span><br><span class="line">100m  etc.tar.gz  hostname  hosts  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 查看客户端要推送的数据</span></span> </span><br><span class="line">[root@nfs01 xue]# ll</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-10.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-1.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-2.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-3.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-4.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-5.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-6.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-7.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-8.txt</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar  7 17:54 xuexi-9.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">####  会发现他会删除服务端上的文件，再传输客户端上的数据</span></span></span><br><span class="line">[root@nfs01 xue]# rsync -avz --delete  . rsync_backup@192.168.1.100::data --password-file=/etc/rsync.client </span><br><span class="line">sending incremental file list</span><br><span class="line">deleting .font-unix/</span><br><span class="line">deleting .XIM-unix/</span><br><span class="line">deleting .X11-unix/</span><br><span class="line">deleting .Test-unix/</span><br><span class="line">deleting .ICE-unix/</span><br><span class="line">deleting hosts</span><br><span class="line">deleting hostname</span><br><span class="line">deleting etc.tar.gz</span><br><span class="line">deleting 100m</span><br><span class="line">./</span><br><span class="line">xuexi-1.txt</span><br><span class="line">xuexi-10.txt</span><br><span class="line">xuexi-2.txt</span><br><span class="line">xuexi-3.txt</span><br><span class="line">xuexi-4.txt</span><br><span class="line">xuexi-5.txt</span><br><span class="line">xuexi-6.txt</span><br><span class="line">xuexi-7.txt</span><br><span class="line">xuexi-8.txt</span><br><span class="line">xuexi-9.txt</span><br><span class="line"></span><br><span class="line">sent 584 bytes  received 332 bytes  1,832.00 bytes/sec</span><br><span class="line">total size is 0  speedup is 0.00</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 此时查看服务端的数据，会发现只剩下xuexi-*的文件</span></span></span><br><span class="line">[root@backup01 data]# ll</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 rsync rsync 0 Mar  7 17:54 xuexi-10.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync 0 Mar  7 17:54 xuexi-1.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync 0 Mar  7 17:54 xuexi-2.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync 0 Mar  7 17:54 xuexi-3.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync 0 Mar  7 17:54 xuexi-4.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync 0 Mar  7 17:54 xuexi-5.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync 0 Mar  7 17:54 xuexi-6.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync 0 Mar  7 17:54 xuexi-7.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync 0 Mar  7 17:54 xuexi-8.txt</span><br><span class="line">-rw-r--r-- 1 rsync rsync 0 Mar  7 17:54 xuexi-9.txt</span><br></pre></td></tr></table></figure><h1 id="7-项目案例：定时备份"><a href="#7-项目案例：定时备份" class="headerlink" title="7. 项目案例：定时备份"></a>7. 项目案例：定时备份</h1><h2 id="7-1-项目背景"><a href="#7-1-项目背景" class="headerlink" title="7.1 项目背景"></a>7.1 项目背景</h2><ul><li><p>可能源于老大的一句话：你去做一下备份</p></li><li><p>接下来需要你自己思考：怎么备份、备份什么内容？怎么统一存放备份，备份保存多长时间，都是什么系统、以及系统什么版本。</p></li><li><p>备份什么？</p><ul><li>数据库、存储</li><li>配置文件</li><li>脚本、代码…</li><li>网站代码</li><li>日志等等</li><li>…..</li></ul></li><li><p>怎么备份？</p><ul><li>tar 打包压缩+定时任务</li></ul></li><li><p>怎么收集存放备份？</p><ul><li>rsync 服务收集备份（客户端推送备份到 rsync 服务端）</li></ul></li></ul><h2 id="7-2-项目流程"><a href="#7-2-项目流程" class="headerlink" title="7.2 项目流程"></a>7.2 项目流程</h2><h3 id="a）环境准备"><a href="#a）环境准备" class="headerlink" title="a）环境准备"></a>a）环境准备</h3><table><thead><tr><th>角色</th><th>主机</th><th>运行服务</th></tr></thead><tbody><tr><td>存放备份</td><td>backup01</td><td>rsync 服务端</td></tr><tr><td>生成备份</td><td>nfs01</td><td>rsync 客户端、其他服务</td></tr><tr><td>生成备份</td><td>web01</td><td>rsync 客户端、其他服务</td></tr><tr><td>……</td><td></td><td></td></tr></tbody></table><h3 id="b）项目步骤"><a href="#b）项目步骤" class="headerlink" title="b）项目步骤"></a>b）项目步骤</h3><blockquote><p>目前这里只列出了操作步骤，工作时还会有沟通、开会、定期汇报等步骤。</p></blockquote><table><thead><tr><th>步骤说明</th><th>详细内容</th></tr></thead><tbody><tr><td>创建 rsync 服务端并调试</td><td>配置服务端</td></tr><tr><td>rsync 客户端节点配置</td><td>（1）备份<br>（2）推送<br>（3）清理</td></tr><tr><td>其他节点配置定时任务</td><td>定时运行备份任务</td></tr><tr><td>备份服务器检查并发送结果邮件</td><td></td></tr></tbody></table><h3 id="c）服务端配置及调试"><a href="#c）服务端配置及调试" class="headerlink" title="c）服务端配置及调试"></a>c）服务端配置及调试</h3><ol><li><h3 id="修改服务端配置文件"><a href="#修改服务端配置文件" class="headerlink" title="修改服务端配置文件"></a>修改服务端配置文件</h3></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@backup01 ~]# <span class="built_in">cat</span> /etc/rsyncd.conf</span><br><span class="line">fake super = <span class="built_in">yes</span>  </span><br><span class="line">uid = rsync   </span><br><span class="line">gid = rsync   </span><br><span class="line">use <span class="built_in">chroot</span> = no   </span><br><span class="line">max connections = 2000</span><br><span class="line"><span class="built_in">timeout</span> = 600</span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">lock file = /var/run/rsync.lock</span><br><span class="line"></span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log</span><br><span class="line">ignore errors</span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span></span><br><span class="line">list = <span class="literal">false</span></span><br><span class="line">hosts allow = 192.168.1.0/24</span><br><span class="line"><span class="comment">###hosts deny = 192.168.1.0/32</span></span><br><span class="line">auth <span class="built_in">users</span> = rsync_backup</span><br><span class="line">secrets file = /etc/rsync.password</span><br><span class="line"></span><br><span class="line"><span class="comment">#############          </span></span><br><span class="line">[data]</span><br><span class="line">comment = my rsync</span><br><span class="line">path = /data</span><br><span class="line"></span><br><span class="line">[backup]   <span class="comment">##### 添加新的模块</span></span><br><span class="line">comment = shouji backups</span><br><span class="line">path = /backup </span><br></pre></td></tr></table></figure><ol start="2"><li>创建共享目录并修改权限<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@backup01 ~]# <span class="built_in">mkdir</span> -p /backup</span><br><span class="line">[root@backup01 ~]# <span class="built_in">chown</span> -R rsync.rsync /backup</span><br><span class="line">[root@backup01 ~]# ll -d /backup/</span><br><span class="line">drwxr-xr-x 2 rsync rsync 6 Mar  8 13:50 /backup/</span><br></pre></td></tr></table></figure></li></ol><h3 id="d）客户端配置"><a href="#d）客户端配置" class="headerlink" title="d）客户端配置"></a>d）客户端配置</h3><blockquote><p>01.创建备份脚本</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /server/scripts/bak_conf.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#author: lsq 2024-03-08</span></span><br><span class="line"><span class="comment">#desc: 备份的相关配置-客户端</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##01.变量</span></span><br><span class="line">ip=`hostname -I | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>`</span><br><span class="line">backup_dir=/backup/<span class="variable">$&#123;ip&#125;</span></span><br><span class="line">time=`<span class="built_in">date</span> +%F_%w`</span><br><span class="line">backup_file=conf-<span class="variable">$&#123;time&#125;</span>.tar.gz</span><br><span class="line">backup_server=192.168.1.100</span><br><span class="line"></span><br><span class="line"><span class="comment">##02.tar打包压缩</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$&#123;backup_dir&#125;</span></span><br><span class="line">tar -zcf <span class="variable">$&#123;backup_dir&#125;</span>/<span class="variable">$&#123;backup_file&#125;</span>  /etc/</span><br><span class="line"></span><br><span class="line"><span class="comment">##03.推送到服务端</span></span><br><span class="line">rsync -a <span class="variable">$&#123;backup_dir&#125;</span>  rsync_backup@<span class="variable">$&#123;backup_server&#125;</span>::backup --password-file=/etc/rsync.client</span><br><span class="line"></span><br><span class="line"><span class="comment">##04.删除旧备份-7天前的</span></span><br><span class="line">find <span class="variable">$&#123;backup_dir&#125;</span> -<span class="built_in">type</span> f -name  <span class="string">&quot;*.tar.gz&quot;</span>  -mtime +7 | xargs <span class="built_in">rm</span> -f</span><br></pre></td></tr></table></figure><blockquote><ol start="2"><li>创建定时任务，每分钟执行一次定时任务</li></ol></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]# vim /var/spool/cron/root</span><br><span class="line">* * * * *  sh /server/scripts/bak_conf.sh  &amp;&gt;&gt;/var/log/backup.log</span><br></pre></td></tr></table></figure><h3 id="e）其他节点配置客户端"><a href="#e）其他节点配置客户端" class="headerlink" title="e）其他节点配置客户端"></a>e）其他节点配置客户端</h3><blockquote><p>这里使用 web01 服务器</p><h3 id="在配置好的客户端上复制备份脚本、crontab-文件、rsync-验证密码文件到新的客户端"><a href="#在配置好的客户端上复制备份脚本、crontab-文件、rsync-验证密码文件到新的客户端" class="headerlink" title="在配置好的客户端上复制备份脚本、crontab 文件、rsync 验证密码文件到新的客户端"></a>在配置好的客户端上复制备份脚本、crontab 文件、rsync 验证密码文件到新的客户端</h3></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01.备份脚本</span></span><br><span class="line">scp  /server/scripts/bak_conf.sh root@192.168.1.20:/server/scripts/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 02.crontab定时任务文件</span></span><br><span class="line">scp /var/spool/cron/root 192.168.1.20:/var/spool/cron/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 03. rsync密码文件</span></span><br><span class="line">scp /etc/rsync.client 192.168.1.20:/etc/</span><br></pre></td></tr></table></figure><ul><li>等待一分钟后，crontab 自动运行备份脚本</li><li>在服务端查看是否有新内容</li><li>会发现已经有了 <code>192.168.1.20</code> 新 ip 出现<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@backup01 ~]# tree /backup/</span><br><span class="line">/backup/</span><br><span class="line">├── 192.168.1.103</span><br><span class="line">│   └── conf-2024-03-08_5.tar.gz</span><br><span class="line">├── 192.168.1.20</span><br><span class="line">│   └── conf-2024-03-08_5.tar.gz</span><br><span class="line">└── hostname</span><br><span class="line"></span><br><span class="line">2 directories, 3 files</span><br></pre></td></tr></table></figure></li></ul><h3 id="f）备份服务器检查及邮件"><a href="#f）备份服务器检查及邮件" class="headerlink" title="f）备份服务器检查及邮件"></a>f）备份服务器检查及邮件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@backup01 ~]# <span class="built_in">cat</span> /server/scripts/check.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">##desc: 检查备份、清理旧备份</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##01.清理旧备份</span></span><br><span class="line">find /backup -<span class="built_in">type</span> f -name <span class="string">&quot;*.tar.gz&quot;</span> -mtime +180 | xargs <span class="built_in">rm</span> -f</span><br><span class="line"></span><br><span class="line"><span class="comment">##02.统计备份结果</span></span><br><span class="line">find /backup -<span class="built_in">type</span> f -name <span class="string">&quot;*.tar.gz&quot;</span> |\</span><br><span class="line">xargs <span class="built_in">ls</span> -lhd |\</span><br><span class="line">awk  -F<span class="string">&#x27;[ /]+&#x27;</span> <span class="string">&#x27;BEGIN&#123;print &quot;IP&quot;,&quot;压缩文件&quot;,&quot;大小&quot;&#125; &#123;print $(NF-1),$NF,$5&#125;&#x27;</span> | column -t &gt; /server/scripts/result.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">##03.发送邮件</span></span><br><span class="line">mail -s <span class="string">&quot;每日备份结果&quot;</span> 2659612760@qq.com &lt;/server/scripts/result.txt</span><br></pre></td></tr></table></figure><ul><li>查看 result.txt 内容<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@backup01 ~]# <span class="built_in">cat</span> /server/scripts/result.txt </span><br><span class="line">IP             压缩文件                   大小</span><br><span class="line">192.168.1.103  conf-2024-03-08_5.tar.gz  10M</span><br><span class="line">192.168.1.20   conf-2024-03-08_5.tar.gz  10M</span><br></pre></td></tr></table></figure></li></ul><h3 id="g）增加文件校验功能"><a href="#g）增加文件校验功能" class="headerlink" title="g）增加文件校验功能"></a>g）增加文件校验功能</h3><blockquote><p>传输过程中，文件可能会损坏，所以需要进行 md5 检验</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##给/etc/下面的文件创建md5并保存至指定文件</span></span><br><span class="line">find /etc/ -<span class="built_in">type</span> f |xargs  <span class="built_in">md5sum</span> &gt;etc-all.md5</span><br><span class="line"></span><br><span class="line"><span class="comment">##校验md5</span></span><br><span class="line"><span class="built_in">md5sum</span> -c etc-all.md5 </span><br><span class="line"></span><br><span class="line"><span class="comment">## 将一个文件的内容修改：比如在rsyncd.conf里增加一个#号</span></span><br><span class="line"><span class="built_in">md5sum</span> -c etc-all.md5 </span><br><span class="line">....</span><br><span class="line">/etc/rsyncd.conf: FAILED</span><br><span class="line">/etc/rsync.client: OK</span><br><span class="line"><span class="built_in">md5sum</span>: WARNING: 1 computed checksum did NOT match</span><br><span class="line"></span><br><span class="line"><span class="comment">## 如果文件过多，不太好看，可以使用--quiet参数，只显示校验失败的</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">md5sum</span> -c --quiet etc-all.md5 </span><br><span class="line">/etc/rsyncd.conf: FAILED</span><br><span class="line"><span class="built_in">md5sum</span>: WARNING: 1 computed checksum did NOT match</span><br></pre></td></tr></table></figure><ul><li><p>具体应用</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##客户端备份完成的时候，为备份文件创建md5校验文件</span></span><br></pre></td></tr></table></figure></li><li><p>我们可以做一个安全防护措施（知识补充）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###给一些命令和固定配置文件，设置md5，定期任务进行校验，以防止病毒修改文件</span></span><br></pre></td></tr></table></figure></li></ul><ol><li><p>客户端增加一个生成 md5 的命令即可【 #2 .5】</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /server/scripts/bak_conf.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#author: lsq 2024-03-08</span></span><br><span class="line"><span class="comment">#desc: 备份的相关配置-客户端</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##01.变量</span></span><br><span class="line">ip=`hostname -I | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>`</span><br><span class="line">backup_dir=/backup/<span class="variable">$&#123;ip&#125;</span></span><br><span class="line">time=`<span class="built_in">date</span> +%F_%w`</span><br><span class="line">backup_file=conf-<span class="variable">$&#123;time&#125;</span>.tar.gz</span><br><span class="line">backup_server=192.168.1.100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##02.tar打包压缩</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$&#123;backup_dir&#125;</span></span><br><span class="line">tar -zcf <span class="variable">$&#123;backup_dir&#125;</span>/<span class="variable">$&#123;backup_file&#125;</span>  /etc/</span><br><span class="line"></span><br><span class="line"><span class="comment">##2.5 创建md5</span></span><br><span class="line">find <span class="variable">$&#123;backup_dir&#125;</span>/<span class="variable">$&#123;backup_file&#125;</span> |xargs <span class="built_in">md5sum</span> &gt;<span class="variable">$&#123;backup_dir&#125;</span>/fingerprint.md5</span><br><span class="line"></span><br><span class="line"><span class="comment">##03.推送到服务端</span></span><br><span class="line">rsync -a <span class="variable">$&#123;backup_dir&#125;</span>  rsync_backup@<span class="variable">$&#123;backup_server&#125;</span>::backup --password-file=/etc/rsync.client</span><br><span class="line"></span><br><span class="line"><span class="comment">##04.删除旧备份-7天前的</span></span><br><span class="line">find <span class="variable">$&#123;backup_dir&#125;</span> -<span class="built_in">type</span> f -name  <span class="string">&quot;*.tar.gz&quot;</span>  -mtime +7 | xargs <span class="built_in">rm</span> -f</span><br></pre></td></tr></table></figure></li><li><p>等待定时任务执行后，查看客户端和服务端是不是都有了 md5 文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### 客户端</span></span><br><span class="line">[root@nfs01 ~]# ll /backup/192.168.1.103/</span><br><span class="line">-rw-r--r-- 1 root root       81 Mar  9 15:58 fingerprint.md5</span><br><span class="line"></span><br><span class="line"><span class="comment">### 服务端</span></span><br><span class="line">[root@backup01 ~]# ll /backup/192.168.1.103/</span><br><span class="line">-rw-r--r-- 1 rsync rsync       81 Mar  9 15:59 fingerprint.md5</span><br></pre></td></tr></table></figure></li><li><p>服务端只是有文件还不行，还需要进行校验，否则不知道是否发生了改变</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@backup01 ~]# <span class="built_in">cat</span> /server/scripts/check.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">##desc: 检查备份、清理旧备份</span></span><br><span class="line"><span class="comment">###0. 变量</span></span><br><span class="line">result_file=/server/scripts/result.txt</span><br><span class="line"><span class="comment">##01.清理旧备份</span></span><br><span class="line">find /backup -<span class="built_in">type</span> f -name <span class="string">&quot;*.tar.gz&quot;</span> -mtime +180 | xargs <span class="built_in">rm</span> -f</span><br><span class="line"></span><br><span class="line"><span class="comment">##02.统计备份结果</span></span><br><span class="line">find /backup -<span class="built_in">type</span> f -name <span class="string">&quot;*.tar.gz&quot;</span> |\</span><br><span class="line">xargs <span class="built_in">ls</span> -lhd |\</span><br><span class="line">awk  -F<span class="string">&#x27;[ /]+&#x27;</span> <span class="string">&#x27;BEGIN&#123;print &quot;IP&quot;,&quot;压缩&quot;,&quot;大小&quot;&#125; &#123;print $(NF-1),$NF,$5&#125;&#x27;</span> | column -t &gt;<span class="variable">$result_file</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##2.5 校验md5</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;下面是md5校验结果&quot;</span> &gt;&gt;<span class="variable">$result_file</span></span><br><span class="line">find /backup/  -name <span class="string">&quot;fingerprint.md5&quot;</span> | xargs <span class="built_in">md5sum</span> -c &gt;&gt;<span class="variable">$result_file</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##03.发送邮件</span></span><br><span class="line">mail -s <span class="string">&quot;每日备份结果&quot;</span> 2659612760@qq.com &lt;<span class="variable">$result_file</span></span><br></pre></td></tr></table></figure></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@backup01 ~]# <span class="built_in">cat</span> /server/scripts/result.txt </span><br><span class="line">IP             压缩                      大小</span><br><span class="line">192.168.1.103  conf-2024-03-08_5.tar.gz  10M</span><br><span class="line">192.168.1.103  conf-2024-03-09_6.tar.gz  10M</span><br><span class="line">192.168.1.20   conf-2024-03-08_5.tar.gz  10M</span><br><span class="line">192.168.1.20   conf-2024-03-09_6.tar.gz  10M</span><br><span class="line">下面是md5校验结果</span><br><span class="line">/backup/192.168.1.103/conf-2024-03-09_6.tar.gz: OK</span><br></pre></td></tr></table></figure><blockquote><p>👺🌟：该脚本还是有问题，再说…..</p></blockquote><h2 id="7-3-项目总结"><a href="#7-3-项目总结" class="headerlink" title="7.3  项目总结"></a>7.3  项目总结</h2><ul><li>目的：对整个网站的核心数据进行备份</li><li>使用到的技术：<ul><li>rsync 备份：将打包好的备份文件推送到服务端</li><li>定时任务：定时运行推送命令</li><li>md5sum：文件校验</li><li>邮件</li><li>shell 脚本：三剑客、find、tar</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 综合架构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文档 </tag>
            
            <tag> 基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NFS存储</title>
      <link href="/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%AD%98%E5%82%A8/02-NFS%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1/"/>
      <url>/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E5%A4%87%E4%BB%BD%E4%B8%8E%E5%AD%98%E5%82%A8/02-NFS%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="一、nfs-概述"><a href="#一、nfs-概述" class="headerlink" title="一、nfs 概述"></a>一、nfs 概述</h1><ul><li><p>nfs 是什么？</p></li><li><p>单纯的存储：硬盘、u 盘等等</p></li><li><p><strong>nfs：共享存储（network filesystem）网络文件系统</strong></p><ul><li><strong>nfs 主要用于 Linux 系统之间</strong></li><li>samba：可用于 linux 与 windows 共享存储</li><li>ftp：windows、linux、mac 之间共享</li></ul></li><li><p>分布式存储：FastDFS、<strong>GlusterFS（GFS）</strong>，HDFS（大数据）</p></li><li><p>为什么使用<br>[如果没有 nfs 共享]</p></li><li><p>A 上传以后，只有 web01 有图片，而此时用户 B 访问的是 web02 就会找不到 A 上传的图片</p></li></ul><p><img src="/images/202403291245681.png"></p><p>[如果使用了 nfs]</p><ul><li>此时无论是哪个用户，都可以看到 A 上传的图片</li></ul><p><img src="/images/202403291245117.png"></p><ul><li>nfs 存放什么？</li><li>存放用户上传的数据（图片、视频等等）</li></ul><h1 id="二、nfs-的工作原理"><a href="#二、nfs-的工作原理" class="headerlink" title="二、nfs 的工作原理"></a>二、nfs 的工作原理</h1><p><strong>- RPC 和 nfs 的关系</strong></p><blockquote><p>👺： 什么是 RPC？</p><ul><li>RPC 是 NFS 的守护进程，由于 NFS 没有固定的端口，每启动一个功能就需要启动一个端口进行传输数据，它会随机启用一些未被使用的端口进行传输，所以需要调用RPC服务</li><li>RPC 的主要功能就是记录 NFS 功能所对应的端口，并将 NFS 客户端请求时将对应的信息传递给客户端，从而使客户端可以正确连接到 NFS 服务</li></ul></blockquote><ul><li>NFS 工作流程</li></ul><p><img src="/images/202403291246254.png"></p><h1 id="三、实战"><a href="#三、实战" class="headerlink" title="三、实战"></a>三、实战</h1><table><thead><tr><th align="left">主机</th><th align="left">ip</th><th align="left">角色</th></tr></thead><tbody><tr><td align="left">nfs01</td><td align="left">192.168.1.40</td><td align="left">服务端</td></tr><tr><td align="left">web01</td><td align="left">192.168.1.20</td><td align="left">客户端</td></tr></tbody></table><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nfs服务端和客户端都安装上nfs、rpc</span></span><br><span class="line">yum install -y nfs-utils rpcbind</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##先启动rpcbind</span></span><br><span class="line">[root@nfs01 ~]# systemctl start rpcbind</span><br><span class="line"></span><br><span class="line"><span class="comment">###查看rpc信息，此时并没有nfs信息</span></span><br><span class="line">[root@nfs01 ~]# rpcinfo -p</span><br><span class="line">   program vers proto   port  service</span><br><span class="line">    100000    4   tcp    111  portmapper</span><br><span class="line">    100000    3   tcp    111  portmapper</span><br><span class="line">    100000    2   tcp    111  portmapper</span><br><span class="line">    100000    4   udp    111  portmapper</span><br><span class="line">    100000    3   udp    111  portmapper</span><br><span class="line">    100000    2   udp    111  portmapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###启动NFS</span></span><br><span class="line">[root@nfs01 ~]# systemctl start nfs</span><br><span class="line"></span><br><span class="line"><span class="comment">## 再次查看rpc信息，会多了一些nfs的信息</span></span><br><span class="line">[root@nfs01 ~]# rpcinfo -p</span><br><span class="line">   program vers proto   port  service</span><br><span class="line">    100000    4   tcp    111  portmapper</span><br><span class="line">    100000    3   tcp    111  portmapper</span><br><span class="line">    100000    2   tcp    111  portmapper</span><br><span class="line">    100000    4   udp    111  portmapper</span><br><span class="line">    100000    3   udp    111  portmapper</span><br><span class="line">    100000    2   udp    111  portmapper</span><br><span class="line">    100024    1   udp  55257  status</span><br><span class="line">    100024    1   tcp  51640  status</span><br><span class="line">    100005    1   udp  20048  mountd</span><br><span class="line">    100005    1   tcp  20048  mountd</span><br><span class="line">    100005    2   udp  20048  mountd</span><br><span class="line">    100005    2   tcp  20048  mountd</span><br><span class="line">    100005    3   udp  20048  mountd</span><br><span class="line">    100005    3   tcp  20048  mountd</span><br><span class="line">    100003    3   tcp   2049  nfs</span><br><span class="line">    100003    4   tcp   2049  nfs</span><br><span class="line">    100227    3   tcp   2049  nfs_acl</span><br><span class="line">    100003    3   udp   2049  nfs</span><br><span class="line">    100003    4   udp   2049  nfs</span><br><span class="line">    100227    3   udp   2049  nfs_acl</span><br><span class="line">    100021    1   udp  49965  nlockmgr</span><br><span class="line">    100021    3   udp  49965  nlockmgr</span><br><span class="line">    100021    4   udp  49965  nlockmgr</span><br><span class="line">    100021    1   tcp  42359  nlockmgr</span><br><span class="line">    100021    3   tcp  42359  nlockmgr</span><br><span class="line">    100021    4   tcp  42359  nlockmgr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置开机自启</span></span><br><span class="line">[root@nfs01 ~]# systemctl <span class="built_in">enable</span> rpcbind nfs</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/nfs-server.service to /usr/lib/systemd/system/nfs-server.service.</span><br></pre></td></tr></table></figure><p><code>命令格式：/data 192.168.168.1.0/24(rw)</code></p><blockquote><p>注意：挂载目录和 ip 之间有空格，ip 和括号之间没有空格</p></blockquote><p><img src="/images/202403291247408.png"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改nfs配置文件</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line">/data 192.168.1.0/24(rw)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装完成后，会自动生成一个默认用户</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">id</span> nfsnobody</span><br><span class="line">uid=65534(nfsnobody) gid=65534(nfsnobody) <span class="built_in">groups</span>=65534(nfsnobody)</span><br><span class="line"></span><br><span class="line"><span class="comment">##此时不要重启nfs，还没有创建共享目录</span></span><br><span class="line"><span class="comment">###创建目录，修改用户和组</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">mkdir</span> /data</span><br><span class="line">[root@nfs01 ~]# <span class="built_in">chown</span> -R nfsnobody.nfsnobody /data/</span><br><span class="line">[root@nfs01 ~]# ll -d /data/</span><br><span class="line">drwxr-xr-x 2 nfsnobody nfsnobody 6 Aug 22 19:41 /data/</span><br><span class="line"></span><br><span class="line">[root@nfs01 ~]# systemctl restart nfs</span><br><span class="line"></span><br><span class="line"><span class="comment">## 加ip查看指定ip下是否有共享目录</span></span><br><span class="line"><span class="comment">## 不加ip查看当前机器下有没有共享目录</span></span><br><span class="line">[root@nfs01 ~]# showmount -e 192.168.1.40</span><br><span class="line">Export list <span class="keyword">for</span> 192.168.1.40:</span><br><span class="line">/data 192.168.1.0/24</span><br><span class="line">[root@nfs01 ~]# showmount -e </span><br><span class="line">Export list <span class="keyword">for</span> nfs01:</span><br><span class="line">/data 192.168.1.0/24</span><br></pre></td></tr></table></figure><p><code>[测试]</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端本地挂载</span></span><br><span class="line">[root@nfs01 ~]# ll /mnt/</span><br><span class="line">total 0</span><br><span class="line">[root@nfs01 ~]# mount -t nfs 192.168.1.40:/data /mnt</span><br><span class="line">[root@nfs01 ~]# <span class="built_in">touch</span> /mnt/1.txt</span><br><span class="line">[root@nfs01 ~]# ll /mnt/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:46 1.txt</span><br><span class="line">[root@nfs01 ~]# ll /data/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:46 1.txt</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 客户端web01挂载</span></span><br><span class="line">[root@web01 script]# showmount -e 192.168.1.40</span><br><span class="line">Export list <span class="keyword">for</span> 192.168.1.40:</span><br><span class="line">/data 192.168.1.0/24</span><br><span class="line"></span><br><span class="line">[root@web01 script]# mount -t nfs 192.168.1.40:/data /server/bbz</span><br><span class="line">[root@web01 script]# ll -d /server/bbz/</span><br><span class="line">drwxr-xr-x 2 nfsnobody nfsnobody 19 Aug 22 19:46 /server/bbz/</span><br><span class="line"></span><br><span class="line">[root@web01 script]# ll /server/bbz/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:46 1.txt</span><br><span class="line"></span><br><span class="line">[root@web01 script]# <span class="built_in">touch</span> /server/bbz/&#123;2..100&#125;.txt</span><br><span class="line">[root@web01 script]# ll /server/bbz/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 100.txt</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 10.txt</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 11.txt</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 12.txt</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"><span class="comment">## 我们去nfs机器上看看是不是也有</span></span><br><span class="line">[root@nfs01 ~]# ll /data/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 100.txt</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 10.txt</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 22 19:50 11.txt</span><br><span class="line">....</span><br></pre></td></tr></table></figure><h1 id="四、服务端参数"><a href="#四、服务端参数" class="headerlink" title="四、服务端参数"></a>四、服务端参数</h1><p><img src="/images/202403291247408.png"></p><blockquote><p>本节主要讲解最后面的参数（rw、sync….）</p></blockquote><table><thead><tr><th align="left">nfs 服务端，共享参数</th><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left">rw</td><td align="left">可读写</td><td align="left"></td></tr><tr><td align="left">ro</td><td align="left">只读&nbsp; read only</td><td align="left"></td></tr><tr><td align="left">sync</td><td align="left">同步写入</td><td align="left">同时将数据写入内存和磁盘中，不会丢失数据</td></tr><tr><td align="left">async</td><td align="left">异步写入</td><td align="left">优先将数据写入内存，再写入磁盘，效率更高，但可能会丢失数据</td></tr><tr><td align="left">anonuid</td><td align="left">anonymous：指定用户uid</td><td align="left">指定客户端映射到服务端使用的用户</td></tr><tr><td align="left">anongid</td><td align="left">指定用户gid</td><td align="left">指定客户端映射到服务端使用的用户组</td></tr><tr><td align="left">root_squash</td><td align="left">NFS 客户端以 root 管理员访问时，映射为 NFS 的匿名用户（不常用）</td><td align="left">root&nbsp; –&gt; nfsnobody</td></tr><tr><td align="left">no_root_squash</td><td align="left">NFS客户端以root访问时，映射为NFS服务端的root用户（不常用）</td><td align="left">客户端root&nbsp; –&gt;&nbsp; 服务端root</td></tr><tr><td align="left">all_squash</td><td align="left">无论NFS客户端使用什么用户访问，均映射为匿名用户</td><td align="left">all –&gt;&nbsp; nfsnobody</td></tr><tr><td align="left">no_all_squash</td><td align="left">无论客户端使用什么用户访问，都不进行压缩</td><td align="left">all&nbsp; –&gt;&nbsp; all</td></tr></tbody></table><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nfs挂载，rw与ro</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line">/data/blog 192.168.1.0/24(rw)</span><br><span class="line">/data/rw   192.168.1.0/24(rw)</span><br><span class="line">/data/ro   192.168.1.0/24(ro)</span><br><span class="line"></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">mkdir</span> -p /data/&#123;rw,ro&#125;</span><br><span class="line"></span><br><span class="line">[root@nfs01 ~]# systemctl restart nfs</span><br><span class="line">[root@nfs01 ~]# showmount -e</span><br><span class="line">Export list <span class="keyword">for</span> nfs01:</span><br><span class="line">/data/ro   192.168.1.0/24</span><br><span class="line">/data/rw   192.168.1.0/24</span><br><span class="line">/data/blog 192.168.1.0/24</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 本地挂载一下</span></span><br><span class="line"><span class="comment">### rw正常写入</span></span><br><span class="line">[root@nfs01 ~]# mount -t nfs 192.168.1.40:/data/rw /mnt</span><br><span class="line">[root@nfs01 ~]# <span class="built_in">chown</span> -R nfsnobody.nfsnobody /data</span><br><span class="line">[root@nfs01 ~]# <span class="built_in">touch</span> /mnt/1.txt</span><br><span class="line">[root@nfs01 ~]# ll /mnt/</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 25 19:08 1.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">### 去掉挂载点</span></span><br><span class="line">[root@nfs01 ~]# umount -v /mnt/</span><br><span class="line">/mnt: nfs4 mount point detected</span><br><span class="line">/mnt: umounted</span><br><span class="line"></span><br><span class="line"><span class="comment">## 挂载ro可读目录，无法写入文件</span></span><br><span class="line">[root@nfs01 ~]# mount -t nfs 192.168.1.40:/data/ro /mnt/</span><br><span class="line">[root@nfs01 ~]# <span class="built_in">touch</span> /mnt/1.txt</span><br><span class="line"><span class="built_in">touch</span>: cannot <span class="built_in">touch</span> ‘/mnt/1.txt’: Read-only file system</span><br></pre></td></tr></table></figure><p>[sync 和 async]</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 如果我们不配置，则默认使用sync</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /var/lib/nfs/etab </span><br><span class="line">/data/rw192.168.1.0/24(rw,<span class="built_in">sync</span>,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=65534,anongid=65534,sec=sys,rw,secure,root_squash,no_all_squash)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除所有数据，进行测试</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">rm</span> -rf /data/rw/*</span><br><span class="line"><span class="comment"># 动态查看目录内容</span></span><br><span class="line">[root@nfs01 ~]# watch <span class="built_in">ls</span> -l /data/rw/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端写入大文件</span></span><br><span class="line">[root@web01 ~]# <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/tmp/big bs=1M count=500</span><br><span class="line">500+0 records <span class="keyword">in</span></span><br><span class="line">500+0 records out</span><br><span class="line">524288000 bytes (524 MB) copied, 5.18806 s, 101 MB/s</span><br><span class="line">[root@web01 ~]# <span class="built_in">cp</span> /tmp/big /mnt/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 你会发现服务端目录下的文件并不是直接全部写入磁盘，而是在慢慢变大</span></span><br></pre></td></tr></table></figure><p><img src="/images/202403291249497.png"></p><p><img src="/images/202403291250570.png"></p><p>[anonuid 和 anongid]</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###  默认使用了自动创建的nfsnobody用户和组</span></span><br><span class="line"><span class="comment">###  anonuid=65534,anongid=65534</span></span><br><span class="line"></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /var/lib/nfs/etab </span><br><span class="line">/data/rw192.168.1.0/24(rw,<span class="built_in">sync</span>,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=65534,anongid=65534,sec=sys,rw,secure,root_squash,no_all_squash)</span><br></pre></td></tr></table></figure><ul><li>用户压缩</li><li>默认：root_squash, no_all_squash</li></ul><p><img src="/images/202403291250686.png"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## nfs默认的设置，当客户端使用root访问时压缩为匿名用户</span></span><br><span class="line"><span class="comment">## 其他用户访问时，不进行压缩</span></span><br><span class="line">/data/rw192.168.1.0/24(rw,<span class="built_in">sync</span>,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=65534,anongid=65534,sec=sys,rw,secure,root_squash,no_all_squash)</span><br><span class="line"></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line">/data/blog 192.168.1.0/24(rw)</span><br><span class="line">/data/rw   192.168.1.0/24(rw)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 其他用户只有访问权限，没有写权限</span></span><br><span class="line">[zzz@web01 ~]$ <span class="built_in">touch</span> /mnt/3.txt</span><br><span class="line"><span class="built_in">touch</span>: cannot <span class="built_in">touch</span> ‘/mnt/3.txt’: Permission denied</span><br><span class="line">[zzz@web01 ~]$ ll /mnt/</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 25 22:00 1.txt</span><br><span class="line">-rw-rw-r-- 1 nfsnobody nfsnobody 0 Aug 25 22:00 2.txt</span><br></pre></td></tr></table></figure><ul><li><strong>all_squash</strong> （常用）</li><li>不论什么用户都进行压缩<br><img src="/images/202403291251648.png"></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 客户端使用root用户创建文件</span></span></span><br><span class="line">[root@nfs01 ~]# touch /mnt/1.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务端查看创建的文件uid、gid，会发现被压缩了</span></span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 0 Aug 25 22:00 1.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 客户端使用普通用户创建文件</span></span></span><br><span class="line">[root@nfs01 ~]# su - zzz</span><br><span class="line">[zzz@nfs01 ~]$ touch /mnt/2.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 服务端查看</span></span></span><br><span class="line">-rw-rw-r-- 1 nfsnobody nfsnobody 0 Aug 25 22:00 2.txt</span><br></pre></td></tr></table></figure><ul><li><strong>all_squash, anonuid+anongid</strong> （常用）</li><li>压缩为指定用户，防止一些用户权限问题</li></ul><p><img src="/images/202403291252397.png"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端、客户端创建指定用户</span></span><br><span class="line">groupadd -g 888 www</span><br><span class="line">useradd -s /sbin/nologin -M -u 888 -g 888 www</span><br><span class="line"><span class="built_in">id</span> www</span><br><span class="line">uid=888(www) gid=888(www) <span class="built_in">groups</span>=888(www)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置共享目录为指定用户，否则客户端没有写入权限</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">chown</span> -R www.www /data/rw</span><br><span class="line">[root@nfs01 ~]# ll -d /data/rw</span><br><span class="line">drwxr-xr-x 2 www www 32 Aug 25 22:00 /data/rw</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">[root@nfs01 ~]# <span class="built_in">cat</span> /etc/exports</span><br><span class="line">/data/blog 192.168.1.0/24(rw)</span><br><span class="line">/data/rw   192.168.1.0/24(rw,all_squash,anonuid=888,anongid=888)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 测试</span></span><br><span class="line">[root@web01 ~]# <span class="built_in">touch</span> /mnt/q.txt</span><br><span class="line">[root@web01 ~]# su - zzz</span><br><span class="line">Last login: Fri Aug 25 22:43:04 CST 2023 on pts/0</span><br><span class="line">[zzz@web01 ~]$ <span class="built_in">touch</span> /mnt/as.txt</span><br><span class="line"></span><br><span class="line">[root@nfs01 ~]# ll  /data/rw</span><br><span class="line">-rw-rw-r-- 1 www www 0 Aug 25 22:46 as.txt</span><br><span class="line">-rw-r--r-- 1 www www 0 Aug 25 22:46 q.txt</span><br></pre></td></tr></table></figure><h1 id="五、客户端挂载参数"><a href="#五、客户端挂载参数" class="headerlink" title="五、客户端挂载参数"></a>五、客户端挂载参数</h1><ul><li>客户端挂载：mount 命令</li><li>挂载信息文件路径：&#x2F;proc&#x2F;mounts</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 ~]# grep 192.168.1.40 /proc/mounts </span><br><span class="line">192.168.1.40:/data/rw /mnt nfs4 rw,relatime,vers=4.1,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.1.20,local_lock=none,addr=192.168.1.40 0 0</span><br></pre></td></tr></table></figure><table><thead><tr><th align="left">参数</th><th align="left">描述</th><th align="left"></th></tr></thead><tbody><tr><td align="left">-t</td><td align="left">指定文件系统类型</td><td align="left">本地：xfs、ext4&#x2F;ext3<div>远程：nfs 等等</div></td></tr><tr><td align="left">-o</td><td align="left">指定挂载详细参数</td><td align="left"></td></tr></tbody></table><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#有时候卸载共享目录会出现卡住和报错，我们可以使用 `-lf` 参数强制卸载 </span></span><br><span class="line">[root@web01 ~]# umount -lf /mnt/</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nfs客户端挂载时，可以使用 `-o`将可读写目录挂载为只读</span></span><br><span class="line"><span class="comment">## ro 则为只读</span></span><br><span class="line">[root@web01 ~]# mount -t nfs -o ro 192.168.1.40:/data/rw /mnt</span><br><span class="line">[root@web01 ~]# <span class="built_in">df</span> -h</span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs                 898M     0  898M   0% /dev</span><br><span class="line">tmpfs                    910M     0  910M   0% /dev/shm</span><br><span class="line">tmpfs                    910M  9.6M  901M   2% /run</span><br><span class="line">tmpfs                    910M     0  910M   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root   17G  7.2G  9.9G  43% /</span><br><span class="line">/dev/sda1               1014M  151M  864M  15% /boot</span><br><span class="line">tmpfs                    182M     0  182M   0% /run/user/0</span><br><span class="line">192.168.1.40:/data/rw     17G  1.9G   16G  11% /mnt</span><br><span class="line"></span><br><span class="line">[root@web01 ~]# grep 192.168.1.40 /proc/mounts </span><br><span class="line">192.168.1.40:/data/rw /mnt nfs4 ro,relatime,vers=4.1,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.1.20,local_lock=none,addr=192.168.1.40 0 0</span><br><span class="line"></span><br><span class="line">[root@web01 ~]# <span class="built_in">ls</span> /mnt/</span><br><span class="line">as.txt  q.txt</span><br><span class="line">[root@web01 ~]# <span class="built_in">touch</span> /mnt/3.txt</span><br><span class="line"><span class="built_in">touch</span>: cannot <span class="built_in">touch</span> ‘/mnt/3.txt’: Read-only file system</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 将上面的ro修改为rw</span></span><br><span class="line">[root@web01 ~]# mount -o rw,remount /mnt</span><br><span class="line">[root@web01 ~]# grep 192.168.1.40 /proc/mounts </span><br><span class="line">192.168.1.40:/data/rw /mnt nfs4 rw,relatime,vers=4.1,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=192.168.1.20,local_lock=none,addr=192.168.1.40 0 0</span><br></pre></td></tr></table></figure><ul><li><p><code>故障案例：</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 背景：以为内一些原因磁盘故障，整个磁盘（文件系统）变为只读模式，报错为：Read-only file system</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排查：查询具体是哪个分区变为只读，例如/mnt分区只读</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解决：mount -o  rw,remount /mnt</span></span><br></pre></td></tr></table></figure></li><li><p><code>永久挂载</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我们现在使用命令挂载，都是临时的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法1: 写入/etc/rc.local</span></span><br><span class="line"><span class="comment">## 注意：/etc/rc.d/rc.local必须有执行权限 chown +x</span></span><br><span class="line">[root@web01 ~]# <span class="built_in">chmod</span> +x /etc/rc.d/rc.local </span><br><span class="line">[root@web01 ~]# ll /etc/rc.d/rc.local </span><br><span class="line">-rwxr-xr-x. 1 root root 473 Oct  2  2020 /etc/rc.d/rc.local</span><br><span class="line">[root@web01 ~]# <span class="built_in">tail</span> -1 /etc/rc.local </span><br><span class="line">mount -t nfs -o rw 192.168.1.40:/data/rw /mnt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法2：写入/etc/fstab里</span></span><br><span class="line">[root@web01 ~]# <span class="built_in">tail</span> -1 /etc/fstab </span><br><span class="line"><span class="comment"># 远程共享目录ip+路径    #本地挂载目录  #挂载文件系统类型  #参数（以后可以写rw等等） #0 0</span></span><br><span class="line">192.168.1.40:/data/rw  /code/blog  nfs defaults 0 0</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h1 id="六、-NFS-存储小结"><a href="#六、-NFS-存储小结" class="headerlink" title="六、 NFS 存储小结"></a>六、 NFS 存储小结</h1><h2 id="1-NFS-存储优点"><a href="#1-NFS-存储优点" class="headerlink" title="1. NFS 存储优点"></a>1. NFS 存储优点</h2><ul><li>01：NFS 文件系统简单易用、方便部署、数据可靠、服务稳定，适合中小型企业</li><li>02：NFS 文件系统内存放的数据都在文件系统之上，所有数据都看得见</li></ul><h2 id="2-NFS-存储局限"><a href="#2-NFS-存储局限" class="headerlink" title="2. NFS 存储局限"></a>2. NFS 存储局限</h2><ul><li>01：存在单点故障，如果构建高可用维护麻烦</li><li>02：NFS 数据明文，并不对数据做任何校验</li><li>03：客户端挂载 NFS 服务没有密码验证，安全性一般（只推荐内网使用）</li></ul><h2 id="3-NFS-应用建议"><a href="#3-NFS-应用建议" class="headerlink" title="3. NFS 应用建议"></a>3. NFS 应用建议</h2><ul><li>01：生产场景应将静态数据尽可能往前端推，减少后端压力</li><li>02：必须将存储里的静态资源通过 CDN 缓存（jpg|png|mp4|css|js）</li><li>03：如果没有缓存或架构本身历史遗留问题太大，再多存储也没用</li></ul><h1 id="七、优化设置"><a href="#七、优化设置" class="headerlink" title="七、优化设置"></a>七、优化设置</h1><h2 id="a-安全优化-（掌握）"><a href="#a-安全优化-（掌握）" class="headerlink" title="a.安全优化 （掌握）"></a>a.安全优化 （掌握）</h2><blockquote><p>客户端挂载时选择一些优化参数</p><ul><li>nosuid</li><li>nodev</li><li>noexec</li></ul></blockquote><table><thead><tr><th align="left">参数</th><th align="left">描述</th><th align="left"></th></tr></thead><tbody><tr><td align="left">suid<div>nosuid</div></td><td align="left">当挂载的文件系统上有 SUID 的程序时，只要使用 nosuid 就能取消设置 SUID 的功能</td><td align="left"></td></tr><tr><td align="left">rw<div>ro</div></td><td align="left">可以指定文件系统是只读（ro）或读写（rw）</td><td align="left"></td></tr><tr><td align="left">dev<div>nodev</div></td><td align="left">是否可以保留某些文件的特殊功能</td><td align="left">一般来说只有&#x2F;dev 才有特殊的文件，因此可以选择 nodev</td></tr><tr><td align="left">exec<div>noexec</div></td><td align="left">是否具有执行文件的权限</td><td align="left">如果挂载的只是普通文件（图片、视频、…）那么可以选择 noexec</td></tr><tr><td align="left">user<div>nouser</div></td><td align="left">是否允许用户进行文件的挂载与卸载功能</td><td align="left">如果要保护文件系统，最好不要提供用户进行挂载与卸载，可以选择 nouser</td></tr><tr><td align="left">auto<div>noauto</div></td><td align="left">这个 auto 指的是 <code>mount -a</code> 时会不会被挂载的项目</td><td align="left">如果不需要某个分区随时被挂载，可以设置为 noauto<div>例如：&#x2F;etc&#x2F;fstab&nbsp; auto</div></td></tr><tr><td align="left"></td><td align="left"></td><td align="left"></td></tr></tbody></table><h2 id="b-性能优化-了解"><a href="#b-性能优化-了解" class="headerlink" title="b. 性能优化 (了解)"></a>b. 性能优化 (了解)</h2><table><thead><tr><th align="left">参数</th><th align="left">描述</th><th align="left"></th></tr></thead><tbody><tr><td align="left">rsize<div>wsize</div></td><td align="left">设置读（rsize）与写入（wsize）的区块大小（block size）</td><td align="left">这个值可以影响客户端与服务端传输数据的缓冲存储量，一般来说如果在局域网内，并且客户端与服务端都有足够的内存，可以设置的大一点，比如 65535，提升缓冲区可提升 nfs 文件系统的传输能力，但设置的不能太大，最好以网络能够传输的最大值为限</td></tr><tr><td align="left"></td><td align="left"></td><td align="left"></td></tr></tbody></table><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## rsize=131072,wsize=131072</span></span><br><span class="line">[root@web01 ~]# grep 192.168.1.40 /proc/mounts </span><br><span class="line">192.168.1.40:/data/rw /mnt nfs4 rw,relatime,vers=4.1,rsize=131072,wsize=131072,n168.1.20,local_lock=none,addr=192.168.1.40 0 0</span><br></pre></td></tr></table></figure><h2 id="c-内核参数优化"><a href="#c-内核参数优化" class="headerlink" title="c. 内核参数优化"></a>c. 内核参数优化</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 ~]# <span class="built_in">cat</span> /proc/sys/net/core/rmem_max </span><br><span class="line">212992</span><br><span class="line">[root@web01 ~]# <span class="built_in">cat</span> /proc/sys/net/core/rmem_default </span><br><span class="line">212992</span><br><span class="line">[root@web01 ~]# <span class="built_in">cat</span> /proc/sys/net/core/wmem_default </span><br><span class="line">212992</span><br><span class="line">[root@web01 ~]# <span class="built_in">cat</span> /proc/sys/net/core/wmem_max </span><br><span class="line">212992</span><br></pre></td></tr></table></figure><ul><li>上述文件如何修改内容，命令如下：<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt;/etc/sysctl.conf&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">net.core.wmem_default = 8388608</span></span><br><span class="line"><span class="string">net.core.rmem_default = 8388608</span></span><br><span class="line"><span class="string">net.core.rmem_max = 16777216</span></span><br><span class="line"><span class="string">net.core.wmem_max = 16777216</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##加载配置文件</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure></li></ul><h1 id="八、优化小结"><a href="#八、优化小结" class="headerlink" title="八、优化小结"></a>八、优化小结</h1><table><thead><tr><th align="left">参数</th><th align="left">描述</th><th align="left"></th></tr></thead><tbody><tr><td align="left">rsize<div>wsize</div></td><td align="left">设置读（rsize）与写入（wsize）的区块大小（block size）</td><td align="left">这个值可以影响客户端与服务端传输数据的缓冲存储量，一般来说如果在局域网内，并且客户端与服务端都有足够的内存，可以设置的大一点，比如 65535，提升缓冲区可提升 nfs 文件系统的传输能力，但设置的不能太大，最好以网络能够传输的最大值为限</td></tr><tr><td align="left"></td><td align="left"></td><td align="left"></td></tr></tbody></table><ul><li>添加硬件（最简单）：sas&#x2F;ssd 硬盘，买多块组成 raid，制作 raid5 或 raid10.</li><li>NFS 服务器端配置<ul><li>&#x2F;data xxxx&#x2F;24 (rw, sync, all_squash, anonuid&#x3D;65534, anongid&#x3D;65534)  xxxx&#x2F;24</li></ul></li><li>NFS 客户端挂载命令优化：<ul><li>mount -t nfs -o <span style="background:rgba(28, 210, 16, 0.55)">nosuid,noexec,nodev</span>,<span style="background:#40a9ff">noatime,nodiratime,rsize&#x3D;131072,wsize&#x3D;131072</span>  192.168.1.40&#x2F;24:&#x2F;data &#x2F;mnt</li></ul></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nosuid，noexec，nodev：安全相关选项</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">noatime，nodiratime，rsize，wsize：性能选项</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#noatime，nodiratime：时间相关</span></span></span><br><span class="line">1、关于文件的几个时间</span><br><span class="line"></span><br><span class="line">我们通过stat命令查看文件的信息，</span><br><span class="line"></span><br><span class="line">[root@CentOS-6-5 /home]# stat a</span><br><span class="line">  File: `a</span><br><span class="line">  Size: 12552     Blocks: 32         IO Block: 4096   regular file</span><br><span class="line">Device: 802h/2050dInode: 1177548     Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2019-10-23 16:54:55.259130660 +0800</span><br><span class="line">Modify: 2019-10-23 16:54:55.259130660 +0800</span><br><span class="line">Change: 2019-10-23 16:54:55.259130660 +0800</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">其中有三个时间，</span><br><span class="line">access：文件上次被读取的时间，文件被读取，执行，打开都会触发更新</span><br><span class="line">modify：文件上次被修改的时间，</span><br><span class="line">change：文件上次权限属主被修改的时间</span><br><span class="line"></span><br><span class="line">2、noatime选项</span><br><span class="line"></span><br><span class="line">对于文件系统，有时候为了提供性能，会设置noatime选项，这个选项的意思是不更新文件的access时间。所以在读取、打开、执行文件时都不会修改，这在一定程度上就降低了系统的IO，尤其是对于读取居多的服务器。</span><br><span class="line"></span><br><span class="line">未设置noatime</span><br><span class="line"></span><br><span class="line">[root@CentOS-6-5 /home]# mount | grep sda2</span><br><span class="line">/dev/sda2 on / type ext4 (rw)</span><br><span class="line">[root@CentOS-6-5 /home]# stat a</span><br><span class="line">  File: `a</span><br><span class="line">  Size: 6         Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: 802h/2050dInode: 1177548     Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2019-10-23 16:54:55.259130660 +0800</span><br><span class="line">Modify: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line">Change: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line">[root@CentOS-6-5 /home]# cat a</span><br><span class="line">hello</span><br><span class="line">[root@CentOS-6-5 /home]# stat a</span><br><span class="line">  File: `a</span><br><span class="line">  Size: 6         Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: 802h/2050dInode: 1177548     Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2019-10-26 22:25:14.722556455 +0800</span><br><span class="line">Modify: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line">Change: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">此时文件系统未设置noatime，读取文件后，文件的access时间发生更新。</span><br><span class="line"></span><br><span class="line">现在我们通过remount添加noatime选项，</span><br><span class="line"></span><br><span class="line">[root@CentOS-6-5 /home]# mount -o remount,noatime /dev/sda2</span><br><span class="line">[root@CentOS-6-5 /home]# mount  | grep sda2</span><br><span class="line">/dev/sda2 on / type ext4 (rw,noatime)</span><br><span class="line">[root@CentOS-6-5 /home]# stat a</span><br><span class="line">  File: `a</span><br><span class="line">  Size: 6         Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: 802h/2050dInode: 1177548     Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2019-10-26 22:25:14.722556455 +0800</span><br><span class="line">Modify: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line">Change: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line">[root@CentOS-6-5 /home]# cat a</span><br><span class="line">hello</span><br><span class="line">[root@CentOS-6-5 /home]# stat a</span><br><span class="line">  File: `a</span><br><span class="line">  Size: 6         Blocks: 8          IO Block: 4096   regular file</span><br><span class="line">Device: 802h/2050dInode: 1177548     Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2019-10-26 22:25:14.722556455 +0800</span><br><span class="line">Modify: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line">Change: 2019-10-26 22:16:49.186557777 +0800</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">可见，添加noatime后，执行同样的读取文件操作，文件的access时间并没有更新，因此就可以节约大量的IO，提供系统性能。</span><br><span class="line"></span><br><span class="line">3、nodiratime选项</span><br><span class="line"></span><br><span class="line">noatime是对于文件而言，那对于目录呢。其实在linux上，目录也是一种文件，毕竟在 linux上everything is a file。因此当设置noatime时，对于目录也是一样的效果。如果想要单独对目录有此效果，就可以使用nodiratime。因此noatime设置后，就无需再设置nodiratime。</span><br></pre></td></tr></table></figure><ul><li>如果<span style="background:rgba(28, 210, 16, 0.55)">卸载</span>的时候提示“umount &#x2F;mnt: device is busy”<ul><li>需要退出挂载目录再进行卸载</li><li>如果是 NFS 服务端宕机，需要强制卸载，<code>umount -lf /mnt </code></li></ul></li><li>大型网站 NFS 网络文件系统的替代软件为&#x3D;&#x3D;分布式文件系统&#x3D;&#x3D;Moosefs（MFS），GlusterFS (大文件)、FastDFS.</li></ul><h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><h2 id="1-重启后无敌时间"><a href="#1-重启后无敌时间" class="headerlink" title="1. 重启后无敌时间"></a>1. 重启后无敌时间</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在我们使用restart重启nfs后，默认会有90秒的无敌时间，此时客户端挂载会卡住无法操作</span></span><br><span class="line"><span class="comment">## 解决：使用reload加载配置文件：systemctl reload nfs</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端重启nfs</span></span><br><span class="line">[root@nfs01 ~]# systemctl restart nfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端进行挂载会处于等待状态</span></span><br><span class="line">[root@web01 ~]# mount -t nfs 192.168.1.40:/data/ro /mnt/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@web01 ~]# </span><br></pre></td></tr></table></figure><p><img src="/images/202403291252635.png"></p>]]></content>
      
      
      <categories>
          
          <category> 综合架构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文档 </tag>
            
            <tag> 基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenSSH远程服务</title>
      <link href="/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1/Openssh/"/>
      <url>/2024/07/29/%E7%BB%BC%E5%90%88%E6%9E%B6%E6%9E%84/%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1/Openssh/</url>
      
        <content type="html"><![CDATA[<h1 id="一、服务概述"><a href="#一、服务概述" class="headerlink" title="一、服务概述"></a>一、服务概述</h1><ul><li>一般用于远程连接或者本地连接</li><li>远程连接：在办公室连接 idc 机房或云服务器</li><li>本地连接：在机房里直接操作服务器</li><li>远程管理卡（物理服务器）：服务器宕机、关机、死机，通过远程管理卡进行维护</li></ul><p>ssh 包括哪些东西</p><ul><li>openssh-server：服务端</li><li>opssh-client：客户端（xshell 等远程连接工具）</li><li>openssl（加密功能）</li></ul><h2 id="1-ssh-介绍"><a href="#1-ssh-介绍" class="headerlink" title="1.  ssh 介绍"></a>1.  ssh 介绍</h2><pre><code>SSH是Secure Shell Protocol的简写，由 IETF网络工作小组（Network Working Group）制定；在进行数据传输之前，SSH先对联机数据进行加密，加密后在进行数据传输，确保了数据的安全 在默认状态下，SSH服务主要提供两个功能： - （1）提供类似telnet远程连接服务器的功能。 - （2）类似FTP服务的sftp-server，借助SSH协议来传输数据，提供更安全的SFTP服务。</code></pre><blockquote><p>👺 特别提醒：<br>        SSH 客户端（ssh 命令）还包含一个很有用的远程安全拷贝命令：scp<br>        它也是通过 ssh 协议工作的</p></blockquote><ul><li><p>知识小结：</p><ul><li>（1）SSH 是安全的加密 <code>协议</code>，用于远程连接 linux 服务器。</li><li>（2）SSH 服务默认端口是 <code>22</code>，安全协议版本 SSH2.（SSH1 有漏洞，基本不再使用）</li><li>（3）SSH 服务端主要包含两个服务功能，<code>①SSH远程连接，②SFTP服务</code></li><li>（4）Linux 中 SSH 客户端包含 ssh 远程连接命令，以及 scp 等。</li></ul></li><li><p>ssh-client 包含的命令</p><ul><li>（1）ssh</li><li>（2）scp</li><li>（3）sftp</li></ul></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### ssh服务端包含的命令和文件路径</span></span><br><span class="line">[root@ssh01 ~]# rpm -ql openssh-server</span><br><span class="line">/etc/pam.d/sshd</span><br><span class="line">/etc/ssh/sshd_config</span><br><span class="line">/etc/sysconfig/sshd</span><br><span class="line">/usr/lib/systemd/system/sshd-keygen.service</span><br><span class="line">/usr/lib/systemd/system/sshd.service</span><br><span class="line">/usr/lib/systemd/system/sshd.socket</span><br><span class="line">/usr/lib/systemd/system/sshd@.service</span><br><span class="line">/usr/lib64/fipscheck/sshd.hmac</span><br><span class="line">/usr/libexec/openssh/sftp-server</span><br><span class="line">/usr/sbin/sshd</span><br><span class="line">/usr/sbin/sshd-keygen</span><br><span class="line">/usr/share/man/man5/moduli.5.gz</span><br><span class="line">/usr/share/man/man5/sshd_config.5.gz</span><br><span class="line">/usr/share/man/man8/sftp-server.8.gz</span><br><span class="line">/usr/share/man/man8/sshd.8.gz</span><br><span class="line">/var/empty/sshd</span><br><span class="line"></span><br><span class="line"><span class="comment">### 客户端命令和文件的路径   </span></span><br><span class="line">[root@ssh01 ~]# rpm -ql openssh-clients</span><br><span class="line">/etc/ssh/ssh_config</span><br><span class="line">/usr/bin/scp</span><br><span class="line">/usr/bin/sftp</span><br><span class="line">/usr/bin/slogin</span><br><span class="line">/usr/bin/ssh</span><br><span class="line">/usr/bin/ssh-add</span><br><span class="line">/usr/bin/ssh-agent</span><br><span class="line">/usr/bin/ssh-copy-id</span><br><span class="line">/usr/bin/ssh-keyscan</span><br><span class="line">/usr/lib64/fipscheck/ssh.hmac</span><br><span class="line">/usr/libexec/openssh/ssh-pkcs11-helper</span><br><span class="line">/usr/share/man/man1/scp.1.gz</span><br><span class="line">/usr/share/man/man1/sftp.1.gz</span><br><span class="line">/usr/share/man/man1/slogin.1.gz</span><br><span class="line">/usr/share/man/man1/ssh-add.1.gz</span><br><span class="line">/usr/share/man/man1/ssh-agent.1.gz</span><br><span class="line">/usr/share/man/man1/ssh-copy-id.1.gz</span><br><span class="line">/usr/share/man/man1/ssh-keyscan.1.gz</span><br><span class="line">/usr/share/man/man1/ssh.1.gz</span><br><span class="line">/usr/share/man/man5/ssh_config.5.gz</span><br><span class="line">/usr/share/man/man8/ssh-pkcs11-helper.8.gz</span><br></pre></td></tr></table></figure><h2 id="2-密钥类型-dsa-和-rsa"><a href="#2-密钥类型-dsa-和-rsa" class="headerlink" title="2. 密钥类型 (dsa 和 rsa)"></a>2. 密钥类型 (dsa 和 rsa)</h2><blockquote><p>dsa 是旧的密钥类型：<br>    - 对称加密，加&#x2F;解速度快、密钥量短<br>    - 只能用于签名</p><p>rsa 是新的类型：<br>    - 非对称加密、加&#x2F;解速度慢、密钥量长，安全性高<br>    - 可以用于签名、加密、解密</p></blockquote><p><code>对称和非对称加密</code>：</p><ul><li>对称：使用一个密钥进行加&#x2F;解，速度快，适合大量数据进行加密</li><li>非对称：使用一对密钥分别完成加&#x2F;解，公钥加密，私钥解密，机制灵活，但是速度慢</li></ul><h1 id="二、远程连接过程"><a href="#二、远程连接过程" class="headerlink" title="二、远程连接过程"></a>二、远程连接过程</h1><p><img src="https://jsd.cdn.zzko.cn/gh/Tripitz/Markdown-img@main/Openssh/202403291304797.png"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 01.第一次连接时，会自动记录指纹信息到当前用户家目录下的.ssh目录中</span></span><br><span class="line">[root@ssh01 ~]# ssh 192.168.1.20</span><br><span class="line">The authenticity of host <span class="string">&#x27;192.168.1.20 (192.168.1.20)&#x27;</span> cant be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:xwVpL0zxUqhoVgWCmUpqbnYkdEZ0kK5rlUcCmAQWvrE.</span><br><span class="line">ECDSA key fingerprint is MD5:1e:cb:83:42:81:b4:65:d0:65:17:0d:5b:a7:40:14:56.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span> connecting (<span class="built_in">yes</span>/no)? </span><br><span class="line"></span><br><span class="line">[root@ssh01 ~]# ll .ssh</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root 174 Mar 14 17:10 known_hosts</span><br><span class="line">[root@ssh01 ~]# <span class="built_in">cat</span> .ssh/known_hosts </span><br><span class="line">192.168.1.20 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOvuOmtMEIXw3dvHxDYxYM5vVyPmlkQCmBxXIWie7iFD6W38C+uRoWjLr0QufaWhgkzm61i1cir0+UCJOxSOcQM=</span><br><span class="line"></span><br><span class="line"><span class="comment">### 02.输入yes确认继续连接</span></span><br><span class="line">[root@ssh01 ~]# ssh 192.168.1.20</span><br><span class="line">The authenticity of host <span class="string">&#x27;192.168.1.20 (192.168.1.20)&#x27;</span> cant be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:xwVpL0zxUqhoVgWCmUpqbnYkdEZ0kK5rlUcCmAQWvrE.</span><br><span class="line">ECDSA key fingerprint is MD5:1e:cb:83:42:81:b4:65:d0:65:17:0d:5b:a7:40:14:56.</span><br><span class="line"><span class="comment">### 【是否继续连接】</span></span><br><span class="line">Are you sure you want to <span class="built_in">continue</span> connecting (<span class="built_in">yes</span>/no)? <span class="built_in">yes</span></span><br><span class="line">Warning: Permanently added <span class="string">&#x27;192.168.1.20&#x27;</span> (ECDSA) to the list of known hosts.</span><br><span class="line"><span class="comment">#### 输入目标主机的密码</span></span><br><span class="line">root@192.168.1.20 password: </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 03.输入密码登录目标主机</span></span><br><span class="line"><span class="comment">##### 只有第一次连接时会出现记录指纹信息提示</span></span><br><span class="line">[root@ssh01 ~]# ssh 192.168.1.20</span><br><span class="line">root@192.168.1.20 s password: </span><br><span class="line">Last login: Thu Mar 14 17:06:29 2024 from 192.168.1.25</span><br><span class="line"></span><br><span class="line">[root@web01 ~]# hostname -I</span><br><span class="line">192.168.1.20 192.168.5.8 </span><br><span class="line"></span><br><span class="line"><span class="comment">### 04.退出登录</span></span><br><span class="line">[root@web01 ~]# <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">logout</span></span><br><span class="line">Connection to 192.168.1.20 closed.</span><br></pre></td></tr></table></figure><blockquote><p>👺注意：如果把 .ssh&#x2F;known_hosts 删除，则连接时会再次记录指纹信息</p></blockquote><h1 id="三、SSH-vs-Telnet"><a href="#三、SSH-vs-Telnet" class="headerlink" title="三、SSH  vs  Telnet"></a>三、SSH  vs  Telnet</h1><ul><li>ssh 与 telnet 的不同点</li><li><strong>安全性</strong>：ssh 是加密连接，telnet 是明文。</li><li><strong>功能性</strong>：ssh 不仅可以远程连接与执行命令，还可以进行文件传输（scp、sftp）等，而 telnet 主要用于连接和执行命令</li><li><strong>配置</strong>：ssh 配置复杂但是安全性高，telnet 配置简单、安全性低</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 01.安装</span></span><br><span class="line">[root@ssh01 ~]# yum install -y telnet-server</span><br><span class="line"></span><br><span class="line">[root@ssh01 ~]# rpm -ql telnet-server</span><br><span class="line">/usr/lib/systemd/system/telnet.socket</span><br><span class="line">/usr/lib/systemd/system/telnet@.service</span><br><span class="line">/usr/sbin/in.telnetd</span><br><span class="line">/usr/share/man/man5/issue.net.5.gz</span><br><span class="line">/usr/share/man/man8/in.telnetd.8.gz</span><br><span class="line">/usr/share/man/man8/telnetd.8.gz</span><br><span class="line"></span><br><span class="line">[root@ssh01 ~]# systemctl restart telnet.socket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 02.使用</span></span><br><span class="line">[C:\~]$ telnet 192.168.1.244 23</span><br><span class="line"></span><br><span class="line">Connecting to 192.168.1.244:23...</span><br><span class="line">Connection established.</span><br><span class="line">To escape to <span class="built_in">local</span> shell, press <span class="string">&#x27;Ctrl+Alt+]&#x27;</span>.</span><br><span class="line">Kernel 3.10.0-1160.el7.x86_64 on an x86_64</span><br><span class="line">ssh01 login: lsq</span><br><span class="line">Password: </span><br><span class="line">Last login: Thu Mar 14 18:07:24 from ::ffff:192.168.1.254</span><br></pre></td></tr></table></figure><blockquote><p>使用抓包工具可以看到，登录时用户和密码都是明文的</p></blockquote><p><img src="https://jsd.cdn.zzko.cn/gh/Tripitz/Markdown-img@main/Openssh/202403291304081.png"></p><p><img src="https://jsd.cdn.zzko.cn/gh/Tripitz/Markdown-img@main/Openssh/202403291305777.png"></p><blockquote><p>执行的命令也可以被抓包到<br><img src="https://jsd.cdn.zzko.cn/gh/Tripitz/Markdown-img@main/Openssh/202403291305764.png"></p></blockquote><h1 id="四、密钥认证"><a href="#四、密钥认证" class="headerlink" title="四、密钥认证"></a>四、密钥认证</h1><h2 id="1-原理"><a href="#1-原理" class="headerlink" title="1. 原理"></a>1. 原理</h2><p><img src="https://jsd.cdn.zzko.cn/gh/Tripitz/Markdown-img@main/Openssh/202403291305563.png"></p><h2 id="2-环境配置"><a href="#2-环境配置" class="headerlink" title="2.  环境配置"></a>2.  环境配置</h2><table><thead><tr><th>角色</th><th></th><th></th></tr></thead><tbody><tr><td>管理机</td><td>ssh01</td><td>192.168.1.244</td></tr><tr><td>被管理</td><td>backup01</td><td>100</td></tr><tr><td>被管理</td><td>nfs01</td><td>103</td></tr><tr><td>01. 创建密钥对</td><td></td><td></td></tr></tbody></table><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@ssh01 ~]# ssh-keygen -t rsa</span><br><span class="line">Generating public/private rsa key pair. </span><br><span class="line"></span><br><span class="line"><span class="comment">### 密钥对存放路径</span></span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): </span><br><span class="line"></span><br><span class="line"><span class="comment">### 密码</span></span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line"><span class="comment">## 确认密码</span></span><br><span class="line">Enter same passphrase again: </span><br><span class="line"></span><br><span class="line"><span class="comment">### 密钥信息已被保存到指定目录</span></span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line"></span><br><span class="line"><span class="comment">### 密钥信息</span></span><br><span class="line"><span class="comment">## SHA256哈希值，用于该密钥的唯一标识，root（用户）ssh01（主机）</span></span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:+ue1rVaz4gWAmRs7VdZwCMmKyR8bKouFmlj55t/G5HQ root@ssh01</span><br><span class="line">The key<span class="string">&#x27;s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|         ..o++.  |</span></span><br><span class="line"><span class="string">|         +oo...  |</span></span><br><span class="line"><span class="string">|     . o=.o      |</span></span><br><span class="line"><span class="string">|      + += .     |</span></span><br><span class="line"><span class="string">|   o   oS+  .    |</span></span><br><span class="line"><span class="string">|  + o ..=.E  .o  |</span></span><br><span class="line"><span class="string">|.+ + o.= .  ...o |</span></span><br><span class="line"><span class="string">|+ . +  o+ ..o+.  |</span></span><br><span class="line"><span class="string">|   o....oo.o+o.  |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br></pre></td></tr></table></figure><ol start="2"><li><p>发送公钥</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@ssh01 ~]# ssh-copy-id -i  /root/.ssh/id_rsa.pub 192.168.1.100</span><br><span class="line"><span class="comment">### 公钥所在目录</span></span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: <span class="string">&quot;/root/.ssh/id_rsa.pub&quot;</span></span><br><span class="line">The authenticity of host <span class="string">&#x27;192.168.1.100 (192.168.1.100)&#x27;</span> cant be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:xwVpL0zxUqhoVgWCmUpqbnYkdEZ0kK5rlUcCmAQWvrE.</span><br><span class="line">ECDSA key fingerprint is MD5:1e:cb:83:42:81:b4:65:d0:65:17:0d:5b:a7:40:14:56.</span><br><span class="line"></span><br><span class="line"><span class="comment">### 确定连接吗</span></span><br><span class="line">Are you sure you want to <span class="built_in">continue</span> connecting (<span class="built_in">yes</span>/no)? <span class="built_in">yes</span></span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to <span class="built_in">log</span> <span class="keyword">in</span> with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- <span class="keyword">if</span> you are prompted now it is to install the new keys</span><br><span class="line"></span><br><span class="line"><span class="comment">### 目标主机的密码</span></span><br><span class="line">root@192.168.1.100\&#x27;s password: </span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   <span class="string">&quot;ssh &#x27;192.168.1.100&#x27;&quot;</span></span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 目标主机的.ssh目录下就会有 &#x27;authorized_keys&#x27;文件</span></span><br><span class="line">[root@backup01 ~]# ll .ssh/</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root 175 Mar  6 18:46 known_hosts</span><br><span class="line">[root@backup01 ~]# ll .ssh/</span><br><span class="line">total 8</span><br><span class="line">-rw------- 1 root root 392 Mar 19 12:50 authorized_keys</span><br><span class="line">-rw-r--r-- 1 root root 175 Mar  6 18:46 known_hosts</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 存储的是公钥信息</span></span><br><span class="line">[root@backup01 ~]# <span class="built_in">cat</span> .ssh/authorized_keys </span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDj7FvgdxSO2SC+/wSvZXfALewabKK+oTZb6Pn0D5OKUGBQvX56CKfLY6XCm0AgPSs+0t0bj4/C+Jk73a7Z7+3Q9dRcf7PqVUzobRUAXVnT2vSC7z17Nha1adnf6fJqZtlmxfraM8Ah97tsOdRRlkU2pkA7vyP8ENC3csedyrVcI+4oo1QlH8/JF9TYq5cjRy3sW06QIxa07PgtcUBIBVbCydIzyjHpqJHp1kzr7+tZVIGpgbwW4KuHHz07FR8vdaOrNg6mhvjgfYf05//GRbyv+EFPyuZ7E4auhJVjA2JjgCl9X7qiR7oCfv2OTWimIFHnKBOKB8Cl/wiqzeMiF7kf root@ssh01</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 不需要密码</span></span><br><span class="line">[root@ssh01 ~]# ssh 192.168.1.100</span><br><span class="line">Last login: Tue Mar 19 12:47:44 2024 from 192.168.1.254</span><br><span class="line">[root@backup01 ~]# hostname -I</span><br><span class="line">192.168.1.100 192.168.5.6 </span><br></pre></td></tr></table></figure></li></ol><h2 id="3-ssh-copy-id-原理"><a href="#3-ssh-copy-id-原理" class="headerlink" title="3. ssh-copy-id 原理"></a>3. ssh-copy-id 原理</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@backup01 ~]# <span class="built_in">which</span> ssh-copy-id</span><br><span class="line">/usr/bin/ssh-copy-id</span><br><span class="line">[root@backup01 ~]# vim /usr/bin/ssh-copy-id </span><br><span class="line">295       ssh <span class="string">&quot;<span class="variable">$@</span>&quot;</span> <span class="string">&quot;exec sh -c &#x27;cd ; umask 077 ; mkdir -p .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys || exit 1 ; if type restorecon &gt;/dev/null 2&gt;&amp;1 ; then     restorecon -F .ssh .ssh/authorized_keys ; fi&#x27;&quot;</span> \</span><br><span class="line">         || <span class="built_in">exit</span> 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 连接到指定主机，然后执行一些命令</span></span><br><span class="line">ssh <span class="string">&quot;<span class="variable">$@</span>&quot;</span> <span class="string">&quot;exec sh -c &#x27;cd ; </span></span><br><span class="line"><span class="string">umask 077 ; mkdir -p .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys || exit 1 ; if type restorecon &gt;/dev/null 2&gt;&amp;1 ; then     restorecon -F .ssh .ssh/authorized_keys ; fi&#x27;&quot;</span> \</span><br><span class="line">         || <span class="built_in">exit</span> 1</span><br><span class="line"></span><br><span class="line"><span class="comment">## 切换到当前用户家目录下</span></span><br><span class="line"><span class="built_in">cd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改权限（系统的umask权限）：目录700，文件600</span></span><br><span class="line"><span class="comment">#这是此条命令临时修改，切勿永久修改</span></span><br><span class="line"><span class="built_in">umask</span> 077</span><br><span class="line"></span><br><span class="line"><span class="comment">## 在家目录下创建.ssh目录（-p是为了防止报错）</span></span><br><span class="line"><span class="built_in">mkdir</span> -p .ssh</span><br><span class="line"></span><br><span class="line"><span class="comment">## 将公钥信息追加到authorized_keys文件中（如果没有则是创建后写入，有则是追加）</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; .ssh/authorized_keys</span><br></pre></td></tr></table></figure><h1 id="五、服务端配置文件"><a href="#五、服务端配置文件" class="headerlink" title="五、服务端配置文件"></a>五、服务端配置文件</h1><h2 id="0-配置文件解析"><a href="#0-配置文件解析" class="headerlink" title="0. 配置文件解析"></a>0. 配置文件解析</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">/etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="comment">## 连接端口</span></span><br><span class="line">Port 22</span><br><span class="line"></span><br><span class="line"><span class="comment">##监听网卡：连接指定网卡ip才能进行访问</span></span><br><span class="line"><span class="comment">## 后面带的是该主机某个网卡ip，不是网段</span></span><br><span class="line">ListenAddress x.x.x.x </span><br><span class="line"></span><br><span class="line"><span class="comment">## 默认创建的密钥文件（一定不要删除，删了就会出问题）</span></span><br><span class="line">HostKey /etc/ssh/ssh_host_rsa_key</span><br><span class="line">HostKey /etc/ssh/ssh_host_ecdsa_key</span><br><span class="line">HostKey /etc/ssh/ssh_host_ed25519_key</span><br><span class="line"></span><br><span class="line"><span class="comment">## 日志相关</span></span><br><span class="line">SyslogFacility AUTHPRIV</span><br><span class="line"></span><br><span class="line"><span class="comment">## 是否允许root用户远程登录</span></span><br><span class="line">PermitRootLogin <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 是否允许密钥登录</span></span><br><span class="line">PubkeyAuthentication <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 能连接到本主机的公钥信息，都在这个文件中</span></span><br><span class="line">AuthorizedKeysFile.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment">## 是否允许密码登录</span></span><br><span class="line">PasswordAuthentication <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 禁止使用空密码登录</span></span><br><span class="line">PermitEmptyPasswords no</span><br><span class="line"></span><br><span class="line"><span class="comment">## 用于禁用挑战响应认证（Challenge-Response Authentication）方式。</span></span><br><span class="line"><span class="comment">## 挑战响应认证是一种基于密码的认证方式，其中服务器会向客户端发送一个挑战，客户端需要用正确的密码来响应这个挑战以通过[身份验证]</span></span><br><span class="line"><span class="comment">## 禁用该认证方式可以提高系统的安全性，因为它减少了密码在网络传输中被窃取的风险。</span></span><br><span class="line">ChallengeResponseAuthentication no</span><br><span class="line"></span><br><span class="line"><span class="comment">## 是否允许基于GSSAPI用户登录</span></span><br><span class="line">GSSAPIAuthentication <span class="built_in">yes</span></span><br><span class="line"><span class="comment">## 连接结束时是否清理GSSAPI凭证</span></span><br><span class="line">GSSAPICleanupCredentials no</span><br><span class="line"></span><br><span class="line"><span class="comment">## 如果要用密码验证，这里必须开启</span></span><br><span class="line">UsePAM <span class="built_in">yes</span></span><br><span class="line">X11Forwarding <span class="built_in">yes</span></span><br><span class="line">AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES</span><br><span class="line">AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT</span><br><span class="line">AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE</span><br><span class="line">AcceptEnv XMODIFIERS</span><br><span class="line">Subsystemsftp/usr/libexec/openssh/sftp-server</span><br></pre></td></tr></table></figure><h2 id="1-核心配置"><a href="#1-核心配置" class="headerlink" title="1.  核心配置"></a>1.  <code>核心配置</code></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安全相关</span></span><br><span class="line">Port 22  <span class="comment">## 连接端口</span></span><br><span class="line">PermitRootLogin no   <span class="comment">## 是否允许root用户远程登录</span></span><br><span class="line">PermitEmptyPasswords no  <span class="comment">## 禁止空密码登录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 连接速度</span></span><br><span class="line">UseDNS no   <span class="comment">## 将远程连接的ip解析为域名</span></span><br><span class="line">GSSAPIAuthentication no  <span class="comment">## 是否允许基于GSSAPI的用户认证</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ListenAddress <span class="comment">## 监听地址</span></span><br></pre></td></tr></table></figure><h2 id="2-常用选项"><a href="#2-常用选项" class="headerlink" title="2.  常用选项"></a>2.  常用选项</h2><table><thead><tr><th>SSH 服务端配置</th><th></th></tr></thead><tbody><tr><td><strong>Port</strong></td><td>连接端口（一般建议使用 10000 以上的端口）</td></tr><tr><td><strong>PermitRootLogin</strong></td><td>root 远程登录</td></tr><tr><td><strong>PermitEmptyPasswords</strong></td><td>是否允许空密码登录</td></tr><tr><td><strong>ListenAddress</strong></td><td>监听网卡</td></tr><tr><td>UseDNS</td><td>将 ip 解析为域名</td></tr><tr><td>GSSAPIAuthentication</td><td>GSSAPI 验证</td></tr><tr><td>PasswordAuthentication</td><td>是否允许密码登录</td></tr><tr><td>PubkeyAuthentication</td><td>是否允许密钥认证</td></tr><tr><td>UsePAM</td><td>如果开启密码登录，这里也要开启</td></tr></tbody></table><h2 id="3-案例"><a href="#3-案例" class="headerlink" title="3.  案例"></a>3.  案例</h2><ul><li>只能在内网登录 ssh01 这个主机，禁止公网访问，且端口使用 52113<ul><li>（1）防火墙拦截</li><li>（2）关闭公网网卡</li><li>（3）修改 SSH 中 Port、ListenAddress 选项</li></ul></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@ssh01 ~]# <span class="built_in">cat</span> &gt;&gt;/etc/ssh/sshd_config &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&gt; Port 52113</span></span><br><span class="line"><span class="string">&gt; ListenAddress 192.168.1.244</span></span><br><span class="line"><span class="string">&gt; EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@ssh01 ~]# <span class="built_in">tail</span> -n2 /etc/ssh/sshd_config</span><br><span class="line">Port 52113</span><br><span class="line">ListenAddress 192.168.1.244</span><br></pre></td></tr></table></figure><ul><li>测试<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 连接22端口失败</span></span><br><span class="line">ssh 192.168.1.244</span><br><span class="line">Connecting to 192.168.1.244:22...</span><br><span class="line">Could not connect to <span class="string">&#x27;192.168.1.244&#x27;</span> (port 22): Connection failed.</span><br><span class="line">Type `<span class="built_in">help</span><span class="string">&#x27; to learn how to use Xshell prompt.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@backup01 ~]# ssh -p52113 192.168.1.244</span></span><br><span class="line"><span class="string">The authenticity of host &#x27;</span>[192.168.1.244]:52113 ([192.168.1.244]:52113)<span class="string">&#x27; can&#x27;</span>t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:xwVpL0zxUqhoVgWCmUpqbnYkdEZ0kK5rlUcCmAQWvrE.</span><br><span class="line">ECDSA key fingerprint is MD5:1e:cb:83:42:81:b4:65:d0:65:17:0d:5b:a7:40:14:56.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span> connecting (<span class="built_in">yes</span>/no)? <span class="built_in">yes</span></span><br><span class="line">Warning: Permanently added <span class="string">&#x27;[192.168.1.244]:52113&#x27;</span> (ECDSA) to the list of known hosts.</span><br><span class="line">root@192.168.1.244\&#x27;s password: </span><br><span class="line">Last failed login: Tue Mar 19 16:24:48 CST 2024 from ::ffff:192.168.1.254 on pts/0</span><br><span class="line">There was 1 failed login attempt since the last successful login.</span><br><span class="line">Last login: Tue Mar 19 13:54:58 2024 from 192.168.1.254</span><br><span class="line"></span><br><span class="line">[root@ssh01 ~]# hostname -I</span><br><span class="line">192.168.1.244 192.168.5.9 </span><br></pre></td></tr></table></figure></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 端口正确，网卡ip错误也是无法连接的</span></span><br><span class="line">[root@backup01 ~]# ssh -p52113 192.168.5.9</span><br><span class="line">ssh: connect to host 192.168.5.9 port 52113: Connection refused</span><br></pre></td></tr></table></figure><blockquote><p>做完案例记得改回去</p></blockquote><h1 id="六、ssh-客户端命令选项"><a href="#六、ssh-客户端命令选项" class="headerlink" title="六、ssh 客户端命令选项"></a>六、ssh 客户端命令选项</h1><ul><li>包含以下几个命令<ul><li>ssh（telnet）</li><li>scp（rcp）</li><li>sftp（ftp）</li></ul></li></ul><table><thead><tr><th>加密协议</th><th>不加密协议（知道就行）</th></tr></thead><tbody><tr><td>ssh</td><td>telnet</td></tr><tr><td>scp</td><td>rcp</td></tr><tr><td>sftp\xftp<br>sftp: Linux 使用<br>xftp：win 使用</td><td>ftp</td></tr></tbody></table><h2 id="1-ssh-相关"><a href="#1-ssh-相关" class="headerlink" title="1.  ssh 相关"></a>1.  ssh 相关</h2><table><thead><tr><th>选项</th><th>含义</th><th>案例</th></tr></thead><tbody><tr><td>-p</td><td>端口</td><td>ssh -p23  x.x.x.x</td></tr><tr><td></td><td>指定用户</td><td>ssh  用户@x.x.x.x</td></tr><tr><td>-o StrictHostKeyChecking&#x3D;no</td><td>连接时不验证主机密钥<br>(后面连接多个主机时使用)</td><td>ssh -o StrictHostKeyChecking&#x3D;no  x.x.x.x</td></tr><tr><td>-v<br>-vvv</td><td>显示执行过程<br>（最多三个 v，详细过程）</td><td>ssh  -v  x.x.x.x</td></tr></tbody></table><h2 id="2-sftp、xftp"><a href="#2-sftp、xftp" class="headerlink" title="2. sftp、xftp"></a>2. sftp、xftp</h2><h3 id="2-1-xftp"><a href="#2-1-xftp" class="headerlink" title="2.1   xftp"></a>2.1   xftp</h3><ul><li>xshell 自带的 xftp 工具</li><li>（1）可以互传文件</li><li>（2）可以修改 linux 系统中文件、目录的权限</li><li>（3）删除、创建文件等<br><img src="https://jsd.cdn.zzko.cn/gh/Tripitz/Markdown-img@main/Openssh/202403291306365.png"></li></ul><h3 id="2-2-sftp"><a href="#2-2-sftp" class="headerlink" title="2.2   sftp"></a>2.2   sftp</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 做了密钥认证，所以不用输密码</span></span><br><span class="line">[root@ssh01 ~]# sftp 192.168.1.100</span><br><span class="line">Connected to 192.168.1.100.</span><br><span class="line">sftp&gt; </span><br></pre></td></tr></table></figure><ul><li>一些常用选项<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">sftp&gt; <span class="built_in">help</span></span><br><span class="line">Available commands:</span><br><span class="line"><span class="built_in">bye</span>                                Quit sftp</span><br><span class="line"><span class="built_in">cd</span> path                            Change remote directory to <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="built_in">chgrp</span> grp path                     Change group of file <span class="string">&#x27;path&#x27;</span> to <span class="string">&#x27;grp&#x27;</span></span><br><span class="line"><span class="built_in">chmod</span> mode path                    Change permissions of file <span class="string">&#x27;path&#x27;</span> to <span class="string">&#x27;mode&#x27;</span></span><br><span class="line"><span class="built_in">chown</span> own path                     Change owner of file <span class="string">&#x27;path&#x27;</span> to <span class="string">&#x27;own&#x27;</span></span><br><span class="line"><span class="built_in">df</span> [-hi] [path]                    Display statistics <span class="keyword">for</span> current directory or</span><br><span class="line">                                   filesystem containing <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="built_in">exit</span>                               Quit sftp</span><br><span class="line">get [-afPpRr] remote [<span class="built_in">local</span>]       Download file</span><br><span class="line">reget [-fPpRr] remote [<span class="built_in">local</span>]      Resume download file</span><br><span class="line">reput [-fPpRr] [<span class="built_in">local</span>] remote      Resume upload file</span><br><span class="line"><span class="built_in">help</span>                               Display this <span class="built_in">help</span> text</span><br><span class="line">lcd path                           Change <span class="built_in">local</span> directory to <span class="string">&#x27;path&#x27;</span></span><br><span class="line">lls [ls-options [path]]            Display <span class="built_in">local</span> directory listing</span><br><span class="line">lmkdir path                        Create <span class="built_in">local</span> directory</span><br><span class="line"><span class="built_in">ln</span> [-s] oldpath newpath            Link remote file (-s <span class="keyword">for</span> symlink)</span><br><span class="line">lpwd                               Print <span class="built_in">local</span> working directory</span><br><span class="line"><span class="built_in">ls</span> [-1afhlnrSt] [path]             Display remote directory listing</span><br><span class="line">lumask <span class="built_in">umask</span>                       Set <span class="built_in">local</span> <span class="built_in">umask</span> to <span class="string">&#x27;umask&#x27;</span></span><br><span class="line"><span class="built_in">mkdir</span> path                         Create remote directory</span><br><span class="line">progress                           Toggle display of progress meter</span><br><span class="line">put [-afPpRr] <span class="built_in">local</span> [remote]       Upload file</span><br><span class="line"><span class="built_in">pwd</span>                                Display remote working directory</span><br><span class="line">quit                               Quit sftp</span><br><span class="line">rename oldpath newpath             Rename remote file</span><br><span class="line"><span class="built_in">rm</span> path                            Delete remote file</span><br><span class="line"><span class="built_in">rmdir</span> path                         Remove remote directory</span><br><span class="line">symlink oldpath newpath            Symlink remote file</span><br><span class="line">version                            Show SFTP version</span><br><span class="line">!<span class="built_in">command</span>                           Execute <span class="string">&#x27;command&#x27;</span> <span class="keyword">in</span> <span class="built_in">local</span> shell</span><br><span class="line">!                                  Escape to <span class="built_in">local</span> shell</span><br><span class="line">?                                  Synonym <span class="keyword">for</span> <span class="built_in">help</span></span><br></pre></td></tr></table></figure></li></ul><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td>bye</td><td>退出</td></tr><tr><td>get</td><td><code>拉取</code>：将目标主机文件下载到本机</td></tr><tr><td>put</td><td><code>推送</code>：将本主机文件推送到目标主机</td></tr><tr><td>ls</td><td>查看目标主机目录下的文件</td></tr><tr><td>lls</td><td>查看本机目录下的文件</td></tr><tr><td>help</td><td>帮助</td></tr></tbody></table><h3 id="2-3-sftp-交互式与非交互式"><a href="#2-3-sftp-交互式与非交互式" class="headerlink" title="2.3   sftp 交互式与非交互式"></a>2.3   sftp 交互式与非交互式</h3><ol><li><p><code>交互式使用 sftp</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ssh01 ~]# sftp 192.168.1.100</span><br><span class="line">sftp&gt; put /etc/hosts /tmp</span><br><span class="line">Uploading /etc/hosts to /tmp/hosts</span><br><span class="line">/etc/hosts                                                                                                        100%  158   285.4KB/s   00:00 </span><br><span class="line"></span><br><span class="line">sftp&gt; get /etc/hostname /root</span><br><span class="line">Fetching /etc/hostname to /root/hostname</span><br><span class="line">/etc/hostname                                                                                                     100%    9     9.7KB/s   00:00  </span><br></pre></td></tr></table></figure></li><li><p><code>非交互式（一般用于脚本）</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 命令行形式</span></span><br><span class="line">[root@ssh01 ~]# sftp --<span class="built_in">help</span></span><br><span class="line">unknown option -- -</span><br><span class="line">usage: sftp [-1246aCfpqrv] [-B buffer_size] [-b batchfile] [-c cipher]</span><br><span class="line">          [-D sftp_server_path] [-F ssh_config] [-i identity_file] [-l <span class="built_in">limit</span>]</span><br><span class="line">          [-o ssh_option] [-P port] [-R num_requests] [-S program]</span><br><span class="line">          [-s subsystem | sftp_server] host</span><br><span class="line">       sftp [user@]host[:file ...]</span><br><span class="line">       sftp [user@]host[:<span class="built_in">dir</span>[/]]</span><br><span class="line">       sftp -b batchfile [user@]host</span><br></pre></td></tr></table></figure></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 将要执行的命令写入文件</span></span><br><span class="line">[root@ssh01 ~]# <span class="built_in">cat</span> upload.ftp </span><br><span class="line">put /etc/hostname /tmp  </span><br><span class="line">put -r /etc /opt  <span class="comment">### 传输目录使用-r参数</span></span><br><span class="line">get /etc/hosts /root</span><br><span class="line"></span><br><span class="line"><span class="comment">## -b 指定文件</span></span><br><span class="line">[root@ssh01 ~]# sftp -b upload.ftp 192.168.1.100</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th><th></th></tr></thead><tbody><tr><td>-b</td><td>指定 ftp 脚本</td><td></td></tr><tr><td>-o</td><td>指定端口</td><td>sftp -o Port&#x3D;52113</td></tr><tr><td>-r</td><td>递归，用于目录</td><td></td></tr></tbody></table><h2 id="3-scp-相关"><a href="#3-scp-相关" class="headerlink" title="3.  scp 相关"></a>3.  scp 相关</h2><ul><li>scp 命令一般就使用以下参数<ul><li>（1）-r</li><li>（2）-P</li></ul></li></ul><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-r</td><td>递归传输，用于目录</td></tr><tr><td>-P</td><td>指定端口</td></tr></tbody></table><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 递归</span></span><br><span class="line">[root@ssh01 ~]# scp -r /etc  192.168.1.100:/root</span><br><span class="line"></span><br><span class="line"><span class="comment">## 目标主机查看</span></span><br><span class="line">[root@backup01 ~]# ll</span><br><span class="line">total 724</span><br><span class="line">drwxr-xr-x 83 root root   8192 Mar 19 17:31 etc</span><br><span class="line">-rw-rw-rw-  1 root root 727290 Mar 12 15:12 sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 指定端口</span></span><br><span class="line">[root@ssh01 ~]# scp -P22 /etc/hostname  192.168.1.100:/root</span><br><span class="line">hostname                                                                                                          100%    6     8.3KB/s   00:00   </span><br><span class="line"></span><br><span class="line">[root@backup01 ~]# <span class="built_in">cat</span> hostname </span><br><span class="line">ssh01</span><br></pre></td></tr></table></figure><h1 id="七、批量分发密钥"><a href="#七、批量分发密钥" class="headerlink" title="七、批量分发密钥"></a>七、批量分发密钥</h1><h2 id="1-非交互发送密钥到-1-台机器"><a href="#1-非交互发送密钥到-1-台机器" class="headerlink" title="1.   非交互发送密钥到 1 台机器"></a>1.   非交互发送密钥到 1 台机器</h2><ul><li><ol><li><code>免交互创建密钥对</code><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 删除旧的.</span></span><br><span class="line"><span class="string">&#x27;👺🌟在工作环境中，不要删除!!！，此处只是做实验&#x27;</span></span><br><span class="line">[root@ssh01 ~]# <span class="built_in">rm</span> -rf /root/.ssh/id_rsa*</span><br><span class="line">[root@ssh01 ~]# &gt; /root/.ssh/known_hosts </span><br><span class="line">[root@ssh01 ~]# </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;-f 指定密钥文件路径和文件名&#x27;</span></span><br><span class="line"><span class="string">&#x27;-P 指定密码&#x27;</span></span><br><span class="line">[root@ssh01 ~]# ssh-keygen -t rsa -f /root/.ssh/id_rsa -P <span class="string">&#x27;&#x27;</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:4vAV+SMk17tG8zmSoRz2YcHFnRIiwdTfF6kAAtOtCSs root@ssh01</span><br><span class="line">The key<span class="string">&#x27;s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|     oo+=+o.oo ..|</span></span><br><span class="line"><span class="string">|     ...o*.+o oo |</span></span><br><span class="line"><span class="string">|      + B +..o. .|</span></span><br><span class="line"><span class="string">|   E . * o o... .|</span></span><br><span class="line"><span class="string">|    o . S X    . |</span></span><br><span class="line"><span class="string">|     + = B O .   |</span></span><br><span class="line"><span class="string">|      o o * +    |</span></span><br><span class="line"><span class="string">|         . . .   |</span></span><br><span class="line"><span class="string">|                 |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br></pre></td></tr></table></figure></li></ol></li><li><ol start="2"><li><code>免交互发送密钥到1台机器</code><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;解决了（yes/no）问题，但还是需要输入密码&#x27;</span></span><br><span class="line">[root@ssh01 ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub -o StrictHostKeyChecking=no -p22 192.168.1.100</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: <span class="string">&quot;/root/.ssh/id_rsa.pub&quot;</span></span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to <span class="built_in">log</span> <span class="keyword">in</span> with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- <span class="keyword">if</span> you are prompted now it is to install the new keys</span><br><span class="line">root@192.168.1.100\&#x27;s password: </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 使用 [sshpass]命令</span></span><br><span class="line"><span class="string">&#x27;有的默认不带sshpass&#x27;</span></span><br><span class="line">[root@ssh01 ~]# sshpass</span><br><span class="line">-bash: sshapss: <span class="built_in">command</span> not found</span><br><span class="line"><span class="comment">## 下载安装</span></span><br><span class="line"><span class="string">&#x27;高版本sshpass,需要编译安装：https://sourceforge.net/projects/sshpass/files/sshpass/&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@ssh01 ~]# wget https://mirrors.tuna.tsinghua.edu.cn/centos/7.9.2009/extras/x86_64/Packages/sshpass-1.06-2.el7.x86_64.rpm</span><br><span class="line">[root@ssh01 ~]# rpm -ivh sshpass-1.06-2.el7.x86_64.rpm </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">👺🌟🌟<span class="string">&#x27;免交互发送密钥&#x27;</span></span><br><span class="line">[root@ssh01 ~]# sshpass -p1 ssh-copy-id -i /root/.ssh/id_rsa.pub -o StrictHostKeyChecking=no -p22 192.168.1.100</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: <span class="string">&quot;/root/.ssh/id_rsa.pub&quot;</span></span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to <span class="built_in">log</span> <span class="keyword">in</span> with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- <span class="keyword">if</span> you are prompted now it is to install the new keys</span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   <span class="string">&quot;ssh -o &#x27;StrictHostKeyChecking=no&#x27; -p &#x27;22&#x27; &#x27;192.168.1.100&#x27;&quot;</span></span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br></pre></td></tr></table></figure></li></ol></li><li><ol start="3"><li><code>测试</code><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ssh01 ~]# ssh 192.168.1.100 w</span><br><span class="line"> 18:07:45 up 19:28,  1 user,  load average: 0.00, 0.02, 0.05</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     pts/4    192.168.1.254    12:47   34:49   0.09s  0.09s -bash</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></li></ul><h2 id="2-批量发送密钥"><a href="#2-批量发送密钥" class="headerlink" title="2. 批量发送密钥"></a>2. 批量发送密钥</h2><blockquote><p>👺🌟🎆：脚本都不完善，仅用于初步学习<br>后续思路：<br>    - 检查本地. ssh 是否有文件，有则不继续执行<br>    - 创建密钥对时，密钥放置的路径和文件名修改为变量<br>    - 分发时 ip 放在一个文件里，公钥路径改为变量等等</p></blockquote><ol><li><code>书写创建密钥脚本</code><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">👺🌟 <span class="string">&#x27;此处只是做实验，工作环境不要执行!!!!!&#x27;</span></span><br><span class="line">[root@ssh01 ~]# <span class="built_in">rm</span> -rf /root/.ssh/id_rsa*</span><br><span class="line">[root@ssh01 ~]# &gt; /root/.ssh/known_hosts </span><br></pre></td></tr></table></figure></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@ssh01 ~]# <span class="built_in">cat</span> /server/srcipts/fenfa.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 免交互创建密钥对</span></span><br><span class="line">ssh-keygen -t rsa -f /root/.ssh/id_rsa -P <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 批量分发密钥</span></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> &#123;100,103&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">sshpass -p1 ssh-copy-id -i /root/.ssh/id_rsa.pub -o StrictHostKeyChecking=no -p22 192.168.1.<span class="variable">$ip</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul><li>测试<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">sh /server/srcipts/fenfa.sh </span><br><span class="line"></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:YqBke+myBBo2AwrUHF+K5yQnsHmZvUqjvZAhpqRgeQ8 root@ssh01</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">| oo..  .         |</span><br><span class="line">|. +o* o          |</span><br><span class="line">|oooB.B           |</span><br><span class="line">|+oooBo.          |</span><br><span class="line">|*XoEooo S        |</span><br><span class="line">|@oXo=. .         |</span><br><span class="line">|++oo..           |</span><br><span class="line">| ..o.            |</span><br><span class="line">|  ..             |</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh -o &#x27;StrictHostKeyChecking=no&#x27; -p &#x27;22&#x27; &#x27;192.168.1.100&#x27;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br><span class="line"></span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh -o &#x27;StrictHostKeyChecking=no&#x27; -p &#x27;22&#x27; &#x27;192.168.1.103&#x27;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li><code>书写检查脚本</code></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;$* 是指执行脚本后面带的参数&#x27;</span>[hostname -I]也可以换成其他要执行的命令</span><br><span class="line">[root@ssh01 ~]# <span class="built_in">cat</span> /server/srcipts/fenfa_check.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> &#123;100,103&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">ssh -o  StrictHostKeyChecking=no -p22 192.168.1.<span class="variable">$ip</span> $*</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul><li>测试<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## [hostname -I]也可以换成其他要执行的命令</span></span><br><span class="line">[root@ssh01 ~]# sh /server/srcipts/fenfa_check.sh hostname -I</span><br><span class="line">192.168.1.100 192.168.5.6 </span><br><span class="line">192.168.1.103 192.168.5.7 </span><br><span class="line"></span><br><span class="line">[root@ssh01 ~]# sh /server/srcipts/fenfa_check.sh w</span><br><span class="line"> 18:36:27 up 19:56,  1 user,  load average: 0.05, 0.03, 0.05</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     pts/4    192.168.1.254    12:47    1:03m  0.09s  0.09s -bash</span><br><span class="line"> 18:36:28 up  8:20,  3 <span class="built_in">users</span>,  load average: 0.01, 0.03, 0.05</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     pts/0    192.168.1.254    13Mar24  6days  0.02s  0.02s -bash</span><br><span class="line">root     pts/1    192.168.1.254    Thu15    5days  0.56s  0.56s -bash</span><br><span class="line">root     pts/2    192.168.1.254    13Mar24  6days  0.42s  0.42s -bash</span><br></pre></td></tr></table></figure></li></ul><h1 id="故障排除"><a href="#故障排除" class="headerlink" title="故障排除"></a>故障排除</h1><h2 id="1-文件权限"><a href="#1-文件权限" class="headerlink" title="1. 文件权限"></a>1. 文件权限</h2><ul><li>一般来说，大部分是因为权限不对导致的错误<ul><li>（1）检查.ssh 目录权限</li><li>（2）检查 authorized_keys 文件权限</li></ul></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 修改客户机authorized_keys文件权限</span></span><br><span class="line">[root@backup01 ~]# ll .ssh/</span><br><span class="line">total 8</span><br><span class="line">-rw------- 1 root root 392 Mar 19 13:37 authorized_keys</span><br><span class="line">-rw-r--r-- 1 root root 175 Mar  6 18:46 known_hosts</span><br><span class="line"></span><br><span class="line">[root@backup01 ~]# <span class="built_in">chmod</span> 777 .ssh/authorized_keys </span><br><span class="line"></span><br><span class="line">[root@backup01 ~]# ll .ssh/</span><br><span class="line">total 8</span><br><span class="line">-rwxrwxrwx 1 root root 392 Mar 19 13:37 authorized_keys</span><br><span class="line">-rw-r--r-- 1 root root 175 Mar  6 18:46 known_hosts</span><br><span class="line"></span><br><span class="line"><span class="comment">### 服务端进行连接</span></span><br><span class="line"><span class="comment">## 会让输入目标主机密码</span></span><br><span class="line">[root@ssh01 ~]# ssh 192.168.1.100 w</span><br><span class="line">root@192.168.1.100\&#x27;s password: </span><br><span class="line"></span><br><span class="line"><span class="comment">### 服务端可以查看详细信息（-v：简单信息，-vvv：更加详细的信息）</span></span><br><span class="line">[root@ssh01 ~]# ssh -vvv 192.168.1.100 w</span><br><span class="line"></span><br><span class="line"><span class="comment">### 在目标主机查看系统日志</span></span><br><span class="line">[root@backup01 ~]# <span class="built_in">tail</span> -f /var/log/secure</span><br><span class="line"><span class="comment">## 这个错误通常表示在 SSH 连接过程中，服务器拒绝了认证，原因可能是文件的所有权或权限设置不正确。</span></span><br><span class="line">Mar 19 13:40:21 backup01 sshd[37447]: Authentication refused: bad ownership or modes <span class="keyword">for</span> file /root/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><ul><li>将权限修改回 600<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看客户端系统日志</span></span><br><span class="line"><span class="built_in">tail</span> -f /var/log/secure</span><br><span class="line"></span><br><span class="line">Mar 19 13:44:14 backup01 sshd[37638]: Accepted publickey <span class="keyword">for</span> root from 192.168.1.244 port 36198 ssh2: RSA SHA256:+ue1rVaz4gWAmRs7VdZwCMmKyR8bKouFmlj55t/G5HQ</span><br><span class="line">Mar 19 13:44:14 backup01 sshd[37638]: pam_unix(sshd:session): session opened <span class="keyword">for</span> user root by (uid=0)</span><br><span class="line">Mar 19 13:44:14 backup01 sshd[37638]: Received disconnect from 192.168.1.244 port 36198:11: disconnected by user</span><br><span class="line">Mar 19 13:44:14 backup01 sshd[37638]: Disconnected from 192.168.1.244 port 36198</span><br><span class="line">Mar 19 13:44:14 backup01 sshd[37638]: pam_unix(sshd:session): session closed <span class="keyword">for</span> user root</span><br></pre></td></tr></table></figure></li></ul><h2 id="2-密钥或密码认证"><a href="#2-密钥或密码认证" class="headerlink" title="2.  密钥或密码认证"></a>2.  密钥或密码认证</h2><ul><li>在一些安全要求高的场景中，会禁止密码验证，只允许密钥</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ssh01 ~]# egrep <span class="string">&quot;#PubkeyAuthentication|^PasswordAuthentication&quot;</span> /etc/ssh/sshd_config </span><br><span class="line"><span class="comment">#PubkeyAuthentication yes ## 是否开启密钥认证</span></span><br><span class="line">PasswordAuthentication <span class="built_in">yes</span> <span class="comment">## 是否开启密码验证</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 综合架构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文档 </tag>
            
            <tag> 基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux基础</title>
      <link href="/2024/07/29/Linux%E5%9F%BA%E7%A1%80/Linux%E5%9F%BA%E7%A1%80/"/>
      <url>/2024/07/29/Linux%E5%9F%BA%E7%A1%80/Linux%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h1><h1 id="1-Linux基本使用和配置"><a href="#1-Linux基本使用和配置" class="headerlink" title="1. Linux基本使用和配置"></a>1. Linux基本使用和配置</h1><h3 id="1-1-查看系统运行级别"><a href="#1-1-查看系统运行级别" class="headerlink" title="1.1 查看系统运行级别"></a>1.1 查看系统运行级别</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看系统当前运行级别,N表示上一次没有模式,即开机后就是3模式(命令行模式)</span></span><br><span class="line">[root@rocky ~][0]# runlevel </span><br><span class="line">N 3</span><br></pre></td></tr></table></figure><h3 id="1-2-切换系统运行级别"><a href="#1-2-切换系统运行级别" class="headerlink" title="1.2 切换系统运行级别"></a>1.2 切换系统运行级别</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0: 关机</span><br><span class="line">1: 单用户模式（用于系统维护）</span><br><span class="line">2: 多用户模式，没有网络支持</span><br><span class="line">3: 多用户模式，具有网络支持</span><br><span class="line">4: 未分配（可以由用户自定义）</span><br><span class="line">5: 多用户模式，具有图形用户界面</span><br><span class="line">6: 重启</span><br><span class="line"></span><br><span class="line">[root@rocky ~][0]# init 3</span><br></pre></td></tr></table></figure><h3 id="1-3-系统登录后欢迎提示"><a href="#1-3-系统登录后欢迎提示" class="headerlink" title="1.3 系统登录后欢迎提示"></a>1.3 系统登录后欢迎提示</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登录后欢迎提示</span></span><br><span class="line">vim /etc/motd</span><br></pre></td></tr></table></figure><h3 id="1-4-系统登录前欢迎提示"><a href="#1-4-系统登录前欢迎提示" class="headerlink" title="1.4 系统登录前欢迎提示"></a>1.4 系统登录前欢迎提示</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登录前欢迎提示</span></span><br><span class="line">vim /etc/issue</span><br></pre></td></tr></table></figure><h3 id="1-5-修改主机名"><a href="#1-5-修改主机名" class="headerlink" title="1.5 修改主机名"></a>1.5 修改主机名</h3><p>&#x3D;&#x3D;注意：主机名不要使用下划线&#x3D;&#x3D;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改主机名</span></span><br><span class="line">hostnamectl set-hostname Rocky &amp;&amp; exec $SHELL -l</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过文件修改</span></span><br><span class="line">vim /etc/hostname</span><br><span class="line">exec $SHELL -l</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">临时修改,重启失效</span></span><br><span class="line">hostname Rocky &amp;&amp; exec $SHELL -l</span><br></pre></td></tr></table></figure><h3 id="1-6-查看当前登录账户-会话"><a href="#1-6-查看当前登录账户-会话" class="headerlink" title="1.6 查看当前登录账户&#x2F;会话"></a>1.6 查看当前登录账户&#x2F;会话</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前登录有效用户</span></span><br><span class="line">[root@Rocky ~][0]# whoami </span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">[root@Rocky ~][0]# who am i</span><br><span class="line">root     pts/0        2023-10-23 17:20 (221.178.140.146)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看系统当前所有的登录会话及所作操作</span></span><br><span class="line">w</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看系统当前所有登录会话</span></span><br><span class="line">[root@Rocky ~][0]# who</span><br><span class="line">root     pts/0        2023-10-24 10:10 (221.178.140.146)</span><br></pre></td></tr></table></figure><h3 id="1-7-命令行提示符"><a href="#1-7-命令行提示符" class="headerlink" title="1.7 命令行提示符"></a>1.7 命令行提示符</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">管理员</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">普通用户</span></span><br><span class="line"></span><br><span class="line">le 控制符\033</span><br><span class="line">\u当前用户</span><br><span class="line">\h主机名简称</span><br><span class="line">\H主机名</span><br><span class="line">\w当前工作目录</span><br><span class="line">\W当前工作目录基名</span><br><span class="line">\t24小时时间格式</span><br><span class="line">\T12小时时间格式</span><br><span class="line">!命令历史数</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开机后命令历史数</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用这个</span></span><br><span class="line">export PS1=&#x27;[\[\e[34;1m\]\u@\[\e[0m\]\[\e[32;1m\]\H\[\e[0m\] \[\e[31;1m\]\W\[\e[0m\]]\$ &#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改提示符,绿色高亮带命令返回值</span></span><br><span class="line">PS1=&#x27;\[\e[32;1m\][\u@\h \w][$?]\$ \[\e[0m\]&#x27; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改提示符,蓝色高亮带命令返回值</span></span><br><span class="line">PS1=&#x27;\[\e[34;1m\][\u@\h \w][$?]\$ \[\e[0m\]&#x27; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改提示符,红色高亮带命令返回值</span></span><br><span class="line">PS1=&#x27;\[\e[31;1m\][\u@\h \w][$?]\$ \[\e[0m\]&#x27; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改提示符,青色高亮带命令返回值</span></span><br><span class="line">PS1=&#x27;\[\e[36;1m\][\u@\h \w][$?]\$ \[\e[0m\]&#x27; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改提示符,洋红色色高亮带命令返回值</span></span><br><span class="line">PS1=&#x27;\[\e[36;1m\][\u@\h \w][$?]\$ \[\e[0m\]&#x27; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改提示符,黄色高亮带命令返回值</span></span><br><span class="line">PS1=&#x27;\[\e[33;1m\][\u@\h \w][$?]\$ \[\e[0m\]&#x27; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">绿色高亮带命令返回值和时间的提示符</span></span><br><span class="line">PS1=&#x27;\[\e[32;1m\][\[\e[0m\]\t\[\e[32;1m\]] [\u@\h \w][$?]\$ \[\e[0m\]&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">蓝色高亮带命令返回值和时间的提示符</span></span><br><span class="line">PS1=&#x27;\[\e[34;1m\][\[\e[0m\]\t\[\e[34;1m\]] [\u@\h \w][$?]\$ \[\e[0m\]&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">红色高亮带命令返回值和时间的提示符</span></span><br><span class="line">PS1=&#x27;\[\e[31;1m\][\[\e[0m\]\t\[\e[31;1m\]] [\u@\h \w][$?]\$ \[\e[0m\]&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">青色高亮带命令返回值和时间的提示符</span></span><br><span class="line">PS1=&#x27;\[\e[36;1m\][\[\e[0m\]\t\[\e[36;1m\]] [\u@\h \w][$?]\$ \[\e[0m\]&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">洋红色高亮带命令返回值和时间的提示符</span></span><br><span class="line">PS1=&#x27;\[\e[35;1m\][\[\e[0m\]\t\[\e[35;1m\]] [\u@\h \w][$?]\$ \[\e[0m\]&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">黄色高亮带命令返回值和时间的提示符</span></span><br><span class="line">PS1=&#x27;\[\e[33;1m\][\[\e[0m\]\t\[\e[33;1m\]] [\u@\h \w][$?]\$ \[\e[0m\]&#x27;</span><br></pre></td></tr></table></figure><h3 id="1-8-卸载虚拟网卡"><a href="#1-8-卸载虚拟网卡" class="headerlink" title="1.8 卸载虚拟网卡"></a>1.8 卸载虚拟网卡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y remove libirt-daemon</span><br></pre></td></tr></table></figure><h1 id="2-命令和命令类型"><a href="#2-命令和命令类型" class="headerlink" title="2. 命令和命令类型"></a>2. 命令和命令类型</h1><h3 id="2-1-内部命令和外部命令"><a href="#2-1-内部命令和外部命令" class="headerlink" title="2.1 内部命令和外部命令"></a>2.1 内部命令和外部命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">外部命令在文件系统路径下有对应的可执行程序</span><br><span class="line">内部命令/bin/bash/*</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">内部命令</span></span><br><span class="line">[root@Rocky ~][0]# type echo</span><br><span class="line">echo is a shell builtin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">外部命令</span></span><br><span class="line">[root@Rocky ~][1]# type shutdown</span><br><span class="line">shutdown is /usr/sbin/shutdown</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">外部命令的存放(搜索)路径</span></span><br><span class="line">[root@Rocky ~][0]# echo $PATH</span><br><span class="line">/root/.local/bin:/root/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span>既是外部命令,也是内部命令</span></span><br><span class="line">[root@Rocky ~][0]# type -a echo</span><br><span class="line">echo is a shell builtin</span><br><span class="line">echo is /usr/bin/echo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">hash</span>命令记录着曾经执行过的外部命令</span></span><br><span class="line">[root@Rocky ~][0]# hash   </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有内部命令</span></span><br><span class="line">enable | awk &#x27;&#123;print $2&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看外部命令路径</span></span><br><span class="line">[root@Rocky ~][0]# which reboot</span><br><span class="line">/usr/sbin/reboot</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看外部命令路径,同时显示帮助文档的路径</span></span><br><span class="line">[root@Rocky ~][0]# whereis ls</span><br><span class="line">ls: /usr/bin/ls /usr/share/man/man1/ls.1.gz /usr/share/man/man1p/ls.1p.gz</span><br></pre></td></tr></table></figure><h3 id="2-2-Hash缓存表"><a href="#2-2-Hash缓存表" class="headerlink" title="2.2 Hash缓存表"></a>2.2 Hash缓存表</h3><p>系统初始hash表为空，当外部命令执行时，默认会从PATH路径下寻找该命令，找到后会将这条命令的路径记录到hash表中，当再次使用该命令时，shel解释器首先会查看hash表，存在将执行之，如果不存在，将会去PATH路径下寻找，利用hash缓存表可大大提高命令的调用速率</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hash显示缓存</span><br><span class="line">hash -l显示hash缓存,可作为输入使用</span><br><span class="line">hash -p path name 将命令全路径path起别名为name</span><br><span class="line">hash -d name 清楚name缓存</span><br><span class="line">hash -r清楚所有缓存</span><br></pre></td></tr></table></figure><h3 id="2-3-命令别名"><a href="#2-3-命令别名" class="headerlink" title="2.3 命令别名"></a>2.3 命令别名</h3><p><strong>别名永久生效：</strong></p><ul><li>仅对当前用户生效：~&#x2F;.bashrc</li><li>对所有用户生效：&#x2F;etc&#x2F;bashrc</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示当前shell进程中所有可用的命令别名</span></span><br><span class="line">alias</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">定义别名</span></span><br><span class="line">type eth0 || alias eth0=&quot;vim /etc/sysconfig/network-scripts/ifcfg-eth0&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">临时取消所有别名</span></span><br><span class="line">unalias -a</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">别名立即生效</span></span><br><span class="line">exec $SHELL -l</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取消别名,当作普通命令来来执行</span></span><br><span class="line">\aliasname</span><br><span class="line">&quot;aliasname&quot;</span><br><span class="line">&#x27;aliasname&#x27;</span><br><span class="line">/PATH/cmd# 只适合外部命令</span><br></pre></td></tr></table></figure><h3 id="2-4-命令的优先级"><a href="#2-4-命令的优先级" class="headerlink" title="2.4 命令的优先级"></a>2.4 命令的优先级</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">别名 &gt; 内部命令 &gt; 外部命令 </span><br></pre></td></tr></table></figure><h3 id="2-5-命令格式"><a href="#2-5-命令格式" class="headerlink" title="2.5 命令格式"></a>2.5 命令格式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CMD[选项...] [参数...]</span><br></pre></td></tr></table></figure><ul><li>短选项：UNIX风格选项，例如：-l，-h</li><li>长选项：GNU风格选项，例如：–all，–host</li><li>BSD风格选项：一个字母，例如：a</li></ul><p>注意：</p><ul><li>多个选项以及参数和命令之间使用空白字符分割</li><li>取消和结束命令执行：Ctrl+c强行终止，Ctrl+d正常退出</li><li>多个命令可以用” ; “符号分开</li><li>一个命令可以用 \ 分成多行</li></ul><h1 id="3-系统相关常见命令"><a href="#3-系统相关常见命令" class="headerlink" title="3. 系统相关常见命令"></a>3. 系统相关常见命令</h1><h3 id="3-1-查看CPU"><a href="#3-1-查看CPU" class="headerlink" title="3.1 查看CPU"></a>3.1 查看CPU</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lscpu</span><br><span class="line">cat /proc/cpuinfo</span><br></pre></td></tr></table></figure><h3 id="3-2-查看内存大小"><a href="#3-2-查看内存大小" class="headerlink" title="3.2 查看内存大小"></a>3.2 查看内存大小</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">free [选项]</span><br><span class="line"></span><br><span class="line">-b以字节为单位</span><br><span class="line">-m以MB为单位</span><br><span class="line">-g以GB为单位</span><br><span class="line">-h易读格式</span><br><span class="line">-t显示RAM+SWAP的总和</span><br><span class="line">-s ?每隔?秒刷新一次</span><br><span class="line">-c ?刷新?次后退出</span><br><span class="line"></span><br><span class="line">[root@Centos7 ~]$ free -h</span><br><span class="line">              total        used        free      shared         buff/cache      available</span><br><span class="line">Mem:           2.8G        343M        2.1G        9.8M               359M           2.3G</span><br><span class="line">Swap:          3.0G          0B        3.0G</span><br><span class="line">           总内存大小已用         剩余    被共享的内存        缓冲/缓存     实际最大可用</span><br><span class="line">           </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清除缓存,默认值是0,重启才能恢复（没有必要，系统还要重新读取）</span></span><br><span class="line">echo 3 &gt; /proc/sys/vm/drop_caches</span><br></pre></td></tr></table></figure><h3 id="3-3-查看硬盘大小"><a href="#3-3-查看硬盘大小" class="headerlink" title="3.3 查看硬盘大小"></a>3.3 查看硬盘大小</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">df </span><br><span class="line"></span><br><span class="line">-H以10为单位</span><br><span class="line">-T文件系统类型</span><br><span class="line">-h按2进制计算</span><br><span class="line">-i查看idone</span><br><span class="line">-P稍微整齐点的输出</span><br><span class="line">-f所有分区的文件系统</span><br></pre></td></tr></table></figure><h3 id="3-4-查看硬盘和分区情况"><a href="#3-4-查看硬盘和分区情况" class="headerlink" title="3.4 查看硬盘和分区情况"></a>3.4 查看硬盘和分区情况</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br><span class="line"></span><br><span class="line">-f显示文件系统</span><br><span class="line"></span><br><span class="line">cat /proc/partitions</span><br></pre></td></tr></table></figure><h3 id="3-5-查看目录大小"><a href="#3-5-查看目录大小" class="headerlink" title="3.5 查看目录大小"></a>3.5 查看目录大小</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">du [选项] 目录</span><br><span class="line"></span><br><span class="line">-h</span><br><span class="line">-s空间总和</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看/etc大小</span></span><br><span class="line">du -sh /etc/</span><br></pre></td></tr></table></figure><h3 id="3-6-查看操作内核版本"><a href="#3-6-查看操作内核版本" class="headerlink" title="3.6 查看操作内核版本"></a>3.6 查看操作内核版本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure><h3 id="3-7-查看操作系统发行版本"><a href="#3-7-查看操作系统发行版本" class="headerlink" title="3.7 查看操作系统发行版本"></a>3.7 查看操作系统发行版本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/redhat-release</span><br><span class="line">cat /etc/os-release</span><br></pre></td></tr></table></figure><h3 id="3-8-查看日期和时间"><a href="#3-8-查看日期和时间" class="headerlink" title="3.8 查看日期和时间"></a>3.8 查看日期和时间</h3><p>Linux的两种时钟</p><p>​系统时钟：由Linux内核通过CPU的工作频率来进行的</p><p>​硬件时钟：主板</p><p>相关命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看系统时间</span></span><br><span class="line">date</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看硬件时间</span></span><br><span class="line">clock</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以硬件时间为准,同步操作系统时间</span></span><br><span class="line">clock -s</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以操作系统时间为准,同步硬件时间</span></span><br><span class="line">clock -w</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置指定时间</span></span><br><span class="line">date -s &quot;2023-10-24 15:30:00&quot;</span><br><span class="line"></span><br><span class="line">date &quot;+%Y年 %m月 %d日 星期%u %H:%M:%S %Z&quot;</span><br></pre></td></tr></table></figure><h3 id="3-9-查看-修改时区"><a href="#3-9-查看-修改时区" class="headerlink" title="3.9 查看&#x2F;修改时区"></a>3.9 查看&#x2F;修改时区</h3><p>时区文件来自相关工具：t’z</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看系统当前时区</span></span><br><span class="line">ll /etc/localtime</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有时区列表</span></span><br><span class="line">timedatectl list-timezones</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改时区为指定时区</span></span><br><span class="line">timedatectl set-timezone Asia/Shanghai</span><br></pre></td></tr></table></figure><h3 id="3-10-查看日历"><a href="#3-10-查看日历" class="headerlink" title="3.10 查看日历"></a>3.10 查看日历</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看今年日历</span></span><br><span class="line">cal -y</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看全年</span></span><br><span class="line">cal 12</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看2020年日历</span></span><br><span class="line">cal 2020</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看2020年10月份日志</span></span><br><span class="line">cal 10 2020</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看1752年9月份日历</span></span><br><span class="line">cal 9 1752</span><br></pre></td></tr></table></figure><h3 id="3-11-关机和重启"><a href="#3-11-关机和重启" class="headerlink" title="3.11 关机和重启"></a>3.11 关机和重启</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关机</span></span><br><span class="line">halt</span><br><span class="line">poweroff</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启</span></span><br><span class="line">-f强制关机,不调用shutdown</span><br><span class="line">-p切断电源</span><br><span class="line">reboot</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关机或重启</span></span><br><span class="line">shutdown 选项</span><br><span class="line">-r重启</span><br><span class="line">-h关机</span><br><span class="line">-c清除</span><br><span class="line"></span><br><span class="line">shutdown 参数</span><br><span class="line">TIME不指定,默认相当于+1（Centos 7）</span><br><span class="line">now立刻,相当于+0</span><br><span class="line">+#几分钟后,例如+3</span><br><span class="line">hh:mm绝对时间表示,指明具体时间</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">立即重启</span></span><br><span class="line">shutdown -r now</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">立即关机</span></span><br><span class="line">shutdown -h now</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">10分钟后关机</span></span><br><span class="line">shutdown -r +10</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">11点定时关机</span></span><br><span class="line">shutdown -r 11:00</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清除设定的操作</span></span><br><span class="line">shutdown -c</span><br></pre></td></tr></table></figure><h3 id="3-12-会话管理"><a href="#3-12-会话管理" class="headerlink" title="3.12 会话管理"></a>3.12 会话管理</h3><p><strong>screen</strong></p><p>利用screen可以实现会话管理，如：新建会话，共享会话等</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装screen来自EPEL源</span></span><br><span class="line">yum -y install screen</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个新的会话</span></span><br><span class="line">screen -S [ screen_name ]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加入一个会话</span></span><br><span class="line">screen -x [ screen_name ]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出并关闭会话</span></span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">剥离当前screen会话</span></span><br><span class="line">Ctrl+a+d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示所有已经打开的screen会话</span></span><br><span class="line">screen -ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">恢复某screen会话</span></span><br><span class="line">screen -r [ screen_name ]</span><br></pre></td></tr></table></figure><h3 id="3-13-输出信息echo"><a href="#3-13-输出信息echo" class="headerlink" title="3.13 输出信息echo"></a>3.13 输出信息echo</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-E（默认）不支持\解释功能</span><br><span class="line">-n 不自动换行</span><br><span class="line">-e 启用\字符的解释功能</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">若启用命令-e,若字符串中出现一下字符,则特别加以处理,而不会将他当成一般文字输出</span></span><br><span class="line">\a发出警报声</span><br><span class="line">\b退格键</span><br><span class="line">\c最后不加上换行符号</span><br><span class="line">\eescape,相当于\033</span><br><span class="line">\n换行且光标移至行首</span><br><span class="line">\r回车,即光标移至行首,但不换行</span><br><span class="line">\t插入tab</span><br><span class="line">\\插入\字符</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">echo -e &quot;\a&quot;</span><br></pre></td></tr></table></figure><p><strong>变量引用</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">变量会替换,弱引用</span></span><br><span class="line">echo &quot;$VAR_NAME&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">变量不会被替换,强引用</span></span><br><span class="line">echo &#x27;$VAR_NAME&#x27;</span><br></pre></td></tr></table></figure><h3 id="3-14-命令行扩展和被括起来的集合"><a href="#3-14-命令行扩展和被括起来的集合" class="headerlink" title="3.14 命令行扩展和被括起来的集合"></a>3.14 命令行扩展和被括起来的集合</h3><h4 id="3-14-1-命令行扩展-和"><a href="#3-14-1-命令行扩展-和" class="headerlink" title="3.14.1 命令行扩展` `和$( )"></a>3.14.1 命令行扩展` `和$( )</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">把一个命令的输出打印给另一个命令的参数</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">(CMD) 或 `CMD`</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">echo &quot;my IP is $(hostname -I)&quot;</span><br></pre></td></tr></table></figure><h4 id="3-14-2-括号扩展："><a href="#3-14-2-括号扩展：" class="headerlink" title="3.14.2 括号扩展：{  }"></a>3.14.2 括号扩展：{  }</h4><p>{ }可以实现打印重复字符串的简化形式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky ~][0]# echo file&#123;1,2,3&#125;</span><br><span class="line">file1 file2 file3</span><br><span class="line"></span><br><span class="line">[root@Rocky ~][0]# echo &#123;1..10&#125;</span><br><span class="line">1 2 3 4 5 6 7 8 9 10</span><br><span class="line"></span><br><span class="line">[root@Rocky ~][0]# echo &#123;1..10&#125;</span><br><span class="line">1 2 3 4 5 6 7 8 9 10</span><br><span class="line"></span><br><span class="line">echo &#123;a..z&#125;</span><br><span class="line">a b c d e f g h i j k l m n o p q r s t u v w x y z</span><br><span class="line"></span><br><span class="line">[root@Rocky ~][130]# echo &#123;10..1&#125;</span><br><span class="line">10 9 8 7 6 5 4 3 2 1</span><br><span class="line"></span><br><span class="line">[root@Rocky ~][0]# echo &#123;1..20..2&#125;</span><br><span class="line">1 3 5 7 9 11 13 15 17 19</span><br><span class="line"></span><br><span class="line">[root@Rocky ~][0]# echo &#123;000..20..4&#125;</span><br><span class="line">000 004 008 012 016 020</span><br><span class="line"></span><br><span class="line">[root@Rocky ~][0]# echo &#123;A..z&#125;</span><br><span class="line">A B C D E F G H I J K L M N O P Q R S T U V W X Y Z [  ] ^ _ ` a b c d e f g h i j k l m n o p q r s t u v w x y z</span><br><span class="line"></span><br><span class="line">[root@Rocky ~][0]# echo file&#123;1..2&#125;.&#123;txt,log&#125;</span><br><span class="line">file1.txt file1.log file2.txt file2.log</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="3-14-3-单引号，双引号和反向单引号的区别区别"><a href="#3-14-3-单引号，双引号和反向单引号的区别区别" class="headerlink" title="3.14.3 单引号，双引号和反向单引号的区别区别"></a>3.14.3 单引号，双引号和反向单引号的区别区别</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">单引号：变量和命令都不识别,当作普通字符串来处理</span><br><span class="line">双引号：不能识别命令,可以识别变量</span><br><span class="line">反向单引号：变量和命令都识别,并且会将反向单引号的内容当作命令进行执行后,再交给调用反向单引号的命令继续</span><br></pre></td></tr></table></figure><h3 id="3-15-tab键补全"><a href="#3-15-tab键补全" class="headerlink" title="3.15 tab键补全"></a>3.15 tab键补全</h3><p>tab键可以实现命令及路径补全，提高输入效率，避免出错，&#x3D;&#x3D;功能来自bash-completion软件包&#x3D;&#x3D;</p><h4 id="3-15-1-命令补全"><a href="#3-15-1-命令补全" class="headerlink" title="3.15.1  命令补全"></a>3.15.1  命令补全</h4><ul><li>内部命令：</li><li>外部命令：bash根据PATH环境变量定义的路径，自左而右再每个路径搜寻以给定命令名命名的文件，第一次找到的命令即为要执行的命令</li></ul><p>注意：用户给定的字符串只有一条唯一对应的命令，直接补全，否则，再次tab会给出列表</p><h4 id="3-15-2-路径补全"><a href="#3-15-2-路径补全" class="headerlink" title="3.15.2 路径补全"></a>3.15.2 路径补全</h4><p>把用户给出的字符串当作路径开头，并在其指定上级目录下搜索以指定的字符串开头的文件名</p><p>如果唯一：则直接补全</p><p>否则：再次Tab给出列表</p><h4 id="3-15-3-双击Tab键"><a href="#3-15-3-双击Tab键" class="headerlink" title="3.15.3 双击Tab键"></a>3.15.3 双击Tab键</h4><p>CMD 2Tab所有子命令或文件补全</p><p>string 2Tab以srting开头命令</p><p>&#x2F;2Tab显示根目录下一级目录，包括隐藏目录</p><p>.&#x2F;2Tab显示当前目录下子目录，包括隐藏目录</p><p>*2Tab当前目录下子目录，不包括隐藏目录</p><p>~2Tab所有用户列表</p><p>$2Tab所有变量</p><p>@2Tab&#x2F;etc&#x2F;hosts记录（Centos 7 不支持）</p><p>&#x3D;2Tab相当于ls -A （Centos 7不支持）</p><h3 id="3-16-命令行历史"><a href="#3-16-命令行历史" class="headerlink" title="3.16 命令行历史"></a>3.16 命令行历史</h3><p>保存你输入的命令历史。可以用它来重复执行命令</p><p>登录shell时，会读取命令历史文件中记录下的命令<code>~/.bash_history</code></p><p>登录进shell后新执行的命令只会记录在缓存中;这些命令会在用户退出时”追加”至命令历史文件中</p><p>当用户正常退出时（exit，Ctrl+d），会将内存的命令历史存放对应的历史文件中，默认是<code>~/.bash_history</code></p><p><strong>命令：history</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-c清空命令历史</span><br><span class="line">-doffset:删除历史中指定的第offset</span><br><span class="line"> n显示最近的n条历史</span><br><span class="line">-a追加本次会话新执行的命令历史列表至历史列表文件</span><br><span class="line">-r读历史文件附加到历史列表</span><br><span class="line">-w保存历史列表到指定的历史文件</span><br><span class="line">-n读历史文件中未度过的行到历史列表</span><br><span class="line">-p展开历史参数成多行,但不存在历史列表中</span><br><span class="line">-s展示历史参数成一行,附加在历史列表后</span><br></pre></td></tr></table></figure><p>历史命令记录的数量由变量<code>$HISTSIZE</code>控制</p><p>历史文件由变量<code>$HISFILE</code>控制</p><p>命令历史文件记录条数由变量<code>$HISTFILESIZE</code>控制</p><p>命令历史保存格式由变量<code>export HISTTIMEFORMAT=&quot;%F %T $(whoami) &quot;</code>定义</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改记录数</span></span><br><span class="line">sed -i &#x27;s|HISTSIZE=1000|HISTSIZE=5000|&#x27; /etc/profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置生效</span></span><br><span class="line">. /etc/profile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成一条假的命令历史</span></span><br><span class="line">history -s rm -rf /*</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改历史命令格式</span></span><br><span class="line">export HISTTIMEFORMAT=&quot;%F %T &quot;</span><br><span class="line"></span><br><span class="line">[15:13:25] [root@Rocky ~][0]# history </span><br><span class="line">    1  2023-10-24 15:09:36 echo 1</span><br><span class="line">    2  2023-10-24 15:09:36 echo 2</span><br></pre></td></tr></table></figure><h3 id="3-17-Bash快捷键"><a href="#3-17-Bash快捷键" class="headerlink" title="3.17 Bash快捷键"></a>3.17 Bash快捷键</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + l清屏</span><br><span class="line">Ctrl + o执行当前命令，并重新显示本命令</span><br><span class="line">Ctrl + s阻止屏幕输出，锁定</span><br><span class="line">Ctrl + q允许屏幕输出，解锁</span><br><span class="line">Ctrl + c终止命令</span><br><span class="line">Ctrl + z挂起命令</span><br><span class="line">Ctrl + a光标移动到命令行首，相当于Home</span><br><span class="line">Ctrl + e光标移动到命令行尾，相当于End</span><br><span class="line">Ctrl + f光标向右移动一个字符</span><br><span class="line">Ctrl + b光标向左移动一个字符</span><br><span class="line">Ctrl + xx光标在命令行首和光标之间移动</span><br><span class="line">Ctrl + u从光标出删除至命令行首</span><br><span class="line">Ctrl + k从光标处删除至命令行尾</span><br><span class="line">Alt  + r删除当前整行</span><br><span class="line">Ctrl + w从光标处向左删除至单词尾</span><br><span class="line">Alt  + d从光标处向右删除至单词尾</span><br><span class="line">Ctrl + d删除光标处一个字符</span><br><span class="line">Ctrl + h删除光标前一个字符</span><br><span class="line">Ctrl + y将删除的字符粘贴至光标后</span><br><span class="line">Alt  + c从光标处开始向右更改为首字母大写的单词</span><br><span class="line">Alt  + u从光标处开始，将右边一共单词改为大写</span><br><span class="line">Alt  + l从光标处开始，将右边一共单词更改为大写</span><br><span class="line">Ctrl + t交换光标处和之前的字符位置</span><br><span class="line">Alt  + t交换光标处和之前的单词位置</span><br><span class="line">Alt  + #提示输入指定字符后，重复显示改字符#次</span><br></pre></td></tr></table></figure><h3 id="3-18-分析系统启动时的消息"><a href="#3-18-分析系统启动时的消息" class="headerlink" title="3.18 分析系统启动时的消息"></a>3.18 分析系统启动时的消息</h3><p>它显示内核在启动过程中发出的消息，包括设备检测、驱动加载、硬件错误等信息。此外，<code>dmesg</code> 也可以用于查看实时内核消息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg</span><br></pre></td></tr></table></figure><h3 id="3-19-判断操作系统安装时间"><a href="#3-19-判断操作系统安装时间" class="headerlink" title="3.19 判断操作系统安装时间"></a>3.19 判断操作系统安装时间</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum history | grep &#x27;System&#x27; | awk -F &#x27;|&#x27; &#x27;&#123;print $3&#125;&#x27;</span><br></pre></td></tr></table></figure><h3 id="3-20-将缓冲区数据写入硬盘"><a href="#3-20-将缓冲区数据写入硬盘" class="headerlink" title="3.20 将缓冲区数据写入硬盘"></a>3.20 将缓冲区数据写入硬盘</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sync</span><br></pre></td></tr></table></figure><h3 id="3-21-周期性运行一个命令"><a href="#3-21-周期性运行一个命令" class="headerlink" title="3.21 周期性运行一个命令"></a>3.21 周期性运行一个命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-n ?指定刷新时间间隔</span><br><span class="line">-d高亮显示其变化</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">监视系统当前运行时间</span></span><br><span class="line">watch -n 1 date</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">监视网络连接</span></span><br><span class="line">watch ss -tulpn</span><br></pre></td></tr></table></figure><h1 id="4-获得帮助"><a href="#4-获得帮助" class="headerlink" title="4. 获得帮助"></a>4. 获得帮助</h1><h3 id="4-1-whatis"><a href="#4-1-whatis" class="headerlink" title="4.1 whatis"></a>4.1 whatis</h3><p>whatis 使用数据库来显示命令的简短描述，刚安装后不可立即使用，需要制作数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Centos 7以后制作数据库</span></span><br><span class="line">mandb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Centos 6之前制作数据库</span></span><br><span class="line">makewhatis</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">whatis cat  等价于   man -f cat</span><br></pre></td></tr></table></figure><h3 id="4-2-查看命令帮助"><a href="#4-2-查看命令帮助" class="headerlink" title="4.2 查看命令帮助"></a>4.2 查看命令帮助</h3><p>内部命令：</p><ul><li>help CMD</li><li>man CMD</li></ul><p>外部命令或者软件：</p><ul><li>CMD –help 或 CMD -h</li><li>使用手册（manual）</li></ul><p>​man CMD</p><ul><li>信息页</li></ul><p>​info CMD</p><ul><li>程序自身帮助文档</li><li>程序官方文档</li><li>发行版的官方文档</li><li>百度，Google</li></ul><h3 id="4-3-–help-和-h-选项"><a href="#4-3-–help-和-h-选项" class="headerlink" title="4.3 –help 和 -h 选项"></a>4.3 –help 和 -h 选项</h3><p>格式说明：</p><ul><li>[] 表示可选项</li><li>CPS或&lt;&gt;表示变化的数据</li><li>…表示一个列表</li><li>x|y|z的意思是”x”或”y”或”z”</li><li>-abc的意思是-a -b -c</li><li>{ } 表示分组</li></ul><h3 id="4-4-man命令"><a href="#4-4-man命令" class="headerlink" title="4.4 man命令"></a>4.4 man命令</h3><p>man 提供命令帮助的文件，手册也存放在&#x2F;usr&#x2F;share&#x2F;man</p><p>几乎每个命令都有man的”页面”</p><p>中文man帮助需要安装包</p><ul><li>man-pages</li><li>man-pages-zh-CN</li></ul><p>man 页面分组为不同的”章节”，统称为Linux手册，man 1 man</p><ul><li>1：用户命令</li><li>2：系统调用</li><li>3：C库调用</li><li>4：设备文件及特殊文件</li><li>5：配置文件格式</li><li>6：游戏</li><li>7：杂项</li><li>8：管理类命令</li><li>8：Linux内核API</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Centos 6 之前版 man 的配置文件</span></span><br><span class="line">/etc/man.config</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Centos 7 之后版 man 的配置文件</span></span><br><span class="line">/etc/man_db.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Ubuntu man 的配置文件</span></span><br><span class="line">/etc/manpath.config</span><br></pre></td></tr></table></figure><p>查看man手册页：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看帮助</span></span><br><span class="line">man -f keyword</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据上面的章节查询对应帮助</span></span><br><span class="line">man [ 章节 ] keyword</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印man帮助文件的路径</span></span><br><span class="line">man -w [ 章节 ] keyword</span><br></pre></td></tr></table></figure><p>man帮助段落说明</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">NAME名称及简要说明</span><br><span class="line">SYNOPSIS用法格式说明</span><br><span class="line">[ ]可选内容</span><br><span class="line">&lt; &gt;必选内容</span><br><span class="line">a|b二选一</span><br><span class="line">&#123; &#125;分组</span><br><span class="line">...用一个内容可出现多次</span><br><span class="line">DESCRIPTION详细说明</span><br><span class="line">OPTIONS选项说明</span><br><span class="line">EXAMPLES示例</span><br><span class="line">FILES相关文件</span><br><span class="line">AUTHOR作者</span><br><span class="line">COPYRUGHT版本信息</span><br><span class="line">REPORTING BUGbug信息</span><br><span class="line">SEE ALSO其他帮助查看</span><br></pre></td></tr></table></figure><h3 id="4-6-info"><a href="#4-6-info" class="headerlink" title="4.6 info"></a>4.6 info</h3><p>man常用于命令参考，GNU工具info 适合通用文档参考<br>没有参数，列出所有的页面<br>info页面的结构就像一个网站<br>每一页分为”节点”<br>链接节点之前*<br>info命令格式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info [命令]</span><br></pre></td></tr></table></figure><p>导航info页</p><ul><li>方向键，PgUp，PgDn 导航</li><li>Tab 键移动到下一个链接</li><li>d 显示主题目录</li><li>Home 显示主题首部</li><li>Enter 进入选定链接</li><li>n&#x2F;p&#x2F;u&#x2F;l 进入下&#x2F;前&#x2F;上一层&#x2F;最后一个链接</li><li>s 文字文本搜索</li><li>q 退出info</li></ul><h1 id="5-目录结构和文件类型"><a href="#5-目录结构和文件类型" class="headerlink" title="5. 目录结构和文件类型"></a>5. 目录结构和文件类型</h1><h3 id="5-1-文件目录结构"><a href="#5-1-文件目录结构" class="headerlink" title="5.1 文件目录结构"></a>5.1 文件目录结构</h3><p>&#x3D;&#x3D;蓝色–&gt;目录，绿色–&gt;可执行文件，红色–&gt;压缩文件，浅蓝色–&gt;链接文件，灰色–&gt;其他文件&#x3D;&#x3D;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/afs: AFS 根目录，通常用于分布式文件系统 AFS。</span><br><span class="line">/bin: 存放系统启动和修复所需的基本命令，这些命令在单用户模式下也可用。</span><br><span class="line">/boot: 包含引导加载程序、内核和其他引导所需的文件。</span><br><span class="line">/dev: 包含设备文件，用于访问系统硬件设备，如磁盘、终端、键盘等。</span><br><span class="line">/etc: 存放系统全局配置文件，包括网络配置、用户账户信息等。</span><br><span class="line">/home: 用户的主目录通常位于此，每个用户有自己的子目录。</span><br><span class="line">/lib: 包含系统启动和运行时所需的共享库。</span><br><span class="line">/lib64: 64位系统的共享库目录，存放64位库文件。</span><br><span class="line">/media: 用于挂载可移动媒体设备，如光盘、USB驱动器等。</span><br><span class="line">/mnt: 用于手动挂载临时文件系统，通常由管理员使用。</span><br><span class="line">/opt: 用于安装可选的软件包，通常是第三方应用程序。</span><br><span class="line">/proc: 虚拟文件系统，提供关于正在运行的系统进程的信息。</span><br><span class="line">/root: 超级用户（root）的主目录。</span><br><span class="line">/run: 运行时临时文件系统，包含运行时文件和进程信息。</span><br><span class="line">/sbin: 存放系统启动、修复和系统维护的基本命令，通常需要超级用户权限。</span><br><span class="line">/srv: 用于存放服务数据，通常由各种服务程序使用。</span><br><span class="line">/sys: 提供对内核参数和状态的访问，通常用于系统管理。</span><br><span class="line">/tmp: 用于存放临时文件，任何用户都可以写入，但文件可能在系统重启时被删除。</span><br><span class="line">/usr: 存放用户数据，包括用户安装的软件、文档、库等。</span><br><span class="line">/var: 存放可变数据，如日志文件、数据库文件、邮件等。</span><br></pre></td></tr></table></figure><h3 id="5-2-应用程序的组成部分"><a href="#5-2-应用程序的组成部分" class="headerlink" title="5.2 应用程序的组成部分"></a>5.2 应用程序的组成部分</h3><p>进制程序: &#x2F;bin，&#x2F;sbin，&#x2F;usr&#x2F;bin，&#x2F;usr&#x2F;sbin，&#x2F;usr&#x2F;local&#x2F;bin，&#x2F;usr&#x2F;local&#x2F;sbin<br>库文件: &#x2F;lib，&#x2F;lib64，&#x2F;usr&#x2F;lib，&#x2F;usr&#x2F;lib64，&#x2F;usr&#x2F;local&#x2F;lib，&#x2F;usr&#x2F;local&#x2F;lib64<br>配置文件: &#x2F;etc，&#x2F;etc&#x2F;DIRECTORY，&#x2F;usr&#x2F;local&#x2F;etc<br>帮助文件: &#x2F;usr&#x2F;share&#x2F;man，&#x2F;usr&#x2F;share&#x2F;doc，&#x2F;usr&#x2F;local&#x2F;share&#x2F;man，&#x2F;usr&#x2F;local&#x2F;share&#x2F;doc</p><h3 id="5-3-Linux下的文件类型"><a href="#5-3-Linux下的文件类型" class="headerlink" title="5.3 Linux下的文件类型"></a>5.3 Linux下的文件类型</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">普通文件</span></span><br><span class="line">- 普通文件是包含数据的一般文件类型。它可以是文本文件、二进制文件或任何其他数据文件。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">目录</span></span><br><span class="line">d 目录是文件系统中用于组织和存储其他文件和目录的特殊类型的文件。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">符号链接文件</span></span><br><span class="line">l 符号链接（软链接）是指向另一个文件或目录的引用文件。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">字符设备文件</span></span><br><span class="line">c 字符设备文件用于与字符设备进行通信，例如终端或串口设备。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">块设备文件</span></span><br><span class="line">b 块设备文件用于与块设备进行通信，例如硬盘驱动器或分区。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">管道文件</span></span><br><span class="line">p 命名管道（FIFO）用于进程间通信，通常以管道(|)的形式在命令行中使用。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">套接字</span></span><br><span class="line">s 套接字文件用于进程间的本地通信，通常在网络编程中使用。</span><br></pre></td></tr></table></figure><h1 id="6-文件操作命令"><a href="#6-文件操作命令" class="headerlink" title="6. 文件操作命令"></a>6. 文件操作命令</h1><h3 id="6-1-显示当前工作目录"><a href="#6-1-显示当前工作目录" class="headerlink" title="6.1 显示当前工作目录"></a>6.1 显示当前工作目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-P显示真实物理路径</span><br><span class="line">-L显示连接路径(默认)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前目录</span></span><br><span class="line">pwd</span><br></pre></td></tr></table></figure><h3 id="6-2-文件路径分割"><a href="#6-2-文件路径分割" class="headerlink" title="6.2 文件路径分割"></a>6.2 文件路径分割</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">当前工作目录的父目录名称</span></span><br><span class="line">dirname $(pwd)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">当前工作目录的基本目录名称</span></span><br><span class="line">basename $(pwd)</span><br></pre></td></tr></table></figure><h3 id="6-3-绝对路径和相对路径"><a href="#6-3-绝对路径和相对路径" class="headerlink" title="6.3 绝对路径和相对路径"></a>6.3 绝对路径和相对路径</h3><ul><li><p>绝对路径</p><p>绝对路径是从文件系统的根目录（通常表示为<code>/</code>）开始的完整路径，以定位文件或目录。它提供了文件或目录的完整位置信息，不依赖于当前工作目录。</p></li><li><p>相对路径</p><p>相对路径是相对于当前工作目录的路径，用于定位文件或目录。它不提供文件或目录的完整位置信息，而是相对于当前位置的路径。</p></li></ul><h3 id="6-4-切换目录"><a href="#6-4-切换目录" class="headerlink" title="6.4 切换目录"></a>6.4 切换目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换到绝对路径</span></span><br><span class="line">cd /path/to/directory</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换到相对路径</span></span><br><span class="line">cd relative/path/to/directory</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换到上级目录</span></span><br><span class="line">cd ..</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换到上上级目录</span></span><br><span class="line">cd ../../</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换到家目录</span></span><br><span class="line">cd ~</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换到上次访问的目录</span></span><br><span class="line">cd -</span><br></pre></td></tr></table></figure><h3 id="6-5-列出目录类容"><a href="#6-5-列出目录类容" class="headerlink" title="6.5 列出目录类容"></a>6.5 列出目录类容</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ls [选项] [目录]</span><br><span class="line"></span><br><span class="line">-a查看所有文件,包括隐藏文件</span><br><span class="line">-l列出文件详细信息</span><br><span class="line">-R递归显示目录中的所有文件和子目录</span><br><span class="line">-ld目录和符号连接信息</span><br><span class="line">-1目录分行显示</span><br><span class="line">-d  只列出目录（不递归列出目录内的文件）</span><br><span class="line">-r倒序</span><br><span class="line">-S按文件大小,从大到小排序</span><br><span class="line">-Sr按文件大小,从小到大排序</span><br><span class="line">-t按文件时间排序,最新的将排在最前面</span><br><span class="line">-tr按文件时间排序,最旧的将排在最前面</span><br><span class="line">-U按目录存放顺序显示</span><br><span class="line">-X按文件后缀排序</span><br><span class="line">-i显示文件Inode编号</span><br><span class="line">-h更直观的方式显示文件大小</span><br></pre></td></tr></table></figure><h3 id="6-6-查看文件时间属性stat"><a href="#6-6-查看文件时间属性stat" class="headerlink" title="6.6 查看文件时间属性stat"></a>6.6 查看文件时间属性stat</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看文件访问时间</span></span><br><span class="line">ls -lu filename</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看文件权限,元数据更改时间</span></span><br><span class="line">ls -lc filename</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看文件修改时间</span></span><br><span class="line">ls -l filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看文件三个时间状态详细状态</span></span><br><span class="line">stat filename</span><br></pre></td></tr></table></figure><h3 id="6-7-确认文件类型和文件类型转换"><a href="#6-7-确认文件类型和文件类型转换" class="headerlink" title="6.7 确认文件类型和文件类型转换"></a>6.7 确认文件类型和文件类型转换</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-b列出文件辨识结果,不显示文件名称</span><br><span class="line">-f列出文件中文件名的文件类型</span><br><span class="line">-L查看对应软链接对应文件的类型</span><br><span class="line"></span><br><span class="line">file dir.txt</span><br></pre></td></tr></table></figure><p>范例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示编码列表</span></span><br><span class="line">iconv -l</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将windows10上文本默认的编码转换UTF-8</span></span><br><span class="line">iconv -f gb2312 win.txt -o win2.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将文本win.txt的编码utf8转换成gb2312,并将转换后的文本保存到win2.txt</span></span><br><span class="line">iconv -f utf8 -t gb2312 win.txt -o win2.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将windows的文本格式转换成Linux的文本格式</span></span><br><span class="line">dos2unix windows.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将linux的文本格式转化成windows的文本格式</span></span><br><span class="line">unix2dos Linux.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">自动检测文件编码,将文件file.txt转换成UTF-8</span></span><br><span class="line">enca -L none -x utf-8 file.txt</span><br></pre></td></tr></table></figure><h3 id="6-8-通配符"><a href="#6-8-通配符" class="headerlink" title="6.8 通配符"></a>6.8 通配符</h3><p>文件通配符可以用来匹配符合条件的多个文件，方便批量管理文件</p><p>通配符采才特定的符号，表示特殊含义，此特殊符号称之为元字符</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">*匹配零个或多个字符,不匹配隐藏文件</span><br><span class="line">?匹配任意单个字符</span><br><span class="line">~当前用户家目录</span><br><span class="line">~zy用户zy家目录</span><br><span class="line">~+和.当前工作目录</span><br><span class="line">~-前一个工作目录</span><br><span class="line">[0-9]0-9的所有数字</span><br><span class="line">[a-z]a-z的所有字母</span><br><span class="line">[A-Z]A-Z的所有字母</span><br><span class="line">[wang]匹配列表中的任意一个字符</span><br><span class="line">[^wang]匹配列表中的所有字符以外的字符</span><br></pre></td></tr></table></figure><p>特殊符号</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[:digit:]: 任意数字，相当于0-9</span><br><span class="line">[:1ower:]: 任意小写字母,表示 a-z</span><br><span class="line">[:upper:]: 任意大写字母,表示 A-Z</span><br><span class="line">[:alpha:]: 任意大小写字母</span><br><span class="line">[:alnum:]: 任意数字或字母</span><br><span class="line">[:blank:]: 水平空白字符</span><br><span class="line">[:space:]: 水平或垂直空白字符</span><br><span class="line">[:punct:]: 标点符号</span><br><span class="line">[:print:]: 可打印字符</span><br><span class="line">[:cntr1:]: 控制(非打印) 字符</span><br><span class="line">[:graph:]: 图形字符</span><br><span class="line">[:xdigit:]:十六进制字符</span><br></pre></td></tr></table></figure><h3 id="6-9-创建文件和刷新文件时间"><a href="#6-9-创建文件和刷新文件时间" class="headerlink" title="6.9 创建文件和刷新文件时间"></a>6.9 创建文件和刷新文件时间</h3><p>touch命令可以用来创建空文件或刷新文件的时间</p><p>不存在的文件将会创建</p><p>存在的文件将会刷新时间，不会清空文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法</span></span><br><span class="line">touch [选项] file...</span><br><span class="line"></span><br><span class="line">-a仅改变atime和ctime</span><br><span class="line">-m仅改变mtime和ctime</span><br><span class="line">-c如果文件不存在,则不予创建</span><br></pre></td></tr></table></figure><h3 id="6-10-复制文件和目录"><a href="#6-10-复制文件和目录" class="headerlink" title="6.10 复制文件和目录"></a>6.10 复制文件和目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cp [选项] 源文件 目标</span><br><span class="line"></span><br><span class="line">-a保留链接、文件属性，并复制目录下的所有内容</span><br><span class="line">-p保留源文件权限,所有者和时间戳信息</span><br><span class="line">-d不复制源文件,只复制软链接</span><br><span class="line">-i如果目标存在,覆盖前提示是否覆盖</span><br><span class="line">-n不覆盖</span><br><span class="line">-r,-R递归复制目录及内部的所有内容</span><br><span class="line">-v显示拷贝过程</span><br><span class="line">-f如果文件不能打开,则尝试删除后再复制</span><br><span class="line">-u只复制源比目标更新的文件,或者目标没有的文件</span><br><span class="line">-b目标存在,覆盖之前先备份一次,形式为filename~,只保留一个版本</span><br><span class="line">--backup=numbered目标存在,覆盖之前先备份加数字后缀,保留多个版本</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@Rocky ~][0]# cp --backup=numbered /etc/fstab fstab</span><br><span class="line">-rw-r--r-- 1 root root 534 Oct 25 16:52 fstab</span><br><span class="line">-rw-r--r-- 1 root root 534 Oct 25 16:53 fstab.~1~</span><br><span class="line">-rw-r--r-- 1 root root 534 Oct 25 16:54 fstab.~2~</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">复制当前目录所有文件</span></span><br><span class="line">cp -a . /PATH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在文件源路径下备份</span></span><br><span class="line">cp -a /apps/nginx/sbin/nginx&#123;,.bak&#125;</span><br></pre></td></tr></table></figure><h3 id="6-11-移动和重命名文件"><a href="#6-11-移动和重命名文件" class="headerlink" title="6.11 移动和重命名文件"></a>6.11 移动和重命名文件</h3><p>mv可以实现文件或目录的移动和改名</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法</span></span><br><span class="line">mv [选项] 源文件或目录 目标文件或目录</span><br><span class="line">mv [选项]源文件或目录 目标文件或目录</span><br><span class="line">mv [选项]源文件或目录1 源文件或目录2 源文件或目录3 目标文件或目录</span><br><span class="line"></span><br><span class="line">-i交互式</span><br><span class="line">-f强制</span><br><span class="line">-b目标存在,覆盖前先备份</span><br><span class="line">-t反转，mv [选项] 目标文件或目录 源文件或目录</span><br></pre></td></tr></table></figure><h3 id="6-12-批量重命名文件"><a href="#6-12-批量重命名文件" class="headerlink" title="6.12 批量重命名文件"></a>6.12 批量重命名文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">为所有conf文件加上.bak后缀</span></span><br><span class="line">renameconf &#x27;conf.bak&#x27;  /PATH/*</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">去掉所有的bak后缀</span></span><br><span class="line">rename &#x27;.bak&#x27; &#x27;&#x27; /PATH/*.bak</span><br></pre></td></tr></table></figure><h3 id="6-13-删除文件"><a href="#6-13-删除文件" class="headerlink" title="6.13 删除文件"></a>6.13 删除文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">rm [选项] 文件路径</span><br><span class="line"></span><br><span class="line">-i交互式删除</span><br><span class="line">-f强制删除</span><br><span class="line">-r递归删除</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除隐藏文件</span></span><br><span class="line">rm -rf .[^.]*</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除所有数据,包括隐藏文件</span></span><br><span class="line">rm -rf * .[^.]*</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">变量如果为空,会导致删根</span></span><br><span class="line">var=&#x27;&#x27;</span><br><span class="line">rm -rf var/*</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除特殊文件-f</span></span><br><span class="line">touch /data/-f</span><br><span class="line">rm -rf /data/-f</span><br><span class="line">rm -rf ./-f</span><br><span class="line">rm -- -f</span><br><span class="line">touch /-f</span><br><span class="line">rm -rf /-f</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除特殊文件 ~</span></span><br><span class="line">touch &#x27;~&#x27;</span><br><span class="line">rm -f ./~</span><br></pre></td></tr></table></figure><p>rm 虽然删除了文件，但是被删除的文件仍然有可能被恢复，在安全要求较高的场景下，可以使用shred安全删除文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">shred [选项] 文件路径</span><br><span class="line"></span><br><span class="line">-z最后一次覆盖添加0,以隐藏覆盖操作</span><br><span class="line">-v能够显示操作进度</span><br><span class="line">-u覆盖后截断并删除文件</span><br><span class="line">-n #指定覆盖文件内容的次数（默认次数是3次）</span><br><span class="line"></span><br><span class="line">范例：</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">[root@Rocky /][0]# <span class="built_in">shred</span> -zvun 5 passwd.txt</span></span><br><span class="line">shred: passwd.txt: pass 1/6 (random)...</span><br><span class="line">shred: passwd.txt: pass 2/6 (ffffff)...</span><br><span class="line">shred: passwd.txt: pass 3/6 (random)...</span><br><span class="line">shred: passwd.txt: pass 4/6 (000000)...</span><br><span class="line">shred: passwd.txt: pass 5/6 (random)...</span><br><span class="line">shred: passwd.txt: pass 6/6 (000000)...</span><br><span class="line">shred: passwd.txt: removing</span><br><span class="line">shred: passwd.txt: renamed to 000000</span><br><span class="line">shred: 000000: renamed to 00000</span><br><span class="line">shred: 00000: renamed to 0000</span><br><span class="line">shred: 0000: renamed to 000</span><br><span class="line">shred: 000: renamed to 00</span><br><span class="line">shred: 00: renamed to 0</span><br><span class="line">shred: passwd.txt: removed</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="6-14-清空文件"><a href="#6-14-清空文件" class="headerlink" title="6.14 清空文件"></a>6.14 清空文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">不会删除文件,会将文件内容清空</span></span><br><span class="line">cat /dev/null &gt; biglog.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方式二,不通用</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">biglog.txt</span></span><br></pre></td></tr></table></figure><h3 id="6-15-目录操作"><a href="#6-15-目录操作" class="headerlink" title="6.15 目录操作"></a>6.15 目录操作</h3><p><strong>查看目录</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tree 目录名</span><br><span class="line"></span><br><span class="line">-d只显示文件夹</span><br><span class="line">-L #显示指定层级的数目</span><br></pre></td></tr></table></figure><p><strong>创建目录</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mkdir [选项] 目录名</span><br><span class="line"></span><br><span class="line">-p递归创建目录</span><br><span class="line">-v显示创建目录过程</span><br><span class="line">-m创建目录时直接指定权限</span><br><span class="line"></span><br><span class="line">范例：</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">递归创建目录</span></span><br><span class="line">mkdir -pv /dir1/dir2/dir3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建目录时指定权限</span></span><br><span class="line">mkdir -m 000 /dir1</span><br></pre></td></tr></table></figure><p><strong>删除空目录</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rmdir </span><br><span class="line"></span><br><span class="line">范例：</span><br><span class="line">rmdir /dir</span><br></pre></td></tr></table></figure><h1 id="7-文件元数据和节点表结构"><a href="#7-文件元数据和节点表结构" class="headerlink" title="7. 文件元数据和节点表结构"></a>7. 文件元数据和节点表结构</h1><h3 id="7-1-inode表结构"><a href="#7-1-inode表结构" class="headerlink" title="7.1 inode表结构"></a>7.1 inode表结构</h3><p>每一个文件的属性信息，比如：文件的大小，时间，类型等，称为文件的元数据（meta data）。这些元数据是存放在node（index node）表中。node表中有很多条记录组成，第一条记录对应存放了一个文件的元数据信息，第一个node表记录对应的保存了以下信息：</p><ul><li><p>文件类型和权限信息：inode 包括文件的类型（普通文件、目录、符号链接等）以及文件的权限信息，如所有者、所属组和其他用户的读、写和执行权限。</p></li><li><p>链接计数（Link Count）：链接计数是指有多少个目录项指向同一个inode。当你创建一个硬链接（hard link）时，链接计数会增加。当链接计数为零时，文件系统会回收inode。</p></li><li><p>所有者和所属组：inode 记录了文件或目录的所有者和所属组的标识符（通常是用户和组的ID）。</p></li><li><p>文件大小：inode 包括文件的实际大小，以字节为单位。</p></li><li><p>时间戳：inode 包括三个时间戳：</p></li></ul><p>​访问时间（Access Time）：文件或目录最后一次被访问的时间。</p><p>​修改时间（Modification Time）：文件或目录内容最后一次被修改的时间。</p><p>​更改时间（Change Time）：inode 元数据最后一次被修改的时间，例如权限、所有者等的更改。</p><ul><li>数据块指针：inode 包含指向文件数据块的指针。这些指针通常包括直接块、间接块和双重间接块，用于定位和访问文件的实际数据。</li></ul><p>​直接块：前12个指针直接指向文件的数据块。<br>​间接块：第13个指针指向一个块，该块包含其他指向数据块的指针。<br>​双重间接块：第14个指针指向一个块，该块包含指向包含其他指向数据块的指针的块的指针。<br>​inode 表结构的主要目的是使文件系统能够高效地管理文件和目录的元数据以及定位数据块。它允许文件系统跟踪和组织文件信息，以便操作系统可以正确地访问和管理文件。</p><h3 id="7-2-案例："><a href="#7-2-案例：" class="headerlink" title="7.2 案例："></a>7.2 案例：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">提示空间满No space left on device,但<span class="built_in">df</span>可以看到空间很多,为什么？</span></span><br><span class="line">1. 磁盘配额限制：在某些情况下，文件系统上的磁盘配额（disk quotas）可能会被启用，这会限制每个用户或组的可用磁盘空间。即使文件系统总体上有足够的可用空间，但如果用户或组的磁盘配额已用尽，他们将无法创建更多文件。</span><br><span class="line">2. 磁盘碎片：即使 df 显示磁盘有足够的总可用空间，如果文件系统中有太多碎片，可能会导致没有足够的连续空间来存储大文件或扩展现有文件。这可能导致 &quot;No space left on device&quot; 错误。</span><br><span class="line">3. 已删除但仍被进程使用的文件：如果有一个进程正在写入或打开一个已被删除的文件，那么即使文件已被标记为删除，磁盘空间也不会被立即释放。</span><br><span class="line">4. 超出文件系统限制：某些文件系统（特别是旧的文件系统）可能有文件数量或文件大小的限制。如果达到了这些限制，你将无法创建更多文件，即使磁盘空间仍然可用。</span><br><span class="line">5. 文件系统损坏：在极少数情况下，文件系统损坏可能导致 &quot;No space left on device&quot; 错误。文件系统检查工具如fsck 可以用于检查和修复文件系统中的问题</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">提示空间快满了,但<span class="built_in">df</span>和<span class="built_in">df</span> -i都可以看到空间很多,为什么？</span></span><br><span class="line">1. 已删除但仍被进程使用的文件：有时，已删除的文件仍然被正在运行的进程使用。这些文件仍占用磁盘空间，尽管它们不再在文件系统中可见。你可以使用工具如 lsof 来查找这些被删除但仍然被打开的文件，然后将这些文件关闭或终止相关进程。</span><br><span class="line">2. 硬链接的问题：硬链接是多个目录项指向相同的inode。如果你创建了大量的硬链接，这可能会导致 &quot;No space left on device&quot; 的错误，即使文件系统的空间和inode都足够。硬链接不会增加inode使用量，但会增加链接计数。确保你了解硬链接的工作原理，并检查是否有大量的硬链接占用了磁盘空间。</span><br><span class="line">3. 磁盘配额限制：磁盘配额限制用户或组的磁盘使用。即使 df 和 df -i 显示有足够的空间和inode，但如果用户或组的配额已用尽，他们将无法创建更多文件。检查磁盘配额是否对你的用户或组进行了限制。</span><br><span class="line">4. 磁盘文件系统损坏：文件系统损坏可能导致奇怪的问题，包括错误的空间报告。运行文件系统检查工具如 fsck 可能有助于发现和修复问题。</span><br><span class="line">5. 软链接的问题：软链接（符号链接）是特殊类型的文件，通常很小。但如果软链接指向一个不存在的文件，它可能会导致错误。确保软链接的目标文件存在。</span><br><span class="line">6. 写入缓冲区满：在某些情况下，写入数据到磁盘可能由于写入缓冲区满而暂停。这可能导致空间似乎快满了，尽管实际上还有可用的空间。等待一段时间或刷新磁盘缓冲区可能会解决这个问题。</span><br></pre></td></tr></table></figure><h3 id="7-3-硬连接"><a href="#7-3-硬连接" class="headerlink" title="7.3 硬连接"></a>7.3 硬连接</h3><p>硬连接的本质就是给一个文件起一个新的名称，实质是同一个文件</p><ol><li>硬链接只能在同一文件系统上创建</li><li>硬链接不能为目录创建</li><li>硬链接与原文件共享数据和inode</li><li>硬链接不占用额外磁盘空间</li><li>硬链接不改变文件的权限和属性</li><li>硬链接不能跨越驱动器或分区</li><li>硬链接不适用于所有文件系统，一些网络文件系统（如NFS）和移动设备文件系统（如FAT）可能不支持硬链接</li><li>删除文件时，rm命令递减计数的链接，当链接数为0，该文件被删除</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法</span></span><br><span class="line">ln 原文件 目标文件</span><br></pre></td></tr></table></figure><h3 id="7-4-软连接"><a href="#7-4-软连接" class="headerlink" title="7.4 软连接"></a>7.4 软连接</h3><p>一个符号链接指向另一个文件，就像windows中快捷方式，软链接文件和原文件本质上不是同一个文件</p><ol><li>软链接可以跨文件系统创建</li><li>软链接可以引用目录</li><li>软链接占用额外磁盘空间，通常是几个字节</li><li>原文件的删除会导致软链接失效</li><li>软连接如何使用相对路径，是相对原文件的路径，而非相对当前目录</li><li>软链接可能引起无限递归，即A指向B，B指向A</li><li>软链接可能引起权限问题：如果软链接引用的文件或目录拥有限制访问的权限，软链接本身可能不起作用。确保软链接和原文件或目录的权限设置允许你访问它们</li><li>软链接不占用inode，他指向的是另外一个文件的路径，其大小为指向路径字符串的长度，不增加或减少目标inode的计数</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法</span></span><br><span class="line">ln -s 原文件 目标文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看连接文件指向的原文件</span></span><br><span class="line">readlink /data/dirlink</span><br></pre></td></tr></table></figure><h3 id="7-5-硬连接和软连接的区别"><a href="#7-5-硬连接和软连接的区别" class="headerlink" title="7.5 硬连接和软连接的区别"></a>7.5 硬连接和软连接的区别</h3><ol><li><strong>本质</strong></li></ol><p>​硬链接：本质是同一个文件</p><p>​软连接：本质不上同一个文件</p><ol start="2"><li><strong>跨设备</strong></li></ol><p>​硬链接：不支持</p><p>​软连接：支持</p><ol start="3"><li><p><strong>inode</strong></p><p>硬链接：相同</p><p>软连接：不通</p></li><li><p><strong>链接数</strong></p></li></ol><p>​硬链接：创建新的硬连接，链接数会增加，删除硬链接，链接数减少</p><p>​软连接：创建或删除，链接数不会变化</p><ol start="5"><li><strong>文件夹</strong></li></ol><p>​硬链接：不支持</p><p>​软连接：支持</p><ol start="6"><li><strong>相对路径</strong></li></ol><p>​硬链接：原始文件相对路径是相对于当前工作目录</p><p>​软连接：原始文件的相对路径是相对于链接文件的相对路径</p><ol start="7"><li><p><strong>删除原文件</strong></p><p>硬链接：只是链接数减一，但链接文件的访问不受影响</p><p>软连接：链接文件将无法访问</p></li><li><p>文件类型</p><p>硬链接：和原文件相同</p><p>软连接：链接文件，和原文件无关</p></li></ol><h1 id="8-标准IO重定向和管道"><a href="#8-标准IO重定向和管道" class="headerlink" title="8. 标准IO重定向和管道"></a>8. 标准IO重定向和管道</h1><h3 id="8-1-标准输入和输出"><a href="#8-1-标准输入和输出" class="headerlink" title="8.1 标准输入和输出"></a>8.1 标准输入和输出</h3><p>Linux给程序提供三种 I &#x2F;O 设备</p><ul><li>标准输入（STDIN）-0默认接受来自终端窗口的输入</li><li>标准输出（STDOUT）    -1        默认输出到终端窗口</li><li>标准错误（STDERR）     -2        默认输出到终端窗口</li></ul><p>文件描述符</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky ~][0]# ll /dev/std*</span><br><span class="line">lrwxrwxrwx 1 root root 15 Oct 18 20:45 /dev/stderr -&gt; /proc/self/fd/2</span><br><span class="line">lrwxrwxrwx 1 root root 15 Oct 18 20:45 /dev/stdin -&gt; /proc/self/fd/0</span><br><span class="line">lrwxrwxrwx 1 root root 15 Oct 18 20:45 /dev/stdout -&gt; /proc/self/fd/1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看每个进程的的I/O设备</span></span><br><span class="line">ll /proc/程序的PID/fd/*</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前终端的I/O设备</span></span><br><span class="line">[root@Rocky ~][0]# ll /proc/self/fd</span><br><span class="line">total 0</span><br><span class="line">lrwx------ 1 root root 64 Oct 26 17:49 0 -&gt; /dev/pts/0</span><br><span class="line">lrwx------ 1 root root 64 Oct 26 17:49 1 -&gt; /dev/pts/0</span><br><span class="line">lrwx------ 1 root root 64 Oct 26 17:49 2 -&gt; /dev/pts/0</span><br><span class="line">lr-x------ 1 root root 64 Oct 26 17:49 3 -&gt; /proc/55244/fd</span><br></pre></td></tr></table></figure><h3 id="8-2-标准输出重定向"><a href="#8-2-标准输出重定向" class="headerlink" title="8.2 标准输出重定向"></a>8.2 标准输出重定向</h3><p>stdout和stderr可以被重定向到指定文件，而非默认的当前终端</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法</span></span><br><span class="line">命令 操作符号 文件名</span><br></pre></td></tr></table></figure><h4 id="8-2-1-输入输出重定向"><a href="#8-2-1-输入输出重定向" class="headerlink" title="8.2.1 输入输出重定向"></a>8.2.1 <strong>输入输出重定向</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">1&gt; </span><span class="language-bash">或 &gt;把标准输出重定向到文件</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">| 强制覆盖</span></span><br><span class="line"><span class="meta prompt_">2&gt;</span><span class="language-bash"> 把标准错误（也有可能是警告或提示信息）重定向到文件</span></span><br><span class="line">&amp;&gt; 把所有输出重定向到文件</span><br><span class="line"><span class="meta prompt_">2&gt;</span><span class="language-bash">&amp;1 把标准错误输出重定向为标准输出</span></span><br><span class="line"><span class="meta prompt_">1&gt;</span><span class="language-bash">&amp;2 将标准输出重定向为标准错误</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将标准输出和标准错误分别重定向到两个文件</span></span><br><span class="line">ls /xxx/ /root/ 1&gt; /data/log_1 2&gt; /data/log_2</span><br></pre></td></tr></table></figure><h4 id="8-2-2-追加"><a href="#8-2-2-追加" class="headerlink" title="8.2.2 追加"></a>8.2.2 <strong>追加</strong></h4><p>&gt;&gt; 可以在原有内容基础上，追加内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;追加标准输出重定向至文件</span></span><br><span class="line"><span class="meta prompt_">2&gt;</span><span class="language-bash">&gt;追加标准错误重定向至文件</span></span><br></pre></td></tr></table></figure><h4 id="8-3-3-合并标准输出和错误输出为同一个数据流进行重定向"><a href="#8-3-3-合并标准输出和错误输出为同一个数据流进行重定向" class="headerlink" title="8.3.3 合并标准输出和错误输出为同一个数据流进行重定向"></a>8.3.3 <strong>合并标准输出和错误输出为同一个数据流进行重定向</strong></h4><p>&amp;&gt;覆盖重定向</p><p>&amp;&gt;&gt;      追加重定向</p><p>COMMAND &gt; &#x2F;path&#x2F;to&#x2F;file.out 2&gt;&amp;1</p><p>COMMAND &gt;&gt; &#x2F;path&#x2F;to&#x2F;file.out 2&gt;&amp;1</p><h4 id="8-4-多个命令输出结果重定向到一个文件"><a href="#8-4-多个命令输出结果重定向到一个文件" class="headerlink" title="8.4.多个命令输出结果重定向到一个文件"></a>8.4.<strong>多个命令输出结果重定向到一个文件</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(echo 123;date) &gt;&gt; file.txt </span><br><span class="line">&#123; echo 123;date;&#125; &gt;&gt; file.txt </span><br></pre></td></tr></table></figure><h3 id="8-3-标准输入重定向"><a href="#8-3-标准输入重定向" class="headerlink" title="8.3 标准输入重定向"></a>8.3 标准输入重定向</h3><h4 id="8-3-1单行重定向"><a href="#8-3-1单行重定向" class="headerlink" title="8.3.1单行重定向"></a>8.3.1<strong>单行重定向</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将文件重定向给<span class="built_in">cat</span>,等价于命令<span class="built_in">cat</span> /etc/fstab</span> </span><br><span class="line">cat &lt; /etc/fstab</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">单行重定向</span></span><br><span class="line">cat &gt; cat.log</span><br><span class="line">hello! </span><br><span class="line"></span><br><span class="line">cat cat.log</span><br><span class="line">hello! </span><br></pre></td></tr></table></figure><h4 id="8-3-2-多行重定向"><a href="#8-3-2-多行重定向" class="headerlink" title="8.3.2 多行重定向"></a>8.3.2 <strong>多行重定向</strong></h4><p>多行重定向提示符变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky ~][0]# echo $PS2</span><br><span class="line"><span class="meta prompt_">&gt;</span></span><br></pre></td></tr></table></figure><p>使用”&lt;&lt;终止词”命令从键盘把多行重导向给STDIN，直到终止词位置之前的所有文本都发送给STDIN，有时被称为就地文本 (here documents)<br>其中终止词可以是任何一个或多个符号，比如: !，@，$，EOF (End of File)等，其中EOF比较常用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">多行重定向</span></span><br><span class="line">cat &gt; file.txt &lt;&lt;EOF</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">追加</span></span><br><span class="line">cat &gt;&gt; file.txt &lt;&lt;EOF</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">允许EOF使用tab键缩进</span></span><br><span class="line">cat &gt;&gt; file.txt &lt;&lt;-EOF</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="8-3-3-tee命令"><a href="#8-3-3-tee命令" class="headerlink" title="8.3.3 tee命令"></a>8.3.3 tee命令</h4><p>利用tee命令可以重定向到多个目标</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-a追加</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重定向到文件且终端输出</span></span><br><span class="line">echo &#x27;FKC&#x27; | tee /data/test.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">对标准输出多次处理</span></span><br><span class="line">echo &#x27;FKC&#x27; | tee /data/test.log | tr &#x27;A-Z&#x27; &#x27;a-z&#x27; &gt; /data/test2.log</span><br></pre></td></tr></table></figure><h1 id="9-用户、组管理"><a href="#9-用户、组管理" class="headerlink" title="9. 用户、组管理"></a>9. 用户、组管理</h1><h3 id="9-1-Linux安全模型"><a href="#9-1-Linux安全模型" class="headerlink" title="9.1 Linux安全模型"></a>9.1 Linux安全模型</h3><h4 id="9-1-1-用户"><a href="#9-1-1-用户" class="headerlink" title="9.1.1 用户"></a>9.1.1 用户</h4><p>Linux中每个用户是通过User ID（UID）来进行唯一标识</p><ul><li>管理员：root，0</li><li>普通用户：1-60000 自动分配</li></ul><p>​系统用户：1-499（Centos 6之前），1-999（Centos 7之后），对守护进程获取资源进行权限分配</p><p>​登录用户：500+（Centos 6之前），1000+（Centos 7之后），给用户使用</p><h4 id="9-1-2-用户组"><a href="#9-1-2-用户组" class="headerlink" title="9.1.2 用户组"></a>9.1.2 用户组</h4><p>Linux中可以将一个或多个用户加入用户组中，用户组是通过Group ID（GID）来唯一标识</p><ul><li>管理员组：root，0</li><li>普通组：</li></ul><p>​系统组：1-499（Centos 6之前），1-999（Centos 7之后），对守护进程获取资源进行权限分配</p><p>​普通组：500+（Centos 6之前），1000+（Centos 7之后），给用户使用</p><h4 id="9-1-3-用户和组的关系"><a href="#9-1-3-用户和组的关系" class="headerlink" title="9.1.3 用户和组的关系"></a>9.1.3 用户和组的关系</h4><ul><li>**用户的主要组：用户必须属于一个且只有一个主组，默认创建用户时会自动创建和用户名同名的组，作为用户的主要组，由于此组中只有一个用户，又称为私有组</li><li>**用户的附加组：一个用户可以属于零个或多个辅助组</li></ul><h4 id="9-1-4-安全上下文"><a href="#9-1-4-安全上下文" class="headerlink" title="9.1.4 安全上下文"></a>9.1.4 安全上下文</h4><p>Linux安全上下文Context: 运行中的程序，即进程process)，以进程发起者的身份运行，进程所能够访问资源的权限取决于进程的运行者的身份<br>比如：分别以root和wang 的身份运行&#x2F;bin&#x2F;cat &#x2F;etc&#x2F;shadow，得到的结果是不同的，资源能否能被访问，是由运行者的身份决定，非程序本身</p><h3 id="9-2-用户和组的配置文件"><a href="#9-2-用户和组的配置文件" class="headerlink" title="9.2 用户和组的配置文件"></a>9.2 用户和组的配置文件</h3><h4 id="9-2-1-etc-passwd"><a href="#9-2-1-etc-passwd" class="headerlink" title="9.2.1 &#x2F;etc&#x2F;passwd"></a>9.2.1 &#x2F;etc&#x2F;passwd</h4><p>用户及其属性信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看帮助man 5 passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">name:password:UID:GID:描述信息:家目录:shell</span><br></pre></td></tr></table></figure><h4 id="9-2-2-etc-shadow"><a href="#9-2-2-etc-shadow" class="headerlink" title="9.2.2 &#x2F;etc&#x2F;shadow"></a>9.2.2 &#x2F;etc&#x2F;shadow</h4><p>用户密码及相关属性</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">### 9.2.3 /etc/group</span></span></span><br><span class="line"></span><br><span class="line">组及其属性信息</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看帮助man 5 group</span></span><br><span class="line">root:x:0:</span><br><span class="line">name:group_passwd:GID:组成员</span><br></pre></td></tr></table></figure><h4 id="9-2-4-etc-gshadow"><a href="#9-2-4-etc-gshadow" class="headerlink" title="9.2.4 &#x2F;etc&#x2F;gshadow"></a>9.2.4 &#x2F;etc&#x2F;gshadow</h4><p>组密码及其相关属性</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root:::</span><br><span class="line">root::组的管理员:组成员</span><br></pre></td></tr></table></figure><h3 id="9-3-用户管理命令"><a href="#9-3-用户管理命令" class="headerlink" title="9.3 用户管理命令"></a>9.3 用户管理命令</h3><h4 id="9-3-1-文件检查"><a href="#9-3-1-文件检查" class="headerlink" title="9.3.1 文件检查"></a>9.3.1 文件检查</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vipw编辑 /etc/passwd 文件</span><br><span class="line">vigr用于编辑 /etc/group 文件</span><br><span class="line">pwck用于检查 /etc/passwd 文件的语法和完整性</span><br><span class="line">grock用于检查 /etc/group 文件的语法和完整性</span><br></pre></td></tr></table></figure><h4 id="9-3-2-创建用户"><a href="#9-3-2-创建用户" class="headerlink" title="9.3.2 创建用户"></a>9.3.2 创建用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">useradd </span><br><span class="line">-u指定UID</span><br><span class="line">-o配合-u选项,不检查UID的唯一性</span><br><span class="line">-g指定用户所属基本组,可为组名,也可以是GID</span><br><span class="line">-c用户描述信息描述信息</span><br><span class="line">-d指定用户家目录</span><br><span class="line">-s指定使用shell</span><br><span class="line">/sbin/nologin</span><br><span class="line">/usr/sbin/nologin（Ubuntu）</span><br><span class="line">/bin/false</span><br><span class="line">-G为用户指明附加组,组须事先存在</span><br><span class="line">-N不创建私用组作为主组,使用users组做主组</span><br><span class="line">-r创建的账户是系统账户</span><br><span class="line">-m创建家目录,用于系统用户</span><br><span class="line">-M不创建家目录,用于非系统用户</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">useradd -r -s /sbin/nologin -u 354 -c &quot;Nginx账户&quot; nginx </span><br></pre></td></tr></table></figure><h4 id="9-3-3-批量创建用户"><a href="#9-3-3-批量创建用户" class="headerlink" title="9.3.3 批量创建用户"></a>9.3.3 批量创建用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newusers passwd 格式文件</span><br></pre></td></tr></table></figure><h4 id="9-3-4-修改用户属性"><a href="#9-3-4-修改用户属性" class="headerlink" title="9.3.4 修改用户属性"></a>9.3.4 修改用户属性</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">usermod</span><br><span class="line">-u新的UID</span><br><span class="line">-g新的主组</span><br><span class="line">-G新附加的组,原来的组会被覆盖,若保留原有,则要同时使用-a选项</span><br><span class="line">-s新的shell类型</span><br><span class="line">-c新的注释信息</span><br><span class="line">-d新的家目录不会自动创建;若要创建新的目录并迁移原家目录,同时使用-m选项</span><br><span class="line">-l新的账户名</span><br><span class="line">-L在/etc/shadow密码栏增加!,即锁定账户</span><br><span class="line">-U将/etc/shadow密码栏!拿掉,即解锁账户</span><br><span class="line">-eYYYY-MM-DD指名用户账户过期日期</span><br><span class="line">-f设置账户宽限期</span><br></pre></td></tr></table></figure><h4 id="9-3-5-修改账户密码"><a href="#9-3-5-修改账户密码" class="headerlink" title="9.3.5 修改账户密码"></a>9.3.5 修改账户密码</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">passwd</span><br><span class="line">-d删除指定用户密码</span><br><span class="line">-l锁定用户</span><br><span class="line">-u解锁用户</span><br><span class="line">-e强制用户下次登录修改密码</span><br><span class="line">-f强制操作</span><br><span class="line">-n指定密码最短使用期限</span><br><span class="line">-x指定密码最大使用期限</span><br><span class="line">-w提前多少天开始警告</span><br><span class="line">-i宽限期</span><br><span class="line">-stdin 从标准输入接受用户密码</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">非交互式修改账户密码（Centos 和 Ubuntu）</span></span><br><span class="line">echo username:passwd | chpasswd</span><br><span class="line"></span><br><span class="line">vim passwd.txt</span><br><span class="line">zy:123</span><br><span class="line">cat passwd.txt | chpasswd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">非交互式修改账户密码（Centos）</span></span><br><span class="line">echo 123 | passwd --stdin root</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通用修改用户密码（Centos 和 Ubuntu）</span></span><br><span class="line">echo -e &#x27;123456\n123456&#x27; | passwd root</span><br></pre></td></tr></table></figure><h4 id="9-3-6-修改用户密码策略"><a href="#9-3-6-修改用户密码策略" class="headerlink" title="9.3.6 修改用户密码策略"></a>9.3.6 修改用户密码策略</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chage</span><br></pre></td></tr></table></figure><h4 id="9-3-7-默认账户创建规则"><a href="#9-3-7-默认账户创建规则" class="headerlink" title="9.3.7 默认账户创建规则"></a>9.3.7 默认账户创建规则</h4><p>账户创建默认规则由文件&#x2F;etc&#x2F;default&#x2F;useradd 指定</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9-node2 ~][1]# cat /etc/default/useradd</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">useradd defaults file</span></span><br><span class="line">GROUP=100组ID</span><br><span class="line">HOME=/home家目录</span><br><span class="line">INACTIVE=-1对应用户密码过期后的宽限期</span><br><span class="line">EXPIRE=用户账号有效期</span><br><span class="line">SHELL=/bin/bash默认shell类型</span><br><span class="line">SKEL=/etc/skel新建账号会从该目录获取默认文件列表</span><br><span class="line">CREATE_MAIL_SPOOL=yes默认是否启用邮箱</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例：还原用户家目录文件</span></span><br><span class="line">cp -r /etc/skel/. /home/username</span><br><span class="line">cp -r /etc/skel /home/username</span><br></pre></td></tr></table></figure><h4 id="9-3-8-默认账户口令策略"><a href="#9-3-8-默认账户口令策略" class="headerlink" title="9.3.8 默认账户口令策略"></a>9.3.8 默认账户口令策略</h4><p>账户口令策略默认规则由文件&#x2F;etc&#x2F;login.defs 定义</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9-node2 ~][148]# cat  /etc/login.defs | grep &#x27;^[^#]&#x27;</span><br><span class="line">MAIL_DIR/var/spool/mail</span><br><span class="line">UMASK022</span><br><span class="line">HOME_MODE0700</span><br><span class="line">PASS_MAX_DAYS99999</span><br><span class="line">PASS_MIN_DAYS0</span><br><span class="line">PASS_WARN_AGE7</span><br><span class="line">UID_MIN                  1000</span><br><span class="line">UID_MAX                 60000</span><br><span class="line">SYS_UID_MIN               201</span><br><span class="line">SYS_UID_MAX               999</span><br><span class="line">SUB_UID_MIN   100000</span><br><span class="line">SUB_UID_MAX600100000</span><br><span class="line">SUB_UID_COUNT    65536</span><br><span class="line">GID_MIN                  1000</span><br><span class="line">GID_MAX                 60000</span><br><span class="line">SYS_GID_MIN               201</span><br><span class="line">SYS_GID_MAX               999</span><br><span class="line">SUB_GID_MIN   100000</span><br><span class="line">SUB_GID_MAX600100000</span><br><span class="line">SUB_GID_COUNT    65536</span><br><span class="line">ENCRYPT_METHOD SHA512</span><br><span class="line">USERGROUPS_ENAB yes</span><br><span class="line">CREATE_HOMEyes</span><br><span class="line">HMAC_CRYPTO_ALGO SHA512</span><br></pre></td></tr></table></figure><h4 id="9-3-9-删除用户"><a href="#9-3-9-删除用户" class="headerlink" title="9.3.9 删除用户"></a>9.3.9 删除用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">userdel</span><br><span class="line">-f强制</span><br><span class="line">-r删除家目录和邮箱</span><br></pre></td></tr></table></figure><h4 id="9-3-10-查看用户相关的ID信息"><a href="#9-3-10-查看用户相关的ID信息" class="headerlink" title="9.3.10 查看用户相关的ID信息"></a>9.3.10 查看用户相关的ID信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">id</span><br><span class="line">-u显示UID</span><br><span class="line">-g显示GID</span><br><span class="line">-G显示用户所属组的ID</span><br><span class="line">-n显示名称,需配合ugG使用</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">[root@rocky9-node2 ~][1]# id -un</span><br><span class="line">root</span><br></pre></td></tr></table></figure><h4 id="9-3-11-切换用户"><a href="#9-3-11-切换用户" class="headerlink" title="9.3.11 切换用户"></a>9.3.11 切换用户</h4><p>su Username：非登录式切换，即不会读取目标用户的配置文件，不改变当前工作目录</p><p>su - Username：登录式切换，会读取目标用户配置文件，切换至家目录，完全切换</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su</span><br><span class="line">-l相当于su - Username</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以指定身份执行命令</span></span><br><span class="line">su - username -c &#x27;COMMAND&#x27;</span><br></pre></td></tr></table></figure><h4 id="9-3-12-用户其他相关指令"><a href="#9-3-12-用户其他相关指令" class="headerlink" title="9.3.12 用户其他相关指令"></a>9.3.12 用户其他相关指令</h4><h3 id="9-4-组管理命令"><a href="#9-4-组管理命令" class="headerlink" title="9.4 组管理命令"></a>9.4 组管理命令</h3><h4 id="9-4-1-创建组"><a href="#9-4-1-创建组" class="headerlink" title="9.4.1 创建组"></a>9.4.1 创建组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">groupadd [选项] 组名</span><br><span class="line">-g指定组的GID</span><br><span class="line">-f创建系统组,Centos 6之前：ID&lt;500,Cetnos 7以后:ID&lt;1000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">group add -g 48 -r nginx</span><br></pre></td></tr></table></figure><h4 id="9-4-2-修改组"><a href="#9-4-2-修改组" class="headerlink" title="9.4.2 修改组"></a>9.4.2 修改组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">groupmod [选项] 组名</span><br><span class="line">-n新名字</span><br><span class="line">-g新的GID</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改组名nginx为tomcat</span></span><br><span class="line">groupmod -n tomcat nginx</span><br></pre></td></tr></table></figure><h4 id="9-4-3-删除组"><a href="#9-4-3-删除组" class="headerlink" title="9.4.3 删除组"></a>9.4.3 删除组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">groupdel [选项] 组名</span><br><span class="line">-f强制删除,即使用户的主组也强制删除</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">groupdel tomcat</span><br></pre></td></tr></table></figure><h4 id="9-4-4-查看组信息"><a href="#9-4-4-查看组信息" class="headerlink" title="9.4.4 查看组信息"></a>9.4.4 查看组信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看用户属于那个组</span></span><br><span class="line">groups username</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看组里有那些用户</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="10-文件权限管理"><a href="#10-文件权限管理" class="headerlink" title="10. 文件权限管理"></a>10. 文件权限管理</h1><h3 id="10-1-修改文件所有者"><a href="#10-1-修改文件所有者" class="headerlink" title="10.1 修改文件所有者"></a>10.1 修改文件所有者</h3><p>chown命令可以修改文件的属主，也可以修改文件属组</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">chown [选项] 新所有者:新所属组 文件或目录</span><br><span class="line">-R递归修改文件夹下权限</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">只修改文件所有者</span></span><br><span class="line">chown nginx /etc/nginx.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">只修改文件所属组</span></span><br><span class="line">chown :nginx /etc/nginx.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改文件所有者和所属组</span></span><br><span class="line">chown nginx:nginx /etc/nginx.conf</span><br></pre></td></tr></table></figure><h3 id="10-2-修改文件所属组"><a href="#10-2-修改文件所属组" class="headerlink" title="10.2 修改文件所属组"></a>10.2 修改文件所属组</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chgrp [选项] 新组 文件或目录</span><br><span class="line">-R递归修改文件夹下权限</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">chgrp nginx /etc/nginx.conf</span><br></pre></td></tr></table></figure><h3 id="10-3-文件的权限说明"><a href="#10-3-文件的权限说明" class="headerlink" title="10.3 文件的权限说明"></a>10.3 文件的权限说明</h3><p>文件的权限主要针对三类对象进行定义</p><p>每个文件针对每类访问者都定义了三种权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">owner所属主，u</span><br><span class="line">group所属组，g</span><br><span class="line">other其他人，o</span><br></pre></td></tr></table></figure><p>每个文件对每类访问者都定义了三种常用权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">r可读</span><br><span class="line">w可写</span><br><span class="line">x执行</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">对于文件的权限</span></span><br><span class="line">r可使用文件查看工具获取其内容</span><br><span class="line">w可修改其内容</span><br><span class="line">x可以执行此文件,（此文件内容必须是可执行的）</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">对于目录的权限</span></span><br><span class="line">r可以使用ls查看此目录中文件列表</span><br><span class="line">w可在此目录中创建文件,也可以删除此目录中的文件,而和被删除文件的权限无关</span><br><span class="line">x可以使用ls -l查看此目录中文件元数据,必须配合r权限,可以cd进入此目录,属于目录可访问的最小权限</span><br><span class="line">X只给目录x权限,不给无执行权限的文件x权限</span><br></pre></td></tr></table></figure><h3 id="10-4-修改文件权限"><a href="#10-4-修改文件权限" class="headerlink" title="10.4 修改文件权限"></a>10.4 修改文件权限</h3><p>&#x3D;&#x3D;注：用户的最终权限是从左往右匹配，即，所有者，所属组，其他人，一旦匹配权限生效，不再往又查看其权限&#x3D;&#x3D;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">chmod [选项] 文件或目录</span><br><span class="line">-R递归修改权限</span><br><span class="line"></span><br><span class="line">修改某一类用户的所有权限</span><br><span class="line">u= g= o= ug= a= u= g=</span><br><span class="line"></span><br><span class="line">修改指定一类用户某个或某个权限</span><br><span class="line">u+ u- g+ g- o+ o- a+ a- + -</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">chmod u+rwx,g-r,o-rx /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">chmod g+rwx /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">chmod u=rw,g=r,o= /etc/my.cnf</span><br><span class="line">-rw-r-----. 1 root root 534 Jun 13 11:12 /etc/my.cnf</span><br></pre></td></tr></table></figure><p><strong>数字表示法</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r4</span><br><span class="line">w2</span><br><span class="line">x1</span><br></pre></td></tr></table></figure><h3 id="10-5-默认权限umask"><a href="#10-5-默认权限umask" class="headerlink" title="10.5 默认权限umask"></a>10.5 默认权限umask</h3><p>umask的值可以用来保留在创建文件权限</p><ul><li>新建文件的默认权限：666-umask，如果所得结果某位存在执行（奇数）权限，则将其权限+1，偶数不变</li><li>新建目录的默认权限：777-umask</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改<span class="built_in">umask</span>权限为777</span></span><br><span class="line">umask 777</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">永久修改<span class="built_in">umask</span>权限</span></span><br><span class="line">echo &#x27;umask 777&#x27; &gt;&gt; ~/.bashrc </span><br><span class="line">source ~/.bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一次性使用<span class="built_in">umask</span>权限,不影响当前环境</span></span><br><span class="line">( umansk 777;touch nginx.log )</span><br></pre></td></tr></table></figure><h3 id="10-6-文件的特殊权限"><a href="#10-6-文件的特殊权限" class="headerlink" title="10.6 文件的特殊权限"></a>10.6 文件的特殊权限</h3><h4 id="10-6-1-SUID"><a href="#10-6-1-SUID" class="headerlink" title="10.6.1 SUID"></a>10.6.1 SUID</h4><p>当 s 权限处于所有者位置时，代表任何用户都可以使用所有者权限来执行这个二进制文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加SUID权限</span></span><br><span class="line">chmod u+s /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清除SUID权限</span></span><br><span class="line">chmod u-s /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="10-6-2-SGID"><a href="#10-6-2-SGID" class="headerlink" title="10.6.2 SGID"></a>10.6.2 SGID</h4><p>当 s 权限处于所属组位置时，代表任何用户都可以使用所属组权限来执行这个二进制文件。</p><p>当 s 权限处于文件夹的所属组位置时，该文件夹下所有文件所属组会继承父文件夹所属组。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加SGID权限</span></span><br><span class="line">chmod g+s /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清除SGID权限</span></span><br><span class="line">chmod g-s /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="10-6-3-STICKY"><a href="#10-6-3-STICKY" class="headerlink" title="10.6.3 STICKY"></a>10.6.3 STICKY</h4><p>当其他人拥有 t 权限时，确保任何用户都可以在其中创建文件，但不能删除其他用户的文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加STICKY权限</span></span><br><span class="line">chmod +t /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清除STICKY权限</span></span><br><span class="line">chmod -t /etc/passwd</span><br></pre></td></tr></table></figure><h3 id="10-7-文件的隐藏权限"><a href="#10-7-文件的隐藏权限" class="headerlink" title="10.7 文件的隐藏权限"></a>10.7 文件的隐藏权限</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">chattr</span><br><span class="line">i禁止对文件进行修改、删除、重命名等操作。</span><br><span class="line">a只能向文件追加数据，不允许修改或删除文件内容。</span><br><span class="line">c用于启用文件系统的压缩功能。</span><br><span class="line">s删除文件时覆盖其内容，以确保无法恢复。</span><br><span class="line">u防止文件被删除。</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看文件隐藏权限</span></span><br><span class="line">lsattr /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">限制文件不允许删除</span></span><br><span class="line">chattr +i /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清除文件隐藏权限</span></span><br><span class="line">chattr -i /etc/my.cnf</span><br></pre></td></tr></table></figure><h3 id="10-8-访问控制列表ACL"><a href="#10-8-访问控制列表ACL" class="headerlink" title="10.8 访问控制列表ACL"></a>10.8 访问控制列表ACL</h3><p>ACL权限功能：实现灵活的权限管理，除了文件的所有者，所属组和其他人，可以对更多的用户设置权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加/清除ACL权限</span></span><br><span class="line">setfacl -m u:zhao:rwx /file/file.txt修改ACL用户权限</span><br><span class="line">setfacl -m g:zhao:rwx /file/file.txt修改ACL组权限</span><br><span class="line">setfacl -Rm u:zhao:rwx /1修递归修改ACL权限</span><br><span class="line">setfacl -Rb u:zhao:rwx /1递归删除所有用户和组ACL权限</span><br><span class="line">setfacl -x u:zhao /file/file.txt删除单个用户ACL权限</span><br><span class="line">setfacl -x g:zhao /file/file.txt 删除单个组的ACL权限</span><br><span class="line">setfacl -Rx u:zhao /file/      递归删除单个用户ACL权限</span><br><span class="line">setfacl -Rx g:zhao /file/ 递归删除单个组的ACL权限</span><br><span class="line">setfacl -b  /file/file.txt 清除所有用户和组的ACL权限</span><br><span class="line">setfacl -R -b /file/递归清除文件夹下所有文件用户和组的ACL权限</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看ACL权限</span></span><br><span class="line">getfacl /file/file.txt </span><br><span class="line">getfacl -R /file/file.txt 递归查看</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份ACL权限</span></span><br><span class="line">getfacl -R /file/file.txt  &gt; acl.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">还原备份的ACL权限</span></span><br><span class="line">setfacl -R --set-file=acl.txt /file/file.txt</span><br></pre></td></tr></table></figure><p>mask：确定在 ACL 中指定的用户、用户组权限和标准文件权限之间的最终权限。</p><p>mask：不影响当前文件所有者，和其他人的权限，但会影响通过 ACL 指定的用户或用户组的权限。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m mask::rwx /file/file.txt</span><br><span class="line">setfacl -m mask::rx /file/file.txt</span><br></pre></td></tr></table></figure><h1 id="11-vim编辑器"><a href="#11-vim编辑器" class="headerlink" title="11. vim编辑器"></a>11. vim编辑器</h1><h3 id="11-1-插入模式"><a href="#11-1-插入模式" class="headerlink" title="11.1 插入模式"></a>11.1 插入模式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">命令模式——&gt;插入模式</span><br><span class="line"></span><br><span class="line">i在光标所在处输入</span><br><span class="line">l在光标所在行的行首输入</span><br><span class="line">a在光标所在处后面输入</span><br><span class="line">A在当前光标所在行的行尾输入</span><br><span class="line">o在当前光标所在行的下方打开一个新行</span><br><span class="line">O在当前光标所在行的上方打开一个新行</span><br></pre></td></tr></table></figure><h3 id="11-2-扩展命令"><a href="#11-2-扩展命令" class="headerlink" title="11.2 扩展命令"></a>11.2 扩展命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">扩展命令模式基本命令</span><br><span class="line">w保存</span><br><span class="line">wq保存退出</span><br><span class="line">x写入并退出</span><br><span class="line">X加密</span><br><span class="line">q退出</span><br><span class="line">q!强制退出</span><br><span class="line">rfiename读文件内容到当前文件</span><br><span class="line">wfilename将当前文件写入另外一个文件</span><br><span class="line">!hostname执行命令</span><br><span class="line">r!hostname将命令输出写到当前文件</span><br><span class="line">set number显示行号</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">d清空文件</span></span><br></pre></td></tr></table></figure><h3 id="11-3-定制vim特性"><a href="#11-3-定制vim特性" class="headerlink" title="11.3 定制vim特性"></a>11.3 定制vim特性</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">配置文件：永久有效</span><br><span class="line">全局：/etc/vimrc</span><br><span class="line">个人：~/.vimrc</span><br><span class="line">显示行号：se nu</span><br><span class="line">取消行号：set nonu</span><br><span class="line"></span><br><span class="line">忽略字符大小写：set ic</span><br><span class="line">不忽略：set noic</span><br><span class="line"></span><br><span class="line">自动缩进：set ai</span><br><span class="line">禁用：set noai</span><br><span class="line"></span><br><span class="line">复制保留格式：set paste</span><br><span class="line">禁用：set nopaste</span><br><span class="line"></span><br><span class="line">显示tab和换行符^|和$显示：set list</span><br><span class="line">禁用：set nolist</span><br><span class="line"></span><br><span class="line">高亮搜索：set hlsearch</span><br><span class="line">禁用：set nohlsearch</span><br><span class="line"></span><br><span class="line">语法高亮：syntax on</span><br><span class="line">禁用：syntax off</span><br><span class="line"></span><br><span class="line">文本格式windows：set fileformat=dos</span><br><span class="line">启用unix格式：set fileformat=unix</span><br><span class="line">简写 set ff=dos|unix</span><br><span class="line"></span><br><span class="line">设置文本宽度</span><br><span class="line">set textwidth=65</span><br><span class="line">set wrapmargin=15</span><br><span class="line"></span><br><span class="line">设置光标标识线：set cul</span><br><span class="line">禁用：set nocursorline</span><br><span class="line"></span><br><span class="line">加密：set key=passwd</span><br><span class="line">禁用：set key=</span><br><span class="line"></span><br><span class="line">设置tab建字符数量：set tabstop=4</span><br><span class="line"></span><br><span class="line">帮助：set all</span><br></pre></td></tr></table></figure><h3 id="11-4-命令模式"><a href="#11-4-命令模式" class="headerlink" title="11.4 命令模式"></a>11.4 命令模式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ZZ保存退出</span><br><span class="line">ZQ不保存退出</span><br><span class="line">H光标出现在当前页面首行开头</span><br><span class="line">L光标出现在当前页面尾行开头</span><br><span class="line">M光标出现在当前页中间行开头</span><br><span class="line">zt将光标所在行前移到屏幕顶端</span><br><span class="line">zz将光标所在行移到屏幕中间</span><br><span class="line">zb将光标所在行移动到屏幕底端</span><br><span class="line">0数字0将光标移动到当前行首</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">将光标移动到当前行尾</span></span><br><span class="line">G移动到文本最后一行或者</span><br><span class="line">:10将光标移动到第10行</span><br><span class="line">100G移动到文本第100行</span><br><span class="line">R替换模式</span><br><span class="line">d0删除到行首</span><br><span class="line"><span class="meta prompt_">d$</span><span class="language-bash">删除到行尾</span></span><br><span class="line">D从光标删除到行尾</span><br><span class="line">3yy复制光标行到和后两行</span><br><span class="line">p粘贴</span><br><span class="line">u返回上一次操作</span><br><span class="line">V整行选中</span><br><span class="line">v光标选中</span><br></pre></td></tr></table></figure><h3 id="11-5-宏"><a href="#11-5-宏" class="headerlink" title="11.5 宏"></a>11.5 宏</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">qa录制宏，a为宏的名称</span><br><span class="line">q停止录制宏</span><br><span class="line">@a执行宏a</span><br><span class="line">@重新执行上次执行的宏</span><br></pre></td></tr></table></figure><h3 id="11-6-编辑二进制文件"><a href="#11-6-编辑二进制文件" class="headerlink" title="11.6 编辑二进制文件"></a>11.6 编辑二进制文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以二进制方式打开文件</span></span><br><span class="line">vim -b /bin/cat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">扩展命令模式下，利用xxd命令转换为可读的十六进制</span></span><br><span class="line">:%!xxd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换至插入模式下，编辑二进制文件</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换至扩展命令模式下，利用xxd命令转换回二进制</span></span><br><span class="line">:%!xxd -r</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">保存退出</span></span><br></pre></td></tr></table></figure><h3 id="11-7-GUI界面工具-gedit"><a href="#11-7-GUI界面工具-gedit" class="headerlink" title="11.7 GUI界面工具 gedit"></a>11.7 GUI界面工具 gedit</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gedit /etc/hosts</span><br></pre></td></tr></table></figure><h1 id="12-文本工具"><a href="#12-文本工具" class="headerlink" title="12. 文本工具"></a>12. 文本工具</h1><h3 id="12-1-cat-查看文件内容"><a href="#12-1-cat-查看文件内容" class="headerlink" title="12.1 cat 查看文件内容"></a>12.1 cat 查看文件内容</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat [选项] 文件</span><br><span class="line"></span><br><span class="line">-E显示行结束符</span><br><span class="line">-A显示所有控制符</span><br><span class="line">-n对每一行显示行号</span><br><span class="line">-b非空行才添加编号</span><br><span class="line">-s压缩连续的空行成一行</span><br><span class="line">nl</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例文件反显</span></span><br><span class="line">[root@rocky9 ~][1]# tac /etc/a.log </span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br></pre></td></tr></table></figure><h3 id="12-1-rev-字符翻转"><a href="#12-1-rev-字符翻转" class="headerlink" title="12.1 rev 字符翻转"></a>12.1 rev 字符翻转</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 ~][0]# echo &#x27;123&#x27; | rev</span><br><span class="line">321</span><br><span class="line">[root@rocky9-node2 ~][0]# rev /etc/a.log </span><br><span class="line">321</span><br><span class="line">cba</span><br></pre></td></tr></table></figure><h3 id="12-2-tr-字符替换"><a href="#12-2-tr-字符替换" class="headerlink" title="12.2 tr 字符替换"></a>12.2 tr 字符替换</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">-c取第一字符集的补集</span><br><span class="line">-d删除符合第一字符集的字符</span><br><span class="line">-s把连续重复的字符以单独一个字符表示,即去重</span><br><span class="line">-t将第一字符集对应字符转化为第二字符集对应的字符</span><br><span class="line"></span><br><span class="line">[:digit:]: 任意数字，相当于0-9</span><br><span class="line">[:1ower:]: 任意小写字母,表示 a-z</span><br><span class="line">[:upper:]: 任意大写字母,表示 A-Z</span><br><span class="line">[:alpha:]: 任意大小写字母</span><br><span class="line">[:alnum:]: 任意数字或字母</span><br><span class="line">[:blank:]: 水平空白字符</span><br><span class="line">[:space:]: 水平或垂直空白字符</span><br><span class="line">[:punct:]: 标点符号</span><br><span class="line">[:print:]: 可打印字符</span><br><span class="line">[:cntr1:]: 控制(非打印) 字符</span><br><span class="line">[:graph:]: 图形字符</span><br><span class="line">[:xdigit:]:十六进制字符</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将小写字母替换成大写字母</span></span><br><span class="line">echo abc | tr &#x27;[:lower:]&#x27; &#x27;[:upper:]&#x27;</span><br><span class="line">输出 ABC</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取补集,即取反,删除除了123的</span></span><br><span class="line">echo abc123 | tr -cd &#x27;123&#x27;</span><br><span class="line">输出 123</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除第一字符集匹配到的字符</span></span><br><span class="line">echo abc | tr -d &#x27;ac&#x27;</span><br><span class="line">输出 b</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将相邻的连续重复字符去重</span></span><br><span class="line">echo aaa | tr -s &#x27;a&#x27;</span><br><span class="line">输出 a</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取随机密码</span></span><br><span class="line">tr -dc a-zA-Z0-9 &lt; /dev/urandom | echo $(head -c 50)</span><br></pre></td></tr></table></figure><h3 id="12-3-查看非文本文件内容"><a href="#12-3-查看非文本文件内容" class="headerlink" title="12.3 查看非文本文件内容"></a>12.3 查看非文本文件内容</h3><h4 id="12-3-1-hexdump"><a href="#12-3-1-hexdump" class="headerlink" title="12.3.1 hexdump"></a>12.3.1 hexdump</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexdump-C -n 512 /dev/sda</span><br></pre></td></tr></table></figure><h4 id="12-3-2-od"><a href="#12-3-2-od" class="headerlink" title="12.3.2 od"></a>12.3.2 od</h4><h4 id="12-3-3-xxd"><a href="#12-3-3-xxd" class="headerlink" title="12.3.3 xxd"></a>12.3.3 xxd</h4><h3 id="12-4-more-分页查看文件内容"><a href="#12-4-more-分页查看文件内容" class="headerlink" title="12.4 more 分页查看文件内容"></a>12.4 more 分页查看文件内容</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more /var/log/secure</span><br></pre></td></tr></table></figure><h3 id="12-5-less-分页查看文件内容"><a href="#12-5-less-分页查看文件内容" class="headerlink" title="12.5 less 分页查看文件内容"></a>12.5 less 分页查看文件内容</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">less /var/log/secure</span><br><span class="line"></span><br><span class="line">空格键 滚动一页</span><br><span class="line">回车键 滚动一行</span><br><span class="line">b   向上翻一页</span><br><span class="line">d   向后翻半页</span><br><span class="line">/  向下搜索&quot;字符串&quot;的功能</span><br><span class="line">?         向上搜索&quot;字符串&quot;的功能</span><br><span class="line">n         重复前一个搜索（与 / 或 ? 有关）</span><br><span class="line">N         反向重复前一个搜索（与 / 或 ? 有关）</span><br></pre></td></tr></table></figure><h3 id="12-6-head显示文件头部行"><a href="#12-6-head显示文件头部行" class="headerlink" title="12.6 head显示文件头部行"></a>12.6 head显示文件头部行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">head [选项] 文件</span><br><span class="line"></span><br><span class="line">-c?  指定输出前?个字节</span><br><span class="line">-n?  指定输出前?行</span><br></pre></td></tr></table></figure><h3 id="12-7-tail-显示文件尾部行"><a href="#12-7-tail-显示文件尾部行" class="headerlink" title="12.7 tail 显示文件尾部行"></a>12.7 tail 显示文件尾部行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tail [选项] 文件</span><br><span class="line"></span><br><span class="line">-f追踪文件最新内容,追踪的是文件描述符</span><br><span class="line">-c?指定输出尾?个字节</span><br><span class="line">-n指定输出的行数</span><br><span class="line">-F追踪文件最新内容,追踪的是文件名</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">追踪最后输出的100行</span></span><br><span class="line">tail -n 100 -f /var/log/secure</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看最后10行</span></span><br><span class="line">tail /var/log/secure</span><br></pre></td></tr></table></figure><h3 id="12-8-cut-按列截取文本"><a href="#12-8-cut-按列截取文本" class="headerlink" title="12.8 cut 按列截取文本"></a>12.8 cut 按列截取文本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cut [选项] 文件</span><br><span class="line"></span><br><span class="line">-d指明分隔符,默认tab</span><br><span class="line">-f ?取第?个字段</span><br><span class="line">?,? 离散的多个字段,例如1,3,6</span><br><span class="line">?-?连续的多个字段,例如1-6</span><br><span class="line">1-3,7 混合使用</span><br><span class="line">-c按字符切割</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">[root@rocky9 ~][0]# cut -d: -f1-3 /etc/passwd</span><br><span class="line">root:x:0</span><br><span class="line">bin:x:1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">[root@rocky9 ~][0]# df -h | tr -s &#x27; &#x27; | cut -d &#x27; &#x27; -f5</span><br><span class="line"><span class="meta prompt_">Use%</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">0%</span></span><br><span class="line"><span class="meta prompt_">0%</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">1%</span></span><br><span class="line"><span class="meta prompt_">8%</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">7%</span></span><br><span class="line"><span class="meta prompt_">0%</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">0%</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">[root@rocky9 ~][127]# ifconfig eth0 | head -n 2 | tail -n 1 | tr -s &#x27; &#x27; | cut -d &#x27; &#x27; -f3</span><br><span class="line">172.31.206.2</span><br></pre></td></tr></table></figure><h3 id="12-9-paste-合并多个文件同行"><a href="#12-9-paste-合并多个文件同行" class="headerlink" title="12.9 paste 合并多个文件同行"></a>12.9 paste 合并多个文件同行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">paste [选项] 文件1 文件2</span><br><span class="line"></span><br><span class="line">-d指定分隔符</span><br><span class="line">-s相当于将一个文件追加到另一个文件后面</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky9 ~][0]# echo 123 &gt; 1.txt;echo 456 &gt; 2.txt;paste 1.txt 2.txt</span><br><span class="line">123456</span><br><span class="line"></span><br><span class="line">[root@rocky9 ~][0]# paste -s 1.txt 2.txt</span><br><span class="line">123</span><br><span class="line">456</span><br></pre></td></tr></table></figure><h3 id="12-10-wc-文本数据统计"><a href="#12-10-wc-文本数据统计" class="headerlink" title="12.10 wc 文本数据统计"></a>12.10 wc 文本数据统计</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wl [选项] 文件</span><br><span class="line"></span><br><span class="line">-l只统计行数</span><br><span class="line">-w只统计单词总数</span><br><span class="line">-c只统计字节总数</span><br><span class="line">-m只统计字符总数</span><br><span class="line">-L显示文件中最长行的长度</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">[root@rocky9 ~][0]# wc /etc/passwd</span><br><span class="line">30    68 1609  /etc/passwd</span><br><span class="line">行数  单词数  字节数</span><br></pre></td></tr></table></figure><h3 id="12-11-sort-排序"><a href="#12-11-sort-排序" class="headerlink" title="12.11 sort 排序"></a>12.11 sort 排序</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sort [选项] 文件</span><br><span class="line"></span><br><span class="line">-rn反向数字排序。（从大到小）</span><br><span class="line">-n按照数字顺序排序。（从小到大）</span><br><span class="line">-u去重，仅保留唯一行。</span><br><span class="line">-t指定字段分隔符。</span><br><span class="line">-k指定要排序的字段。</span><br><span class="line">-R随机排序</span><br><span class="line">-f忽略字符串中的字符大小写</span><br></pre></td></tr></table></figure><h3 id="12-12-uniq-去重"><a href="#12-12-uniq-去重" class="headerlink" title="12.12 uniq 去重"></a>12.12 uniq 去重</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">uniq [选项] 文件</span><br><span class="line"></span><br><span class="line">-c显示每行出现的次数。</span><br><span class="line">-d仅显示重复行。</span><br><span class="line">-u仅显示不重复的行。</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取文件共同的行（文件自身不能有重复的行）</span></span><br><span class="line">cat 1.txt 2.txt | sort | uniq -d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取文件不同的行</span></span><br><span class="line">cat 1.txt 2.txt | sort | uniq -u</span><br></pre></td></tr></table></figure><h3 id="12-13-diff-文件比较"><a href="#12-13-diff-文件比较" class="headerlink" title="12.13 diff 文件比较"></a>12.13 diff 文件比较</h3><p>diff命令可以比较两个文件之间的区别</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">### 12.14 patch 文件比较</span><br><span class="line"></span><br><span class="line">```shell</span><br></pre></td></tr></table></figure><h3 id="12-15-cmp-比较两个二进制文件的不同"><a href="#12-15-cmp-比较两个二进制文件的不同" class="headerlink" title="12.15 cmp 比较两个二进制文件的不同"></a>12.15 cmp 比较两个二进制文件的不同</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 ~][1]# cmp /bin/dir /bin/ls</span><br><span class="line">/bin/dir /bin/ls differ: byte 25, line 1</span><br></pre></td></tr></table></figure><h1 id="13-文本处理工具和正则表达式"><a href="#13-文本处理工具和正则表达式" class="headerlink" title="13. 文本处理工具和正则表达式"></a>13. 文本处理工具和正则表达式</h1><h3 id="13-1-基本正则表达式"><a href="#13-1-基本正则表达式" class="headerlink" title="13.1 基本正则表达式"></a>13.1 基本正则表达式</h3><h4 id="13-1-1-字符匹配"><a href="#13-1-1-字符匹配" class="headerlink" title="13.1.1 字符匹配"></a>13.1.1 字符匹配</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.匹配任意单个字符，可以是一个汉字</span><br><span class="line">[ ]匹配指定范围内的任意单个字符，示例：[0-9a-b@.]</span><br><span class="line">[^]匹配指定范围外的任意单个字符，示例：[^a]</span><br><span class="line">[:alnum:]表示字母和数字</span><br><span class="line">[:alpha:]代表任何英文大小写字符，相当于 A-Z， a-z</span><br><span class="line">[:lower:]小写字母，示例：[[:lower:]]，相当于[a-z]</span><br><span class="line">[:upper:]大写字母</span><br><span class="line">[:blank:]空白字符（空白和制表符）</span><br><span class="line">[:space:]水平和垂直的空白字符</span><br><span class="line">[:cntrl:]不可打印的控制字符（退格、删除、警铃...）</span><br><span class="line">[:digit:]十进制数字</span><br><span class="line">[:xdigit:]十六进制数字</span><br><span class="line">[:graph:]可打印的非空白字符</span><br><span class="line">[:print:]可打印的字符</span><br><span class="line">[:punct:]标点符号</span><br></pre></td></tr></table></figure><h4 id="13-1-2-匹配次数"><a href="#13-1-2-匹配次数" class="headerlink" title="13.1.2 匹配次数"></a>13.1.2 匹配次数</h4><p>用在要指定次数的字符后面，用于指定前面的字符要出现的次数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*匹配前面的字符任意次，包括0次，贪婪模式</span><br><span class="line">.*匹配任意长度任意字符</span><br><span class="line">\?匹配其前面的字符0或1次，即可有可无</span><br><span class="line">\+匹配其前面的字符至少1次，即 ≥1次</span><br><span class="line">\&#123;n\&#125;匹配前面的字符n次</span><br><span class="line">\&#123;m,n\&#125;匹配前面字符至少m次，最多n次</span><br><span class="line">\&#123;,n\&#125;匹配前面字符最多n次</span><br><span class="line">\&#123;n,\&#125;匹配前面的字符至少n次</span><br></pre></td></tr></table></figure><h4 id="13-1-3-位置锚定"><a href="#13-1-3-位置锚定" class="headerlink" title="13.1.3 位置锚定"></a>13.1.3 位置锚定</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">^行首锚定，用于模式的最左侧</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">行尾锚定，用于模式的最右侧</span></span><br><span class="line">^PATTERN$用于模式匹配整行</span><br><span class="line">^$空行</span><br><span class="line">^[[:space:]]*$空白行</span><br><span class="line">\&lt; 或者 \b   词首锚定，用于单词模式的左侧</span><br><span class="line">\&gt; 或者 \b   词尾锚定，用于单词模式的右侧</span><br><span class="line">\&lt;PATTERN\&gt;匹配整个单词</span><br></pre></td></tr></table></figure><h4 id="13-1-4-分组"><a href="#13-1-4-分组" class="headerlink" title="13.1.4 分组"></a>13.1.4 分组</h4><p>使用(    )将多个字符捆绑在一起当作一个整体来处理</p><p>分组括号中的模式匹配到的内容会被正则表达式引擎记录于内部变量中，这些变量的命名方式为：\1，\2，\3 ….</p><p>\1 表示从左侧的第一个左括号以及与之匹配的右括号之间模式所匹配到的所有字符</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">### 13.1.5 或者</span></span></span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">a\|ba或者b</span><br><span class="line">c\|catc或者cat</span><br><span class="line">\(C\|c\)atCat或者cat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">排除空行和#号开头的行</span></span><br><span class="line">grep -Ev &#x27;^#|^$&#x27; /etc/fstab</span><br><span class="line">grep &#x27;^[^#]&#x27; /etc/fstab</span><br></pre></td></tr></table></figure><h3 id="13-2-扩展正则表达式"><a href="#13-2-扩展正则表达式" class="headerlink" title="13.2 扩展正则表达式"></a>13.2 扩展正则表达式</h3><h4 id="13-2-1-字符匹配"><a href="#13-2-1-字符匹配" class="headerlink" title="13.2.1 字符匹配"></a>13.2.1 字符匹配</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.匹配任意单个字符，可以是一个汉字</span><br><span class="line">[ ]匹配指定范围内的任意单个字符，示例：[0-9a-b@.]</span><br><span class="line">[^]匹配指定范围外的任意单个字符，示例：[^a]</span><br><span class="line">[:alnum:]表示字母和数字</span><br><span class="line">[:alpha:]代表任何英文大小写字符，相当于 A-Z， a-z</span><br><span class="line">[:lower:]小写字母，示例：[[:lower:]]，相当于[a-z]</span><br><span class="line">[:upper:]大写字母</span><br><span class="line">[:blank:]空白字符（空白和制表符）</span><br><span class="line">[:space:]水平和垂直的空白字符</span><br><span class="line">[:cntrl:]不可打印的控制字符（退格、删除、警铃...）</span><br><span class="line">[:digit:]十进制数字</span><br><span class="line">[:xdigit:]十六进制数字</span><br><span class="line">[:graph:]可打印的非空白字符</span><br><span class="line">[:print:]可打印的字符</span><br><span class="line">[:punct:]标点符号</span><br></pre></td></tr></table></figure><h4 id="13-2-2-匹配次数"><a href="#13-2-2-匹配次数" class="headerlink" title="13.2.2 匹配次数"></a>13.2.2 匹配次数</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*匹配前面字符任意次</span><br><span class="line">?0或1次</span><br><span class="line">+1次或多次</span><br><span class="line">&#123;n&#125;匹配n次</span><br><span class="line">&#123;m,n&#125;至少m，至多n次</span><br></pre></td></tr></table></figure><h4 id="13-2-3-位置锚定"><a href="#13-2-3-位置锚定" class="headerlink" title="13.2.3 位置锚定"></a>13.2.3 位置锚定</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">^ 行首</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"> 行尾</span></span><br><span class="line">\&lt;,\b 语首</span><br><span class="line">\&gt;,\b 语尾</span><br></pre></td></tr></table></figure><h4 id="13-2-4-分组"><a href="#13-2-4-分组" class="headerlink" title="13.2.4 分组"></a>13.2.4 分组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">( )分组</span><br><span class="line">后向引用：\1，\2，...</span><br></pre></td></tr></table></figure><h4 id="13-2-5-或者"><a href="#13-2-5-或者" class="headerlink" title="13.2.5 或者"></a>13.2.5 或者</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> |   或者</span><br><span class="line">a|ba或b</span><br><span class="line">C|catC或cat</span><br><span class="line">(C|c)catCat或cat</span><br></pre></td></tr></table></figure><h3 id="13-2-检验数字的表达式"><a href="#13-2-检验数字的表达式" class="headerlink" title="13.2 检验数字的表达式"></a>13.2 检验数字的表达式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1. 数字：^[0-9]*$</span><br><span class="line">2. n位的数字：^\d&#123;n&#125;$</span><br><span class="line">3. 至少n位的数字：^\d&#123;n,&#125;$</span><br><span class="line">4. m-n位的数字：^\d&#123;m,n&#125;$</span><br><span class="line">5. 零和非零开头的数字：^(0|[1-9][0-9]*)$</span><br><span class="line">6. 非零开头的最多带两位小数的数字：^([1-9][0-9]*)+(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line">7. 带1-2位小数的正数或负数：^(\-)?\d+(\.\d&#123;1,2&#125;)?$</span><br><span class="line">8. 正数、负数、和小数：^(\-|\+)?\d+(\.\d+)?$</span><br><span class="line">9. 有两位小数的正实数：^[0-9]+(.[0-9]&#123;2&#125;)?$</span><br><span class="line">10. 有1~3位小数的正实数：^[0-9]+(.[0-9]&#123;1,3&#125;)?$</span><br><span class="line">11. 非零的正整数：^[1-9]\d*$ 或 ^([1-9][0-9]*)&#123;1,3&#125;$ 或 ^\+?[1-9][0-9]*$</span><br><span class="line">12. 非零的负整数：^\-[1-9][]0-9&quot;*$ 或 ^-[1-9]\d*$</span><br><span class="line">13. 非负整数：^\d+$ 或 ^[1-9]\d*|0$</span><br><span class="line">14. 非正整数：^-[1-9]\d*|0$ 或 ^((-\d+)|(0+))$</span><br><span class="line">15. 非负浮点数：^\d+(\.\d+)?$ 或 ^[1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0$</span><br><span class="line">16. 非正浮点数：^((-\d+(\.\d+)?)|(0+(\.0+)?))$ 或 ^(-([1-9]\d*\.\d*|0\.\d*[1-9]\d*))|0?\.0+|0$</span><br><span class="line">17. 正浮点数：^[1-9]\d*\.\d*|0\.\d*[1-9]\d*$ 或 ^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$</span><br><span class="line">18. 负浮点数：^-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$ 或 ^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$</span><br><span class="line">19. 浮点数：^(-?\d+)(\.\d+)?$ 或 ^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$</span><br></pre></td></tr></table></figure><h3 id="13-3-检验字符的表达式"><a href="#13-3-检验字符的表达式" class="headerlink" title="13.3 检验字符的表达式"></a>13.3 检验字符的表达式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. 汉字：^[\u4e00-\u9fa5]&#123;0,&#125;$</span><br><span class="line">2. 英文和数字：^[A-Za-z0-9]+$ 或 ^[A-Za-z0-9]&#123;4,40&#125;$</span><br><span class="line">3. 长度为3-20的所有字符：^.&#123;3,20&#125;$</span><br><span class="line">4. 由26个英文字母组成的字符串：^[A-Za-z]+$</span><br><span class="line">5. 由26个大写英文字母组成的字符串：^[A-Z]+$</span><br><span class="line">6. 由26个小写英文字母组成的字符串：^[a-z]+$</span><br><span class="line">7. 由数字和26个英文字母组成的字符串：^[A-Za-z0-9]+$</span><br><span class="line">8. 由数字、26个英文字母或者下划线组成的字符串：^\w+$ 或 ^\w&#123;3,20&#125;$</span><br><span class="line">9. 中文、英文、数字包括下划线：^[\u4E00-\u9FA5A-Za-z0-9_]+$</span><br><span class="line">10. 中文、英文、数字但不包括下划线等符号：^[\u4E00-\u9FA5A-Za-z0-9]+$ 或 ^[\u4E00-\u9FA5A-Za-z0-9]&#123;2,20&#125;$</span><br><span class="line">11. 可以输入含有^%&amp;&#x27;,;=?$\&quot;等字符：[^%&amp;&#x27;,;=?$\x22]+ 12 禁止输入含有~的字符：[^~\x22]+</span><br></pre></td></tr></table></figure><h3 id="13-4-特殊需求表达式"><a href="#13-4-特殊需求表达式" class="headerlink" title="13.4 特殊需求表达式"></a>13.4 特殊需求表达式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1. Email地址：^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$</span><br><span class="line">2. 域名：[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;(/.[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;)+/.?</span><br><span class="line">3. InternetURL：[a-zA-z]+://[^\s]* 或 ^http://([\w-]+\.)+[\w-]+(/[\w-./?%&amp;=]*)?$</span><br><span class="line">4. 手机号码：^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d&#123;8&#125;$</span><br><span class="line">5. 电话号码(&quot;XXX-XXXXXXX&quot;、&quot;XXXX-XXXXXXXX&quot;、&quot;XXX-XXXXXXX&quot;、&quot;XXX-XXXXXXXX&quot;、&quot;XXXXXXX&quot;和&quot;XXXXXXXX)：^(\(\d&#123;3,4&#125;-)|\d&#123;3.4&#125;-)?\d&#123;7,8&#125;$</span><br><span class="line">6. 国内电话号码(0511-4405222、021-87888822)：\d&#123;3&#125;-\d&#123;8&#125;|\d&#123;4&#125;-\d&#123;7&#125;</span><br><span class="line">7. 身份证号(15位、18位数字)：^\d&#123;15&#125;|\d&#123;18&#125;$</span><br><span class="line">8. 短身份证号码(数字、字母x结尾)：^([0-9])&#123;7,18&#125;(x|X)?$ 或 ^\d&#123;8,18&#125;|[0-9x]&#123;8,18&#125;|[0-9X]&#123;8,18&#125;?$</span><br><span class="line">9. 帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)：^[a-zA-Z][a-zA-Z0-9_]&#123;4,15&#125;$</span><br><span class="line">10. 密码(以字母开头，长度在6~18之间，只能包含字母、数字和下划线)：^[a-zA-Z]\w&#123;5,17&#125;$</span><br><span class="line">11. 强密码(必须包含大小写字母和数字的组合，不能使用特殊字符，长度在8-10之间)：^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).&#123;8,10&#125;$</span><br><span class="line">12. 日期格式：^\d&#123;4&#125;-\d&#123;1,2&#125;-\d&#123;1,2&#125;</span><br><span class="line">13. 一年的12个月(01～09和1～12)：^(0?[1-9]|1[0-2])$</span><br><span class="line">14. 一个月的31天(01～09和1～31)：^((0?[1-9])|((1|2)[0-9])|30|31)$</span><br><span class="line">15. 钱的输入格式：</span><br><span class="line">16. 1.有四种钱的表示形式我们可以接受:&quot;10000.00&quot; 和 &quot;10,000.00&quot;, 和没有 &quot;分&quot; 的 &quot;10000&quot; 和 &quot;10,000&quot;：^[1-9][0-9]*$</span><br><span class="line">17. 2.这表示任意一个不以0开头的数字,但是,这也意味着一个字符&quot;0&quot;不通过,所以我们采用下面的形式：^(0|[1-9][0-9]*)$</span><br><span class="line">18. 3.一个0或者一个不以0开头的数字.我们还可以允许开头有一个负号：^(0|-?[1-9][0-9]*)$</span><br><span class="line">19. 4.这表示一个0或者一个可能为负的开头不为0的数字.让用户以0开头好了.把负号的也去掉,因为钱总不能是负的吧.下面我们要加的是说明可能的小数部分：^[0-9]+(.[0-9]+)?$</span><br><span class="line">20. 5.必须说明的是,小数点后面至少应该有1位数,所以&quot;10.&quot;是不通过的,但是 &quot;10&quot; 和 &quot;10.2&quot; 是通过的：^[0-9]+(.[0-9]&#123;2&#125;)?$</span><br><span class="line">21. 6.这样我们规定小数点后面必须有两位,如果你认为太苛刻了,可以这样：^[0-9]+(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line">22. 7.这样就允许用户只写一位小数.下面我们该考虑数字中的逗号了,我们可以这样：^[0-9]&#123;1,3&#125;(,[0-9]&#123;3&#125;)*(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line">23 8.1到3个数字,后面跟着任意个 逗号+3个数字,逗号成为可选,而不是必须：^([0-9]+|[0-9]&#123;1,3&#125;(,[0-9]&#123;3&#125;)*)(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line">24. 备注：这就是最终结果了,别忘了&quot;+&quot;可以用&quot;*&quot;替代如果你觉得空字符串也可以接受的话(奇怪,为什么?)最后,别忘了在用函数时去掉去掉那个反斜杠,一般的错误都在这里</span><br><span class="line">25. xml文件：^([a-zA-Z]+-?)+[a-zA-Z0-9]+\\.[x|X][m|M][l|L]$</span><br><span class="line">26. 中文字符的正则表达式：[\u4e00-\u9fa5]</span><br><span class="line">27. 双字节字符：[^\x00-\xff] (包括汉字在内，可以用来计算字符串的长度(一个双字节字符长度计2，ASCII字符计1))</span><br><span class="line">28. 空格的正则表达式：\s*(可以用来删除空格)</span><br><span class="line">29. HTML标记的正则表达式：&lt;(\S*?)[^&gt;]*&gt;.*?&lt;/\1&gt;|&lt;.*? /&gt; (网上流传的版本太糟糕，上面这个也仅仅能部分，对于复杂的嵌套标记依旧无能为力)</span><br><span class="line"></span><br><span class="line">30. 首尾空白字符的正则表达式：^\s*|\s*$或(^\s*)|(\s*$) (可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式)</span><br><span class="line"></span><br><span class="line">31. 腾讯QQ号：[1-9][0-9]&#123;4,&#125; (腾讯QQ号从10000开始)</span><br><span class="line">32. 中国邮政编码：[1-9]\d&#123;5&#125;(?!\d) (中国邮政编码为6位数字)</span><br><span class="line">33. IP地址：\d+\.\d+\.\d+\.\d+ (提取IP地址时有用)</span><br><span class="line">34. IP地址：((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.)&#123;3&#125;(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))</span><br></pre></td></tr></table></figure><h3 id="13-2-grep"><a href="#13-2-grep" class="headerlink" title="13.2 grep"></a>13.2 grep</h3><p>全局的搜索正则表达式并打印出行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">grep [选项] PATTERN [文件]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">常见选项</span></span><br><span class="line">--color=auto对匹配到的文本进行着色显示</span><br><span class="line">-m?匹配到?行后停止</span><br><span class="line">-v对不匹配的进行显示</span><br><span class="line">-i忽略大小写</span><br><span class="line">-n显示匹配行的行号</span><br><span class="line">-c统计匹配次数</span><br><span class="line">-o仅显示匹配的字符</span><br><span class="line">-q静默模式，不输出任何信息</span><br><span class="line">-A?显示匹配行和匹配行后?行</span><br><span class="line">-B?显示匹配行和匹配行前?行</span><br><span class="line">-C?显示匹配行和匹配行前后?行</span><br><span class="line">-e或，匹配模式1或者模式2</span><br><span class="line">-w匹配整个单词,除了字母,下划线均可以作为分隔符</span><br><span class="line">-E使用扩展正则表达式</span><br><span class="line">-F不使用正则表达式</span><br><span class="line">-f使用文件内容做为模式,效果和-e类似</span><br><span class="line">-r递归目录，但是不处理软链接</span><br><span class="line">-R递归目录，但处理软连接</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匹配?行后停止匹配</span></span><br><span class="line">grep -m 1 root /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示行号</span></span><br><span class="line">grep -n  root /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">统计匹配到的行数</span></span><br><span class="line">grep -c  root /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">只显示匹配到的字符串自身</span></span><br><span class="line">grep -o root /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">静默模式,找到或者找不到都不输出</span></span><br><span class="line">grep -q root /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匹配多个条件,或模式</span></span><br><span class="line">grep -e root -e bash /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">只匹配整个单词,而不是字符</span></span><br><span class="line">grep -w /sbin/nologin /etc/passwd\</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取IP地址</span></span><br><span class="line">ip addr show dev eth0 | grep -Eo &#x27;([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;&#x27; | head -n 1</span><br></pre></td></tr></table></figure><h3 id="13-3-sed"><a href="#13-3-sed" class="headerlink" title="13.3 sed"></a>13.3 sed</h3><p>Sed是从文件或管道中读取一行，处理一行，输出一行；再读取一行，再处理一行，再输出一行，直到最后一行。每当处理一行时，把当前处理的行存储在临时缓冲区中，称为模式空间 (Pattern Space)，接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。一次处理一行的设计模式使得sed性能很高，sed在读取大文件时不会出现卡顿的现象。如果使用vi命令打开几十M上百M的文件，明显会出现有卡顿的现象，这是因为vi命令打开文件是一次性将文件加载到内存，然后再打开。Sed就避免了这种情况，一行一行的处理，打开速度非常快，执行速度也很快。</p><h4 id="13-3-1-sed-指令选项"><a href="#13-3-1-sed-指令选项" class="headerlink" title="13.3.1 sed 指令选项"></a>13.3.1 sed 指令选项</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sed [选项] &#x27;地址...&#x27; 文件</span><br><span class="line"></span><br><span class="line">-n不输出模式空间内容到屏幕,即关闭自动打印</span><br><span class="line">-e多点编辑</span><br><span class="line">-f/PATH/SCRIPT_FILE从指定文件中读取编辑脚本</span><br><span class="line">-E  使用扩展正则表达式</span><br><span class="line">-r 使用扩展正则表达式</span><br><span class="line">-i.bak修改文件,并备份一个bak文件</span><br><span class="line">-p打印当前模式空间内容，追加到默认输出之后</span><br><span class="line">-d删除模式空间匹配的行，并立即开启下一轮循环        </span><br><span class="line">-Ip忽略大小写输出</span><br><span class="line">a在指定行后面追加文本，支持使用\n实现多行追加</span><br><span class="line">i在行前面插入文本</span><br><span class="line">c替换行为单行或多行文本</span><br><span class="line">w /path/file保存模式匹配的行至指定文件</span><br><span class="line">r /path/file读取指定文件中的文本至模式空间中匹配到的行后</span><br><span class="line">=为模式空间中的行打印行号</span><br><span class="line">!模式空间中匹配取反处理</span><br><span class="line"></span><br><span class="line">s/pattern/string/ 查找替换，支持使用其他分隔符，可以是其他形式：s###，s@@@</span><br><span class="line">替换修饰符号</span><br><span class="line">g全局替换</span><br><span class="line">p显示替换成功的行</span><br><span class="line">w /PATH/FILE将替换成功的行保存至文件中</span><br><span class="line">i忽略大小写</span><br></pre></td></tr></table></figure><h4 id="13-3-2-sed-地址格式"><a href="#13-3-2-sed-地址格式" class="headerlink" title="13.3.2 sed 地址格式"></a>13.3.2 sed 地址格式</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">?指定的行号，$表示最后一行</span><br><span class="line">/pat/被此处所正则比表达式能够匹配到的每一行</span><br><span class="line"></span><br><span class="line">?,?从?行到第?行</span><br><span class="line">?,+?从?行到+?行</span><br><span class="line">/pat1/,/pat2/</span><br><span class="line">?,/pat/</span><br><span class="line"></span><br><span class="line">1~2 奇数行</span><br><span class="line">2~2 偶数行</span><br></pre></td></tr></table></figure><h4 id="13-3-3-sed-打印行"><a href="#13-3-3-sed-打印行" class="headerlink" title="13.3.3 sed 打印行"></a>13.3.3 sed 打印行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印第2行</span></span><br><span class="line">sed -n &#x27;2p&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印第2行和第6行</span></span><br><span class="line">sed -n -e &#x27;2p&#x27; -e &#x27;6p&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印第2行到第6行</span></span><br><span class="line">sed -n &#x27;2,6p&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印模式匹配到的行,忽略大小写</span></span><br><span class="line">sed -n &#x27;/^P.*D$/Ip&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="13-3-4-sed-删除行"><a href="#13-3-4-sed-删除行" class="headerlink" title="13.3.4 sed 删除行"></a>13.3.4 sed 删除行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清空文件</span></span><br><span class="line">sed -i &#x27;d&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除第2行</span></span><br><span class="line">sed -i &#x27;2d&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除包含root的行</span></span><br><span class="line">sed -i &#x27;/root/d&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除不包含root的行</span></span><br><span class="line">sed -i &#x27;/root/!d&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除被模式匹配到的行</span></span><br><span class="line">sed -Ei &#x27;/^root.*bash$/d&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除奇数行</span></span><br><span class="line">sed -i &#x27;1~2d&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除偶数行</span></span><br><span class="line">sed -i &#x27;2~2d&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除第1行到往后的3行,即删除前4行</span></span><br><span class="line">sed -i &#x27;1,+3d&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="13-3-5-sed-添加行"><a href="#13-3-5-sed-添加行" class="headerlink" title="13.3.5 sed 添加行"></a>13.3.5 sed 添加行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在第二行后面追加PASSWD</span></span><br><span class="line">sed -i &#x27;2aPASSWD&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在第二行前面追加PASSWD</span></span><br><span class="line">sed -i &#x27;2iPASSWD&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在第二行前面追加多行</span></span><br><span class="line">sed -i &#x27;2iPASSWD\nPASSWD&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在第二行前面追加多行并填充空格,第一行的空格需要用\专转义</span></span><br><span class="line">sed -i &#x27;2i\   PASSWD\n   PASSWD&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在被模式匹配到的行后面追加passwd</span></span><br><span class="line">sed -i &#x27;/^PASSWD$/ipasswd&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="13-3-6-sed-替换行"><a href="#13-3-6-sed-替换行" class="headerlink" title="13.3.6 sed 替换行"></a>13.3.6 sed 替换行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">替换第2行</span></span><br><span class="line">sed -i &#x27;2s|.*|PASSWD|&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">替换第2行</span></span><br><span class="line">sed -i &#x27;2cPASSWD&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">替换指定的行</span></span><br><span class="line">sed -i &#x27;s|PASSWD|passwd|&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">替换被匹配到的行</span></span><br><span class="line">sed -i &#x27;s|^P.*D$|passwd|&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="13-3-7-sed-额外案例"><a href="#13-3-7-sed-额外案例" class="headerlink" title="13.3.7 sed 额外案例"></a>13.3.7 sed 额外案例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取IP</span></span><br><span class="line">ifconfig ens33 | sed -nr &quot;2s|[^0-9]+([0-9.]+).*|\1|p&quot;</span><br><span class="line">ifconfig ens33 | sed -nr &quot;2s|^[^0-9]+([0-9.]+).*$|\1|p&quot;</span><br><span class="line">ifconfig ens33 | sed -nr -e &#x27;2s|^.*inet ||p&#x27; | sed -n &#x27;s| netmask.*||p&#x27;</span><br><span class="line">ifconfig ens33 | sed -nr -e &#x27;2s|^.*inet ||;s| netmask.*||p&#x27;</span><br><span class="line">ifconfig ens33 | sed -rn &#x27;2s|(.*inet )([0-9].*)( netmask.*)|\2|p&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取基名</span></span><br><span class="line">echo &#x27;/etc/sysconfig/network-scripts&#x27; | sed -rn &#x27;s|(.*)/([^/]+)/?|\2|p&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取目录名</span></span><br><span class="line">echo &#x27;/etc/sysconfig/network-scripts&#x27; | sed -rn &#x27;s|(.*)/([^/]+)/?|\1|p&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匹配的行开头增加#号</span></span><br><span class="line">sed -E  &#x27;/^UUID/s/(UUID.*$)/#\1/&#x27; /etc/fstab</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匹配的行结尾增加#号</span></span><br><span class="line">sed -E  &#x27;/^UUID/s/(UUID.*$)/\1#/&#x27; /etc/fstab</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匹配的行中间加#</span></span><br><span class="line">sed -E  &#x27;/default/s/(default)/#\1/&#x27; etc/fstab</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">行尾追加参数</span></span><br><span class="line">sed -Ei.bak &#x27;/^GRUB_CMDLINE_LINUX/s/(GRUB.*)&quot;/\1 net.ifnames=0 biosdevname=0&quot;/&#x27; /etc/default/grub</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sed引用变量,使用双引号</span></span><br><span class="line">NAME=root ; sed -i &quot;s|$NAME|123|g&quot; /etc/passwd </span><br></pre></td></tr></table></figure><h4 id="13-3-8-sed-高级用法"><a href="#13-3-8-sed-高级用法" class="headerlink" title="13.3.8 sed 高级用法"></a>13.3.8 sed 高级用法</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">P打印模式空间开端至\n内容，并追加到默认输出之前</span><br><span class="line">h把模式空间中的内容覆盖至保持空间中</span><br><span class="line">H把模式空间中的内容追加至保持空间中</span><br><span class="line">g从保持空间取出数据覆盖至模式空间</span><br><span class="line">G从保持空间取出内容追加至模式空间</span><br><span class="line">x把模式空间中的内容与保持空间中的内容进行互换</span><br><span class="line">n读取匹配到的行的下一行覆盖至模式空间</span><br><span class="line">N读取匹配到的行的下一行追加至模式空间</span><br><span class="line">d删除模式空间中行</span><br><span class="line">D如果模式空间包含换行符，则删除直到第一个换行符的模式空间中的文本，并不会读取新的输入行</span><br><span class="line">    而使用合成的模式空间重新启动循环。如果模式空间不包含换行符，则会像发出d命令那样启动正常的新循环</span><br></pre></td></tr></table></figure><h3 id="13-4-awk"><a href="#13-4-awk" class="headerlink" title="13.4 awk"></a>13.4 awk</h3><h4 id="13-4-1-awk-工作原理"><a href="#13-4-1-awk-工作原理" class="headerlink" title="13.4.1 awk 工作原理"></a>13.4.1 awk 工作原理</h4><ul><li>处理BEGIN动作</li><li>逐行处理</li><li>处理END动作</li></ul><h4 id="13-4-2-动作-print"><a href="#13-4-2-动作-print" class="headerlink" title="13.4.2 动作 print"></a>13.4.2 动作 print</h4><ul><li>逗号将使用一个空格表示</li><li>如果没有打印内容，相当于 print $0</li><li>固定字符串需要使用双引号引起来，而变量和数字不需要</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">接受标准输入1打印“hello awk”</span></span><br><span class="line">[root@centos ~][0]$ awk &#x27;&#123;print &quot;hello awk&quot;&#125;&#x27;</span><br><span class="line">1</span><br><span class="line">hello awk</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印指定次数</span></span><br><span class="line">[root@centos ~][0]$ seq 2 | awk &#x27;&#123;print &quot;hello awk&quot;&#125;&#x27;</span><br><span class="line">hello awk</span><br><span class="line">hello awk</span><br></pre></td></tr></table></figure><h4 id="13-4-3-awk-变量"><a href="#13-4-3-awk-变量" class="headerlink" title="13.4.3 awk 变量"></a>13.4.3 awk 变量</h4><h5 id="1-输入分割符-FS"><a href="#1-输入分割符-FS" class="headerlink" title="1. 输入分割符 FS"></a>1. 输入分割符 FS</h5><blockquote><p>字段的分隔符，默认是空格</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -v FS=&quot;:&quot; &#x27;&#123;print $1&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h5 id="2-输出分隔符-OFS"><a href="#2-输出分隔符-OFS" class="headerlink" title="2. 输出分隔符 OFS"></a>2. 输出分隔符 OFS</h5><blockquote><p>输出后字段分隔符</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F &#x27;:&#x27; -v OFS=&#x27;--&#x27; &#x27;&#123;print $1OFS$2&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h5 id="3-输入换行符-RS"><a href="#3-输入换行符-RS" class="headerlink" title="3. 输入换行符 RS"></a>3. 输入换行符 RS</h5><blockquote><p>换行符，默认是\n</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改换行符</span></span><br><span class="line">awk -v RS=&#x27;:&#x27; &#x27;&#123;print $0&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h5 id="4-输出换行符-ORS"><a href="#4-输出换行符-ORS" class="headerlink" title="4. 输出换行符 ORS"></a>4. 输出换行符 ORS</h5><blockquote><p>输出后字段的换行符</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改输出换行符</span></span><br><span class="line">awk -v ORS=&#x27;/&#x27; &#x27;&#123;print $0&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h5 id="5-字段数量-NF"><a href="#5-字段数量-NF" class="headerlink" title="5. 字段数量 NF"></a>5. 字段数量 NF</h5><blockquote><p>记录的是分割后，当前行总字段数量</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看每一行有多少个字段</span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;&#123;print NF&#125;&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印最后一个字段</span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;&#123;print $NF&#125;&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印倒数第二个字段</span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;&#123;print $(NF-1)&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h5 id="6-单个文件行号-NR"><a href="#6-单个文件行号-NR" class="headerlink" title="6. 单个文件行号 NR"></a>6. 单个文件行号 NR</h5><blockquote><p>记录的是当前行的行号</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">给文件添加行号</span></span><br><span class="line">awk &#x27;&#123;print NR,$0&#125;&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印第二行</span></span><br><span class="line">awk &#x27;NR==2&#123;print $0&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h5 id="7-多个文件行号-FNR"><a href="#7-多个文件行号-FNR" class="headerlink" title="7. 多个文件行号 FNR"></a>7. 多个文件行号 FNR</h5><blockquote><p>分别记录每个文件的行号</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">给多个文件分别添加行号</span></span><br><span class="line">awk &#x27;&#123;print FNR,$0&#125;&#x27; /etc/passwd /etc/fstab</span><br></pre></td></tr></table></figure><h5 id="8-处理的文件名称-FILENAME"><a href="#8-处理的文件名称-FILENAME" class="headerlink" title="8. 处理的文件名称 FILENAME"></a>8. 处理的文件名称 FILENAME</h5><blockquote><p>记录的是当前文件名称</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">给每行开头添加当前处理的文件名称</span></span><br><span class="line">awk &#x27;&#123;print FILENAME,$0&#125;&#x27; /etc/fstab</span><br></pre></td></tr></table></figure><h5 id="9-参数的个数-ARGC"><a href="#9-参数的个数-ARGC" class="headerlink" title="9. 参数的个数 ARGC"></a>9. 参数的个数 ARGC</h5><blockquote><p>记录的是命令行的参数个数</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;print ARGC&#125;&#x27; /etc/fstab </span><br></pre></td></tr></table></figure><h5 id="10-参数的数组-ARGV"><a href="#10-参数的数组-ARGV" class="headerlink" title="10. 参数的数组 ARGV [ ? ]"></a>10. 参数的数组 ARGV [ ? ]</h5><blockquote><p>数组，保存的是命令行所给定的各个参数，每一个参数是ARGV[0] ….</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;print ARGV[0],ARGV[1],ARGV[2]&#125;&#x27; /etc/fstab /etc/passwd</span><br></pre></td></tr></table></figure><h5 id="11-自定义变量"><a href="#11-自定义变量" class="headerlink" title="11. 自定义变量"></a>11. 自定义变量</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印变量var的值,有几行打几次</span></span><br><span class="line"></span><br><span class="line">seq 1 | awk -v var=&#x27;zhangyu&#x27; &#x27;&#123;print var&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开头打印一遍var的值</span></span><br><span class="line">awk -v var=&#x27;zhangyu&#x27; &#x27;BEGIN&#123;print var&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">内部变量赋值</span></span><br><span class="line">awk &#x27;BEGIN&#123;var=&quot;zhangyu&quot;;print var&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">内部多个变量</span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;&#123;age=&quot;12&quot;;sex=&quot;man&quot;;print $1,age,sex&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="13-4-4-动作-printf"><a href="#13-4-4-动作-printf" class="headerlink" title="13.4.4 动作 printf"></a>13.4.4 动作 printf</h4><h5 id="1-格式符"><a href="#1-格式符" class="headerlink" title="1. 格式符"></a>1. 格式符</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">%</span><span class="language-bash">c显示字符的ASCII码</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">d,%i 显示十进制整数</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">e,%E显示科学计数法数值</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">f 显示为小数</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">g,%G以科学计数法或浮点形式显示数值</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">s显示字符串</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">u无符号整数</span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">%显示%自身</span></span><br></pre></td></tr></table></figure><h5 id="2-修饰符"><a href="#2-修饰符" class="headerlink" title="2. 修饰符"></a>2. 修饰符</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?[.?]第一个?控制显示的宽度：第二个?表示小数点后精度，如：%3.1f</span><br><span class="line">-左对齐(默认右对齐) 如：%-15s</span><br><span class="line">+显示数值的正负符号 如：%+d</span><br></pre></td></tr></table></figure><h4 id="13-4-5-操作符"><a href="#13-4-5-操作符" class="headerlink" title="13.4.5 操作符"></a>13.4.5 操作符</h4><h5 id="1-算数操作符"><a href="#1-算数操作符" class="headerlink" title="1. 算数操作符"></a>1. 算数操作符</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">x+y，x-y，x*y，x/y，x^Y，x%y</span><br><span class="line">-x转换为负数</span><br><span class="line">+x将字符串转换为数值</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">赋值操作符</span></span><br><span class="line">=，+=，*=，/=，%=，^=,++,--</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">比较操作符</span></span><br><span class="line">==,!=,&gt;,&gt;=,&lt;,&lt;=</span><br><span class="line"></span><br><span class="line">awk &#x27;NR&gt;2&#123;print $0&#125;&#x27; /etc/passwd</span><br><span class="line">awk &#x27;NR==2&#123;print $0&#125;&#x27; /etc/passwd</span><br><span class="line">awk &#x27;NR!=2&#123;print $0&#125;&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匹配<span class="variable">$3</span>不是&gt;=500的行，打印出<span class="variable">$0</span></span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;!($3&gt;=500)&#123;print $0&#125;&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印奇数行</span></span><br><span class="line">seq 10 | awk &#x27;NR%2==1&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印偶数行</span></span><br><span class="line">seq 10 | awk &#x27;NR%2==0&#x27;</span><br></pre></td></tr></table></figure><h5 id="2-模式匹配符"><a href="#2-模式匹配符" class="headerlink" title="2. 模式匹配符"></a>2. 模式匹配符</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~  左边是否和右边匹配,包含关系</span><br><span class="line">!~ 是否不匹配</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匹配整行中，开头是root的行</span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;$0 ~ /^root/&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匹配整行中，开头是root的行，然后输出该行的<span class="variable">$1</span></span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;$0 ~ /^root/&#123;print $1&#125;&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">不匹配整行中，开头是root的行</span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;$0 !~ /^root/&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">行尾匹配bash$的打印出<span class="variable">$1</span>,<span class="variable">$NF</span></span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;$NF ~ /bash$/&#123;print $1,$NF&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h5 id="3-逻辑操作符WO"><a href="#3-逻辑操作符WO" class="headerlink" title="3. 逻辑操作符WO"></a>3. 逻辑操作符WO</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&amp;&amp;并且</span><br><span class="line">|| 或者</span><br><span class="line">!取反</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取磁盘使用率</span></span><br><span class="line">df -h | awk -F &#x27;[ ]+|%&#x27; &#x27;$5 &gt; 15 &amp;&amp; /^[^Files]/&#123;print $0&#125;&#x27;</span><br></pre></td></tr></table></figure><h5 id="4-三元表达式"><a href="#4-三元表达式" class="headerlink" title="4. 三元表达式"></a>4. 三元表达式</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果满足则，如果不满足则</span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;&#123;if ($3 &gt; 20) &#123;print &quot;√&quot;,$0&#125; else &#123;print &quot;x&quot;,$0&#125;&#125;&#x27; /etc/passwd</span><br><span class="line">awk -F &#x27;:&#x27; &#x27;$3 &gt; 20 &#123;print &quot;√&quot;,$0&#125; $3 &lt;= 1000 &#123;print &quot;x&quot;,$0&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="13-4-6-模式PATTERN"><a href="#13-4-6-模式PATTERN" class="headerlink" title="13.4.6 模式PATTERN"></a>13.4.6 模式PATTERN</h4><p>PATTERN：根据模式条件，过滤匹配的行，再做处理</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">正则表达式</span></span><br><span class="line">awk &#x27;/^root/&#123;print $0&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关系表达式，为真才会处理</span></span><br><span class="line">awk &#x27;$0 ~ /^root/&#123;print $0&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">地址表达式(位置表达)</span></span><br><span class="line">awk &#x27;NR&gt;3 &amp;&amp; NR&lt;6&#123;print $0&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">正则表达式(位置表达)</span></span><br><span class="line"> awk &#x27;/^root/,/^bin/&#123;print $0&#125;&#x27;</span><br><span class="line"> </span><br><span class="line">BEGIN(仅在处理之前执行一次)</span><br><span class="line">END(仅在处理完成之后执行一次)</span><br><span class="line">awk -F &#x27;:&#x27; &#x27;BEGIN &#123;print &quot;开始&quot;&#125; &#123;print $0&#125; END &#123;print &quot;结束&quot;&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="13-4-7-流程控制语句"><a href="#13-4-7-流程控制语句" class="headerlink" title="13.4.7 流程控制语句"></a>13.4.7 流程控制语句</h4><h5 id="1-条件判断"><a href="#1-条件判断" class="headerlink" title="1. 条件判断"></a>1. 条件判断</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断</span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;&#123;if ($3 &gt; 1000) &#123;print &quot;√&quot;,$0&#125; else &#123;print &quot;x&quot;,$0&#125;&#125;&#x27; /etc/passwd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">多次判断</span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;&#123;if ($3 &lt; 50) &#123;print &quot;小于50&quot;,$0&#125; else if ($3 &lt; 60) &#123;print &quot;小于60&quot;,$0&#125; else &#123;print &quot;不小于50,也不小于60&quot;,$0&#125;&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h5 id="2-循环"><a href="#2-循环" class="headerlink" title="2. 循环"></a>2. 循环</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">计算1+2+3..+100</span></span><br><span class="line">awk &#x27;BEGIN&#123;sum=0;i=1;while(i&lt;=100)&#123;sum+=i;i++&#125;;print sum&#125;&#x27;</span><br><span class="line">for i in &#123;1..100&#125;; do let sum=sum+i; done; echo $sum</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印网段IP</span></span><br><span class="line">awk &#x27;BEGIN &#123; i=1; while (i&lt;=255) &#123; print &quot;192.168.1.&quot; i; i++ &#125; &#125;&#x27;</span><br><span class="line">awk &#x27;BEGIN &#123; for (i=1; i&lt;=255; i++) print &quot;192.168.1.&quot; i &#125;&#x27;</span><br></pre></td></tr></table></figure><h5 id="3-continue和break"><a href="#3-continue和break" class="headerlink" title="3. continue和break"></a>3. continue和break</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">计算奇数之和</span></span><br><span class="line">awk &#x27;BEGIN&#123;sum=0;for(i=1;i&lt;=100;i++)&#123;if(i%2==0)continue;sum=sum+i&#125;;print sum&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">终止循环</span></span><br><span class="line">awk &#x27;BEGIN&#123;sum=0;for(i=1;i&lt;=100;i++)&#123;if(i&gt;99)break;sum=sum+i&#125;;print sum&#125;&#x27;</span><br></pre></td></tr></table></figure><h5 id="4-next"><a href="#4-next" class="headerlink" title="4. next"></a>4. next</h5><blockquote><p>可以提前结束对本行的处理直接进入下一行</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F &#x27;:&#x27; &#x27;&#123;if($3%2!=0)next; print $1,$3&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="13-4-8-关联数组"><a href="#13-4-8-关联数组" class="headerlink" title="13.4.8 关联数组"></a>13.4.8 关联数组</h4><h5 id="1-定义数组"><a href="#1-定义数组" class="headerlink" title="1. 定义数组"></a>1. 定义数组</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">定义两个关联数组的值，然后输出其中一个数组的值</span></span><br><span class="line">awk &#x27;BEGIN&#123;weekdays[&quot;mom&quot;]=&quot;Monday&quot;;weekdays[&quot;tue&quot;]=&quot;Tuesday&quot;;print weekdays[&quot;mom&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h5 id="2-遍历数组"><a href="#2-遍历数组" class="headerlink" title="2. 遍历数组"></a>2. 遍历数组</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">for (变量 in 数组名) &#123;print 变量&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">var存了数组下标，这里是输出下标的值</span></span><br><span class="line">awk &#x27;BEGIN&#123;weekdays[&quot;mon&quot;]=&quot;Monday&quot;;weekdays[&quot;tue&quot;]=&quot;Tuesday&quot;;for (var in weekdays) &#123;print weekdays[var]&#125;&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">var存了数组下标，这里是输出有哪些下标</span></span><br><span class="line">awk &#x27;BEGIN&#123;weekdays[&quot;mon&quot;]=&quot;Monday&quot;;weekdays[&quot;tue&quot;]=&quot;Tuesday&quot;;for (var in weekdays)&#123;print var&#125;&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印下标对应的值</span></span><br><span class="line">awk &#x27;BEGIN&#123;weekdays[&quot;mon&quot;]=&quot;Monday&quot;;weekdays[&quot;tue&quot;]=&quot;Tuesday&quot;;for (var in weekdays)&#123;print var&quot;:&quot;weekdays[var]&#125;&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">定义两个数组，判断下标mon是否在数组weekdays中</span></span><br><span class="line">awk &#x27;BEGIN&#123;weekdays[&quot;mon&quot;]=&quot;Monday&quot;;weekdays[&quot;tue&quot;]=&quot;Tuesday&quot;;if (&quot;mon&quot; in weekdays) &#123;print &quot;存在&quot;&#125;else&#123;print&quot;不存在&quot;&#125;&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">定义输出</span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;&#123;user[$1]=$3&#125; END &#123;for(var in user) &#123;print &quot;username:&quot; var &quot;, uid:&quot; user[var]&#125;&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><h5 id="3-范例："><a href="#3-范例：" class="headerlink" title="3. 范例："></a>3. 范例：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">统计主机不同连接状态的次数</span></span><br><span class="line">ss | awk -F &#x27;[ ]+|:&#x27; &#x27;NR!=1 &#123;state[$2]++&#125; END &#123;for (i in state) &#123;print i, state[i]&#125;&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">统计主机连接次数</span></span><br><span class="line">ss | awk -F &#x27;[ ]+|:&#x27; &#x27;NR!=1&#123;ip[$7] = ip[$7] + 1&#125; END &#123;for (i in ip) &#123;print i&quot;有&quot;ip[i]&quot;个连接数&quot;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure><h4 id="13-4-8-函数"><a href="#13-4-8-函数" class="headerlink" title="13.4.8 函数"></a>13.4.8 函数</h4><h5 id="1-调用shell指令"><a href="#1-调用shell指令" class="headerlink" title="1. 调用shell指令"></a>1. 调用shell指令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 ~][0]# awk &#x27;BEGIN&#123;system(&quot;hostname&quot;)&#125;&#x27;</span><br><span class="line">rocky9</span><br><span class="line">[root@rocky9 ~][0]# awk &#x27;BEGIN&#123;score=100; system(&quot;echo your score is &quot; score) &#125;&#x27;</span><br><span class="line">your score is 100</span><br></pre></td></tr></table></figure><h5 id="2-常见内置函数"><a href="#2-常见内置函数" class="headerlink" title="2. 常见内置函数"></a>2. 常见内置函数</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rand():返回0和1之间一个固定的数</span></span><br><span class="line">awk &#x27;BEGIN&#123;print rand() &#125;&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">srand():配合rand()函数，生成随机数的种子</span></span><br><span class="line"> awk &#x27;BEGIN&#123;srand();print rand() &#125;&#x27;</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">int():返回整数</span></span><br><span class="line">awk &#x27;BEGIN&#123;print int(110000) &#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成随机整数</span></span><br><span class="line">awk &#x27;BEGIN&#123;srand();print int(rand()*100000000000000000)&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rand():返回0和1之间一个固定的数</span></span><br><span class="line">awk &#x27;BEGIN&#123;print rand() &#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">srand():配合rand()函数，生成随机数的种子</span></span><br><span class="line"> awk &#x27;BEGIN&#123;srand();print rand() &#125;&#x27;</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">int():返回整数</span></span><br><span class="line">awk &#x27;BEGIN&#123;print int(110000) &#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成随机整数</span></span><br><span class="line">awk &#x27;BEGIN&#123;srand();print int(rand()*100000000000000000)&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sub(r,s,[t])对字符串搜索r表示匹配内容，并将第一个匹配内容替换成s</span></span><br><span class="line">[root@rocky9 ~][0]# echo &quot;2008:08:08 08:08:08&quot; | awk &#x27;sub(/:/,&quot;-&quot;,$1)&#x27;</span><br><span class="line">2008-08:08 08:08:08</span><br><span class="line">[root@rocky9 ~][0]# echo &quot;2008:08:08 08:08:08&quot; | awk &#x27;sub(/:/,&quot;-&quot;,$2)&#x27;</span><br><span class="line">2008:08:08 08-08:08</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gsub(r,s,[t])对字符串进行r表示匹配内容，并全部替换为s所表示的内容<span class="variable">$1</span>,2,3表示替换的列</span></span><br><span class="line">[root@rocky9 ~][0]# echo &quot;2008:08:08 08:08:08&quot; | awk &#x27;gsub(/:/,&quot;-&quot;,$1)&#x27;</span><br><span class="line">2008-08-08 08:08:08</span><br><span class="line">[root@rocky9 ~][0]# echo &quot;2008:08:08 08:08:08&quot; | awk &#x27;gsub(/:/,&quot;-&quot;,$2)&#x27;</span><br><span class="line">2008:08:08 08-08-08</span><br><span class="line">[root@rocky9 ~][0]# echo &quot;2008:08:08 08:08:08&quot; | awk &#x27;gsub(/:/,&quot;-&quot;,$0)&#x27;</span><br><span class="line">2008-08-08 08-08-08</span><br><span class="line">split(s,array,[r])以r为分隔符，切割字符串s，并将切割后的结果保存至array所表示的数组中，第一个索引值为1，第二个索引值为2,...</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-自定义函数"><a href="#3-自定义函数" class="headerlink" title="3. 自定义函数"></a>3. 自定义函数</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法</span></span><br><span class="line">function 函数名 ( 参数,参数,.....) &#123;</span><br><span class="line">  函数体</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">function man(x,y)</span><br><span class="line"><span class="meta prompt_"> x&gt;</span><span class="language-bash">y?var=x:var=y</span></span><br><span class="line"> return var</span><br><span class="line">&#125;</span><br><span class="line">BEGIN&#123;print man(a,b)&#125;</span><br><span class="line">awk &#x27;function man(x,y) &#123;return x &gt; y ? x : y;&#125;BEGIN&#123;print man(10,100);&#125;&#x27;</span><br></pre></td></tr></table></figure><h1 id="14-文件查找"><a href="#14-文件查找" class="headerlink" title="14. 文件查找"></a>14. 文件查找</h1><h3 id="14-1-locate-非实时查找"><a href="#14-1-locate-非实时查找" class="headerlink" title="14.1 locate 非实时查找"></a>14.1 locate 非实时查找</h3><p>依托于文件索引数据库  &#x2F;var&#x2F;lib&#x2F;mlocate&#x2F;mlocate.db</p><p>工作特点：速度块、模糊查找、非实时查找、搜索的是文件全路径，不仅仅是文件名、可能只搜索用户具备读取和执行权限的目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成索引数据库</span></span><br><span class="line">updatedb</span><br><span class="line"></span><br><span class="line">locate [选项] PATTERN</span><br><span class="line"></span><br><span class="line">-i不区分大小写搜索</span><br><span class="line">-n ?只列出前?个匹配到的项目</span><br><span class="line">-r使用基本正则表达式</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索路径名称或路径中包含<span class="string">&quot;conf&quot;</span>的文件</span></span><br><span class="line">locate conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索以<span class="string">&quot;conf&quot;</span>结尾的文件</span></span><br><span class="line">locate -r &#x27;\.conf$&#x27;</span><br></pre></td></tr></table></figure><h3 id="14-2-find-实时查找"><a href="#14-2-find-实时查找" class="headerlink" title="14.2 find 实时查找"></a>14.2 find 实时查找</h3><p>find是实时查找工具，通过遍历指定路径完成文件查找</p><p>工作特点：查找速度略慢，精确查找，实时查找，查找条件丰富，可能只搜索用户具备读取和执行权限的目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">find [选项] [查找路径] [查找条件] [处理动作]</span><br><span class="line"></span><br><span class="line">-depth对每个目录先处理目录内文件,再处理目录本身</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">会列出/etc下所有的文件路径</span></span><br><span class="line">find /etc</span><br></pre></td></tr></table></figure><h4 id="14-2-1-指定搜索目录的深度"><a href="#14-2-1-指定搜索目录的深度" class="headerlink" title="14.2.1 指定搜索目录的深度"></a>14.2.1 指定搜索目录的深度</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-maxdepth?最大搜索目录深度，指定目录下文件为第1级</span><br><span class="line">-mindepth?最小搜索目录深度</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索目录深度为5层，最小搜索2层</span></span><br><span class="line">find /etc -maxdepth 5 -mindepth 2</span><br></pre></td></tr></table></figure><h4 id="14-2-2-根据文件名和inode查找"><a href="#14-2-2-根据文件名和inode查找" class="headerlink" title="14.2.2 根据文件名和inode查找"></a>14.2.2 根据文件名和inode查找</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-name &quot;文件名称&quot; 文件名称支持通配符：*,?,[],[^]（使用通配符建议加双引号）</span><br><span class="line">-iname &quot;文件名称&quot; 不区分大小写</span><br><span class="line">-inum ?按inode查找（文件编号）</span><br><span class="line">-samefile name相同inode号的文件,需要保证在同一分区</span><br><span class="line">-links ?链接数为?的文件</span><br><span class="line">-regex &quot;PATTERN&quot;以正则表达式匹配整个文件路径，而非文件名称</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找passwd</span></span><br><span class="line">find /etc -name &quot;*passwd*&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按inode查找</span></span><br><span class="line">find / -inum 34243 -ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匹配conf结尾的文件</span></span><br><span class="line">find /etc -regex &quot;^.*\.conf&quot;</span><br></pre></td></tr></table></figure><h4 id="14-2-3-根据属主、属组查找"><a href="#14-2-3-根据属主、属组查找" class="headerlink" title="14.2.3 根据属主、属组查找"></a>14.2.3 根据属主、属组查找</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-user &quot;username&quot;查找属主为为指定用户UID的文件</span><br><span class="line">-group &quot;groupname&quot;查找属组为指定GID的文件</span><br><span class="line">-uid &quot;UID&quot;查找属主为指定UID号的文件</span><br><span class="line">-gid &quot;GID&quot;查找组指定组ID的文件</span><br><span class="line">-nouser 查找没有属主的文件</span><br><span class="line">-nogroup 查找没有属组的文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找账户nginx文件</span></span><br><span class="line">find  / -user nginx </span><br></pre></td></tr></table></figure><h4 id="14-2-4-根据文件类型查找"><a href="#14-2-4-根据文件类型查找" class="headerlink" title="14.2.4 根据文件类型查找"></a>14.2.4 根据文件类型查找</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-type 文件类型</span><br><span class="line"></span><br><span class="line">f普通文件</span><br><span class="line">d目录文件</span><br><span class="line">l链接文件</span><br><span class="line">s套接字文件</span><br><span class="line">b块文件</span><br><span class="line">c字符设备文件</span><br><span class="line">p管道文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找系统上的块文件</span></span><br><span class="line">find / -type b</span><br></pre></td></tr></table></figure><h4 id="14-2-5-搜索空文件或目录、"><a href="#14-2-5-搜索空文件或目录、" class="headerlink" title="14.2.5 搜索空文件或目录、"></a>14.2.5 搜索空文件或目录、</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-empty搜索大小为0的文件或空目录</span><br><span class="line"></span><br><span class="line">find /app -type d -empty</span><br></pre></td></tr></table></figure><h4 id="14-2-6-与或非"><a href="#14-2-6-与或非" class="headerlink" title="14.2.6 与或非"></a>14.2.6 与或非</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-a与</span><br><span class="line">-o或</span><br><span class="line">-not ! 非</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">小括号可以提升优先级</span></span><br><span class="line">find /etc/ \( -type d -o -type l \)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找套接字文件或块文件</span></span><br><span class="line">find / -type s -o -type b</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找</span></span><br></pre></td></tr></table></figure><h4 id="14-2-7-德-·-摩根定律"><a href="#14-2-7-德-·-摩根定律" class="headerlink" title="14.2.7 德 · 摩根定律"></a>14.2.7 德 · 摩根定律</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">（非A）或（非B）=非（A且B）</span><br><span class="line">（非A）且（非B）=非（A或B）</span><br><span class="line"></span><br><span class="line">!A -a !B = !(A -o B)</span><br><span class="line">!A -o !B = !(A -a B)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找不属于用户 <span class="string">&quot;zhangyu&quot;</span> 或不属于用户 <span class="string">&quot;zhangsan&quot;</span> 的文件或目录</span></span><br><span class="line">find ! -user zhangyu -o ! -user zhangsan</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找既不属于用户 <span class="string">&quot;zhangyu&quot;</span> 又不属于用户 <span class="string">&quot;zhangsan&quot;</span> 的文件或目录。</span></span><br><span class="line">find ! \( -user zhangyu -a -user zhangsan \) </span><br></pre></td></tr></table></figure><h4 id="14-2-8-排除文件"><a href="#14-2-8-排除文件" class="headerlink" title="14.2.8 排除文件"></a>14.2.8 排除文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找etc下，除/etc/sane.目录的其他所有.conf后缀的文件</span></span><br><span class="line">find /etc/ -path &#x27;/etc/sane.d&#x27; -a -prune -o -name &quot;*.conf&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找etc下，除/etc/sane和/etc/fonts两个目录的所有.conf后缀的文件</span></span><br><span class="line">find /etc \( -path &quot;/etc/sane.d&quot; -o -path &quot;/etc/fonts&quot; \) -prune -o -name &quot;*.conf&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">排除/proc和/sys目录</span></span><br><span class="line">find / \( -path &quot;/proc/&quot; -o -path &quot;/proc/&quot; \) -a -prune -o -type f -a -mmin -1</span><br></pre></td></tr></table></figure><h4 id="14-2-9-根据文件大小查找"><a href="#14-2-9-根据文件大小查找" class="headerlink" title="14.2.9 根据文件大小查找"></a>14.2.9 根据文件大小查找</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">find [选项] [查找路径] [查找条件] [处理动作]</span><br><span class="line"></span><br><span class="line">-size [+|-]?常用单位：k，M,G,c(byte)，注意大小写敏感</span><br><span class="line">6k表示5k，6k</span><br><span class="line">-6k表示0-5k</span><br><span class="line">+6k表示6k以上,不包括6k</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">dd if=/dev/zero of=bing.log bs=100M count=10</span><br><span class="line">find / -size +900M</span><br></pre></td></tr></table></figure><h4 id="14-2-10-根据时间戳查询"><a href="#14-2-10-根据时间戳查询" class="headerlink" title="14.2.10 根据时间戳查询"></a>14.2.10 根据时间戳查询</h4><p>find命令认为24小时之内为第0天</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">天</span><br><span class="line">-atime [+|-]10</span><br><span class="line">10表示10-11天之间</span><br><span class="line">+10表示11天以后</span><br><span class="line">-10表示0-10天之间</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">find /root -atime -10</span><br><span class="line"></span><br><span class="line">分钟</span><br><span class="line">-mmin  29</span><br><span class="line">-2929分钟之内发生变化的文件</span><br><span class="line">+2929分钟之前发生变化的文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">范例</span></span><br><span class="line">find /etc/ -mmin -20</span><br></pre></td></tr></table></figure><h4 id="14-2-11-根据权限查找"><a href="#14-2-11-根据权限查找" class="headerlink" title="14.2.11 根据权限查找"></a>14.2.11 根据权限查找</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-perm [/|-]MODE</span><br><span class="line"> MODE精确权限匹配</span><br><span class="line">/MODE任何一类（u，g，o）任意一类对象满足对应匹配的权限即可，或关系</span><br><span class="line">-MODE每一类对象都必须满足指定权限，才匹配。与关系</span><br><span class="line">0:表示不关注</span><br><span class="line">    </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找root下600权限的文件</span></span><br><span class="line">find /root -perm 600</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找etc下g有x权限或u有x权限的文件</span></span><br><span class="line">find /etc -perm /g+x,u+x</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">匹配root目录下600权限且是文件夹的文件</span></span><br><span class="line">find /root/ -perm 600 -a -type d</span><br></pre></td></tr></table></figure><h4 id="14-2-12-处理搜索到的文件"><a href="#14-2-12-处理搜索到的文件" class="headerlink" title="14.2.12 处理搜索到的文件"></a>14.2.12 处理搜索到的文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">-print默认的处理动作，显示至屏幕</span><br><span class="line">-ls类似于对查找到的文件执行ls -l指令</span><br><span class="line">-delete删除查找到的文件</span><br><span class="line">-fls file找到的所有文件长格式信息保存至file中</span><br><span class="line">-ok cmd &#123;&#125; \;对查找到的每个文件执行由cmd指定的命令，每个文件执行命令前都会交互式要求用户确认</span><br><span class="line">-exec cmd &#123;&#125; \;对查找到的每个文件执行由cmd指定的命令</span><br><span class="line">&#123;&#125;用于引用查找到的文件名称自身</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除搜索到的文件</span></span><br><span class="line">find /data -size +5M -delete</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">类似<span class="built_in">ls</span> -li重定向</span></span><br><span class="line">find /data -fls /root/find.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份配置文件，添加，orig这个扩展名</span></span><br><span class="line">find -name &quot;.conf&quot; -exec cp &#123;&#125; &#123;&#125;.orig \;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">提示删除存在时间超过3天以上的joe的临时文件</span></span><br><span class="line">find /tmp -ctime +3 -user joe -ok rm &#123;&#125; \;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在主目录中寻找可被其他用户写入的文件</span></span><br><span class="line">find ~ -perm -002 -exec chmod o-w &#123;&#125; \;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找/data下的权限为644，后缀为sh的普通文件，增加执行权限</span></span><br><span class="line">find /data -type f -perm 664 -name &quot;*.sh&quot; -exec chmod 755 &#123;&#125; \;</span><br></pre></td></tr></table></figure><h4 id="14-2-13-xargs"><a href="#14-2-13-xargs" class="headerlink" title="14.2.13 xargs"></a>14.2.13 xargs</h4><p>xargs可以将收到的标准输出，传给下一个命令，作为其参数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-n ?表示一次传给后面指令的参数是多少个</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找有特殊权限的文件，并排序,注意,此处匹配条件逻辑不一样，参考根据权限查找章节</span></span><br><span class="line">find /bin/ -perm /7000 | xargs ls -sl</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以字符nul分隔</span></span><br><span class="line">find -type f -name &quot;*.txt&quot; -print0 | xargs -o rm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">并发执行多个进程</span></span><br><span class="line">seq 100 | xargs -i -p10 wget -p /data http:/10.0.0.8/.html</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">并行下载视频</span></span><br><span class="line">seq 389 | xargs -i -p3 you-get https://www.bilibili.com/video/avsaddaewq?p=&#123;&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">批量创建账户</span></span><br><span class="line">echo user&#123;1..10&#125; | xargs -n1 useradd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用空作为文件的分隔符</span></span><br><span class="line">find -print0 | xargs -0 ls -Sl</span><br></pre></td></tr></table></figure><h1 id="15-压缩和解压缩"><a href="#15-压缩和解压缩" class="headerlink" title="15. 压缩和解压缩"></a>15. 压缩和解压缩</h1><h3 id="15-1-compress"><a href="#15-1-compress" class="headerlink" title="15.1 compress"></a>15.1 compress</h3><p>安装：yum -y install ncompress</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">compress [选项] 文件</span><br><span class="line"></span><br><span class="line">-d解压缩，相当于uncompress</span><br><span class="line">-c结果输出至标准输出，不输出原文件</span><br><span class="line">-v显示详情</span><br><span class="line">zcat查看压缩文件内容</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩文件</span></span><br><span class="line">compress bing.log输出--&gt;bing.log.Z</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压缩</span></span><br><span class="line">uncompress bing.log.Z输出--&gt;bing.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩时保留源文件</span></span><br><span class="line">compress -c bing.log &gt; bing.log.Z</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压时保留压缩文件</span></span><br><span class="line">uncompress -c bing.log.Z &gt; bing.log</span><br></pre></td></tr></table></figure><h3 id="15-2-gzip"><a href="#15-2-gzip" class="headerlink" title="15.2 gzip"></a>15.2 gzip</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">compress [选项] 文件</span><br><span class="line"></span><br><span class="line">-d解压缩，相当于gunzip</span><br><span class="line">-k保留原文件（centos8才支持）</span><br><span class="line">-c压缩结果输出至标准输出，保留原文件不变</span><br><span class="line">-?指定压缩比，?取值为1-9，值越大压缩比越大</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩文件</span></span><br><span class="line">gzip bing.log  输出--&gt;bing.log.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压缩</span></span><br><span class="line">gunzip bing.log.gz输出--&gt;bing.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩时保留源文件</span></span><br><span class="line">gzip -c bing.log &gt; bing.log.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压时保留压缩文件</span></span><br><span class="line">gunzip -c bing.log.gz  &gt; bing.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件重定向压缩</span></span><br><span class="line">cat bing.log | gzip &gt; bing.log.gz</span><br></pre></td></tr></table></figure><h3 id="15-3-bzip2"><a href="#15-3-bzip2" class="headerlink" title="15.3 bzip2"></a>15.3 bzip2</h3><p>安装：yum -y install bzip2</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">bzip2 [选项] 文件</span><br><span class="line"></span><br><span class="line">-k保留原文件</span><br><span class="line">-d解压缩</span><br><span class="line">-c压缩结果输出至标准输出，保留原文件不改变</span><br><span class="line">-?指定压缩比，?取值为1-9，值越大压缩比越大，默认为9</span><br><span class="line">bzcat查看压缩文件内容</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩文件</span></span><br><span class="line">bzip2 bing.log  输出--&gt;bing.log.bz2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压缩</span></span><br><span class="line">bunzip2 bing.log.bz2输出--&gt;bing.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩保留原文件</span></span><br><span class="line">bzip2 -k bing.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压保留原文件</span></span><br><span class="line">bunzip2 -k bing.log.bz2 </span><br></pre></td></tr></table></figure><h3 id="15-4-xz"><a href="#15-4-xz" class="headerlink" title="15.4 xz"></a>15.4 xz</h3><p>安装：yum -y install xz</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">xz [选项] 文件</span><br><span class="line"></span><br><span class="line">-kkeep，保留原文件</span><br><span class="line">-d解压缩</span><br><span class="line">-c压缩结果输出至标准输出，保留原文件不改变</span><br><span class="line">-?指定压缩比，?取值为1-9，默认为6</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩文件</span></span><br><span class="line">xz bing.log输出--&gt;bing.log.xz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压缩</span></span><br><span class="line">xz -d bing.log.xz输出--&gt;bing.log</span><br><span class="line">unxz bing.log.xz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩保留原文件</span></span><br><span class="line">xz -c bing.log &gt; bing.log.xz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压保留原文件</span></span><br><span class="line">xz -d -c bing.log.xz &gt; bing.log</span><br></pre></td></tr></table></figure><h3 id="15-5-zip-压缩文件夹"><a href="#15-5-zip-压缩文件夹" class="headerlink" title="15.5 zip 压缩文件夹"></a>15.5 zip 压缩文件夹</h3><p>安装：yum -y install zip unzip</p><p>zip可以实现打包目录和多个文件成一个文件并压缩，但是可能会丢失文件属性信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">zip 压缩后的文件 原文件</span><br><span class="line"></span><br><span class="line">-r针对文件夹进行打包</span><br><span class="line">-q静默模式</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩单个文件（会保留原文件）</span></span><br><span class="line">zip -q bing.log.zip bing.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压文件</span></span><br><span class="line">unzip -q bing.log.zip</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩多个文件到一个压缩包</span></span><br><span class="line">zip -q /root/all.zip *</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩文件夹</span></span><br><span class="line">zip -qr etc.zip /etc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压文件夹</span></span><br><span class="line">unzip -q etc.zip</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压文件到指定目录</span></span><br><span class="line">unzip -q etc.zip -d /etc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">不打包目录，只打包当前文件</span></span><br><span class="line">cd /etc</span><br><span class="line">zip -qr /root/etc.zip *</span><br><span class="line"></span><br><span class="line">cd /root</span><br><span class="line">unzip -q etc.zip</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="16-文件归档-tar"><a href="#16-文件归档-tar" class="headerlink" title="16 文件归档 tar"></a>16 文件归档 tar</h1><h3 id="16-1-tar-打包压缩"><a href="#16-1-tar-打包压缩" class="headerlink" title="16.1 tar 打包压缩"></a>16.1 tar 打包压缩</h3><p>tar可以对目录和多个文件打包成一个文件，并且可以压缩，保留文件属性不丢失，常用于备份</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">tar 选项 目标文件 源文件</span><br><span class="line"></span><br><span class="line">-C解包到指定文件夹</span><br><span class="line">-c打包</span><br><span class="line">-t预览</span><br><span class="line">-x解包</span><br><span class="line">-vf通用选项 代表文件</span><br><span class="line">-j使用bizp2对打包文件进行压缩</span><br><span class="line">-J使用xz对打包文件进行压缩</span><br><span class="line">-z使用gzip对打包文件进行压缩</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打包文件夹（会保留原文件）</span></span><br><span class="line">tar -cvf /root/home.tar /home</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">预览打包文件夹内容</span></span><br><span class="line">tar -tvf home.tar</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解包文件夹（会保留原文件）</span></span><br><span class="line">tar -xvf home.tar</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解包文件夹到指定目录</span></span><br><span class="line">tar -xvf home.tar -C /tmp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打包文件不包括目录自身</span></span><br><span class="line">cd /etc</span><br><span class="line">tar -zcvf /root/etc.tar.gz *</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打包目录并使用bizp2进行压缩</span></span><br><span class="line">tar -jcvf home.tar.bz2 /home</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打包目录并使用xz进行压缩</span></span><br><span class="line">tar -Jcvf home.tar.xz /home</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打包目录并使用gzip进行压缩</span></span><br><span class="line">tar -zcvf home.tar.gz /home</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压并解包到指定目录（x选项对于不同压缩格式是通用的）</span></span><br><span class="line">tar -xvf home.tar.xz -C /tmp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打包多个文件并使用gzip进行压缩</span></span><br><span class="line">tar -zcvf home.tar.gz /mysql/data/bing*</span><br></pre></td></tr></table></figure><p>利用tar进行文件复制</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将/etc复制到/root下</span></span><br><span class="line">tar -c /etc | tar -x -C /root/</span><br></pre></td></tr></table></figure><p>排除文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-exclude排除文件</span></span><br><span class="line">tar -zcvf /root/a.tgz --exclude=/app/host1 -exclude=/app/host2 /app</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-T选项指定输入文件，-X选项指定包含要排除的文件列表</span></span><br><span class="line">tar -zcvf mybackup.tgz -T /root/includefilelist -x /excludefilelist</span><br></pre></td></tr></table></figure><h3 id="16-2-split-文件切割"><a href="#16-2-split-文件切割" class="headerlink" title="16.2 split 文件切割"></a>16.2 split 文件切割</h3><p>split命令可以分割一个文件为多个文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按40K大小切割文件bin.log.gz,到目录/root/bin.log.gz下</span></span><br><span class="line">split -b 40K bin.log.gz /root/bin.log.gz</span><br><span class="line"></span><br><span class="line">-rw-r--r-- 1 root root 203555 Nov  2 09:59 bin.log.gz</span><br><span class="line">-rw-r--r-- 1 root root  40960 Nov  2 10:00 bin.log.gzaa</span><br><span class="line">-rw-r--r-- 1 root root  40960 Nov  2 10:00 bin.log.gzab</span><br><span class="line">-rw-r--r-- 1 root root  40960 Nov  2 10:00 bin.log.gzac</span><br><span class="line">-rw-r--r-- 1 root root  40960 Nov  2 10:00 bin.log.gzad</span><br><span class="line">-rw-r--r-- 1 root root  39715 Nov  2 10:00 bin.log.gzae</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用数字方式作为切割文件名</span></span><br><span class="line">split -b 40K -d bin.log.gz /root/bin.log.gz</span><br><span class="line"></span><br><span class="line">-rw-r--r-- 1 root root 203555 Nov  2 09:59 bin.log.gz</span><br><span class="line">-rw-r--r-- 1 root root  40960 Nov  2 10:02 bin.log.gz00</span><br><span class="line">-rw-r--r-- 1 root root  40960 Nov  2 10:02 bin.log.gz01</span><br><span class="line">-rw-r--r-- 1 root root  40960 Nov  2 10:02 bin.log.gz02</span><br><span class="line">-rw-r--r-- 1 root root  40960 Nov  2 10:02 bin.log.gz03</span><br><span class="line">-rw-r--r-- 1 root root  39715 Nov  2 10:02 bin.log.gz04</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">合并切割的文件</span></span><br><span class="line">cat /root/bin.log.gz* &gt; bin.log.gz</span><br></pre></td></tr></table></figure><h1 id="17-rpm-软件包管理"><a href="#17-rpm-软件包管理" class="headerlink" title="17. rpm 软件包管理"></a>17. rpm 软件包管理</h1><h3 id="17-1-gcc-编译过程"><a href="#17-1-gcc-编译过程" class="headerlink" title="17.1 gcc 编译过程"></a>17.1 gcc 编译过程</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">分步骤编译运行</span></span><br><span class="line">gcc -E hello.c -o hello.i对hello.c文件进行预处理，生成了hello.i文件</span><br><span class="line">gcc -S hello.i -o hello.s对预处理文件进行编译，生成了汇编文件</span><br><span class="line">gcc -c hello.s -o hello.o对汇编文件进行编译，生成了目标文件</span><br><span class="line">gcc hello.o -o hello对目标文件进行链接，生成了可执行文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一步实现编译过程</span></span><br><span class="line">gcc hello.c -o hello直接编译链接成可执行目标文件</span><br></pre></td></tr></table></figure><h3 id="17-2-软件模块的静态和动态链接"><a href="#17-2-软件模块的静态和动态链接" class="headerlink" title="17.2 软件模块的静态和动态链接"></a>17.2 软件模块的静态和动态链接</h3><h4 id="17-2-1-动态链接"><a href="#17-2-1-动态链接" class="headerlink" title="17.2.1 动态链接"></a>17.2.1 动态链接</h4><p>动态链接主要就是把各个模块之间互相引用的部分处理好，使得各个模块之间能够正确的衔接，分为静态和动态链接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看二进制文件依赖那些库</span></span><br><span class="line">[root@rocky9 ~][0]# ldd /bin/ls</span><br><span class="line"></span><br><span class="line">linux-vdso.so.1 (0x00007ffec07ae000)</span><br><span class="line">libselinux.so.1 =&gt; /lib64/libselinux.so.1 (0x00007f12e1a77000)</span><br><span class="line">libcap.so.2 =&gt; /lib64/libcap.so.2 (0x00007f12e1a6d000)</span><br><span class="line">libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f12e1800000)</span><br><span class="line">libpcre2-8.so.0 =&gt; /lib64/libpcre2-8.so.0 (0x00007f12e1764000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 (0x00007f12e1ad0000)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载配置文件种指定的库文件</span></span><br><span class="line">ldconfig</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示本机已经缓存的所有可用库文件名及路径映射关系</span></span><br><span class="line">/sbin/ldconfig -p</span><br></pre></td></tr></table></figure><h4 id="17-2-2-静态链接"><a href="#17-2-2-静态链接" class="headerlink" title="17.2.2 静态链接"></a>17.2.2 静态链接</h4><p>静态链接会把对应的依赖库复制一份到包</p><h4 id="17-2-4-库文件被破坏恢复"><a href="#17-2-4-库文件被破坏恢复" class="headerlink" title="17.2.4 库文件被破坏恢复"></a>17.2.4 库文件被破坏恢复</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1.开机读进度条按一次Esc</span><br><span class="line"></span><br><span class="line">2.选择CD-ROM drive启动</span><br><span class="line"></span><br><span class="line">3.选择第三项Troubleshooting</span><br><span class="line"></span><br><span class="line">4.选择第二项Rescue a CentOS system救援模式</span><br><span class="line"></span><br><span class="line">5.等待进入选项界面输入1（Continue）</span><br><span class="line"></span><br><span class="line">6.此时可以看到chroot /mnt/sysimage （根已经被挂载到了/mnt/sysimage）</span><br><span class="line"></span><br><span class="line">7.please press &lt;return&gt; to get a shell. 按回车，开启shell</span><br><span class="line"></span><br><span class="line">8.此时使用光盘启动，使用的是光盘内的操作系统</span><br><span class="line"></span><br><span class="line">9.将破坏的库文件恢复到原来根下（库文件被移动）</span><br><span class="line">mv /mut/sysumage/data/libc.so.6 /mnt/sysimage/lib64/</span><br><span class="line"></span><br><span class="line">9.将破坏的库文件恢复到原来根下（库文件被删除）</span><br><span class="line">mv /lib64/libc.so.6 /mnt/sysimage/lib64/</span><br><span class="line"></span><br><span class="line">10.Ctrl+Alt+Delete 或 reboot 重启操作系统</span><br></pre></td></tr></table></figure><h3 id="17-3-软件包管理工具"><a href="#17-3-软件包管理工具" class="headerlink" title="17.3 软件包管理工具"></a>17.3 软件包管理工具</h3><h4 id="17-3-1-查看-解压包文件内容"><a href="#17-3-1-查看-解压包文件内容" class="headerlink" title="17.3.1 查看&#x2F;解压包文件内容"></a>17.3.1 查看&#x2F;解压包文件内容</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">利用cpio工具查看包文件列表</span></span><br><span class="line">rpm2cpio 包文件 | cpio -it</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">释放包内的文件</span></span><br><span class="line">rpm2cpio 包文件 | cpio -idv</span><br></pre></td></tr></table></figure><h4 id="17-3-2-包搜索引擎"><a href="#17-3-2-包搜索引擎" class="headerlink" title="17.3.2 包搜索引擎"></a>17.3.2 包搜索引擎</h4><p>&#x3D;&#x3D;注意：第三方包建议检查其合法性，来源合法性，程序包的完整性&#x3D;&#x3D;</p><p><a href="http://pkgs.org/">http://pkgs.org</a></p><p><a href="http://rpmfind.net/">http://rpmfind.net</a></p><p><a href="http://rpm.pbone.net/">http://rpm.pbone.net</a></p><p><a href="http://sourceforge.net/">http://sourceforge.net</a></p><h4 id="17-3-3-rpm-常用指令"><a href="#17-3-3-rpm-常用指令" class="headerlink" title="17.3.3 rpm 常用指令"></a>17.3.3 rpm 常用指令</h4><p>Centos 系统上使用 rpm 命令管理程序包</p><h5 id="17-3-3-1-rpm-包安装-卸载"><a href="#17-3-3-1-rpm-包安装-卸载" class="headerlink" title="17.3.3.1 rpm 包安装&#x2F;卸载"></a>17.3.3.1 rpm 包安装&#x2F;卸载</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">rpm 选项 包文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装rpm包</span></span><br><span class="line">rpm -ivh gzip-1.5-10.el7.x86_64.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载rpm包</span></span><br><span class="line">rpm -evh gzip-1.5-10.el7.x86_64.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">升级rpm包(如果没有旧版本，就安装)</span></span><br><span class="line">rpm -Uvh gzip-1.5-10.el7.x86_64.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">升级rpm包(如果没有旧版本，就不做动作)</span></span><br><span class="line">rpm -Fvh gzip-1.5-10.el7.x86_64.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">忽略依赖关系检查安装</span></span><br><span class="line">rpm -ivh --nodeps gzip-1.5-10.el7.x86_64.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">强制安装rpm包，忽略任何报错和警告</span></span><br><span class="line">rpm -ivh --force gzip-1.5-10.el7.x86_64.rpm</span><br></pre></td></tr></table></figure><h5 id="17-3-3-2-rpm-包查询"><a href="#17-3-3-2-rpm-包查询" class="headerlink" title="17.3.3.2 rpm 包查询"></a>17.3.3.2 rpm 包查询</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询rpm包会安装那些文件</span></span><br><span class="line">rpm -qpl gzip-1.5-10.el7.x86_64.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询rpm包的说明信息</span></span><br><span class="line">rpm -qpi gzip-1.5-10.el7.x86_64.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询已安装的rpm包安装有那些文件</span></span><br><span class="line">rpm -ql kernel-3.10.0-1160.el7.x86_64</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询已安装包的详细信息</span></span><br><span class="line">rpm -qi kernel-3.10.0-1160.el7.x86_64</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询磁盘文件来自那个rpm包</span></span><br><span class="line">rpm -qf /usr/bin/ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询功能是由那个包提供</span></span><br><span class="line">rpm -q --whatprovides bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询包被那些包依赖</span></span><br><span class="line">rpm -q --whatrequires bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询已经安装的所有rpm包</span></span><br><span class="line">rpm -qa</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询已安装rpm包的文档</span></span><br><span class="line">rpm -qd coreutils-8.22-24.el7.x86_64</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询rpm包自带的脚本</span></span><br><span class="line">rpm -q --scripts bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询包提供的能力（依赖）</span></span><br><span class="line">rpm -q --provides bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询指定的能力由那个包所提供</span></span><br><span class="line">rpm -q --whatprovides bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询指定的能力被那个包依赖</span></span><br><span class="line">rpm -q --whatrequires bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询指定的程序包所依赖的能力</span></span><br><span class="line">rpm -R </span><br></pre></td></tr></table></figure><h5 id="17-3-3-3-rpm-包完整性校验"><a href="#17-3-3-3-rpm-包完整性校验" class="headerlink" title="17.3.3.3 rpm 包完整性校验"></a>17.3.3.3 rpm 包完整性校验</h5><p>在安装包时，系统也会检查包的来源是否合法</p><p>在检查包的来源和完整性之前，必须导入所需要的公钥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ls -l  /etc/pki/rpm-gpg</span><br><span class="line"></span><br><span class="line">-rw-r--r--. 1 root root 1690 Nov 23  2020 RPM-GPG-KEY-CentOS-7</span><br><span class="line">-rw-r--r--. 1 root root 1004 Nov 23  2020 RPM-GPG-KEY-CentOS-Debug-7</span><br><span class="line">-rw-r--r--. 1 root root 1690 Nov 23  2020 RPM-GPG-KEY-CentOS-Testing-7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">导入公钥</span></span><br><span class="line">rpm --import RPM-GPG-KEY-CentOS-7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询安装好的密钥</span></span><br><span class="line">rpm -qa &quot;gpg-pubkey*&quot;、</span><br><span class="line">输出：gpg-pubkey-f4a80eb5-53a7ff4b</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询公钥信息</span></span><br><span class="line">rpm -qi gpg-pubkey-f4a80eb5-53a7ff4b</span><br></pre></td></tr></table></figure><p>检查包的完整性签名</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -K kernel-3.10.0-1160.el7.x86_64</span><br></pre></td></tr></table></figure><h5 id="17-3-3-4-rpm-包数据库"><a href="#17-3-3-4-rpm-包数据库" class="headerlink" title="17.3.3.4 rpm 包数据库"></a>17.3.3.4 rpm 包数据库</h5><p>软件在安装时，会将包里的每个文件的元数据，如:大小，权限，所有者，时间等记录至rpm相关数据库中，可以用来检查包中的文件是否和当初安装时有所变化</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">S文件大小不匹配。</span><br><span class="line">M文件的权限、类型等模式不匹配。</span><br><span class="line">5校验和（以前是 MD5 校验和）不匹配。</span><br><span class="line">D设备的主/次编号不匹配。</span><br><span class="line">L符号链接的目标路径不匹配。</span><br><span class="line">U文件的用户所有权不匹配。</span><br><span class="line">G文件的组所有权不匹配。</span><br><span class="line">T文件的修改时间不匹配。</span><br><span class="line">P文件的能力（capabilities）不匹配。</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查已安装的rpm的完整性，无输出，就是完整</span></span><br><span class="line">rpm -V centos-release </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查所有已安装的rpm的完整性，无输出，就是完整</span></span><br><span class="line">rpm -Va</span><br></pre></td></tr></table></figure><p>重建rpm包数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看rpm包数据库文件</span></span><br><span class="line">ls  /var/lib/rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初始化，如果事先不存在数据库，则新建，如果存在，不执行任何操作</span></span><br><span class="line">rpm --initdb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重建已安装的包头的数据库索目录</span></span><br><span class="line">rpm --rebuilddb </span><br></pre></td></tr></table></figure><h1 id="18-yum-和-dnf"><a href="#18-yum-和-dnf" class="headerlink" title="18. yum 和 dnf"></a>18. yum 和 dnf</h1><h3 id="18-1-yum-相关配置文件"><a href="#18-1-yum-相关配置文件" class="headerlink" title="18.1 yum 相关配置文件"></a>18.1 yum 相关配置文件</h3><p>仓库公共配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/yum.conf</span><br><span class="line">[main]</span><br><span class="line">gpgcheck=1校验安装包的数字签名</span><br><span class="line">installonly_limit=3同时可以安装3个包，最小值为2，如设置为0或1，为不限制</span><br><span class="line">clean_requirements_on_remove=True卸载包时也卸载相关依赖</span><br><span class="line">best=True多个相同的包选择高版本的包，即使缺少包的依赖</span><br><span class="line">skip_if_unavailable=False当存储库不可用时是否跳过它</span><br></pre></td></tr></table></figure><p>仓库配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/etc/yum.repos.d/*.repo</span><br><span class="line"></span><br><span class="line">[base]</span><br><span class="line">name=CentOS-$releasever - Base</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">baseurl=http://mirror.centos.org/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure><h3 id="18-2-yum-配置文件内置变量"><a href="#18-2-yum-配置文件内置变量" class="headerlink" title="18.2 yum 配置文件内置变量"></a>18.2 yum 配置文件内置变量</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">releasever当前OS的发型版的主版本号，如6，7，8</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="built_in">arch</span>cpu架构，如i686，x86_64</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">basearch系统基础平台：i386，X86_64</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">contentdir表示目录，比如centos-8，centos-7</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">YUM0-<span class="variable">$YUM9</span>自定义变量</span></span><br></pre></td></tr></table></figure><h3 id="18-3-yum-常用指令"><a href="#18-3-yum-常用指令" class="headerlink" title="18.3 yum 常用指令"></a>18.3 yum 常用指令</h3><h4 id="18-3-1-显示仓库列表"><a href="#18-3-1-显示仓库列表" class="headerlink" title="18.3.1 显示仓库列表"></a>18.3.1 显示仓库列表</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认显示启用的仓库</span></span><br><span class="line">yum repolist [ all | enabled | disabled ]</span><br></pre></td></tr></table></figure><h4 id="18-3-2-永久启用-禁用仓库"><a href="#18-3-2-永久启用-禁用仓库" class="headerlink" title="18.3.2 永久启用&#x2F;禁用仓库"></a>18.3.2 永久启用&#x2F;禁用仓库</h4><p>该功能来自yum -y install yum-utils</p><p>可以生成yum仓库的配置文件及启用或禁用仓库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成仓库配置文件</span></span><br><span class="line">yum-config-manager -add-repo URL或file</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启用仓库</span></span><br><span class="line">yum-config-manager --enable &quot;仓库名称&quot;   </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁用仓库</span></span><br><span class="line">yum-config-manager --disable &quot;仓库名称&quot;</span><br></pre></td></tr></table></figure><h4 id="18-3-3-指定仓库安装软件包"><a href="#18-3-3-指定仓库安装软件包" class="headerlink" title="18.3.3 指定仓库安装软件包"></a>18.3.3 指定仓库安装软件包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--disablerepo=仓库名临时禁用某个仓库</span><br><span class="line">--enablerepo=仓库名临时启用某个仓库</span><br><span class="line"></span><br><span class="line">yum -y --disablerepo=* --enablerepo=指定的仓库名称软件包名</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum list显示所有仓库的程序包</span><br><span class="line">yum -y reinstall 重装程序包</span><br><span class="line">yum update更新程序包</span><br><span class="line">yum clean all清理元数据缓存</span><br><span class="line">yum makecache下载元数据缓存（不是必须）</span><br><span class="line">yum provides 查看该特性属于那个安装包</span><br><span class="line">--disablerepo=官方仓库名 安装时,将禁用官方仓库,使用其他仓库来安装</span><br><span class="line">--enablerepo=仓库名称 指定仓库,来安装rpm包</span><br></pre></td></tr></table></figure><h4 id="18-3-4-查询软件包详细信息"><a href="#18-3-4-查询软件包详细信息" class="headerlink" title="18.3.4 查询软件包详细信息"></a>18.3.4 查询软件包详细信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum info 软件包名</span><br></pre></td></tr></table></figure><h4 id="18-3-5-查询特性由那个程序包提供"><a href="#18-3-5-查询特性由那个程序包提供" class="headerlink" title="18.3.5 查询特性由那个程序包提供"></a>18.3.5 查询特性由那个程序包提供</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum provides 文件或指令</span><br></pre></td></tr></table></figure><h4 id="18-3-6-指定关键字查询程序包"><a href="#18-3-6-指定关键字查询程序包" class="headerlink" title="18.3.6 指定关键字查询程序包"></a>18.3.6 指定关键字查询程序包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum search 关键字</span><br></pre></td></tr></table></figure><h4 id="18-3-7-查询包依赖的能力"><a href="#18-3-7-查询包依赖的能力" class="headerlink" title="18.3.7 查询包依赖的能力"></a>18.3.7 查询包依赖的能力</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum deplist 程序包名</span><br></pre></td></tr></table></figure><h4 id="18-3-8-安装或升级时忽略某个包"><a href="#18-3-8-安装或升级时忽略某个包" class="headerlink" title="18.3.8 安装或升级时忽略某个包"></a>18.3.8 安装或升级时忽略某个包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -x 程序包名</span><br></pre></td></tr></table></figure><h4 id="18-3-9-重新安装程序包"><a href="#18-3-9-重新安装程序包" class="headerlink" title="18.3.9 重新安装程序包"></a>18.3.9 重新安装程序包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y reinstall 程序包名</span><br></pre></td></tr></table></figure><h4 id="18-3-8-更新软件包"><a href="#18-3-8-更新软件包" class="headerlink" title="18.3.8 更新软件包"></a>18.3.8 更新软件包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查可用升级</span></span><br><span class="line">yum check-update </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新nginx</span></span><br><span class="line">yum update nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新整个操作系统</span></span><br><span class="line">yum update</span><br></pre></td></tr></table></figure><h4 id="18-3-9-yum-history"><a href="#18-3-9-yum-history" class="headerlink" title="18.3.9 yum history"></a>18.3.9 yum history</h4><p>yum 执行安装卸载命令会记录到相关日志中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /var/log/yum.log</span><br><span class="line">cat /var/log/dnf.log</span><br></pre></td></tr></table></figure><p>yum 事务历史</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">yum history</span><br><span class="line"></span><br><span class="line">ID     | Login user               | Date and time    | Action(s)      | Altered</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">     3 | root &lt;root&gt;              | 2023-11-02 17:49 | Install        |   31   </span><br><span class="line">     2 | root &lt;root&gt;              | 2023-11-02 13:15 | I, U           |  154   </span><br><span class="line">     1 | System &lt;unset&gt;           | 2023-08-21 18:01 | Install        |  300 </span><br><span class="line">     </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看2号事件安装的包</span></span><br><span class="line">yum history info 2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">撤销2号事件安装的包</span></span><br><span class="line">yum history undo 2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新执行2号事件</span></span><br><span class="line">yum history redo 2</span><br></pre></td></tr></table></figure><h3 id="18-4-yum-元数据缓存"><a href="#18-4-yum-元数据缓存" class="headerlink" title="18.4 yum 元数据缓存"></a>18.4 yum 元数据缓存</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum缓存存放的路径</span></span><br><span class="line">ls /var/cache/yum/x86_64/7/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清理所有仓库元数据缓存</span></span><br><span class="line">yum clean all</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新构建缓存</span></span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><h3 id="18-4-配置-epel-源"><a href="#18-4-配置-epel-源" class="headerlink" title="18.4 配置 epel 源"></a>18.4 配置 epel 源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">阿里云</span></span><br><span class="line">curl -o /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">USTC</span></span><br><span class="line">yum install -y epel-release.noarch</span><br><span class="line">sed -i &#x27;s|^metalink=|#metalink=|g&#x27; /etc/yum.repos.d/epel.repo</span><br><span class="line">sed -i &#x27;s|^#baseurl=https\?://download.fedoraproject.org/pub/epel/|baseurl=https://mirrors.ustc.edu.cn/epel/|g&#x27; /etc/yum.repos.d/epel.repo</span><br><span class="line">sed -i &#x27;s|^#baseurl=https\?://download.example/pub/epel/|baseurl=https://mirrors.ustc.edu.cn/epel/|g&#x27; /etc/yum.repos.d/epel.repo</span><br></pre></td></tr></table></figure><h3 id="18-5-配置光盘源仓库"><a href="#18-5-配置光盘源仓库" class="headerlink" title="18.5 配置光盘源仓库"></a>18.5 配置光盘源仓库</h3><p>&#x3D;&#x3D;仓库路径到repodata的父目录止&#x3D;&#x3D;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/CD.repo</span><br><span class="line">[CD-base]</span><br><span class="line">name=CentOS-$releasever - CD Base</span><br><span class="line">baseurl=file:///media/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure><h3 id="18-6-yum-升级内核"><a href="#18-6-yum-升级内核" class="headerlink" title="18.6 yum 升级内核"></a>18.6 yum 升级内核</h3><p>网站：<a href="http://elrepo.org/tiki/HomePage">http://elrepo.org/tiki/HomePage</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum -y install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看仓库中的内核版本</span></span><br><span class="line">yum --enablerepo elrepo-kernel list | grep kernel</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装新内核</span></span><br><span class="line">yum --enablerepo elrepo-kernel install kernel-ml.x86_64 -y                        </span><br></pre></td></tr></table></figure><h3 id="18-7-rpm-程序包被破坏恢复方法"><a href="#18-7-rpm-程序包被破坏恢复方法" class="headerlink" title="18.7 rpm 程序包被破坏恢复方法"></a>18.7 rpm 程序包被破坏恢复方法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1.开机读进度条按一次Esc</span><br><span class="line"></span><br><span class="line">2.选择CD-ROM drive启动</span><br><span class="line"></span><br><span class="line">3.选择第三项Troubleshooting</span><br><span class="line"></span><br><span class="line">4.选择第二项Rescue a CentOS system救援模式</span><br><span class="line"></span><br><span class="line">5.等待进入选项界面输入1（Continue）</span><br><span class="line"></span><br><span class="line">6.此时可以看到chroot /mnt/sysimage （根已经被挂载到了/mnt/sysimage）</span><br><span class="line"></span><br><span class="line">7.please press &lt;return&gt; to get a shell. 按回车，开启shell</span><br><span class="line"></span><br><span class="line">8.此时使用光盘启动，使用的是光盘内的操作系统</span><br><span class="line"></span><br><span class="line">9.使用光盘内的rpm程序包安装rpm</span><br><span class="line">mkdir /mnt/cdrom</span><br><span class="line">mount /dev/sr0 /mnt/cdrom</span><br><span class="line">rpm -ivh /mnt/cdrom/Packages/rpm-4.11.3-40.e17.x86_64.rpm --root=/mnt/sysimage</span><br><span class="line"></span><br><span class="line">10.Ctrl+Alt+Delete 或 reboot 重启操作系统</span><br></pre></td></tr></table></figure><h3 id="18-8-包组管理"><a href="#18-8-包组管理" class="headerlink" title="18.8. 包组管理"></a>18.8. 包组管理</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看包组</span></span><br><span class="line">yum grouplist</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装包组</span></span><br><span class="line">yum -y grouplist 包组</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载包组</span></span><br><span class="line">yum -y remove 包组</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看包组信息</span></span><br><span class="line">yum grouplist &quot;包组&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看包组内拥有那些程序包</span></span><br><span class="line">yum groupinfo &quot;包组&quot;</span><br></pre></td></tr></table></figure><h3 id="18-9-实现私有-yum-仓库"><a href="#18-9-实现私有-yum-仓库" class="headerlink" title="18.9 实现私有 yum 仓库"></a>18.9 实现私有 yum 仓库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h1 id="19-编译安装"><a href="#19-编译安装" class="headerlink" title="19. 编译安装"></a>19. 编译安装</h1><h3 id="19-1-源码编译介绍"><a href="#19-1-源码编译介绍" class="headerlink" title="19.1 源码编译介绍"></a>19.1 源码编译介绍</h3><p>&#x3D;&#x3D;程序包编译安装&#x3D;&#x3D;</p><p>源代码&gt;&gt;预处理&gt;&gt;编译&gt;&gt;汇编&gt;&gt;链接&gt;&gt;执行</p><p>&#x3D;&#x3D;程序包编译工具&#x3D;&#x3D;</p><p>c、c++的源码编译：使用make项目管理器</p><p>configure脚本&gt;&gt;Makefile.in&gt;&gt;Makefile</p><p>相关开发工具：</p><p>autoconf：生成configure脚本</p><p>automake：生成Malefile.in</p><p>java的源码编译：使用maven</p><p>&#x3D;&#x3D;C语言源代码编译安装过程&#x3D;&#x3D;</p><p>利用编译工具，通常只需要进行三个大的步骤</p><ul><li><p>.&#x2F;configure</p><ol><li>通过选项传递参数，指定安装路径，启用特性等。执行时会参考用户指定以及Makefile.in文件生成Makefile</li><li>检查依赖到的外部环境，如依赖的软件包</li></ol></li><li><p>make</p></li></ul><p>​根据 Makefile 文件，构建应用程序</p><ul><li>make install</li></ul><p>​复制文件到相应路径</p><p>注意：安装前可以通过查看README，INSTALL查看获取帮助</p><h3 id="19-2-编译安装准备"><a href="#19-2-编译安装准备" class="headerlink" title="19.2 编译安装准备"></a>19.2 编译安装准备</h3><p>准备：安装相关的依赖包</p><p>开发工具：make，gcc(c&#x2F;c++编译器GNU C Conplief)</p><p>开发环境：开发库（glibc：标准库），头文件，可安装开发组Development Tools</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生产实践,基于最小化安装的系统</span></span><br><span class="line">yum -y install gcc make gcc-c++ glibc glibc-devel pcre pcre-devel openssl openssl-devel systemd-devel zlib-devel vim lrzsz tree tmux lsof tcpdump wget net-tools iotop bc bzip2 zip unzip nfs-utils man-pages</span><br></pre></td></tr></table></figure><h3 id="19-3-编译安装-tree"><a href="#19-3-编译安装-tree" class="headerlink" title="19.3 编译安装 tree"></a>19.3 编译安装 tree</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建目录</span></span><br><span class="line">mkdir -p /apps/tree</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载tree</span></span><br><span class="line">curl -o /apps/tree-2.1.0.tgz http://mama.indstate.edu/users/ice/tree/src/tree-2.1.0.tgz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压tar包</span></span><br><span class="line">cd /apps ; tar -xvf tree-2.1.0.tgz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开始编译,由于这个包太简单了,所以直接提供了Makefile</span></span><br><span class="line">sed -i &#x27;s|/usr/local|/apps/tree|&#x27; /apps/tree-2.1.0/Makefile修改安装路径</span><br><span class="line">sed -i &#x27;s|VERSION=2.1.0|VERSION=10.0|&#x27; /apps/tree-2.1.0/Makefile自定义一下版本</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译安装</span></span><br><span class="line">make install</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置环境变量</span></span><br><span class="line">echo  &#x27;PATH=/apps/tree/bin/:$PATH&#x27; &gt; /etc/profile.d/tree.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重读shell环境</span></span><br><span class="line">exec $SHELL -l</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看tree版本</span></span><br><span class="line">tree --version</span><br></pre></td></tr></table></figure><h1 id="20-Ubuntu-软件管理"><a href="#20-Ubuntu-软件管理" class="headerlink" title="20. Ubuntu 软件管理"></a>20. Ubuntu 软件管理</h1><p>Debian软件包通常为预编译的二进制格式的扩展名”.deb”，类似rpm文件，因此安装快速，无需编译软件。包文件包括特定功能或软件所必需的文件、元数据和指令</p><ul><li>dpkg: package manager for Debian，类似于rpm，dpkg是基于Debian的系统的包管理器。可以安装，删除和构建软件包，但无法自动下载和安装软件包或其依赖项</li><li>apt: Advanced Packaging Tool，功能强大的软件管理工具，甚至可升级整个Ubuntu的系统，基于客户&#x2F;服务器架构</li></ul><h3 id="20-1-APT-工作原理"><a href="#20-1-APT-工作原理" class="headerlink" title="20.1 APT 工作原理"></a>20.1 APT 工作原理</h3><p>在服务器上先复制所有DEB包，然后用APT的分析工具genbasedir根据每个DEB 包的包头(Header) 信息对所有的DEB包进行分析，并将该分析结果记录在文件夹base内的一个DEB 索引清单文件中，一旦APT 服务器内的DEB有所变动，要使用genbasedir产生新的DEB索引清单。客户端在进行安装或升级时先要查询DEB索引清单，从而获知所有具有依赖关系的软件包，并一同下载到客户端以便安装。当客户端需要安装、升级或删除某个软件包时客户端计算机取得DEB索引清单压缩文件后，会将其解压置放于 ar&#x2F;cache&#x2F;apt&#x2F;，而客户端使用apt-get install或apt-get upgrade命令的时候，就会将这个文件夹内的数据和客户端计算机内的DEB数据库比对，知道哪些DEB已安装、未安装或是可以升级的</p><h3 id="20-2-dpkg-包管理器"><a href="#20-2-dpkg-包管理器" class="headerlink" title="20.2 dpkg 包管理器"></a>20.2 dpkg 包管理器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装包</span></span><br><span class="line">dpkg -i package.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除包（不建议，不自动卸载依赖于它的包）</span></span><br><span class="line">dpkg -r package.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除包（包括配置文件）</span></span><br><span class="line">dpkg -P package.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">列出当前已经安装的包，类似于rpm -qa</span></span><br><span class="line">dpkg -l </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示该包的简要说明，类似于rpm -qi</span></span><br><span class="line">dpkg -l package</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">列出该包的状态，包括详细信息，类似于rpm -qi</span></span><br><span class="line">dpkg -s package</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">列出该包中所包含的文件，类似于rpm -ql</span></span><br><span class="line">dpkg -L package</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">搜索包含pattern的包，类似于rpm -qf</span></span><br><span class="line">dpkg -S &lt;pattren&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置包，-a 使用 配置所有没有配置的软件包</span></span><br><span class="line">dpkg --configure package</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">列出deb包的内容，类似rpm -qpl</span></span><br><span class="line">dpkg -c package.deb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解开deb包的内容</span></span><br><span class="line">dpkg --unpack package.deb</span><br></pre></td></tr></table></figure><h3 id="20-3-apt"><a href="#20-3-apt" class="headerlink" title="20.3 apt"></a>20.3 apt</h3><p>Debian 使用apt 工具集来管理包系统，apt-get 是其中一个常用的命令行工具，另外一款较为流行的命令行与GUI兼顾的工具是 aptitude，之前最常用的 Linux 包管理命令都被分散在了 apt-get、apt-cache 和 apt-config 这三条命令中在2014年apt命令发布第一个稳定版，Ubuntu 16.04引入新特性之一便是 apt 命令，apt 命令解决了命令过于分散的问题，它包括 apt-get 命令出现以来使用最广泛的功能选项，以及 apt-cache 和 apt-config 命令中很少用到的功能。在使用apt 命令时，用户不必再由 apt-get 转到 apt-cache 或 apt-config，提供管理软件包所需的必要选项<br>apt 相当于apt-get、apt-cache和apt-config 中最常用命令选项的集合apt 具有更精减但足够的命令选项，而且参数选项的组织方式更为有效。此外，启用的几个特性也非常有帮助。例如:可以在使用 apt 命令安装或删除程序时看到进度条,apt 还会在更新存储库数据库时提示用户可升级的软件包个数<br>apt 与 apt-get 有一些类似的命令选项，但它并不能完全向下兼容 apt-get 命令,也即可用apt 替换部分 apt-get系列命令，但不是全部<br>apt命令用法<br>查看帮助:apt help</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装包</span></span><br><span class="line">apt install tree zip</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装图形桌面</span></span><br><span class="line">apt install ubuntu-desktop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除包</span></span><br><span class="line">aptremove treezip</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">说明：apt remove中添加--purge选项会删除包配置文件，谨慎使用</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">更新包索引，相当于yum clean all &amp;&amp; yum makecache（修改仓库以后必须执行）</span></span><br><span class="line">apt update</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">升级包：要升级系统，请首先更新软件包索引，再升级</span></span><br><span class="line">apt upgrade apache2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">apt列出仓库软件包，等于yum list</span></span><br><span class="line">apt list</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">搜索软件包</span></span><br><span class="line">apt search nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看某个安装包的详细信息</span></span><br><span class="line">apt show apache2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在线安装软件包</span></span><br><span class="line">apt install apache2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">卸载单个软件包，但是保留配置文件</span></span><br><span class="line">apt remove apache2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除安装包并解决依赖关系</span></span><br><span class="line">apt autoremove apache2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">卸载单个软件包删除配置文件</span></span><br><span class="line">apt purge apache2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">升级所有已安装且可升级到新版本的软件包</span></span><br><span class="line">apt upgrade</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">升级整个系统，必要时可以移除旧的软件包</span></span><br><span class="line">apt full-upgrade</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">编辑<span class="built_in">source</span>源文件</span></span><br><span class="line">apt edit-sources</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看仓库中那些软件包有那些版本可以安装</span></span><br><span class="line">apt-cache madison nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装软件包的时候指定安装具体的版本</span></span><br><span class="line">apt install nginx=1.14.0-0ubuntu1.6</span><br></pre></td></tr></table></figure><h3 id="20-4-配置-apt-仓库"><a href="#20-4-配置-apt-仓库" class="headerlink" title="20.4 配置 apt 仓库"></a>20.4 配置 apt 仓库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置阿里云apt仓库 ubuntu 20.04(focal)</span></span><br><span class="line">vim /etc/apt/sources.list</span><br><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb https://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb-src https://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">deb https://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure><h1 id="21-磁盘管理"><a href="#21-磁盘管理" class="headerlink" title="21. 磁盘管理"></a>21. 磁盘管理</h1><h3 id="21-1-Linux-磁盘标识"><a href="#21-1-Linux-磁盘标识" class="headerlink" title="21.1 Linux 磁盘标识"></a>21.1 Linux 磁盘标识</h3><h4 id="21-1-2-设备文件"><a href="#21-1-2-设备文件" class="headerlink" title="21.1.2 设备文件"></a>21.1.2 设备文件</h4><p>设备文件：关联至一个设备驱动程序（有点像硬件的软链接），进而能够跟与之对应的硬件设备进行通信</p><p>设备号码：主设备号（标识设备类型）、次设备号（标识同一类型下不同的设备）</p><p>设备类型：块设备（磁盘）、字符设备（键盘）</p><p>设备文件命名：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/dev/sdX# scsi、sata、sas、ide、usb</span><br><span class="line">/dev/nume0n1p5# nume协议</span><br></pre></td></tr></table></figure><p>虚部磁盘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/dev/vd</span><br><span class="line">/dev/xvd</span><br></pre></td></tr></table></figure><p>磁盘标识</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/dev/sda</span><br><span class="line">/dev/sdb</span><br><span class="line">/dev/sdc</span><br></pre></td></tr></table></figure><p>分区标识</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/dev/sda1</span><br><span class="line">/dev/sda2</span><br><span class="line">/dev/sda3</span><br></pre></td></tr></table></figure><h4 id="21-2-3-创建设备文件"><a href="#21-2-3-创建设备文件" class="headerlink" title="21.2.3 创建设备文件"></a>21.2.3 创建设备文件</h4><p>如果两个设备设备类型和设备编号一致,可以认为是同一个设备</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">brw-rw----. 1 123 disk 8, 0 Nov  4 13:47 /dev/sda1</span><br><span class="line">8 主设备号,标识设备类型</span><br><span class="line">0 次设备号,标识同一类型下不同的设备</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个和/dev/sda1一样的设备</span></span><br><span class="line">mknod /data/sda1 b 8 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">挂载</span></span><br><span class="line">mount /data/sda1 /data</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看两个目录,内容一致</span></span><br><span class="line">[root@Centos7-1 ~][0]$ ll /boot/ /data/</span><br><span class="line">/boot/:</span><br><span class="line">total 112032</span><br><span class="line">-rw-r--r--. 1 123 root   153562 Apr  1  2020 config-3.10.0-1127.el7.x86_64</span><br><span class="line">drwxr-xr-x. 3 123 root       17 Aug 21 18:01 efi</span><br><span class="line">drwxr-xr-x. 2 123 root       27 Aug 21 18:02 grub</span><br><span class="line">drwx------. 5 123 root       97 Aug 21 19:10 grub2</span><br><span class="line">-rw-------. 1 123 root 61878439 Aug 21 18:08 initramfs-0-rescue-57e6abd4afac4b96931cf5ca2015883e.img</span><br><span class="line">-rw-------. 1 123 root 21551304 Aug 21 18:11 initramfs-3.10.0-1127.el7.x86_64.img</span><br><span class="line">-rw-------. 1 123 root 13657368 Aug 21 19:06 initramfs-3.10.0-1127.el7.x86_64kdump.img</span><br><span class="line">-rw-r--r--. 1 123 root   320512 Apr  1  2020 symvers-3.10.0-1127.el7.x86_64.gz</span><br><span class="line">-rw-------. 1 123 root  3611662 Apr  1  2020 System.map-3.10.0-1127.el7.x86_64</span><br><span class="line">-rwxr-xr-x. 1 123 root  6762688 Aug 21 18:08 vmlinuz-0-rescue-57e6abd4afac4b96931cf5ca2015883e</span><br><span class="line">-rwxr-xr-x. 1 123 root  6762688 Apr  1  2020 vmlinuz-3.10.0-1127.el7.x86_64</span><br><span class="line"></span><br><span class="line">/data/:</span><br><span class="line">total 112032</span><br><span class="line">-rw-r--r--. 1 123 root   153562 Apr  1  2020 config-3.10.0-1127.el7.x86_64</span><br><span class="line">drwxr-xr-x. 3 123 root       17 Aug 21 18:01 efi</span><br><span class="line">drwxr-xr-x. 2 123 root       27 Aug 21 18:02 grub</span><br><span class="line">drwx------. 5 123 root       97 Aug 21 19:10 grub2</span><br><span class="line">-rw-------. 1 123 root 61878439 Aug 21 18:08 initramfs-0-rescue-57e6abd4afac4b96931cf5ca2015883e.img</span><br><span class="line">-rw-------. 1 123 root 21551304 Aug 21 18:11 initramfs-3.10.0-1127.el7.x86_64.img</span><br><span class="line">-rw-------. 1 123 root 13657368 Aug 21 19:06 initramfs-3.10.0-1127.el7.x86_64kdump.img</span><br><span class="line">-rw-r--r--. 1 123 root   320512 Apr  1  2020 symvers-3.10.0-1127.el7.x86_64.gz</span><br><span class="line">-rw-------. 1 123 root  3611662 Apr  1  2020 System.map-3.10.0-1127.el7.x86_64</span><br><span class="line">-rwxr-xr-x. 1 123 root  6762688 Aug 21 18:08 vmlinuz-0-rescue-57e6abd4afac4b96931cf5ca2015883e</span><br><span class="line">-rwxr-xr-x. 1 123 root  6762688 Apr  1  2020 vmlinuz-3.10.0-1127.el7.x86_64</span><br></pre></td></tr></table></figure><h3 id="21-2-硬盘类型"><a href="#21-2-硬盘类型" class="headerlink" title="21.2 硬盘类型"></a>21.2 硬盘类型</h3><h4 id="21-2-3-查看硬盘类型"><a href="#21-2-3-查看硬盘类型" class="headerlink" title="21.2.3 查看硬盘类型"></a>21.2.3 查看硬盘类型</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1表示机械硬盘,0表示固态或其他</span></span><br><span class="line">lsblk -d -o name,rota</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看Linux的块设备</span></span><br><span class="line">ls /sys/block</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1表示机械硬盘,0表示固态或其他</span></span><br><span class="line">cat /sys/block/sda/queue/rotational</span><br></pre></td></tr></table></figure><h4 id="21-2-4-硬盘接口类型介绍"><a href="#21-2-4-硬盘接口类型介绍" class="headerlink" title="21.2.4 硬盘接口类型介绍"></a>21.2.4 硬盘接口类型介绍</h4><ul><li>IDE：133MB&#x2F;s</li><li>SCSI：640MB&#x2F;s</li><li>SATA：6Gbps，SATA数据接口与电源接口分开，即两条线</li><li>SAS：6Gbps，SAS是一整条线，数据接口和电源接口一体化，SAS中是包含电源线的，二SATA中不包含电源线，SATA标准其实是SAS标准的一个子集，二者可建通，SATA硬盘可以插在SAS主板上，反之不行</li><li>USB：480MB&#x2F;s</li><li>M.2：</li></ul><p>注意：Nvme协议硬盘速度是最快的</p><h3 id="21-3-机械硬盘和固态硬盘"><a href="#21-3-机械硬盘和固态硬盘" class="headerlink" title="21.3 机械硬盘和固态硬盘"></a>21.3 机械硬盘和固态硬盘</h3><p>机械硬盘结构</p><p><img src="C:\Users\张宇\AppData\Roaming\Typora\typora-user-images\image-20231104152148740.png" alt="image-20231104152148740"></p><p>固态硬盘结构（SSD）</p><p><img src="C:\Users\张宇\AppData\Roaming\Typora\typora-user-images\image-20231104152313536.png" alt="image-20231104152313536"></p><h3 id="21-4-硬盘分区介绍"><a href="#21-4-硬盘分区介绍" class="headerlink" title="21.4 硬盘分区介绍"></a>21.4 硬盘分区介绍</h3><h4 id="21-4-1-不重启扫描新硬盘"><a href="#21-4-1-不重启扫描新硬盘" class="headerlink" title="21.4.1 不重启扫描新硬盘"></a>21.4.1 不重启扫描新硬盘</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方法一</span></span><br><span class="line">echo - - - &gt; /sys/class/scsi_host/host0/scan</span><br><span class="line">echo - - - &gt; /sys/class/scsi_host/host1/scan</span><br><span class="line">echo - - - &gt; /sys/class/scsi_host/host2/scan</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方法二</span></span><br><span class="line">for host in $(/bin/ls /sys/class/scsi_host/);do</span><br><span class="line">echo &quot;- - -&quot; &gt; /sys/class/scsi_host/$&#123;host&#125;/scan;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h4 id="21-4-2-MBR-分区"><a href="#21-4-2-MBR-分区" class="headerlink" title="21.4.2 MBR 分区"></a>21.4.2 MBR 分区</h4><p>硬盘即使在不分区的情况下也可以使用，那么硬盘为什么分区：</p><ul><li>优化I&#x2F;O性能</li><li>实现磁盘空间配额</li><li>提高修复速度</li><li>隔离系统和程序</li><li>安装多个OS</li><li>采用不同文件系统</li></ul><p>MBR：使用32位表示扇区数，分区不超过2T</p><p>0磁道0扇区（第一个扇区）：共512字节，其中前446字节用来记录启动计算机的主引导程序，64字节用来记录分区表，其中每16个字节记录一个分区，还有2个字节表示55aa表示第一个扇区结束（结束标志），所以MBR分区中一块硬盘最多有4个主分区，也可以3个主分区+1扩展分区。扩展分区可以创建N个逻辑分区。</p><p>MBR分区：主分区和扩展分区对应标识1-4，逻辑分区从5开始</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看第一个扇区</span></span><br><span class="line">[root@Centos7-1 ~][0]$ hexdump -C -n 512 /dev/sda</span><br><span class="line">00000000  eb 63 90 10 8e d0 bc 00  b0 b8 00 00 8e d8 8e c0  |.c..............|</span><br><span class="line">00000010  fb be 00 7c bf 00 06 b9  00 02 f3 a4 ea 21 06 00  |...|.........!..|</span><br><span class="line">00000020  00 be be 07 38 04 75 0b  83 c6 10 81 fe fe 07 75  |....8.u........u|</span><br><span class="line">00000030  f3 eb 16 b4 02 b0 01 bb  00 7c b2 80 8a 74 01 8b  |.........|...t..|</span><br><span class="line">00000040  4c 02 cd 13 ea 00 7c 00  00 eb fe 00 00 00 00 00  |L.....|.........|</span><br><span class="line">00000050  00 00 00 00 00 00 00 00  00 00 00 80 01 00 00 00  |................|</span><br><span class="line">00000060  00 00 00 00 ff fa 90 90  f6 c2 80 74 05 f6 c2 70  |...........t...p|</span><br><span class="line">00000070  74 02 b2 80 ea 79 7c 00  00 31 c0 8e d8 8e d0 bc  |t....y|..1......|</span><br><span class="line">00000080  00 20 fb a0 64 7c 3c ff  74 02 88 c2 52 be 05 7c  |. ..d|&lt;.t...R..||</span><br><span class="line">00000090  b4 41 bb aa 55 cd 13 5a  52 72 3d 81 fb 55 aa 75  |.A..U..ZRr=..U.u|</span><br><span class="line">000000a0  37 83 e1 01 74 32 31 c0  89 44 04 40 88 44 ff 89  |7...t21..D.@.D..|</span><br><span class="line">000000b0  44 02 c7 04 10 00 66 8b  1e 5c 7c 66 89 5c 08 66  |D.....f..\|f.\.f|</span><br><span class="line">000000c0  8b 1e 60 7c 66 89 5c 0c  c7 44 06 00 70 b4 42 cd  |..`|f.\..D..p.B.|</span><br><span class="line">000000d0  13 72 05 bb 00 70 eb 76  b4 08 cd 13 73 0d 5a 84  |.r...p.v....s.Z.|</span><br><span class="line">000000e0  d2 0f 83 de 00 be 85 7d  e9 82 00 66 0f b6 c6 88  |.......&#125;...f....|</span><br><span class="line">000000f0  64 ff 40 66 89 44 04 0f  b6 d1 c1 e2 02 88 e8 88  |d.@f.D..........|</span><br><span class="line">00000100  f4 40 89 44 08 0f b6 c2  c0 e8 02 66 89 04 66 a1  |.@.D.......f..f.|</span><br><span class="line">00000110  60 7c 66 09 c0 75 4e 66  a1 5c 7c 66 31 d2 66 f7  |`|f..uNf.\|f1.f.|</span><br><span class="line">00000120  34 88 d1 31 d2 66 f7 74  04 3b 44 08 7d 37 fe c1  |4..1.f.t.;D.&#125;7..|</span><br><span class="line">00000130  88 c5 30 c0 c1 e8 02 08  c1 88 d0 5a 88 c6 bb 00  |..0........Z....|</span><br><span class="line">00000140  70 8e c3 31 db b8 01 02  cd 13 72 1e 8c c3 60 1e  |p..1......r...`.|</span><br><span class="line">00000150  b9 00 01 8e db 31 f6 bf  00 80 8e c6 fc f3 a5 1f  |.....1..........|</span><br><span class="line">00000160  61 ff 26 5a 7c be 80 7d  eb 03 be 8f 7d e8 34 00  |a.&amp;Z|..&#125;....&#125;.4.|</span><br><span class="line">00000170  be 94 7d e8 2e 00 cd 18  eb fe 47 52 55 42 20 00  |..&#125;.......GRUB .|</span><br><span class="line">00000180  47 65 6f 6d 00 48 61 72  64 20 44 69 73 6b 00 52  |Geom.Hard Disk.R|</span><br><span class="line">00000190  65 61 64 00 20 45 72 72  6f 72 0d 0a 00 bb 01 00  |ead. Error......|</span><br><span class="line">000001a0  b4 0e cd 10 ac 3c 00 75  f4 c3 00 00 00 00 00 00  |.....&lt;.u........|</span><br><span class="line">000001b0  00 00 00 00 00 00 00 00  61 6c 01 00 00 00 80 20  |........al..... |</span><br><span class="line">000001c0  21 00 83 aa 28 82 00 08  00 00 00 00 20 00 00 aa  |!...(....... ...|</span><br><span class="line">000001d0  29 82 8e fe ff ff 00 08  20 00 00 f8 5f 02 00 00  |)....... ..._...|</span><br><span class="line">000001e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line">000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|</span><br><span class="line">00000200</span><br></pre></td></tr></table></figure><h5 id="21-4-2-1-备份-还原分区表"><a href="#21-4-2-1-备份-还原分区表" class="headerlink" title="21.4.2.1 备份&#x2F;还原分区表"></a>21.4.2.1 备份&#x2F;还原分区表</h5><p>&#x3D;&#x3D;注意：备份的分区表需要放在远程主机，否则备份没有任何意义&#x3D;&#x3D;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份分区表</span></span><br><span class="line">dd if=/dev/sda of=MBR.bak bs=1 count=64 skip=446</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">破坏分区表</span></span><br><span class="line">dd if=/dev/zero of=/dev/sda bs=1 count=64 seek=446</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启服务器</span></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line">1.开机读进度条按一次Esc</span><br><span class="line"></span><br><span class="line">2.选择CD-ROM drive启动</span><br><span class="line"></span><br><span class="line">3.选择第三项Troubleshooting</span><br><span class="line"></span><br><span class="line">4.选择第二项Rescue a CentOS system救援模式</span><br><span class="line"></span><br><span class="line">5.等待进入选项界面输入3（skip to shell）</span><br><span class="line"></span><br><span class="line">6.此时可以看到chroot /mnt/sysimage （根已经被挂载到了/mnt/sysimage）</span><br><span class="line"></span><br><span class="line">7.此时使用光盘启动，使用的是光盘内的操作系统</span><br><span class="line"></span><br><span class="line">7.配置临时IP（因为备份如果放在本机是没有任何意义的）</span><br><span class="line">ip addr add 192.168.1.7/24 dev ens33</span><br><span class="line"></span><br><span class="line">9.在故障服务器上使用scp将192.168.1.17的/root/MBR.bak拷贝到本机</span><br><span class="line">scp 192.168.1.17:/root/MBR.bak .</span><br><span class="line"></span><br><span class="line">10.还原分区表</span><br><span class="line">dd if=MBR.bak of=/dev/sda bs=1 seek=446</span><br><span class="line"></span><br><span class="line">11.Ctrl+Alt+Delete 或 reboot 重启操作系统</span><br></pre></td></tr></table></figure><h4 id="21-4-3-GPT-分区"><a href="#21-4-3-GPT-分区" class="headerlink" title="21.4.3 GPT 分区"></a>21.4.3 GPT 分区</h4><p>GPT分区：GUID最大支持128个主分区，使用64位，支持8Z（512byte），64Z（4096byte）空间</p><p>UEFI：统一可扩展固件接口，硬件支持GPT，使得操作系统可以启动</p><p>GPT分区结构分为4个区域；</p><ul><li>GPT头</li><li>分区表</li><li>GPT分区</li><li>备份区域</li></ul><h3 id="21-5-分区管理"><a href="#21-5-分区管理" class="headerlink" title="21.5 分区管理"></a>21.5 分区管理</h3><h4 id="21-5-1-查看块设备"><a href="#21-5-1-查看块设备" class="headerlink" title="21.5.1 查看块设备"></a>21.5.1 查看块设备</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br></pre></td></tr></table></figure><h4 id="21-5-2-parted"><a href="#21-5-2-parted" class="headerlink" title="21.5.2 parted"></a>21.5.2 parted</h4><p>&#x3D;&#x3D;parted的所有操作都是立即生效，小心使用&#x3D;&#x3D;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">parted [选项] 设备 [命令]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建分区表msdos（MBR）|gpt</span></span><br><span class="line">parted /dev/sdb mklabel gpt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建1个分区,分配200M空间</span></span><br><span class="line">parted /dev/sdb mkpart primary 1 200</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建2个分区,分配200M空间</span></span><br><span class="line">parted /dev/sdb mkpart primary 201 500</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看创建的分区</span></span><br><span class="line">parted /deb/sdb print</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除分区第一个分区</span></span><br><span class="line">parted /deb/sdb rm 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清空分区表</span></span><br><span class="line">dd if=/dev/zero of=/dev/sdb bs=1 count=66 seek=446</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清空分区</span></span><br><span class="line">dd if=/dev/zero of=/dev/sdb bs=1 count=64 seek=446</span><br></pre></td></tr></table></figure><h4 id="21-5-3-fdisk-（MBR分区管理）"><a href="#21-5-3-fdisk-（MBR分区管理）" class="headerlink" title="21.5.3 fdisk （MBR分区管理）"></a>21.5.3 fdisk （MBR分区管理）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fdisk 硬盘</span><br><span class="line"></span><br><span class="line">m查看帮助</span><br><span class="line">p显示当前分区情况</span><br><span class="line">n创建分区</span><br><span class="line">d删除分区</span><br><span class="line">g创建GPT分区</span><br><span class="line">o创建MBR分区</span><br><span class="line">t修改分区类型,list或L列出所有分区类型</span><br><span class="line">w保存退出</span><br><span class="line">q不保存退出</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">非交互式创建分区（实际是将交互式分区动作分解）</span></span><br><span class="line">echo -e &#x27;n\np\n\n\n+2G\nw\n&#x27; | fdisk /dev/sdb</span><br></pre></td></tr></table></figure><h4 id="21-5-4-gdisk（GPT分区管理）"><a href="#21-5-4-gdisk（GPT分区管理）" class="headerlink" title="21.5.4 gdisk（GPT分区管理）"></a>21.5.4 gdisk（GPT分区管理）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdisk 硬盘</span><br></pre></td></tr></table></figure><h4 id="21-5-5-重读分区表"><a href="#21-5-5-重读分区表" class="headerlink" title="21.5.5 重读分区表"></a>21.5.5 重读分区表</h4><p>重新读取分区表（适合于除了centos6以外的其他版本)，向内核注册新的分区表</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">partprobe</span><br><span class="line"></span><br><span class="line">partx -a /dev/sdb Centos 6把磁盘的分区表让内存读取（适合增加分区操作）</span><br><span class="line">partx -d --nr 1-4 /dev/sdbCentos 6把磁盘的分区表让内存读取（适合删除分区操作）</span><br></pre></td></tr></table></figure><h1 id="22-文件系统"><a href="#22-文件系统" class="headerlink" title="22. 文件系统"></a>22. 文件系统</h1><p>文件系统是操作系统用于明确存储设备或分区上的文件的方法和数据结构，即在存储设备上组织文件的方法。操作系统中负责管理和存储文件信息的软件结构称为文件管理系统，简称文件系统从系统角度来看，文件系统是对文件存储设备的空间进行组织和分配，负责文件存储并对存入的文件进行保护和检索的系统。具体地说，它负责为用户建立文件，存入、读出、修改、转储文件，控制文件的存取，安全控制，日志，压缩，加密等</p><h3 id="22-1-查看当前系统支持的文件系统"><a href="#22-1-查看当前系统支持的文件系统" class="headerlink" title="22.1 查看当前系统支持的文件系统"></a>22.1 查看当前系统支持的文件系统</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -ld /lib/modules/$(uname -r)/kernel/fs</span><br></pre></td></tr></table></figure><h3 id="22-2-Linux-常用文件系统"><a href="#22-2-Linux-常用文件系统" class="headerlink" title="22.2 Linux 常用文件系统"></a>22.2 Linux 常用文件系统</h3><ul><li><p>ext2：适用于分区不是很大，文件更新也不频繁的情况，例如&#x2F;boot</p></li><li><p>ext3：ext2的改进版，支持日志功能，能够帮助系统从非正常关机导致的异常中恢复</p></li><li><p>ext4：是ext文件系统的最新版本，提供了很多新的特性，包括秒级的时间戳，创建和使用巨型文件（16TB），最大1EB的文件系统，以及速度的提升</p></li><li><p>xfs：最大支持8EB的文件系统</p></li><li><p>swap：交换分区，模拟内存</p></li></ul><h3 id="22-3-创建文件系统"><a href="#22-3-创建文件系统" class="headerlink" title="22.3 创建文件系统"></a>22.3 创建文件系统</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 [选项] 分区</span><br><span class="line"></span><br><span class="line">-t &#123;ext2|ext3|ext4|xfs&#125;指定文件系统类型</span><br><span class="line">-b &#123;1024|2048|4096&#125;指定块block大小,一个文件分配的最小空间</span><br><span class="line">-L &quot;LABEL&quot;设置卷标,比如可以写上挂载点</span><br><span class="line">-f强制创建文件系统</span><br><span class="line">-j相当于mkfs -t ext3</span><br><span class="line">-i?    为数据空间中每多少个字节创建一个inode；不应该小于block大小</span><br><span class="line">-N?指定分区中创建多少个inode</span><br><span class="line">-l一个inode记录占用的磁盘空间大小 128--4096</span><br><span class="line">-m  0.05 默认5%，为管理人员预留空间占总空间的百分比（可以写小数）</span><br><span class="line">-O启用或关闭指定特性,去百度</span><br></pre></td></tr></table></figure><h3 id="22-4-查看分区信息"><a href="#22-4-查看分区信息" class="headerlink" title="22.4 查看分区信息"></a>22.4 查看分区信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">blkid [选项]</span><br><span class="line"></span><br><span class="line">-U指定UUID来查找对应设备</span><br><span class="line">-L指定&quot;卷标&quot;来查找对应设备</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查找分区</span><br><span class="line">findfs [选项]</span><br><span class="line"></span><br><span class="line">UUID=使用UUID搜索</span><br><span class="line">LABEL=使用&quot;卷标&quot;搜索</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">findfs UUID=4f3dce7e-d57d-41c5-b916-2982dfd98405</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断目录是否是挂载点</span></span><br><span class="line">findmnt /boot</span><br></pre></td></tr></table></figure><h3 id="22-5-重新设定文件系统参数"><a href="#22-5-重新设定文件系统参数" class="headerlink" title="22.5 重新设定文件系统参数"></a>22.5 重新设定文件系统参数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">tune2fs [选项] 分区</span><br><span class="line"></span><br><span class="line">-l查看指定文件系统超级块信息,xfs文件系统使用 xfs.info /目录</span><br><span class="line">-L&quot;LABEL&quot; 修改卷标</span><br><span class="line">-m? 修改预留给管理员的空间百分比</span><br><span class="line">-j将ext2升级为ext3</span><br><span class="line">-U UUID 修改UUID号 </span><br><span class="line">-O文件系统属性启用或者禁用</span><br><span class="line">-o调整文件系统的默认挂载选项</span><br><span class="line">-h查看超级块信息,不显示分组</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改文件系统UUID</span></span><br><span class="line">umount /dev/sdb1</span><br><span class="line">tune2fs -U $(uuidgen) /dev/sdb1</span><br></pre></td></tr></table></figure><h3 id="22-7-文件系统挂载"><a href="#22-7-文件系统挂载" class="headerlink" title="22.7 文件系统挂载"></a>22.7 文件系统挂载</h3><p>挂载规则：<br>一个挂载点同时只能挂载一个设备<br>一个挂载点同时挂载了多个设备，只能看到最后一个设备的数据，其他设备上的数据将被隐藏<br>一个设备可以同时挂载到多个挂载点<br>通常挂载点一般是已存在且为空的目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">mount [选项] 块设备 挂载点</span><br><span class="line"></span><br><span class="line">-text4 指定要挂载的设备上的文件系统类型</span><br><span class="line">-r只读挂载</span><br><span class="line">-w读写挂载</span><br><span class="line">-n不更新/etc/mtab，mount命令不可见</span><br><span class="line">-a自动挂载所有支持自动挂载的设备（定义在/etc/fstab文件中，且挂载选项中有auto功能）</span><br><span class="line">-L&quot;LABEL&quot;以卷标指定挂载设备</span><br><span class="line">-U&quot;UUID&quot; 以UUID指定要挂载的设备</span><br><span class="line">-B --bind 绑定目录到另外一个目录</span><br><span class="line"></span><br><span class="line">-o options：（挂载文件系统的选项，多个选项使用逗号分隔）</span><br><span class="line">   async 异步模式，内存更改时，写入buffer，过一段时间再写到磁盘中</span><br><span class="line">   sync同步模式，内存更改时，同步写磁盘</span><br><span class="line">   atime/noatime 禁止目录和目录下文件更新时间,据说可以优化网站5%性能</span><br><span class="line">   diratime/nodirtime 目录的访问时间戳</span><br><span class="line">   auto/noauto是否支持开机自动挂载，是否支持-a</span><br><span class="line">   exec/noexec是否支持在文件系统上运行应用程序</span><br><span class="line">   dev/nodev是否支持在此文件系统上使用设备文件</span><br><span class="line">   suid/nosuid是否支持suid和sgid权限</span><br><span class="line">   remount 重新挂载</span><br><span class="line">   ro 只读 rw读写</span><br><span class="line">   user/nouser 是否允许普通用户挂载此设备，/etc/fstab使用</span><br><span class="line">   acl/noacl 启用此文件系统上的acl功能</span><br><span class="line">   loop分配一个loop设备,查看目录和loop设备关联性 losetup -a</span><br><span class="line">   _netdev 当网络可用时，才对网络资源进行挂载，NFS文件系统</span><br><span class="line">   defaults相当于rw，suid，dev，exec，auto，nouser，async</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">挂载</span></span><br><span class="line">mount /dev/sdb1 /pic</span><br><span class="line">mounnt UUID=&quot;9866f965-43cf-472b-b886-24b11f89afe6&quot; /pic</span><br><span class="line">mount -U 9866f965-43cf-472b-b886-24b11f89afe6 /pic</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将文件夹挂载到文件夹</span></span><br><span class="line">mount -B /etc /mnt/etc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">取消挂载</span></span><br><span class="line">umount /pic</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新挂载</span></span><br><span class="line">mount -o remount,rw /pic</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看设备正在被那些进程或用户使用</span></span><br><span class="line">fuser -v /mysql</span><br><span class="line">lsof /mysql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">杀掉所有正在使用的进程</span></span><br><span class="line">kill -9 24153</span><br><span class="line">fuser -km /mysql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看某个设备所有的挂载点</span></span><br><span class="line">mount /dev/sdb1</span><br><span class="line">mount</span><br></pre></td></tr></table></figure><h3 id="22-8-对文件创建文件系统"><a href="#22-8-对文件创建文件系统" class="headerlink" title="22.8 对文件创建文件系统"></a>22.8 对文件创建文件系统</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成一个空文件</span></span><br><span class="line">dd if=/dev/zero of=data.img bs=1M count=100</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建文件系统</span></span><br><span class="line">mkfs.ext4 data.img</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">挂载</span></span><br><span class="line">mount data.img /tmp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将需要的数据拷贝</span></span><br><span class="line">cp -ra /etc /tmp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将文件发送到其他服务器</span></span><br><span class="line">scp data.img root@192.168.1.17:/root/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在192.168.1.17上挂载data.img,实现类似U盘效果</span></span><br><span class="line">mount data.img /tmp</span><br></pre></td></tr></table></figure><h3 id="22-10-etc-fstab-文件格式"><a href="#22-10-etc-fstab-文件格式" class="headerlink" title="22.10 &#x2F;etc&#x2F;fstab 文件格式"></a>22.10 &#x2F;etc&#x2F;fstab 文件格式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">UUID或者块设备的位置挂载文件夹文件系统格式挂载选项   0 0</span><br><span class="line"></span><br><span class="line">第一个0表示文件系统是否应该包含在备份中。0 表示不包含，1 表示包含。</span><br><span class="line">第二个0用于指定文件系统检查的顺序。0 表示不检查，1 表示先检查，其他数字则表示检查顺序的优先级。</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">UUID=d98f13eb-905f-41ac-93d3-f6b0c5a994f2 /data  ext4defaults00</span><br><span class="line">UUID=d98f13eb-905f-41ac-93d3-f6b0c5a994f2 /data  ext4noatime,rw00</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件挂载到文件夹不允许写UUID</span></span><br><span class="line">/image/mnt/image ext4defaults00</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件夹挂载到文件夹</span></span><br><span class="line">/etc /mnt/etc nonebind00</span><br></pre></td></tr></table></figure><h3 id="22-11-etc-fstab-文件错误修复"><a href="#22-11-etc-fstab-文件错误修复" class="headerlink" title="22.11  &#x2F;etc&#x2F;fstab 文件错误修复"></a>22.11  &#x2F;etc&#x2F;fstab 文件错误修复</h3><p>故障现象表现为，开机一直读进度条，持续等待会进入紧急模式</p><p>&#x3D;&#x3D;注意：如果不能写入文件需要重新挂载根目录 mount -o remount,rw &#x2F;&#x3D;&#x3D;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.输入root口令</span><br><span class="line"></span><br><span class="line">2.journalctl -xb 查看系统本次启动相关日志</span><br><span class="line"></span><br><span class="line">3.确定故障原因修复</span><br><span class="line"></span><br><span class="line">4.重启</span><br></pre></td></tr></table></figure><h3 id="22-12-文件系统检测和修复"><a href="#22-12-文件系统检测和修复" class="headerlink" title="22.12 文件系统检测和修复"></a>22.12 文件系统检测和修复</h3><p>文件系统故障常发生于死机或非正常关机之后，挂载文件系统表示为”no clean”</p><p>&#x3D;&#x3D;注意：一定不要在挂载状态下执行修复命令，且修复命令要与原来的文件系统相同&#x3D;&#x3D;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fsck.ext4 [选项] 块设备</span><br><span class="line"></span><br><span class="line">-a自动修复</span><br><span class="line">-r 交互式修复错误</span><br></pre></td></tr></table></figure><p>ext系列文件专用的检测修复工具</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">e2fsck [选项] 块设备</span><br><span class="line"></span><br><span class="line">-y自动回答为yes</span><br><span class="line">-f强制修复</span><br><span class="line">-p自动进行安全的修复</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">范例</span></span><br><span class="line">e2fsck /dev/sda2</span><br></pre></td></tr></table></figure><p>xfs文件系统专用检测修复工具</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xfs_repair [选项] 块设备</span><br><span class="line"></span><br><span class="line">init 1 进入单用户模式</span><br><span class="line">-f 修复文件,而非设备</span><br><span class="line">-n只检查</span><br><span class="line">-d允许修复只读的挂载设备，在单用户下修复/时使用，然后立即reboot</span><br></pre></td></tr></table></figure><h1 id="23-交换分区-swap"><a href="#23-交换分区-swap" class="headerlink" title="23 交换分区 swap"></a>23 交换分区 swap</h1><h3 id="23-1-swap-分区大小选择"><a href="#23-1-swap-分区大小选择" class="headerlink" title="23.1 swap 分区大小选择"></a>23.1 swap 分区大小选择</h3><table><thead><tr><th align="left">系统中的RAM大小</th><th>推荐的swap大小</th><th>允许休眠的建议swap空间的大小</th></tr></thead><tbody><tr><td align="left">低于2GB</td><td>RAM的2倍</td><td>RAM容量的三倍</td></tr><tr><td align="left">2GB-8GB</td><td>等于RAM的大小</td><td>等于RAM大小</td></tr><tr><td align="left">8GB-64GB</td><td>4GB到RAM容量的0.5倍</td><td>RAM容量的倍数</td></tr><tr><td align="left">超过64G</td><td>独立负载(至少4GB)</td><td>不建议使用休眠功能</td></tr></tbody></table><h3 id="23-2-swap-的使用策略"><a href="#23-2-swap-的使用策略" class="headerlink" title="23.2 swap 的使用策略"></a>23.2 swap 的使用策略</h3><p>说明：当内存在使用100%-30%&#x3D;70%的时候，就开始有交换分区的使用，简单的说这个参数定义了系统对swap的使用倾向，默认值为30，值越大越倾向使用swap分区，可以设置为0，这样做并不会禁止对swap分区的使用，只是最大限度的降低了使用swap分区的可能性</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 ~]$ cat /proc/sys/vm/swappiness </span><br><span class="line">30</span><br><span class="line"></span><br><span class="line">echo vm.swappiness = 10 &gt;&gt; /etc/sysctl.conf  &amp;&amp; sysctl -p</span><br></pre></td></tr></table></figure><h3 id="23-3-创建swap分区"><a href="#23-3-创建swap分区" class="headerlink" title="23.3 创建swap分区"></a>23.3 创建swap分区</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建swap分区</span></span><br><span class="line">fdisk /dev/sdb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">格式化文件系统</span></span><br><span class="line">mkswap /dev/sdb1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">挂载swap分区</span></span><br><span class="line">vim /etc/fstab</span><br><span class="line">UUID=e45b02cd-bfc6-41d4-9414-b8309e0372a3 swap  swap    defaults        0 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询正在使用的交换分区</span></span><br><span class="line">swapono -s</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启用swap分区</span></span><br><span class="line">swapon /dev/sdb1</span><br><span class="line">swapon -a</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">禁用swap分区</span></span><br><span class="line">swapoff /dev/sdb1</span><br></pre></td></tr></table></figure><h1 id="24-移动介质"><a href="#24-移动介质" class="headerlink" title="24. 移动介质"></a>24. 移动介质</h1><p>挂载意味着使外来的文件系统看起来如同是主目录树的一部分，有所移动介质也需要挂载，挂载点通常在&#x2F;media 或 &#x2F;mnt 下</p><p>访问前，介质必须被挂载</p><p>摘除时，介质必须被卸载</p><p>按照默认设备，非根用户只能挂载某些设备（光盘，DVD，软盘，USB等等）</p><h3 id="24-1-光盘"><a href="#24-1-光盘" class="headerlink" title="24.1 光盘"></a>24.1 光盘</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">手工挂载</span></span><br><span class="line">mount /dev/cdrom /mnt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ISO文件挂载</span></span><br><span class="line">mount /data/CentOS-7-x86_64-Everything-2009.iso /mnt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">自动挂载</span></span><br><span class="line">执行：yum -y install autofs &amp;&amp; systemctl enable --now autofs  （Centos 7 8 使用）</span><br><span class="line">执行：chkconfig autofs on &amp;&amp; service autofs start（Centos 6 使用）</span><br><span class="line">执行：cd /misc/cd</span><br></pre></td></tr></table></figure><p>操作光盘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">弹出光盘</span></span><br><span class="line">eject</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">弹入光盘</span></span><br><span class="line">eject -t</span><br></pre></td></tr></table></figure><h3 id="24-2-USB"><a href="#24-2-USB" class="headerlink" title="24.2 USB"></a>24.2 USB</h3><p>工具来自：yum -y install usbutils</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看USB设备是否被识别,来自软件包usbutils</span></span><br><span class="line">lsusb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看日志是否检测到了新设备插入</span></span><br><span class="line">tail -f /var/log/messages</span><br></pre></td></tr></table></figure><p>格式化USB使其在Linux上可以使用，工具来自：yum -y install dosfstools</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">格式化usb（兼容windows和centos）格式化为FAT32</span></span><br><span class="line">mkfs.vfat /dev/sdd1</span><br></pre></td></tr></table></figure><h3 id="24-3-dd-指令"><a href="#24-3-dd-指令" class="headerlink" title="24.3 dd 指令"></a>24.3 dd 指令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">dd if=/PATH of=/PATH bs=? count=?</span><br><span class="line"></span><br><span class="line">if=file从文件读取</span><br><span class="line">of=file写到文件中</span><br><span class="line"></span><br><span class="line">ibs=size一次读size个byte</span><br><span class="line">0bs=sizi一次写size个byte</span><br><span class="line">bs=size指定块大小，既是ibs，也是obs</span><br><span class="line"></span><br><span class="line">cbs=size一次转化size个byte</span><br><span class="line">skip=blocks从开头忽略blocks个ibs大小的块,源</span><br><span class="line">seek=blocks从开头忽略blocks个obs大小的块,目标</span><br><span class="line"></span><br><span class="line">count=n复制n个bs</span><br><span class="line">conv=conversion用指定参数转换文件</span><br><span class="line"></span><br><span class="line">conversion转换参数</span><br><span class="line">ascii转换EBCDIC为ASCII</span><br><span class="line">ebadic转换ASCII为EBCDIC</span><br><span class="line">lcase 把大写字符转换为小写字符</span><br><span class="line">ucase把小写字符转换为大写字符</span><br><span class="line">nocreat不创建输出文件</span><br><span class="line">noerror出错时不停止</span><br><span class="line">notrunc不截断输出文件</span><br><span class="line">sync把每个输入块填充到ibs个字节，不足部分用空（nul）字符补齐</span><br><span class="line">fdatasync只有输出数据写入磁盘，才算做写入完成</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">真实写磁盘的速度：</span></span><br><span class="line">dd if=/dev/zero of=f1.txt bs=1M count=1024 conv=fdatasync</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">克隆分区</span></span><br><span class="line">dd if=/dev/sda1 of=sdy</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">克隆全盘数据,并使用gzip压缩</span></span><br><span class="line">dd if=/dev/sda | gzip &gt; /PATH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将克隆指定盘</span></span><br><span class="line">dd if=/PATH of=/dev/sda</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将压缩的克隆文件恢复到指定盘</span></span><br><span class="line">gzip -dc /PATH | dd of=/dev/sda</span><br></pre></td></tr></table></figure><h1 id="25-RAID-级别工作原理"><a href="#25-RAID-级别工作原理" class="headerlink" title="25. RAID 级别工作原理"></a>25. RAID 级别工作原理</h1><h3 id="25-1-RAID-的作用"><a href="#25-1-RAID-的作用" class="headerlink" title="25.1 RAID 的作用"></a>25.1 RAID 的作用</h3><p>&#x3D;&#x3D;RAID 的作用&#x3D;&#x3D;</p><p>提高IO能力，磁盘并行读写</p><p>提高耐用性，磁盘冗余算法来实现</p><h3 id="25-2-RAID-实现方式"><a href="#25-2-RAID-实现方式" class="headerlink" title="25.2 RAID 实现方式"></a>25.2 RAID 实现方式</h3><p>&#x3D;&#x3D;RAID 实现方式&#x3D;&#x3D;</p><p>外接式磁盘阵列：通过扩展卡提供适配能力</p><p>内接式RAID：主板集成RAID控制器，安装OS前在BISO里配置、</p><p>软件RAID：通过OS实现</p><h3 id="25-3-RAID-级别"><a href="#25-3-RAID-级别" class="headerlink" title="25.3 RAID 级别"></a>25.3 RAID 级别</h3><p>&#x3D;&#x3D;RAID-0&#x3D;&#x3D;</p><p>多块相同容量硬盘合并在一起，成为一块大硬盘，存储时数据雨露均沾，依次使用每块小硬盘，提高读写速度，最小磁盘数2，2+</p><p>容易丢失数据，没有容错性</p><p>&#x3D;&#x3D;RAID-1&#x3D;&#x3D;</p><p>镜像，两块硬盘数据会同步（写同步，删同步），主要是防止有硬盘损坏（提高容错性），最少磁盘数2，2N</p><p>读性能提升，写性能下降，只能使用50%空间</p><p>&#x3D;&#x3D;RAID-4（已经淘汰）&#x3D;&#x3D;</p><p>多块硬盘放数据，一块硬盘异或校验数据，坏的硬盘可以通过校验位恢复，（x+y&#x3D;校验位，校验位-y&#x3D;x）最少3块硬盘才能做RAID4</p><p>&#x3D;&#x3D;RAID-5&#x3D;&#x3D;</p><p>多块硬盘放数据，随机硬盘放异或校验位，最多可以坏1块硬盘，最少3块硬盘才能做RAID5</p><p>读，写性能提升，利用率为N-1&#x2F;N</p><p>&#x3D;&#x3D;RAID-6&#x3D;&#x3D;</p><p>多块硬盘放数据，随机两块硬盘放校验位，最多可以坏2块硬盘，最少4块硬盘才能做RAID6</p><p>&#x3D;&#x3D;RAID-10（最优）&#x3D;&#x3D;</p><p>多块硬盘相互组成RAID1（镜像），最后多组RAID1（镜像）组成RAID0（合并），每组镜像只能坏一块硬盘</p><p>利用率为50%</p><p>&#x3D;&#x3D;RAID-01&#x3D;&#x3D;</p><p>多块硬盘相互组成RAID0，最后多组RAID0组成RAID1 </p><p>&#x3D;&#x3D;RAID-50&#x3D;&#x3D;</p><p>&#x3D;&#x3D;JBOD&#x3D;&#x3D;</p><p>将多块一个盘合并为一个大的连续空间</p><h1 id="26-逻辑卷"><a href="#26-逻辑卷" class="headerlink" title="26. 逻辑卷"></a>26. 逻辑卷</h1><h3 id="26-1-创建逻辑卷"><a href="#26-1-创建逻辑卷" class="headerlink" title="26.1 创建逻辑卷"></a>26.1 创建逻辑卷</h3><p>相关工具来自：yum -y install lvm2</p><p>一、创建物理卷</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建物理卷,命令格式pvcreate 硬盘名称（或者分区名称）</span></span><br><span class="line">pvcreate /dev/sdb1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看物理卷信息</span></span><br><span class="line">pvdisplay</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除物理卷,命令格式pvmove 硬盘名称（或者分区名称）</span></span><br><span class="line">pvremove /dev/sdb1</span><br></pre></td></tr></table></figure><p>二、创建卷组</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建卷组,命令格式vgcreate 卷组名称 pv名称</span></span><br><span class="line">vgcreate vg_mysql /dev/sdb1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看卷组信息</span></span><br><span class="line">vgdisplay</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除卷组,命令格式vgremove 卷组名称</span></span><br><span class="line">vgremove vg_mysql</span><br></pre></td></tr></table></figure><p>三、创建逻辑卷</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-l 60%vg使用卷组的60%</span><br><span class="line">-l 100%FREE使用卷组剩余空间的100%</span><br><span class="line">-L +500M指定大小</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建逻辑卷,命令格式lvcreate -n 卷组名 -L 分配大小 卷组名称</span> </span><br><span class="line">lvcreate -n lv_date -L 1G vg_mysql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看逻辑卷信息</span></span><br><span class="line">lvdisplay</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除逻辑卷,命令格式lvremove 逻辑卷路径</span></span><br><span class="line">lvremove /dev/vg_mysql/lv_date</span><br></pre></td></tr></table></figure><p>四、创建文件系统</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 格式化文件系统</span><br><span class="line">mkfs.ext4 /dev/vg_mysql/lv_date</span><br></pre></td></tr></table></figure><p>五、挂载逻辑卷&#x3D;&#x3D;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 创建挂载目录</span><br><span class="line">mkdir -p /mysql/data</span><br><span class="line"></span><br><span class="line"># 挂载逻辑卷</span><br><span class="line">vim /etc/fstab</span><br><span class="line"></span><br><span class="line">UUID=ef5dc733-e379-441a-b180-a6b28e94e637 /mysql/data ext4defaults0 0</span><br></pre></td></tr></table></figure><h3 id="26-2-扩展逻辑卷空间"><a href="#26-2-扩展逻辑卷空间" class="headerlink" title="26.2 扩展逻辑卷空间"></a>26.2 扩展逻辑卷空间</h3><h4 id="26-2-1-扩容卷组"><a href="#26-2-1-扩容卷组" class="headerlink" title="26.2.1 扩容卷组"></a>26.2.1 扩容卷组</h4><p>卷组没有空间时，使用物理卷扩容卷组</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建物理卷,命令格式pvcreate 硬盘名称（或者分区名称）</span></span><br><span class="line">pvcreate /dev/sdc1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">扩容卷组,命令格式vgextend  &lt;要扩容的卷组名称&gt; &lt;要添加到卷组的pv路径&gt;</span></span><br><span class="line">vgextend vg_mysql /dev/sdc1</span><br></pre></td></tr></table></figure><h4 id="26-2-2-扩容逻辑卷"><a href="#26-2-2-扩容逻辑卷" class="headerlink" title="26.2.2 扩容逻辑卷"></a>26.2.2 扩容逻辑卷</h4><p>卷组还有剩余空间时，使用卷组扩容逻辑卷</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-l 60%vg使用卷组的60%</span><br><span class="line">-l 100%FREE使用卷组剩余空间的100%</span><br><span class="line">-L +500M指定大小</span><br><span class="line">-r扩展逻辑卷时,同步逻辑卷文件系统（推荐使用）</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">扩容逻辑卷,命令格式lvextend -L分配大小 -n 逻辑卷名</span></span><br><span class="line">lvextend -L +1G  -n /dev/vg_mysql/lv_date</span><br><span class="line"></span><br><span class="line">-- 此时新扩容的空间由于没有文件系统,虽然逻辑卷空间已经增加,但是依然无法使用</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">同步逻辑卷文件系统,ext4</span></span><br><span class="line">resize2fs /dev/vg_mysql/lv_date</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">同步逻辑卷文件系统,xfs （指定挂载目录）</span></span><br><span class="line">xfs_growfs /mysql/data</span><br></pre></td></tr></table></figure><h4 id="26-2-3-同步文件系统"><a href="#26-2-3-同步文件系统" class="headerlink" title="26.2.3 同步文件系统"></a>26.2.3 同步文件系统</h4><p>此时新扩容的空间由于没有文件系统,虽然逻辑卷空间已经增加,但是依然无法使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">同步逻辑卷文件系统,ext4</span></span><br><span class="line">resize2fs /dev/vg_mysql/lv_date</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">同步逻辑卷文件系统,xfs （挂载目录的目录）</span></span><br><span class="line">xfs_growfs /mysql/data</span><br><span class="line">xfs_growfs /# 给/同步文件系统</span><br></pre></td></tr></table></figure><h3 id="26-3-缩减逻辑卷空间"><a href="#26-3-缩减逻辑卷空间" class="headerlink" title="26.3 缩减逻辑卷空间"></a>26.3 缩减逻辑卷空间</h3><p>&#x3D;&#x3D;缩减逻辑卷有风险（缩减空间不要小于已使用空间），建议备份重要数据，xfs 文件系统不支持缩减逻辑卷&#x3D;&#x3D;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1. 取消挂载的逻辑卷（必须执行）</span><br><span class="line">umount /mysql/data</span><br><span class="line"></span><br><span class="line">2. 检查文件系统完整性（必须执行）</span><br><span class="line">fsck -f /dev/vg_mysql/lv_date或e2fsck -f /dev/vg_mysql/lv_date</span><br><span class="line"></span><br><span class="line">3. 缩减文件系统空间（必须执行）,将文件系统大小调整为1G</span><br><span class="line">resize2fs /dev/vg_mysql/lv_date 1G</span><br><span class="line"></span><br><span class="line">4. 缩减逻辑卷,将逻辑卷大小调整为1G,必须和文件系统大小一致</span><br><span class="line">lvreduce -L 1G /dev/vg_mysql/lv_date</span><br><span class="line"></span><br><span class="line">5. 恢复挂载,验证结果</span><br><span class="line">df -h | grep /dev/vg_mysql/lv_date</span><br><span class="line">lvdisplay | grep -A 15  /dev/vg_mysql/lv_date | grep &#x27;LV Size&#x27;</span><br></pre></td></tr></table></figure><h3 id="26-4-逻辑卷快照"><a href="#26-4-逻辑卷快照" class="headerlink" title="26.4 逻辑卷快照"></a>26.4 逻辑卷快照</h3><h4 id="26-4-1-逻辑卷快照原理"><a href="#26-4-1-逻辑卷快照原理" class="headerlink" title="26.4.1 逻辑卷快照原理"></a>26.4.1 逻辑卷快照原理</h4><p>快照是特殊的逻辑卷，它是在生成快照时存在的逻辑卷的准确拷贝，对于需要备份或者复制的现有数据临时拷贝以及其他操作来说，快照是最合适的选择，快照只有在它们和原来的逻辑卷不同时才会消耗空间，建立快照的卷大小，小于等于原始逻辑卷，也可以使用lvextend扩展快照</p><p>逻辑卷快照</p><p>逻辑卷快照就是将当时的系统信息记录下来，就好像照相一样，将来有任何数据改动了，则改动前的原始数据会被移动到快照区。没有改动的区域则由快照区和文件系统共享</p><p>工作原理</p><ol><li>在生成快照时会分配给它一定的空间，但只有在原来的逻辑卷或者快照改变时才会使用这些空间。</li><li>当原来的逻辑卷中有所改变时，会将旧的数据复制到快照中</li><li>快照中只含有原来的逻辑卷中未更改的数据或者生成快照后的快照中更改的数据</li></ol><p>由于快照区与原本的LV公用很多PE区块，因此快照与被快照的LV必须在同一共VG中，系统恢复的时候的文件数量不能高于快照区的实际容量。</p><p>快照特点</p><ol><li>备份速度快，只是创建了LV</li><li>应用场景是测试，不能完全代替备份</li><li>快照之后，逻辑卷的修改速度会收到一定印象</li></ol><h4 id="26-4-2-创建逻辑卷快照"><a href="#26-4-2-创建逻辑卷快照" class="headerlink" title="26.4.2 创建逻辑卷快照"></a>26.4.2 创建逻辑卷快照</h4><p>创建逻辑卷快照，快照必须和 lv 在同一个 vg 中</p><p>可以创建多个快照，每个快照记录的都是快照创建时，逻辑卷的状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看卷组剩余空间</span></span><br><span class="line">vgdisplay | grep -A 16 vg_mysql | grep &#x27;PE Size&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建逻辑卷快照,快照的大小必须小于lv的大小</span></span><br><span class="line">lvcreate -n 快照名称 -s -L 快照空间大小 对那个lv来创建</span><br><span class="line">lvcreate -n lv_date_kz -s -L 500M /dev/vg_mysql/lv_date</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">挂载逻辑卷快照ext4</span></span><br><span class="line">mount -o ro /dev/vg_mysql/lv_date_kz /tmp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">挂载逻辑卷快照,xfs</span></span><br><span class="line">mount -o nouuid,ro /dev/vg_mysql/lv_date_kz /tmp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除逻辑卷快照</span></span><br><span class="line">lvremove /dev/vg_mysql/lv_date_kz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">快照和逻辑卷的大小一致</span></span><br><span class="line">/dev/mapper/vg_mysql-lv_date     976M  2.6M  912M   1% /mysql/data</span><br><span class="line">/dev/mapper/vg_mysql-lv_date_kz  976M  2.6M  912M   1% /tmp</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="26-4-3-逻辑卷快照还原"><a href="#26-4-3-逻辑卷快照还原" class="headerlink" title="26.4.3 逻辑卷快照还原"></a>26.4.3 逻辑卷快照还原</h4><p>逻辑卷中记录的是最新的数据，而快照中记录的都是快照创建时，逻辑卷的状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取消逻辑卷和逻辑卷挂载的全部挂载（离线状态才可以还原快照）</span></span><br><span class="line">umount /mysql/data</span><br><span class="line">umount /tmp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">逻辑卷还原快照,命令格式lvconvert --merge 快照逻辑卷名称</span></span><br><span class="line">lvconvert --merge /dev/vg_mysql/lv_date_kz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时还原的快照已经被删除（该指令返回找不到逻辑卷）</span></span><br><span class="line">lvdisplay /dev/vg_mysql/lv_date_kz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新挂载还原的逻辑卷</span></span><br><span class="line">mount /dev/mapper/vg_mysql-lv_date /mysql/data</span><br></pre></td></tr></table></figure><h3 id="26-5-拆卸更换逻辑卷硬盘"><a href="#26-5-拆卸更换逻辑卷硬盘" class="headerlink" title="26.5 拆卸更换逻辑卷硬盘"></a>26.5 拆卸更换逻辑卷硬盘</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">参考Linux入门到精通P69最后20分钟</span><br></pre></td></tr></table></figure><h1 id="27-网络协议"><a href="#27-网络协议" class="headerlink" title="27. 网络协议"></a>27. 网络协议</h1><h3 id="27-1-网络基础"><a href="#27-1-网络基础" class="headerlink" title="27.1 网络基础"></a>27.1 网络基础</h3><h4 id="27-1-1-网络的范围分类"><a href="#27-1-1-网络的范围分类" class="headerlink" title="27.1.1 网络的范围分类"></a>27.1.1 网络的范围分类</h4><ul><li>广域网</li><li>城域网</li><li>局域网</li></ul><h4 id="27-1-2-网络的特征"><a href="#27-1-2-网络的特征" class="headerlink" title="27.1.2 网络的特征"></a>27.1.2 网络的特征</h4><p>速度（带宽）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1B=8b,100Mbps=102400Kbps</span><br><span class="line">102400Kbps/8=12800KBps</span><br><span class="line">100M 宽带最大下载速度为12.8M/s</span><br></pre></td></tr></table></figure><h3 id="27-2-网络标准OSI七层结构"><a href="#27-2-网络标准OSI七层结构" class="headerlink" title="27.2 网络标准OSI七层结构"></a>27.2 网络标准OSI七层结构</h3><p>7.应用层 Application针对特定应用的协议，邮件协议、文件传输协议、远程协议</p><p>6.表示层 Presentation      设备固有数据格式和网络标准数据格式转换（不同的标准代表不同的信息）</p><p>5.会话层 Session      通信管理，负责建立和断开通信连接，管理传输层一下的分层</p><p>4.传输层 Transport   确保数据成功到达，数据校验</p><p>3.网络层 Network    地址管理和路由选择（经过那个路由传递到目标地址？）</p><p>2.数据链路层 Date link     互联设备之间的数据传输和特定数据结构的数据帧 </p><p>1.物理层 Physical     硬件互联（无线&#x2F;有线）1个字节&#x3D;8位</p><h3 id="27-3-网络通信过程"><a href="#27-3-网络通信过程" class="headerlink" title="27.3 网络通信过程"></a>27.3 网络通信过程</h3><h4 id="27-3-1-协议数据单元PUD"><a href="#27-3-1-协议数据单元PUD" class="headerlink" title="27.3.1 协议数据单元PUD"></a>27.3.1 协议数据单元PUD</h4><p>PDU 协议数据单元是值对等层次之间传递的数据单位</p><p>物理层的PDU是数据位 bit</p><p>数据链路层的PDU是数据帧 frame</p><p>网络层的PDU是数据包 packet</p><p>传输层的PDU是数据段 segment</p><p>其他更高层次的PUD是消息 message</p><h4 id="27-3-2-三种通讯模式"><a href="#27-3-2-三种通讯模式" class="headerlink" title="27.3.2 三种通讯模式"></a>27.3.2 三种通讯模式</h4><p>单播（unicast）：发送报文的目标唯一，不代表收到的人只有一个</p><p>广播（broadcast）：发送报文的目标是一定范围内的所有</p><p>组播（multicase）：发送报文的目标是部分计算机，一部分人</p><h4 id="27-3-3-冲突域和广播域"><a href="#27-3-3-冲突域和广播域" class="headerlink" title="27.3.3 冲突域和广播域"></a>27.3.3 冲突域和广播域</h4><p>冲突域：当两个网络设备同时发送数据，如果发送了冲突，则两个设备处于同一个冲突域，反之，则各自处于不同的冲突域</p><p>广播域：一个网络设备发送广播，另一个设备收到了，则两个设备处同一个广播域，反之，则各自处于不同的广播域</p><h4 id="27-3-4-三种通讯机制"><a href="#27-3-4-三种通讯机制" class="headerlink" title="27.3.4 三种通讯机制"></a>27.3.4 三种通讯机制</h4><p>单工：只能一个方向传（喇叭、音响、收音机）</p><p>半双工：不能同时收和发（对讲机）</p><p>全双工：同时收发（手机）</p><h3 id="27-4-网络设备"><a href="#27-4-网络设备" class="headerlink" title="27.4 网络设备"></a>27.4 网络设备</h3><h4 id="27-4-1-交换机"><a href="#27-4-1-交换机" class="headerlink" title="27.4.1 交换机"></a>27.4.1 交换机</h4><p>交换机处于数据链路层，交换机内部RAM芯片，会记录一张MAC地址和交换机端口对应的表，当目标的MAC在表中有记录时，交换机将直接将数据帧发送给对应端口，当一个新的目标地址出现时，交换机通过MAC表没有找到对应端口，将泛洪，数据帧会从所有端口转发出去，这一个过程会让交换机记录下目标地址和源地址的端口，从而下次将不在泛洪</p><p>如果一个数据帧的目标地址是所有地址，交换机将广播，将数据帧发送到所有的端口，过多的广播会造成广播风暴，网络堵塞</p><h4 id="27-4-2-路由器"><a href="#27-4-2-路由器" class="headerlink" title="27.4.2 路由器"></a>27.4.2 路由器</h4><p>路由器处于网络层</p><h3 id="27-5-以太网"><a href="#27-5-以太网" class="headerlink" title="27.5 以太网"></a>27.5 以太网</h3><h4 id="27-5-1-以太网-MAC-帧结构"><a href="#27-5-1-以太网-MAC-帧结构" class="headerlink" title="27.5.1 以太网 MAC 帧结构"></a>27.5.1 以太网 MAC 帧结构</h4><ol><li><strong>前导信息（Preamble）</strong>：通常是7个字节的前导码，用于同步接收端的时钟，并标识数据帧的开始。</li><li><strong>起始帧界定符（Start Frame Delimiter）</strong>：1个字节，标志着数据帧的开始。</li><li><strong>目标MAC地址（Destination MAC Address）</strong>：通常是6个字节，指示了数据帧的目标设备的MAC地址。</li><li><strong>源MAC地址（Source MAC Address）</strong>：同样是6个字节，指示了数据帧的发送者的MAC地址。</li><li><strong>类型&#x2F;长度字段（Type&#x2F;Length Field）</strong>：通常是2个字节，用于标识数据帧中封装的上层协议类型（如IPv4、IPv6、ARP等）或指定数据帧的长度。</li><li><strong>数据（Data）</strong>：数据帧的实际数据部分，长度可以变化，最小长度为46字节。</li><li><strong>校验和序列（Frame Check Sequence，FCS）</strong>：通常是4个字节，包括CRC（循环冗余检测）校验码，用于检测数据帧在传输过程中的错误。</li></ol><h3 id="27-6-虚拟局域网-VLAN"><a href="#27-6-虚拟局域网-VLAN" class="headerlink" title="27.6 虚拟局域网 VLAN"></a>27.6 虚拟局域网 VLAN</h3><p>将交换机的端口划分不同的网段，实现广播域隔离，将路由器的两端分别接入不同的VLAN，实现不通的VLAN通讯，而带有路由功能的交换机被称之为三层交换机，即可以实现网络层功能</p><h3 id="27-8-TCP-IP协议"><a href="#27-8-TCP-IP协议" class="headerlink" title="27.8 TCP&#x2F;IP协议"></a>27.8 TCP&#x2F;IP协议</h3><h4 id="27-8-1-TCP-IP-分层结构"><a href="#27-8-1-TCP-IP-分层结构" class="headerlink" title="27.8.1 TCP&#x2F;IP 分层结构"></a>27.8.1 TCP&#x2F;IP 分层结构</h4><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35354992/1685521192618-e0777325-e0da-44ca-9cd7-177e18e40df8.png?x-oss-process=image/resize,w_868,limit_0" alt="image.png"></p><h4 id="27-8-2-TCP-IP-通信过程"><a href="#27-8-2-TCP-IP-通信过程" class="headerlink" title="27.8.2 TCP&#x2F;IP 通信过程"></a>27.8.2 TCP&#x2F;IP 通信过程</h4><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35354992/1685521719075-5f85002a-1d65-429a-8b0e-a283ca884296.png" alt="img"></p><h4 id="27-8-3-TCP包头结构"><a href="#27-8-3-TCP包头结构" class="headerlink" title="27.8.3 TCP包头结构"></a>27.8.3 TCP包头结构</h4><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35354992/1685523010222-429dab41-9eed-4e5f-a4d3-74a9d7b943e5.png?x-oss-process=image/resize,w_985,limit_0" alt="image.png"></p><h4 id="27-8-4-TCP-三次握手"><a href="#27-8-4-TCP-三次握手" class="headerlink" title="27.8.4 TCP 三次握手"></a>27.8.4 TCP 三次握手</h4><h4 id="27-8-5-TCP-四次挥手"><a href="#27-8-5-TCP-四次挥手" class="headerlink" title="27.8.5 TCP 四次挥手"></a>27.8.5 TCP 四次挥手</h4><h3 id="27-9-端口"><a href="#27-9-端口" class="headerlink" title="27.9 端口"></a>27.9 端口</h3><h4 id="27-9-1-端口分类"><a href="#27-9-1-端口分类" class="headerlink" title="27.9.1 端口分类"></a>27.9.1 端口分类</h4><p>传输层通过port号，确定应用层协议，范围0-65535</p><ul><li><p>0-1023：系统端口或特权端口(仅管理员可用)，众所周知，永久的分配给固定的系统应用使用，22&#x2F;TCP(ssh)，80&#x2F;TCP(http)，443&#x2F;TCP(https)</p></li><li><p>1024-49151：用户端口或注册端口，但要求并不严格，分配给程序注册为某应用使用，1443&#x2F;TCP(sql server)，1521&#x2F;TCP(oracle)，3306&#x2F;TCP(mysql)，11211&#x2F;tcp&#x2F;udp(memcached)</p></li><li><p>49152-65535：动态或私有端口，客户端随机使用端口，范围定义：</p></li></ul><h4 id="27-9-2-定义随机端口范围"><a href="#27-9-2-定义随机端口范围" class="headerlink" title="27.9.2 定义随机端口范围"></a>27.9.2 定义随机端口范围</h4><p>客户端访问服务器时，使用随机端口，可以定义随机端口使用的范围</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 查看</span><br><span class="line">cat /proc/sys/net/ipv4/ip_local_port_range</span><br><span class="line"></span><br><span class="line"># 临时修改</span><br><span class="line">echo 20000 65535 &gt; /proc/sys/net/ipv4/ip_local_port_range</span><br><span class="line"></span><br><span class="line"># 著名服务用的端口号</span><br><span class="line">less /etc/services</span><br></pre></td></tr></table></figure><h4 id="27-9-3-端口监听"><a href="#27-9-3-端口监听" class="headerlink" title="27.9.3 端口监听"></a>27.9.3 端口监听</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装nc工具包</span></span><br><span class="line">yum -y install nc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打开9527端口</span></span><br><span class="line">nc -l 9527</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">访问9527端口</span></span><br><span class="line">nc 192.168.1.8 9527</span><br></pre></td></tr></table></figure><h4 id="27-9-4-查看端口被那个PID-程序占用"><a href="#27-9-4-查看端口被那个PID-程序占用" class="headerlink" title="27.9.4 查看端口被那个PID&#x2F;程序占用"></a>27.9.4 查看端口被那个PID&#x2F;程序占用</h4><p>工具来自：yum -y install lsof</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ss -tunp</span><br><span class="line">lsof -i:22</span><br></pre></td></tr></table></figure><h4 id="27-9-5-判断远程主机端口是否打开"><a href="#27-9-5-判断远程主机端口是否打开" class="headerlink" title="27.9.5 判断远程主机端口是否打开"></a>27.9.5 判断远程主机端口是否打开</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">0 表示打开,1 表示关闭</span></span><br><span class="line">[root@Centos ~][0]$ &lt; /dev/tcp/192.168.1.17/22</span><br><span class="line">[root@Centos ~][0]$ </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭状态</span></span><br><span class="line">[root@Centos ~][0]$ &lt; /dev/tcp/192.168.1.17/23</span><br><span class="line">-bash: connect: Connection refused</span><br><span class="line">-bash: /dev/tcp/192.168.1.17/23: Connection refused</span><br><span class="line">[root@Centos ~][1]$ </span><br></pre></td></tr></table></figure><h3 id="27-10-Internet-层"><a href="#27-10-Internet-层" class="headerlink" title="27.10 Internet 层"></a>27.10 Internet 层</h3><h4 id="27-10-11-ping-工具"><a href="#27-10-11-ping-工具" class="headerlink" title="27.10.11 ping 工具"></a>27.10.11 ping 工具</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ping [选项] 目标IP</span><br><span class="line"></span><br><span class="line">-c ?指定ping请求次数</span><br><span class="line">-i ?每次请求间隔时间,以秒为单位</span><br><span class="line">-s ?指定数据包大小,以字节为单位</span><br><span class="line">-t ?设置存活数值TTL的大小。</span><br><span class="line">-w ?等待响应的超时时间,以秒为单位</span><br><span class="line">-W ?等待指定时间后执行</span><br><span class="line">-q安静模式,不显示每个ping请求的输出</span><br><span class="line">-f洪水模式,尽全力ping目标IP</span><br><span class="line">-I指定发起ping请求的IP</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断网络是否可达</span></span><br><span class="line">ping 192.168.1.7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发送指定字节</span></span><br><span class="line">ping 192.168.1.7 -s 65507</span><br></pre></td></tr></table></figure><h4 id="27-10-12-ARP-地址解析协议"><a href="#27-10-12-ARP-地址解析协议" class="headerlink" title="27.10.12 ARP 地址解析协议"></a>27.10.12 ARP 地址解析协议</h4><p>&#x3D;&#x3D;ARP 工作原理&#x3D;&#x3D;</p><ol><li><strong>ARP请求</strong>： 当设备在本地网络中要与另一台设备通信时，它首先检查本地 ARP 缓存（ARP缓存是一个存储IP地址与MAC地址映射的表格）。如果要访问的目标地址不在缓存中，它将广播发送一个ARP请求。该请求包含发送方设备的IP地址和MAC地址，以及目标设备的IP地址。这个广播帧会发送到本地网络上的所有设备。如果，ARP协议发现目标地址不和自己处于一个网段，将会找自己的网关，让网关将自己的请求交给目标地址</li><li><strong>ARP应答</strong>： 当网络上的设备收到ARP请求后，目标设备会检查请求中的IP地址是否与自己的IP地址相匹配。如果匹配，目标设备会发送一个ARP应答，包含自己的MAC地址。这个应答消息只会发送给ARP请求中指定的源设备。</li><li><strong>更新ARP缓存</strong>： 源设备收到来自目标设备的ARP应答后，它将更新自己的ARP缓存，将目标设备的IP地址和MAC地址进行关联，以便将来通信时能够直接使用该信息。</li><li><strong>通信</strong>： 有了IP地址到MAC地址的映射后，源设备就能够构建数据帧并将其发送到目标设备。数据帧中包含目标设备的MAC地址，确保数据能够被正确路由到目标设备。</li></ol><p>&#x3D;&#x3D;免费 ARP IP地址冲突检测原理&#x3D;&#x3D;</p><ol><li><strong>服务器获取IP地址</strong>： 服务器在配置网络接口时被分配了IP地址，例如192.168.1.7。</li><li><strong>发送ARP请求</strong>： 一旦服务器拥有IP地址，它会尝试使用ARP请求广播来查找与该IP地址关联的MAC地址。服务器会发送ARP请求消息，询问局域网上的所有设备：”谁是192.168.1.7的MAC地址？”</li><li><strong>等待响应</strong>： 服务器将等待一定次数或一段时间以获取ARP响应。在这段时间内，其他设备在局域网上接收到了这个ARP请求。</li><li><strong>检测冲突</strong>： 如果另一台设备已经使用了IP地址192.168.1.7并发送了ARP响应，这将导致服务器接收到多个具有相同IP地址但不同MAC地址的ARP响应。这是一个明显的冲突标志。</li><li><strong>解决冲突</strong>： 一旦服务器检测到IP地址冲突，它应该采取措施来解决冲突，通常通过更改其IP地址或定位和解决与之冲突的设备。解决冲突后，服务器应该重新发送ARP请求以获取正确的MAC地址。</li></ol><p>&#x3D;&#x3D;反向 ARP 动态IP地址获取原理&#x3D;&#x3D;</p><ol><li><strong>RARP服务器</strong>：在网络中，通常有一个或多个RARP服务器，它们维护MAC地址到IP地址的映射表。</li><li><strong>RARP请求</strong>：当计算机启动时，它可能不知道自己的IP地址，但它会知道自己的MAC地址。计算机发送一个RARP请求广播，通知网络上的RARP服务器说：“这是我的MAC地址，请告诉我我的IP地址是什么？”</li><li><strong>RARP响应</strong>：RARP服务器接收到请求后，查询其映射表以查找相应的IP地址，然后将响应发送回请求计算机。这个响应包含了计算机所需的IP地址。</li><li><strong>IP地址配置</strong>：计算机接收到RARP响应后，可以配置其IP地址，并随后在网络上正常通信。</li></ol><p>&#x3D;&#x3D;ARP 指令&#x3D;&#x3D;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-sIP和MAC地址绑定</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示 arp 缓存</span></span><br><span class="line">arp -n</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清理 arp 缓存</span></span><br><span class="line">arp -d 192.168.1.17</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">手动绑定MAC地址</span></span><br><span class="line">arp -s 192.168.1.17 00:0c:29:37:d7:b4</span><br></pre></td></tr></table></figure><h1 id="28-IP-地址"><a href="#28-IP-地址" class="headerlink" title="28. IP 地址"></a>28. IP 地址</h1><h3 id="28-1-IP-地址分类"><a href="#28-1-IP-地址分类" class="headerlink" title="28.1 IP 地址分类"></a>28.1 IP 地址分类</h3><p>网段数&#x3D;2^可变的网络ID的位数</p><p>主机数&#x3D;2^主机ID位数-2</p><h4 id="281-1-A类"><a href="#281-1-A类" class="headerlink" title="281.1 A类"></a>281.1 A类</h4><p>0-127.X.Y.Z</p><p>网络ID位是最高的8位，主机ID是24位低位</p><p>网段数：2^7-2&#x3D;126</p><p>每个网络中的主机数：2^24-2&#x3D;16777214</p><p>默认子网掩码：255.0.0.0</p><h4 id="28-1-2-B类"><a href="#28-1-2-B类" class="headerlink" title="28.1.2 B类"></a>28.1.2 B类</h4><p>128-191.X.Y.Z</p><p>网络ID位是最高的16位，主机ID是16位低位</p><p>网段数：2^16-2&#x3D;16384</p><p>每个网络中的主机数：2^16-2&#x3D;65534</p><p>默认子网掩码：255.255.0.0</p><h4 id="28-1-3-C类"><a href="#28-1-3-C类" class="headerlink" title="28.1.3 C类"></a>28.1.3 C类</h4><p>192-223.X.Y.Z</p><p>网络ID位是最高的24位，主机ID是8位低位</p><p>网段数：2^24-3&#x3D;2097152</p><p>每个网络中的主机数：2^8-2&#x3D;254</p><p>默认子网掩码：255.255.255.0</p><h4 id="28-1-4-D类"><a href="#28-1-4-D类" class="headerlink" title="28.1.4 D类"></a>28.1.4 D类</h4><p>组（多）播224-239.X.Y.Z</p><h4 id="28-1-5-E类"><a href="#28-1-5-E类" class="headerlink" title="28.1.5 E类"></a>28.1.5 E类</h4><p>保留未使用，240-255</p><h4 id="28-1-6-私有IP地址"><a href="#28-1-6-私有IP地址" class="headerlink" title="28.1.6 私有IP地址"></a>28.1.6 私有IP地址</h4><p>不直接用于互联网，通常是在局域网中使用</p><p>A类 10.0.0.0到10.255.255.255</p><p>B类 172.16.0.0到172.31.255.255</p><p>C类 192.168.0.0到192.168.255.255</p><h4 id="28-1-7-公有IP地址"><a href="#28-1-7-公有IP地址" class="headerlink" title="28.1.7 公有IP地址"></a>28.1.7 公有IP地址</h4><p>互联网上设备拥有的唯一地址</p><p>A类 1.0.0.0到9.255.255.255</p><p>​11.0.0.0到126.255.255.255</p><p>B类 128.0.0.0到172.15.255.255</p><p>​172.32.0.0到191.255.255.255</p><p>C类 192.0.0.0到192.167.255.255</p><p>​192.169.0.0到223.255.255.255</p><h4 id="28-1-8-特殊地址"><a href="#28-1-8-特殊地址" class="headerlink" title="28.1.8 特殊地址"></a>28.1.8 特殊地址</h4><ul><li>0.0.0.0</li></ul><p>​0.0.0.0并不是一个真正意义上的IP地址，它表示所有不清楚的主机和目的网络</p><ul><li>255.255.255.255</li></ul><p>​限制广播地址。对本机来说，这个地址指本网段内(同一广播域)的所有主机</p><ul><li>127.0.0.1~127.255.255.254</li></ul><p>​本机回环地址，主要用于测试，在传输介质上永远不应该出现目的地址位127.0.0.1的数据包</p><ul><li>224.0.0.0~239.255.255.255</li></ul><p>​组播地址，224.0.01特值所有主机，224.0.0.2特指所有路由器。224.0.0.5值OSPF路由器，地址多用于一些特定的程序以及多媒体程序</p><ul><li>169.254.X.X</li></ul><p>​如果windows主机使用DHCP自动分配地址，而又无法从DHCP服务器获取地址，系统会为主机分配这样的地址</p><h3 id="28-2-子网掩码"><a href="#28-2-子网掩码" class="headerlink" title="28.2 子网掩码"></a>28.2 子网掩码</h3><p>CIDR：无类域间路由，目前的网络已不再按A、B、C类划分网段，可以任意指定网段的范围</p><p>CIDR：无类域间路由表示法：IP&#x2F;网络ID位数，如172.16.0.100&#x2F;16</p><p>netmask子网掩码：32位或128位（ipv6）的数字，和IP成对使用，用来确认IP地址中的网络ID和主机ID，对应网络ID的位为1，对应主机ID的位为0，变现为连续的高位为1，连续的低位为0</p><h1 id="29-网络配置"><a href="#29-网络配置" class="headerlink" title="29 网络配置"></a>29 网络配置</h1><h3 id="29-1-网卡信息"><a href="#29-1-网卡信息" class="headerlink" title="29.1 网卡信息"></a>29.1 网卡信息</h3><p>工具来自：yum -y install net-tools</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网卡信息,命令格式ethtool 网卡名</span></span><br><span class="line">ethtool eth0</span><br></pre></td></tr></table></figure><h3 id="29-2-网卡驱动"><a href="#29-2-网卡驱动" class="headerlink" title="29.2 网卡驱动"></a>29.2 网卡驱动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网卡驱动</span></span><br><span class="line">ethtool -i ens33 | grep driver</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载网卡驱动,命令格式modprobe -r 网卡驱动名</span></span><br><span class="line">modprobe -r e1000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载网卡驱动,命令格式modprobe 网卡驱动名</span></span><br><span class="line">modprobe e1000</span><br></pre></td></tr></table></figure><h3 id="29-3-网卡命名"><a href="#29-3-网卡命名" class="headerlink" title="29.3 网卡命名"></a>29.3 网卡命名</h3><h4 id="29-3-1-网卡命名规则"><a href="#29-3-1-网卡命名规则" class="headerlink" title="29.3.1 网卡命名规则"></a>29.3.1 网卡命名规则</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">en: Ethernet 有线局域网</span><br><span class="line">w]: wlan 无线局域网</span><br><span class="line">ww: wwan无线广域网</span><br><span class="line">o&lt;index&gt;: 集成设备的设备索引号</span><br><span class="line">s&lt;s1ot&gt;: 扩展槽的索引号</span><br><span class="line">X&lt;MAC&gt;: 基于MAC地址的命名</span><br><span class="line">p&lt;bus&gt;s&lt;slot&gt;: enp2s1</span><br></pre></td></tr></table></figure><h4 id="29-3-2-网卡命名配置文件"><a href="#29-3-2-网卡命名配置文件" class="headerlink" title="29.3.2 网卡命名配置文件"></a>29.3.2 网卡命名配置文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网卡的mac地址或其他唯一标识符</span></span><br><span class="line">ip addr show</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建自定义的 udev 规则文件：在 /etc/udev/rules.d/ 目录下创建一个 .rules 后缀的文件</span></span><br><span class="line">vi /etc/udev/rules.d/eth1-custom-eth.rules</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网卡驱动,可以在下面规则指令中,增加网卡驱动选项</span></span><br><span class="line">ethtool -i ens160 | grep driver</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编辑规则文件并添加规则：在编辑器中添加一个 SUBSYSTEM 和 ATTR&#123;address&#125; 基于网卡的硬件标识符的规则。使用 NAME 关键字来指定自定义的网卡名称。</span></span><br><span class="line">SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;,DRIVERS==&quot;?*&quot;,ATTR&#123;address&#125;==&quot;00:0c:29:d8:cb:85&quot;,ATTR&#123;type&#125;==&quot;1&quot;,KERNEL==&quot;eth*&quot;,NAME=&quot;eth1&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新加载 udev 规则：使用以下命令重新加载 udev 规则，以使新规则生效。</span></span><br><span class="line">udevadm control --reload-rules</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改网卡配置文件名和网卡名</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启网络服务</span></span><br><span class="line">systemctl restart NetworkManager</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启服务器</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h4 id="29-2-1-脚本：多网卡修改eth0"><a href="#29-2-1-脚本：多网卡修改eth0" class="headerlink" title="29.2.1 脚本：多网卡修改eth0"></a>29.2.1 脚本：多网卡修改eth0</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改终端符号带命令返回值</span></span><br><span class="line">[[ $&#123;PS1&#125; = &#x27;[\u@\h \W]\$ &#x27; ]] &amp;&amp; echo &#x27;PS1=&quot;[\u@\h \w][\$?]$ &quot;&#x27; &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改网卡名称为eth0</span></span><br><span class="line">iplist=$(cd /sys/class/net/ &amp;&amp; /bin/ls -d e*)</span><br><span class="line">source /etc/os-release</span><br><span class="line">echo -n &gt; /etc/udev/rules.d/70-persistent-net.rules</span><br><span class="line">count=0</span><br><span class="line">Centos_address=7</span><br><span class="line">Rocky_address=9</span><br><span class="line">for i in $iplist; do</span><br><span class="line">    echo &#x27;SUBSYSTEM==&quot;net&quot;,ACTION==&quot;add&quot;,DRIVERS==&quot;?*&quot;,ATTR&#123;address&#125;==&quot;&#x27;$(cat /sys/class/net/$i/address)&#x27;&quot;,ATTR&#123;type&#125;==&quot;1&quot;,KERNEL==&quot;eth*&quot;,&quot;NAME=&quot;eth&#x27;$&#123;count&#125;&#x27;&quot;&#x27; &gt;&gt; /etc/udev/rules.d/70-persistent-net.rules</span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">如果是Rocky Linux则执行以下操作</span></span><br><span class="line">    if [ &quot;$NAME&quot; = &#x27;Rocky Linux&#x27; ]; then     </span><br><span class="line">cat &gt; /etc/NetworkManager/system-connections/$&#123;i&#125;.nmconnection &lt;&lt; EOF1</span><br><span class="line">[connection]</span><br><span class="line">id=eth$&#123;count&#125;</span><br><span class="line">uuid=$(uuidgen)</span><br><span class="line">type=ethernet</span><br><span class="line">autoconnect-priority=-999</span><br><span class="line">interface-name=eth$&#123;count&#125;</span><br><span class="line"></span><br><span class="line">[ethernet]</span><br><span class="line"></span><br><span class="line">[ipv4]</span><br><span class="line">address1=192.168.1.$&#123;Rocky_address&#125;/24,192.168.1.2</span><br><span class="line">dns=192.168.1.2;</span><br><span class="line"></span><br><span class="line">[ipv6]</span><br><span class="line">addr-gen-mode=eui64</span><br><span class="line">method=auto</span><br><span class="line"></span><br><span class="line">[proxy]</span><br><span class="line">EOF1</span><br><span class="line">        count=$((count + 1))</span><br><span class="line">        Rocky_address=$((Rocky_address + 10))   </span><br><span class="line">    fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果是CentOS Linux则执行以下操作</span>  </span><br><span class="line">    if [ &quot;$NAME&quot; = &#x27;CentOS Linux&#x27; ]; then</span><br><span class="line">cat &gt; /etc/sysconfig/network-scripts/ifcfg-eth$&#123;count&#125; &lt;&lt; EOF2</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">NAME=eth$&#123;count&#125;</span><br><span class="line">MACADDR=$(cat /sys/class/net/$&#123;i&#125;/address)</span><br><span class="line">DEVICE=eth$&#123;count&#125;</span><br><span class="line">UUID=$(uuidgen)</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.1.$&#123;Centos_address&#125;</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.1.2</span><br><span class="line">DNS1=192.168.1.2</span><br><span class="line">ONBOOT=yes</span><br><span class="line">EOF2</span><br><span class="line">        count=$((count + 1))</span><br><span class="line">        Centos_address=$((Centos_address + 10))</span><br><span class="line">        mv /etc/sysconfig/network-scripts/ifcfg-$&#123;i&#125; /etc/sysconfig/network-scripts/$&#123;i&#125;</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新加载udev规则文件</span></span><br><span class="line">udevadm control --reload-rules</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新生成grub</span></span><br><span class="line">sed -Ei.bak &#x27;/^GRUB_CMDLINE_LINUX/s/(GRUB.*)&quot;/\1 net.ifnames=0 biosdevname=0&quot;/&#x27; /etc/default/grub</span><br><span class="line">grub2-mkconfig -o /boot//grub2/grub.cfg</span><br><span class="line"></span><br><span class="line">shutdown -r now</span><br></pre></td></tr></table></figure><h3 id="29-4-网络配置文件详解"><a href="#29-4-网络配置文件详解" class="headerlink" title="29.4 网络配置文件详解"></a>29.4 网络配置文件详解</h3><h4 id="29-4-1-Centos-网卡配置"><a href="#29-4-1-Centos-网卡配置" class="headerlink" title="29.4.1 Centos 网卡配置"></a>29.4.1 Centos 网卡配置</h4><p>cd &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">TYPE=接口类型;常见有的Ethernet,Bridge</span><br><span class="line">NAME=此配置文件给那个网卡使用的网卡名</span><br><span class="line">MACADDR=修改网卡MAC地址，逻辑上修改,可以直接写自定义的MAC地址</span><br><span class="line">DEVICE=此配置文件给那个网卡使用的网卡名         </span><br><span class="line">HWADDR=对应的设备的MAC地址,可以使用ip link show sen33 查看网卡MAC地址,需要和实际MAC对应</span><br><span class="line">UUID=设备的唯一标识,可以使用uuidgen生成</span><br><span class="line">BOOTPROTO=激活此设备时使用的地址配置协议,常见的有dhcp，static(静态),none,bootp</span><br><span class="line">IPADDR=IP地址 </span><br><span class="line">NETMASK=子网掩码,如255.255.255.0√二选一</span><br><span class="line">PREFIX=网络ID的位数,如24√二选一</span><br><span class="line">GATEWAY=默认网关</span><br><span class="line">DNS1=第一个DNS服务器</span><br><span class="line">DNS2=第一个DNS服务器</span><br><span class="line">DOMAIN=ping www补全的后缀</span><br><span class="line">ONBOOT=yes表示网卡随系统开机而启用，避免单点失败</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">DHCP配置</span></span><br><span class="line">DEVICE=eht0</span><br><span class="line">BOOTPROTO=dhcp</span><br></pre></td></tr></table></figure><h4 id="29-4-1-Ubuntu-网卡配置"><a href="#29-4-1-Ubuntu-网卡配置" class="headerlink" title="29.4.1 Ubuntu 网卡配置"></a>29.4.1 Ubuntu 网卡配置</h4><p>官网文档：</p><p><a href="https://help.ubuntu.com/">https://help.ubuntu.com</a></p><p><a href="https://ubuntu.com/server/docs">https://ubuntu.com/server/docs</a></p><h3 id="29-5-网络配置相关命令"><a href="#29-5-网络配置相关命令" class="headerlink" title="29.5 网络配置相关命令"></a>29.5 网络配置相关命令</h3><h4 id="29-5-1-ifconfig-命令"><a href="#29-5-1-ifconfig-命令" class="headerlink" title="29.5.1 ifconfig 命令"></a>29.5.1 ifconfig 命令</h4><p>工具来自：yum -y install net-tools</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示活动的网卡信息</span></span><br><span class="line">ifconfig</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">效果类似拔网线,禁用网卡</span></span><br><span class="line">ifconfig ens33 down</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">效果类似插网线,启用网卡</span></span><br><span class="line">ifconfig ens33 up</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">临时设置网卡IP,重启失效，想要恢复可以重新设置原来的IP</span></span><br><span class="line">ifconfig ens33 192.168.1.100</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清空网卡IP,重启失效</span></span><br><span class="line">ifconfig ens33 0.0.0.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">临时添加一个IP,并设置虚拟接口名为ens33-1</span></span><br><span class="line">ifconfig ens33:ens33-1 192.168.1.101</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除临时IP</span></span><br><span class="line">ifconfig ens33:ens33-1 down</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网卡流量使用情况</span></span><br><span class="line">ifconfig -s</span><br></pre></td></tr></table></figure><h4 id="29-5-2-ip-命令"><a href="#29-5-2-ip-命令" class="headerlink" title="29.5.2 ip 命令"></a>29.5.2 ip 命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有网卡状态</span></span><br><span class="line">ip link</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示指定网卡信息</span></span><br><span class="line">ip addr show eth0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拔网线</span></span><br><span class="line">ip link set eth0 down</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">插网线</span></span><br><span class="line">ip link set eth0 up</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">临时修改网卡名</span></span><br><span class="line">ip link set ens33 name eth0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">临时添加一个IP地址</span></span><br><span class="line">ip addr add 192.168.1.100/24 dev eth0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">临时删除一个IP地址</span></span><br><span class="line">ip addr del 192.168.1.100/24 dev eth0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清空IP地址</span></span><br><span class="line">ip addr flush dev eth0 </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改IP地址</span></span><br><span class="line">ip addr change 192.168.1.100/24 dev eth0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网卡流量使用情况</span></span><br><span class="line">ip -s link show eth0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示路由信息</span></span><br><span class="line">ip route</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示接口路由信息</span></span><br><span class="line">ip route show dev eth0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加网络接口的默认网关</span></span><br><span class="line">ip route add default via 192.168.0.1 dev eth0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除网络接口的默认网关</span></span><br><span class="line">ip route del default via 192.168.0.1 dev eth0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加一条网络路由</span></span><br><span class="line">ip route add 192.168.2.0/24 via 192.168.1.1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除一条网络路由</span></span><br><span class="line">ip route del 192.168.2.0/24 via 192.168.1.1</span><br></pre></td></tr></table></figure><h4 id="29-5-3-nmcli-命令"><a href="#29-5-3-nmcli-命令" class="headerlink" title="29.5.3 nmcli 命令"></a>29.5.3 nmcli 命令</h4><p>nmcli 是软件 NetworkManager 的提供的命令。使用 nmcli 命令时，必须确保 NetworkManager 为运行状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">networking 可以简写为，n，ne，net，netw，netwo，networ，network</span><br><span class="line">connectivity 可以简写为，c，co，con，conn ......</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看 NetworkManager 是否接管网络设置</span></span><br><span class="line">nmcli networking</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动网络服务</span></span><br><span class="line">nmcli net on</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭网络服务,所有网卡全down</span></span><br><span class="line">nmcli net off</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新加载网络服务</span></span><br><span class="line">nmcli connection reload</span><br></pre></td></tr></table></figure><table><thead><tr><th>nmcli con mod</th><th>对应文件配置</th></tr></thead><tbody><tr><td>ipv4.method manual</td><td>BOOTPROTO&#x3D;none</td></tr><tr><td>ipv4.method auto</td><td>BOOTPROTO&#x3D;dhcp</td></tr><tr><td>ipv4.addresses 192.168.2.1&#x2F;24</td><td>IPADDR&#x3D;192.168.2.1      PREFIX&#x3D;24</td></tr><tr><td>ipv4.gateway 172.16.0.200</td><td>GATEWAY&#x3D;172.16.0.200</td></tr><tr><td>ipv4.dns 8.8.8.8</td><td>DNS0&#x3D;8.8.8.8</td></tr><tr><td>ipv4.dns-search example.com</td><td>DOMAIN&#x3D;example.com</td></tr><tr><td>ipv4.ignore-auto-dns true</td><td>PEERDNS&#x3D;no</td></tr><tr><td>connection.autoconnect yes</td><td>ONBOOT&#x3D;yes</td></tr><tr><td>connection.id eth0</td><td>NAME&#x3D;eth0</td></tr><tr><td>connection.interface-name eth0</td><td>DEVICE&#x3D;eth0</td></tr><tr><td>802-3-ethernet.mac-address  . . .</td><td>HWADDR&#x3D;. . .</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h5 id="29-5-3-1-nmcli-实现bonding"><a href="#29-5-3-1-nmcli-实现bonding" class="headerlink" title="29.5.3.1 nmcli 实现bonding"></a>29.5.3.1 nmcli 实现bonding</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建Bonding接口</span></span><br><span class="line">nmcli con add type bond con-name mybond0 ifname bond0 mode active-backup ipv4.method manual ipv4.addresses 192.168.1.200/24 </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加从属接口</span></span><br><span class="line">nmcli con add con-name mybond0-eth0 ifname ens33 type bond-slave master bond0</span><br><span class="line">nmcli con add con-name mybond0-eth1 ifname ens36 type bond-slave master bond0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注: 如果没有为从属接口提供连接名，则该名称是接口名称加类型构成</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看正在使用的接口</span></span><br><span class="line">nmcli connection</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除原网卡的接口</span></span><br><span class="line">nmcli connection delete 接口名</span><br><span class="line">nmcli connection delete 接口名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">要启动Bonding接口，必须首先启动从属接口</span></span><br><span class="line">nmcli con up mybond0-eth0</span><br><span class="line">nmcli con up mybond0-eth1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动Bonding接口</span></span><br><span class="line">nmcli con up mybond0</span><br></pre></td></tr></table></figure><h3 id="29-6-验证生效的网络配置"><a href="#29-6-验证生效的网络配置" class="headerlink" title="29.6 验证生效的网络配置"></a>29.6 验证生效的网络配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证IP地址是否生效</span></span><br><span class="line">ip addr</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证网关是否生效</span></span><br><span class="line">route -n</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证DNS是否生效</span></span><br><span class="line">cat /etc/resolv.conf</span><br></pre></td></tr></table></figure><h3 id="29-6-网卡双IP永久保存"><a href="#29-6-网卡双IP永久保存" class="headerlink" title="29.6 网卡双IP永久保存"></a>29.6 网卡双IP永久保存</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.可以直接在原IP配置文件中，写两个IP、子网掩码、网关</span><br><span class="line">2.可以将网卡文件复制一份，改成 DEVICE=ens33:1 复制的网卡文件名称也改成ifcfg-ens33:1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启网络服务</span></span><br><span class="line">systemctl start network</span><br></pre></td></tr></table></figure><h3 id="29-7-网卡配置静态和动态同时使用"><a href="#29-7-网卡配置静态和动态同时使用" class="headerlink" title="29.7 网卡配置静态和动态同时使用"></a>29.7 网卡配置静态和动态同时使用</h3><p>&#x3D;&#x3D;网卡别名的配置文件必须使用静态地址&#x3D;&#x3D;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.将网卡文件复制一份，改成 DEVICE=ens33:1 复制的网卡文件名称也改成ifcfg-ens33:1</span><br><span class="line">2.修改ifcfg-ens33配置文件为DHCP</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启服务器</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h3 id="29-8-网卡聚合"><a href="#29-8-网卡聚合" class="headerlink" title="29.8 网卡聚合"></a>29.8 网卡聚合</h3><p>将多块网卡绑定同一IP地址对外提供服务，可以实现高可用或者均衡负载，直接给两块网卡设置同一IP地址是不可以的，通过bonding，虚拟一块网卡对外提供连接，物理网卡的被修改为相同的MAC地址</p><h4 id="29-8-1-bonding-7种工作模式"><a href="#29-8-1-bonding-7种工作模式" class="headerlink" title="29.8.1 bonding 7种工作模式"></a>29.8.1 bonding 7种工作模式</h4><ul><li><p>Round Robin (balance-rr)： Mode 0</p><p>轮询，数据包依次在可用的接口之间轮流发送。它可以提供负载均衡</p></li><li><p>Active-Backup： Mode 1</p><p>主备，一个接口处于活动状态，另一个接口处于备用状态。如果活动接口失效，备用接口会接管并成为活动接口</p></li><li><p>XOR (balance-xor)：Mode 2</p><p>根据发送数据包的源和目标MAC地址，将数据包分布到可用接口。同一源和目标地址的数据包将始终通过相同的接口发送。</p></li><li><p>Broadcast：Mode 3</p><p>所有接口都被用于发送和接收数据，但只有接收数据时会将数据包发送到所有接口。</p></li><li><p>802.3ad (LACP)：Mode 4</p><p>通过使用 LACP（Link Aggregation Control Protocol）协议来动态协商工作模式，从而实现接口绑定。这需要交换机端也支持 LACP。</p></li><li><p>TLB (balance-tlb)：Mode 5</p><p>根据每个接口的负载情况，将数据包发送到可用接口。接口的负载越低，发送的数据包越多。</p></li><li><p>ALB (balance-alb)：Mode 6</p><p>类似于 <code>balance-tlb</code>，但在接口失效时，会将MAC地址映射到另一个可用接口，以提供冗余。</p></li></ul><h4 id="29-8-2"><a href="#29-8-2" class="headerlink" title="29.8.2"></a>29.8.2</h4><h4 id="29-8-3-实现-Mode-1-模式"><a href="#29-8-3-实现-Mode-1-模式" class="headerlink" title="29.8.3 实现 Mode 1 模式"></a>29.8.3 实现 Mode 1 模式</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建bonding设备的配置文件</span></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-bond1</span><br><span class="line">TYPE=bond</span><br><span class="line">DEVICE=bond1</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">IPADDR=192.168.1.200</span><br><span class="line">PREFIX=24</span><br><span class="line">BONDING_OPTS=&quot;mode=1 miimon=100&quot;    miimon指定链路监测时间间隔。如果miimon=100，那么系统每100ms检测一次链路连接状态，如果有一条线路不通就转入另一条线路,这里使用 mode1 模式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">DEVICE=eth0</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">MASTER=bond1</span><br><span class="line">SLAVE=yes</span><br><span class="line">ONBOOT=yes</span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth1</span><br><span class="line">DEVICE=eth1</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">MASTER=bond1</span><br><span class="line">SLAVE=yes</span><br><span class="line">ONBOOT=yes</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启网络服务</span></span><br><span class="line">systemctl restart network</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启后确认依然能生效</span></span><br><span class="line">shutdown -r now</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看bond状态</span></span><br><span class="line">cat /proc/net/bonding/bond1</span><br></pre></td></tr></table></figure><p>删除bond</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁用</span></span><br><span class="line">ip link set down dev bond0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载驱动</span></span><br><span class="line">modprobe -r bonding</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除bonding配置文件</span></span><br><span class="line">mv /etc/sysconfig/network-scripts/ifcfg-bond1 /tmp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">恢复原来网卡的配置文件</span></span><br></pre></td></tr></table></figure><h4 id="29-8-4"><a href="#29-8-4" class="headerlink" title="29.8.4"></a>29.8.4</h4><h4 id="29-8-5-实现-Mode-3-模式"><a href="#29-8-5-实现-Mode-3-模式" class="headerlink" title="29.8.5 实现 Mode 3 模式"></a>29.8.5 实现 Mode 3 模式</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建bonding设备的配置文件</span></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-bond1</span><br><span class="line">TYPE=bond</span><br><span class="line">DEVICE=bond1</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">IPADDR=192.168.1.200</span><br><span class="line">PREFIX=24</span><br><span class="line">BONDING_OPTS=&quot;mode=3 miimon=100&quot;    miimon指定链路监测时间间隔。如果miimon=100，那么系统每100ms检测一次链路连接状态，如果有一条线路不通就转入另一条线路,这里使用 mode1 模式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">DEVICE=eth0</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">MASTER=bond1</span><br><span class="line">SLAVE=yes</span><br><span class="line">ONBOOT=yes</span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth1</span><br><span class="line">DEVICE=eth1</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">MASTER=bond1</span><br><span class="line">SLAVE=yes</span><br><span class="line">ONBOOT=yes</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启网络服务</span></span><br><span class="line">systemctl restart network</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启后确认依然能生效</span></span><br><span class="line">shutdown -r now</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看bond状态</span></span><br><span class="line">cat /proc/net/bonding/bond1</span><br></pre></td></tr></table></figure><p>删除bond</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">禁用网卡</span></span><br><span class="line">ip link set down dev bond1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">卸载驱动</span></span><br><span class="line">modprobe -r bonding</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除bonding配置文件</span></span><br><span class="line">mv /etc/sysconfig/network-scripts/ifcfg-bond1 /tmp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">恢复原来网卡的配置文件</span></span><br></pre></td></tr></table></figure><h4 id="29-8-6"><a href="#29-8-6" class="headerlink" title="29.8.6"></a>29.8.6</h4><h4 id="29-8-7"><a href="#29-8-7" class="headerlink" title="29.8.7"></a>29.8.7</h4><h4 id="29-8-8"><a href="#29-8-8" class="headerlink" title="29.8.8"></a>29.8.8</h4><h3 id="29-9-网络组-Network-Teaming"><a href="#29-9-网络组-Network-Teaming" class="headerlink" title="29.9 网络组 Network Teaming"></a>29.9 网络组 Network Teaming</h3><p>网络组：是将多个网卡聚合在一起的方法，从而实现冗错和提高吞吐量，网络组不同于旧版中<code>bonding</code>技术，提供更好的性能和扩展性，网络组由内核驱动和<code>teamd</code>守护进程实现</p><h4 id="29-9-1-实现网络组"><a href="#29-9-1-实现网络组" class="headerlink" title="29.9.1 实现网络组"></a>29.9.1 实现网络组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建team接口</span></span><br><span class="line">nmcli con add con-name myteam0 ifname team0 type team config &#x27;&#123;&quot;runner&quot;:&#123;&quot;name&quot;:&quot;activebackup&quot;&#125;&#125;&#x27; ipv4.method manual ipv4.addresses 192.168.1.200/24 </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加从属接口</span></span><br><span class="line">nmcli con add con-name myteam0-eth0  type team-slave master team0 ifname ens33</span><br><span class="line">nmcli con add con-name myteam0-eth1  type team-slave master team0 ifname ens36</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注: 如果没有为从属接口提供连接名，则该名称是接口名称加类型构成</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看正在使用的接口</span></span><br><span class="line">nmcli connection</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除原网卡的接口</span></span><br><span class="line">nmcli connection delete 接口名</span><br><span class="line">nmcli connection delete 接口名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新加载网卡配置文件</span></span><br><span class="line">nmcli con reload</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">要启动Bonding接口，必须首先启动从属接口</span></span><br><span class="line">nmcli con up mybond0-eth0</span><br><span class="line">nmcli con up mybond0-eth1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动Bonding接口</span></span><br><span class="line">nmcli con up mybond0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网络组状态</span></span><br><span class="line">teamdctl team0 state</span><br></pre></td></tr></table></figure><h3 id="29-10-Linux-网络桥"><a href="#29-10-Linux-网络桥" class="headerlink" title="29.10 Linux 网络桥"></a>29.10 Linux 网络桥</h3><p>工具来自：yum -y install bridge-utils</p><h3 id="29-11-网络测试诊断工具"><a href="#29-11-网络测试诊断工具" class="headerlink" title="29.11 网络测试诊断工具"></a>29.11 网络测试诊断工具</h3><ul><li><h4 id="测试网络连通性"><a href="#测试网络连通性" class="headerlink" title="测试网络连通性"></a>测试网络连通性</h4><p>ping</p></li><li><p>显示正确的路由表</p><p>ip route</p></li><li><p>路由追踪</p><p>traceroute</p><p>tracepath</p><p>mtr</p></li><li><p>确认名称服务器使用</p><p>nslookup</p><p>host</p><p>dig</p></li><li><p>抓包工具</p><p>tcpdump</p><p>wireshark</p></li><li><p>安全扫描工具</p><p>nmap</p><p>netcat</p></li><li><p>流量控制工具</p><p>tc</p></li></ul><h4 id="29-11-1-tcpdump"><a href="#29-11-1-tcpdump" class="headerlink" title="29.11.1 tcpdump"></a>29.11.1 tcpdump</h4><p>网络数据包截取分析工具，支持针对网络层、协议、主机、网络或端口的过滤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">-a尝试将网络和广播地址转换成名称</span><br><span class="line">-c ?收到指定的数据包数目后,就停止输出操作</span><br><span class="line">-d把编译过的数据包编码转换成可阅读的格式,并输出到标准输出</span><br><span class="line">-dd把编译过的数据包编码转换成C语言的格式,并输出到标准输出</span><br><span class="line">-ddd把编译过的数据包编码转换成十进制数字的格式,并输出到标准输出</span><br><span class="line">-e在每列输出资料上显示连接层级的文件头</span><br><span class="line">-f用数字显示实际网络地址</span><br><span class="line">-F &lt;文件&gt;     指定内含表达方式的文件</span><br><span class="line">-i &lt;网络界面&gt; 使用指定的网络界面送出数据包</span><br><span class="line">-l使用标准输出列的缓冲区</span><br><span class="line">-n不把主机的网络地址转换成名字</span><br><span class="line">-N不列出域名。</span><br><span class="line">-o不将数据包编码最佳化。</span><br><span class="line">-p不让网络界面进入混杂模式。</span><br><span class="line">-q 快速输出，仅列出少数的传输协议信息。</span><br><span class="line">-r&lt;数据包文件&gt;  从指定的文件读取数据包数据。</span><br><span class="line">-s&lt;数据包大小&gt;   设置每个数据包的大小。</span><br><span class="line">-S 用绝对而非相对数值列出TCP关联数</span><br><span class="line">-t 在每列倾倒资料上不显示时间戳记。</span><br><span class="line">-tt 在每列倾倒资料上显示未经格式化的时间戳记</span><br><span class="line">-T&lt;数据包类型&gt;  强制将表达方式所指定的数据包转译成设置的数据包类型</span><br><span class="line">-v 详细显示指令执行过程。</span><br><span class="line">-vv 更详细显示指令执行过程。</span><br><span class="line">-x 用十六进制字码列出数据包资料。</span><br><span class="line">-w&lt;数据包文件&gt; 把数据包数据写入指定的文件。</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">不指定任何参数,监听第一块网卡上经过的数据包。</span></span><br><span class="line">tcpdump</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">监听特定网卡</span></span><br><span class="line">tcpdump -i eth0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">监听主机出入的通信包</span></span><br><span class="line">tcpdump host 192.168.1.100</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">监听特定来源</span></span><br><span class="line">tcpdump src host hostname</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">监听特定目标地址</span></span><br><span class="line">tcpdump dst host hostname</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果不指定src和dst,那么来源或者目标是hostname的通信都会被监听</span></span><br><span class="line">tcpdump host hostname</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">监听特定端口</span></span><br><span class="line">tcpdump port 3000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">监听TCP/UDP</span></span><br><span class="line">tcpdump tcp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">来源主机+端口+TCP，监听来自主机10.0.0.100在端口22上的TCP数据包</span></span><br><span class="line">tcpdump tcp port 22 and src host 10.0.0.100</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">监听特定主机之间的通信</span></span><br><span class="line">tcpdump ip host 10.0.0.101 and 10.0.0.102</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">10.0.0.101和除了10.0.0.1之外的主机之间的通信</span></span><br><span class="line">tcpdump ip host 10.0.0.101 and ! 10.0.0.1</span><br></pre></td></tr></table></figure><h4 id="29-11-2-nmap"><a href="#29-11-2-nmap" class="headerlink" title="29.11.2 nmap"></a>29.11.2 nmap</h4><p>扫描远程主机工具：yum -y install nmap</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">-sTTCP connect()扫描，这是最基本的 TCP 扫描方式。这种扫描很容易被检测到，在目标主机的日志中会记录大批的连接请求以及错误信息</span><br><span class="line"></span><br><span class="line">-sSTCP 同步扫描 (TCP SYN)，因为不必全部打开一个 TCP 连接，所以这项技术通常称为半开扫描 (half-sSopen)。这项技术最大的好处是，很少有系统能够把这记入系统日志</span><br><span class="line"></span><br><span class="line">-sF,-sX,-SN秘密FIN 数据包扫描、圣诞树(Xma Tree)、空(Nu1) 扫模式。这些扫描方式的理论依据是:关闭的端口需要对你的探测包回应 RST 包，而打开的端口必需忽略有问题的包</span><br><span class="line"></span><br><span class="line">-sPping 扫描，用 ping 方式检查网络上哪些主机正在运行。当主机阻塞 ICMP echo 请求包是 ping 扫描是sP无效的。nmap 在任何情况下都会进行 ping 扫描，只有目标主机处于运行状态，才会进行后续的扫描</span><br><span class="line"></span><br><span class="line">-sUUDP 的数据包进行扫描，想知道在某台主机上提供哪些 UDP 服务，可以使用此选项</span><br><span class="line"></span><br><span class="line">-SAACK 扫描，这项高级的扫描方法通常可以用来穿过防火墙。</span><br><span class="line">-sw滑动窗口扫描，非常类似于 ACK 的扫描</span><br><span class="line">-SRRPC 扫描，和其它不同的端口扫描方法结合使用。</span><br><span class="line"></span><br><span class="line">-bFTP 反弹攻击 (bounce attack)，连接到防火墙后面的一台 FTP 服务器做代理，接着进行端口扫描</span><br><span class="line">-pO在扫描之前，不 ping 主机。</span><br><span class="line"></span><br><span class="line">-PT扫描之前，使用 TCP ping 确定哪些主机正在运行</span><br><span class="line"></span><br><span class="line">-PS对于 root 用户，这个选项让 nmap 使用 SYN 包而不是 ACK 包来对目标主机进行扫描。</span><br><span class="line">-PI设置这个选项，让 nmap 使用真正的 ping(ICMP echo 请求)来扫描目标主机是否正在运行。</span><br><span class="line">-PB这是默认的 ping 扫描选项。它使用 ACK(-PT)和 ICMP(-PI) 两种扫型并行扫描。如果防火墙能够过滤其中一种包，使用这种方法，你就能够穿过防火墙。</span><br><span class="line"></span><br><span class="line">-O这个选项激活对 TCP/IP 指纹特征 (fingerprinting) 的扫描，获得远程主机的标志，也就是操作系统类型</span><br><span class="line">-I打开 nmap 的反向标志扫描功能</span><br><span class="line">-f使用碎片 IP 数据包发送 SYN、FIN、XMAS、NULL。包增加包过滤、入侵检测系统的难度，使其无法知道你的企图</span><br><span class="line"></span><br><span class="line">-v冗余模式，强烈推荐这个选项，它会给出扫描过程中的详细信息。</span><br><span class="line"></span><br><span class="line">-S &lt;IP&gt;一些情况下 nmap 可能无法确定你的源地址。在这种情况下用这个选项给出 IP 地址</span><br><span class="line">-g port设置扫描的源端口</span><br><span class="line">-oN把扫描结果重定向到一个可读的文件 logfilename 中</span><br><span class="line"></span><br><span class="line">-oS扫描结果输出到标准输出</span><br><span class="line">--host_timeout设置扫描一台主机的时间，以毫秒为单位，默认情况下，没有超时限制</span><br><span class="line">--max_rtt_timeout设置对每次探测的等待时间，以毫秒为单位，如果超过这个时间限制就重传或超时，默认值大约是900毫秒</span><br><span class="line"></span><br><span class="line">--min_rtt_timeout设置 nmap 对每次探测至少等待你指定的时间，以毫秒为单位</span><br><span class="line">-M count设置进行 TCP connect() 扫描时，最多使用多少个套接字进行并行的扫描</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">TCP ack 扫描，并发2000，速度快</span></span><br><span class="line">nmap -n -PA --min-parallelism 2000 172.16.0.0/16</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">仅列出指定网段上的每台主机，不发送任何报文到目标主机</span></span><br><span class="line">nmap -sL 192.168.1.0/24</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">扫描主机范围</span></span><br><span class="line">nmap -sP 192.168.1.0-255</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">扫描地址段</span></span><br><span class="line">nmap -sP -v 192.168.1.0/24</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">扫描指定主机端口使用情况</span></span><br><span class="line">nmap -v -A 10.0.0.7</span><br></pre></td></tr></table></figure><h1 id="30-路由管理"><a href="#30-路由管理" class="headerlink" title="30. 路由管理"></a>30. 路由管理</h1><h3 id="30-1-路由表构成"><a href="#30-1-路由表构成" class="headerlink" title="30.1 路由表构成"></a>30.1 路由表构成</h3><ul><li><p>Destination：目标网络ID，表示可以到达的目标网络ID，0.0.0.0表示所有未知网络，又称为默认路由，优先级最低</p></li><li><p>Gateway：(网关)到达非直连的网络，将数据发送到临近（下一个）路由器的临近本主机的接口的IP地址，如果是直连网络gateway是0.0.0.0rout</p></li><li><p>Genmask：（子网掩码）目标网络对应的netmask</p></li><li><p>Metric：到达远程主机的费用，值越少，路由选择偏向性越高</p></li><li><p>Iface：到达对应网络，应该由当前主机那个网卡发送出来</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos ~][0]$ route -n</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.1.2     0.0.0.0         UG    100    0        0 ens33</span><br><span class="line">192.168.1.0     0.0.0.0         255.255.255.0   U     100    0        0 ens33</span><br></pre></td></tr></table></figure><h3 id="30-2-route-命令"><a href="#30-2-route-命令" class="headerlink" title="30.2 route 命令"></a>30.2 route 命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">route</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看路由表</span></span><br><span class="line">route -n</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加一个主机路由(到达一个IP地址怎么走)</span></span><br><span class="line">route add -host 目标IP gw 网关(下一跳) dev 网卡名称</span><br><span class="line">route add -host 192.168.30.1 gw 172.16.0.1 dev ens33</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加一个网络路由(到达一个网段地址怎么走)</span></span><br><span class="line">route add -net 目标IP gw 网关(下一跳) dev 网卡名称</span><br><span class="line">route add -net 192.168.0.0/24 gw 172.16.0.1 dev ens33</span><br><span class="line">route add -net 192.168.0.0 netmask 255.255.255.0 gw 172.16.0.1 dev ens33</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加一个网络路由，给他设置费用,费用越低,使用偏向性越高</span></span><br><span class="line">route add -net 192.168.0.0/24 gw 172.16.0.1 dev ens33 metric 200</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加一个默认路由</span></span><br><span class="line">route add -net 0.0.0.0 netmask 0.0.0.0 gw 172.16.0.1</span><br><span class="line">route add -net 0.0.0.0/0 gw 172.16.0.1</span><br><span class="line">route add default gw 172.16.0.1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除静态主机路由</span></span><br><span class="line">route del -host 192.168.30.1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除静态网络路由</span></span><br><span class="line">route del -net 192.168.0.0 netmask 255.255.255.0</span><br></pre></td></tr></table></figure><h3 id="30-3-2路由器的路由实现"><a href="#30-3-2路由器的路由实现" class="headerlink" title="30.3 2路由器的路由实现"></a>30.3 2路由器的路由实现</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35354992/1686123844695-27c340d6-b728-4f00-bfc0-fc2986511f91.png" alt="img"></p><p>Route 1 路由表</p><table><thead><tr><th>目标网络</th><th>网关</th><th>子网掩码</th><th>接口</th></tr></thead><tbody><tr><td>Destination</td><td>Gateway</td><td>Genmask</td><td></td></tr><tr><td>172.16.0.0</td><td>0.0.0.0</td><td>255.255.0.0</td><td>eth0</td></tr><tr><td>10.0.0.0</td><td>0.0.0.0</td><td>255.0.0.0</td><td>eth1</td></tr><tr><td>192.168.0.0</td><td>10.0.0.201</td><td>255.255.255.0</td><td>eth1</td></tr></tbody></table><p>Route 2 路由表</p><table><thead><tr><th>目标网络</th><th>网关</th><th>子网掩码</th><th>接口</th></tr></thead><tbody><tr><td>Destination</td><td>Gateway</td><td>Genmask</td><td></td></tr><tr><td>172.16.0.0</td><td>10.0.0.200</td><td>255.255.0.0</td><td>eth1</td></tr><tr><td>10.0.0.0</td><td>0.0.0.0</td><td>255.0.0.0</td><td>eth1</td></tr><tr><td>192.168.0.0</td><td>0.0.0.0</td><td>255.255.255.0</td><td>eth0</td></tr></tbody></table><h3 id="30-4-3路由器的路由实现"><a href="#30-4-3路由器的路由实现" class="headerlink" title="30.4 3路由器的路由实现"></a>30.4 3路由器的路由实现</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35354992/1686145331121-fc47a827-1472-458f-8be7-841ff2efe766.png" alt="img"></p><table><thead><tr><th>路由器</th><th>目标地址</th><th>网关</th></tr></thead><tbody><tr><td>1</td><td>172.20.0.0&#x2F;16</td><td>172.18.0.201</td></tr><tr><td>1</td><td>172.22.0.0&#x2F;16</td><td>172.18.0.201</td></tr><tr><td>2</td><td>172.16.0.0</td><td>172.18.0.200</td></tr><tr><td>2</td><td>172.22.0.0</td><td>172.20.0.201</td></tr><tr><td>3</td><td>0.0.0.0</td><td>172.20.2.200</td></tr></tbody></table><h3 id="30-5-路由的保存"><a href="#30-5-路由的保存" class="headerlink" title="30.5 路由的保存"></a>30.5 路由的保存</h3><p>该文件不存在，需要手动创建</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/network-scripts/route-eth0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">路由表配置风格</span></span><br><span class="line">(1)TARGET via GW</span><br><span class="line">例：10.0.0.8/8 via 172.16.0.1</span><br><span class="line"></span><br><span class="line">(2)每三行定义一条路由?号是第几条路由,例: 1、2、3</span><br><span class="line">ADDRESS?=TARGET</span><br><span class="line">NETMASK?=mask</span><br><span class="line">GATWAY?=GW</span><br></pre></td></tr></table></figure><h1 id="31-进程，性能相关工具"><a href="#31-进程，性能相关工具" class="headerlink" title="31. 进程，性能相关工具"></a>31. 进程，性能相关工具</h1><h3 id="31-1-进程管理工具"><a href="#31-1-进程管理工具" class="headerlink" title="31.1 进程管理工具"></a>31.1 进程管理工具</h3><h4 id="31-1-1-pstree-进程树"><a href="#31-1-1-pstree-进程树" class="headerlink" title="31.1.1 pstree 进程树"></a>31.1.1 pstree 进程树</h4><p>工具来自：<code>yum -y install psmisc</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pstree [选项] [PID|USER]</span><br><span class="line"></span><br><span class="line">-p显示PID</span><br><span class="line">-T不显示线程thread，默认显示线程</span><br><span class="line">-u显示用户切换</span><br><span class="line">-H pid高亮显示父进程和前辈进程</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看某个用户进程</span></span><br><span class="line">pstree root</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看进程ID</span></span><br><span class="line">pstree -pT</span><br></pre></td></tr></table></figure><h4 id="31-1-2-ps-进程信息"><a href="#31-1-2-ps-进程信息" class="headerlink" title="31.1.2 ps 进程信息"></a>31.1.2 ps 进程信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">a显示所有终端运行的进程</span><br><span class="line">x选项包括不在终端运行的进程</span><br><span class="line">u选项显示进程所有者信息</span><br><span class="line">f显示父子进程关系</span><br><span class="line">o显示定制的信息</span><br><span class="line">L显示支持的属性列表</span><br><span class="line"></span><br><span class="line">-k|--sort对属性排序,在属性前加 - 表示倒序</span><br><span class="line">-o挑选要显示的属性,pid,user,%cpu,cmd ...</span><br><span class="line">-C指定命令,多个命令用,分隔</span><br><span class="line">-e显示所有进程，相当于-A</span><br><span class="line">-L显示线程</span><br><span class="line">-f显示完整格式程序信息</span><br><span class="line">-F显示更完整格式的进程信息</span><br><span class="line">-H以进程层级格式显示进程相关信息</span><br><span class="line">-u UID|USER_NAME指定有效的用户ID或名称</span><br><span class="line">-U UID|USER_NAME指定真正的用户ID或名称</span><br><span class="line">-g GID|GROUP_NAME指定有效的gid或组名称</span><br><span class="line">-G GID|GROUP_NAME指定真正的gid或组名称</span><br><span class="line">-p PID显示指pid的进程</span><br><span class="line">--ppid PID显示属于pid的子进程</span><br><span class="line">-t tty指定tty,相当于 t</span><br><span class="line">-M显示SELinu信息,相当于 Z</span><br><span class="line"></span><br><span class="line">ni：nice值</span><br><span class="line">pri：priority优先级</span><br><span class="line">rtprio：实时优先级</span><br><span class="line">psr：processor cpu编号</span><br></pre></td></tr></table></figure><h4 id="31-1-3-搜索进程和健康检查"><a href="#31-1-3-搜索进程和健康检查" class="headerlink" title="31.1.3 搜索进程和健康检查"></a>31.1.3 搜索进程和健康检查</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pidof mysqld</span><br><span class="line"></span><br><span class="line">-x按脚本名称查询PID</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按脚本名称查询PID</span></span><br><span class="line">pidof -x iptables.sh</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pgrep mysqld</span><br><span class="line"></span><br><span class="line">-u  生效者</span><br><span class="line">-U真正发起运行命令者</span><br><span class="line">-t与指定终端相关的进程</span><br><span class="line">-l显示进程名</span><br><span class="line">-a显示进程的完整命令</span><br><span class="line">-p PID显示指定进程的子进程</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看进程PID</span></span><br><span class="line">pgrep sshd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看你某个终端运行进程</span></span><br><span class="line">pgrep -at pts/0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断进程是否存在</span></span><br><span class="line">pidof sshd &amp;&gt; /dev/null &amp;&amp; echo &quot;进程存在&quot; || echo &quot;进程不存在&quot;</span><br><span class="line">pgrep -c sshd &amp;&gt; /dev/null &amp;&amp; echo &quot;进程存在&quot; || echo &quot;进程不存在&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断进程是否存在</span></span><br><span class="line">kill -0 PID &amp;&gt; /dev/null;echo $?</span><br><span class="line">killall -0 ssh &amp;&gt; /dev/null;echo $?</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进程的健康性检查</span></span><br><span class="line">模拟客户端发起访问，以此来判断是否健康</span><br></pre></td></tr></table></figure><h4 id="31-1-4-调整进程优先级"><a href="#31-1-4-调整进程优先级" class="headerlink" title="31.1.4 调整进程优先级"></a>31.1.4 调整进程优先级</h4><ul><li><strong>静态优先级：</strong> 静态优先级是一个用于表示进程相对于其他进程的相对优先级的整数值。它通常在范围 <code>[100, 139]</code> 内，其中 <code>100</code> 是最低优先级，而 <code>139</code> 是最高优先级。</li><li><strong>Nice值：</strong> Nice值是一个范围在 <code>-20</code> 到 <code>19</code> 之间的整数，用于表示进程的相对优先级。<code>-20</code> 是最高优先级（最不nice），<code>19</code> 是最低优先级（最nice）。较小的Nice值对应于更高的优先级，较大的Nice值对应于更低的优先级。</li><li><strong>默认的Nice值：</strong> 当进程启动时，默认的Nice值为 <code>0</code>，这对应于静态优先级 <code>120</code>。因此，默认情况下，进程的优先级为 <code>120</code>。</li><li><strong>只有根用户可以降低Nice值：</strong> 通常，只有超级用户（根用户）才能降低（提高优先性）进程的Nice值，即将Nice值从正数减小到负数。这可以通过使用 <code>renice</code> 命令来实现。非特权用户只能增加Nice值（减小优先级）。</li><li><strong>优先级最高为-19，最低为20：</strong> 由于Nice值的范围是 <code>-20</code> 到 <code>19</code>，对应的静态优先级范围是 <code>[100, 139]</code>，所以最高的进程优先级是 <code>-19</code> 对应静态优先级 <code>100</code>，而最低的进程优先级是 <code>20</code> 对应静态优先级 <code>139</code>。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以最高优先级来启动进程</span></span><br><span class="line">nice -n -19 ping 127.0.0.1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以最低优先级来启动进程</span></span><br><span class="line">nice -n 20 ping 127.0.0.1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">调整正在运行的进程优先级</span></span><br><span class="line">renice -n -10 3727</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看进程优先级</span></span><br><span class="line">prtstat -r $(pidof ping) | grep nice</span><br></pre></td></tr></table></figure><h4 id="31-1-5-lsof-查看进程打开文件"><a href="#31-1-5-lsof-查看进程打开文件" class="headerlink" title="31.1.5 lsof 查看进程打开文件"></a>31.1.5 lsof 查看进程打开文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出指定进程打开的文件</span></span><br><span class="line">lsof -p &lt;PID&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示使用该目录或文件的进程</span></span><br><span class="line">lsof /path/to/file</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出某个用户打开的文件</span></span><br><span class="line">lsof -u username</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出某个特定端口被哪个进程占用</span></span><br><span class="line">lsof -i :80</span><br></pre></td></tr></table></figure><p>范例：误删除被使用的文件，恢复</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">模拟文件被使用</span></span><br><span class="line">tail -f /var/log/dpkg.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除使用中的文件</span></span><br><span class="line">rm -rf /var/log/dpkg.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找被删除但仍然被进程使用的文件</span></span><br><span class="line">lsof | grep &#x27;deleted&#x27;</span><br><span class="line">tail   5285     root    3r   REG    252,3  766  788975 /var/log/dpkg.log (deleted)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">恢复文件</span></span><br><span class="line">cat /proc/$(pidof tail)/fd/3 &gt; /var/log/dpkg.log</span><br></pre></td></tr></table></figure><h3 id="31-2-系统性能工具"><a href="#31-2-系统性能工具" class="headerlink" title="31.2 系统性能工具"></a>31.2 系统性能工具</h3><h4 id="31-2-1-uptime-负载查询"><a href="#31-2-1-uptime-负载查询" class="headerlink" title="31.2.1 uptime 负载查询"></a>31.2.1 uptime 负载查询</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@Ubuntu:~# uptime</span><br><span class="line"> 21:24:39 up 11:45,  2 users,  load average: 0.02, 0.01, 0.00</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出说明</span></span><br><span class="line">21:24:39: 当前系统时间为 21 点 24 分 39 秒。</span><br><span class="line">up 11:45: 系统已经运行了 11 小时 45 分钟。这表示自上次启动系统以来的运行时间。</span><br><span class="line">2 users: 当前有 2 个用户登录到系统。</span><br><span class="line">load average: 0.02, 0.01, 0.00: 负载平均值。负载平均值显示了系统在过去 1 分钟、5 分钟和 15 分钟内的平均负载情况</span><br></pre></td></tr></table></figure><p>&#x2F;proc&#x2F;uptime 包括两个值，单位s</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@Ubuntu:~# cat /proc/uptime</span><br><span class="line">42711.43 84637.93</span><br><span class="line"></span><br><span class="line">42711.43系统开机时间</span><br><span class="line">84637.93系统空闲实现,按CPU核数计算，两颗CPU的空闲时间需要乘2</span><br></pre></td></tr></table></figure><h4 id="31-2-3-prtstat-查看进程信息"><a href="#31-2-3-prtstat-查看进程信息" class="headerlink" title="31.2.3  prtstat 查看进程信息"></a>31.2.3  prtstat 查看进程信息</h4><p>工具来自：<code>yum -y install psmisc</code>   可以显示更为详细的信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">prtstat [进程PID]</span><br><span class="line"></span><br><span class="line">-r更清晰的显示</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看sshd进程详细信息</span></span><br><span class="line">prtstat -r $(pidof sshd)</span><br></pre></td></tr></table></figure><h4 id="31-2-4-top-查看进程实时"><a href="#31-2-4-top-查看进程实时" class="headerlink" title="31.2.4 top 查看进程实时"></a>31.2.4 top 查看进程实时</h4><h4 id="31-2-5-mpstat-显示CPU相关统计"><a href="#31-2-5-mpstat-显示CPU相关统计" class="headerlink" title="31.2.5 mpstat 显示CPU相关统计"></a>31.2.5 mpstat 显示CPU相关统计</h4><p>工具来自：<code>yum -y install sysstat</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一秒钟收集一次数据,收集5次退出</span></span><br><span class="line">root@Ubuntu:~# mpstat 1 5</span><br><span class="line">Linux 5.15.0-83-generic (Ubuntu) 11/07/2023 _x86_64_(2 CPU)</span><br><span class="line"></span><br><span class="line">09:37:00 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle</span><br><span class="line">09:37:00 PM  all    0.28    0.01    0.15    0.02    0.00    0.00    0.00    0.00    0.00   99.53</span><br></pre></td></tr></table></figure><h3 id="31-3-Centos-8-图形化系统管理工具"><a href="#31-3-Centos-8-图形化系统管理工具" class="headerlink" title="31.3 Centos 8 图形化系统管理工具"></a>31.3 Centos 8 图形化系统管理工具</h3><p>Cockpit 是 Centos 8 引入的新特性，是一个基于web界面的应用，它提供了对系统的图形化管理</p><ul><li>监控系统活动（CPU，内存，磁盘IO和网络流量）</li><li>查看系统日志条目</li><li>查看磁盘分区的容量</li><li>查看网络活动（发送和接收）</li><li>查看用户账户</li><li>检查系统服务的状态</li><li>提取已安装应用的信息</li><li>查看和安装可用更新（如果以root身份登录），并在需要时重启系统</li><li>打开并使用终端窗口</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装cockpit</span></span><br><span class="line">dnf -y install cockpit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动服务</span></span><br><span class="line">systemctl enable --now cockpit.socket</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">访问界面</span></span><br><span class="line">https://192.168.1.8:9090</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">账号/密码</span></span><br><span class="line">账号/密码为root的账号密码</span><br></pre></td></tr></table></figure><h1 id="32-信号发送-Kill"><a href="#32-信号发送-Kill" class="headerlink" title="32. 信号发送 Kill"></a>32. 信号发送 Kill</h1><p><code>kill</code>：内部命令，可用来向进程发送控制信号，以实现对进程管理，每个信号对应一个数字，信号名称以SIG开头，可以省略，不区分大小写</p><h3 id="32-1-查看信号列表"><a href="#32-1-查看信号列表" class="headerlink" title="32.1 查看信号列表"></a>32.1 查看信号列表</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kill -l</span><br><span class="line">trap -l</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">信号列表</span></span><br><span class="line"> 1) SIGHUP 2)  SIGINT 3)  SIGQUIT 4)  SIGILL 5)  SIGTRAP</span><br><span class="line"> 6) SIGABRT 7)  SIGBUS 8)  SIGFPE 9)  SIGKILL10) SIGUSR1</span><br><span class="line">11) SIGSEGV12) SIGUSR213) SIGPIPE14) SIGALRM15) SIGTERM</span><br><span class="line">16) SIGSTKFLT17) SIGCHLD18) SIGCONT19) SIGSTOP20) SIGTSTP</span><br><span class="line">21) SIGTTIN22) SIGTTOU23) SIGURG24) SIGXCPU25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM27) SIGPROF28) SIGWINCH29) SIGIO30) SIGPWR</span><br><span class="line">31) SIGSYS34) SIGRTMIN35) SIGRTMIN+136) SIGRTMIN+237) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+439) SIGRTMIN+540) SIGRTMIN+641) SIGRTMIN+742) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+944) SIGRTMIN+1045) SIGRTMIN+1146) SIGRTMIN+1247) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+1449) SIGRTMIN+1550) SIGRTMAX-1451) SIGRTMAX-1352) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-1154) SIGRTMAX-1055) SIGRTMAX-956) SIGRTMAX-857) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-659) SIGRTMAX-560) SIGRTMAX-461) SIGRTMAX-362) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-164) SIGRTMAX</span><br></pre></td></tr></table></figure><h3 id="32-2-常用信号"><a href="#32-2-常用信号" class="headerlink" title="32.2 常用信号"></a>32.2 常用信号</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0)用于检查进程是否仍在运行 killall -0 haproxy</span><br><span class="line">1)  SIGHUP无须关闭进程而让其重读配置文件</span><br><span class="line">2)  SIGINT中止正在运行的进程：相当于ctl+c</span><br><span class="line">3)  SIGQUTT相当于ctl+\</span><br><span class="line">9)  SIGKILL强制杀死正在运行的进程</span><br><span class="line">15) SIGTERM优雅的终止正在运行的进程</span><br><span class="line">18) SIGCONT继续运行</span><br><span class="line">19) SIGSTOP后台休眠</span><br></pre></td></tr></table></figure><h3 id="32-3-发送信号的方法"><a href="#32-3-发送信号的方法" class="headerlink" title="32.3 发送信号的方法"></a>32.3 发送信号的方法</h3><p>信号的数字表示：1，2 ，9</p><p>信号完整名称：SIGHUP，sighup</p><p>信号的简写名称：HUP，hup</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">按PID发送信号</span><br><span class="line">kill pid</span><br><span class="line">kill -9pid</span><br><span class="line">kill -15 pid</span><br></pre></td></tr></table></figure><p>按命令来发送，工具来自：<code>yum -y install psmisc</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">killall -SIGTERM  ping</span><br><span class="line">killall -TERM  ping</span><br><span class="line">killall -15  ping</span><br></pre></td></tr></table></figure><h3 id="32-4-作业管理"><a href="#32-4-作业管理" class="headerlink" title="32.4 作业管理"></a>32.4 作业管理</h3><p>Linux 的作业控制</p><ul><li>前台作业：通过终端启动，且启动后一直占据终端</li><li>后台作业：可通过终端启动，但启动后立即转入后台运行</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将一个前台的作业调入后台休眠</span></span><br><span class="line">Ctrl + z</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将一个前台作业调入后台执行</span></span><br><span class="line">kill -18 PID</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将一个还没有启动的作业调入后台执行</span></span><br><span class="line">COMMAND &amp;</span><br></pre></td></tr></table></figure><p>后台作业虽然被送往后台运行，但其依然与终端有关；退出终端，将关闭后台作业，如果希望送往后台后，剥离与终端的关系</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nohup COMMAND &amp;&gt; /dev/null &amp;</span><br><span class="line"></span><br><span class="line">screen;COMMAND</span><br><span class="line">tmux;COMMAND</span><br></pre></td></tr></table></figure><h3 id="32-5-作业控制"><a href="#32-5-作业控制" class="headerlink" title="32.5 作业控制"></a>32.5 作业控制</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前终端的所有作业</span></span><br><span class="line">jobs</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">把指定的后台作业调回前台</span></span><br><span class="line">fg</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">让送往后台的作业在后台继续运行</span></span><br><span class="line">bg</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">终止指定的作业</span></span><br><span class="line">kill</span><br></pre></td></tr></table></figure><h3 id="32-6-任务并行运行"><a href="#32-6-任务并行运行" class="headerlink" title="32.6 任务并行运行"></a>32.6 任务并行运行</h3><p>利用后台执行，实现并行同时运行多个进程，提高效率</p><p>方法一</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 127.0.0.1 &amp;</span><br></pre></td></tr></table></figure><p>方法二</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(ping 127.0.0.1);(ping 127.0.0.2);(ping 127.0.0.3)</span><br></pre></td></tr></table></figure><p>方法三</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 127.0.0.1 &amp; ping 127.0.0.2 &amp; ping 127.0.0.3</span><br></pre></td></tr></table></figure><p>多组命令后台并行运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; ping 127.0.0.1;ping 127.0.0.2; &#125;&amp; &#123; ping 127.0.0.3;ping 127.0.0.4; &#125;&amp;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NET=192.168.1</span><br><span class="line">for i in &#123;1..254&#125; ;do</span><br><span class="line">    &#123;   </span><br><span class="line">        ping -c1 -w1 $&#123;NET&#125;.$&#123;i&#125; &amp;&gt; /dev/null &amp;&amp; echo $&#123;NET&#125;.$&#123;i&#125; is UP || echo $&#123;NET&#125;.$&#123;i&#125; is DOWN</span><br><span class="line">    &#125; &amp;</span><br><span class="line">done</span><br><span class="line">wait</span><br></pre></td></tr></table></figure><h1 id="33-计划任务"><a href="#33-计划任务" class="headerlink" title="33. 计划任务"></a>33. 计划任务</h1><p>通过计划任务，可以让系统自动的按时间或周期性计划执行任务</p><h3 id="33-1-一次性任务"><a href="#33-1-一次性任务" class="headerlink" title="33.1 一次性任务"></a>33.1 一次性任务</h3><p>at 工具</p><ul><li>交互式工具，由 <code>yum -y install at</code> 提供</li><li>依赖 <code>systemctl status atd.service</code> 服务，需要启动才能实现 at 任务</li><li>at 任务队列存放在&#x2F;var&#x2F;spool&#x2F;at&#x2F;</li></ul><p>at 命令</p><ul><li><p>作业执行命令的结果中，标准输出和错误以执行任务者的身份邮件通知给root</p></li><li><p>默认Centos8最小化安装是没有安装邮件服务器，需要自行安装</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">at [选项] 时间</span><br><span class="line"></span><br><span class="line">-v显示版本信息</span><br><span class="line">-t time时间格式</span><br><span class="line">14:20在今日的14:20执行，如果已过，则明天执行</span><br><span class="line">14:20 2016-09-20指定具体时间日期执行</span><br><span class="line"></span><br><span class="line">-l列出指定队列中等待运行的作业</span><br><span class="line">-d删除指定的作业</span><br><span class="line">-c查看具体作业任务</span><br><span class="line">-f /path/file指定的文件中读取任务</span><br><span class="line">-m当任务被完成之后，将给用户发送邮件，即使没有标准输出</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出所有计划任务</span></span><br><span class="line">at -l</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看某个计划任务具体内容</span></span><br><span class="line">at -c 3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除指定计划任务</span></span><br><span class="line">at -d 3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">非交互式创建计划任务</span></span><br><span class="line">echo &#x27;echo 123&#x27; | at 14:25</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">非交互式创建计划任务</span></span><br><span class="line">at 14:25 &lt; at.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">交互式执行计划任务</span></span><br><span class="line">at</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">Ctrl + D 保存计划任务</span><br></pre></td></tr></table></figure><h3 id="33-2-一次性任务权限控制"><a href="#33-2-一次性任务权限控制" class="headerlink" title="33.2 一次性任务权限控制"></a>33.2 一次性任务权限控制</h3><ul><li>白名单：&#x2F;etc&#x2F;at.allow默认不存在，如果文件存在了，那么只有该文件中的用户才能执行at命令</li><li>黑名单：&#x2F;etc&#x2F;at&#x2F;at.deny默认存在，拒绝该文件中用户执行at命令，而没有在at.deny文件中的使用者则可执行</li><li>如果两个文件都不存在，只有root可以执行at命令</li></ul><h3 id="33-3-周期性计划任务"><a href="#33-3-周期性计划任务" class="headerlink" title="33.3 周期性计划任务"></a>33.3 周期性计划任务</h3><p>周期性任务计划cron相关的程序包：</p><ul><li><p>cronie：主程序包，提供crond守护进程及相关辅助工具</p></li><li><p>crontabs：包含 CentOS 提供系统维护任务</p></li><li><p>cronie-anacron：cronie的补充程序，cronie的补充程序，用于监控cronie任务执行状态，如：cronie中的任务在过去该运行的时间点未能正常运行，则anacron会随后启动一次此任务</p></li><li><p>cron依赖于crond服务，确保crond守护进程处于运行状态：</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Centos 7 +</span></span><br><span class="line">systemctl status crond.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Centos 6</span></span><br><span class="line">service crond.service status</span><br></pre></td></tr></table></figure><p>cron 任务分为</p><ul><li>系统cron任务：系统维护作业，<code>/etc/crontab</code> 主配置文件，<code>/etc/cron.d</code> 子配置文件</li><li>用户cron任务：保存在 <code>/var/spool/cron/USERNAME</code> 利用 <code>crontab</code> 命令管理</li></ul><h4 id="33-3-1-etc-crontab-配置文件解析"><a href="#33-3-1-etc-crontab-配置文件解析" class="headerlink" title="33.3.1 &#x2F;etc&#x2F;crontab 配置文件解析"></a>33.3.1 &#x2F;etc&#x2F;crontab 配置文件解析</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SHELL=/bin/bash默认的shell类型</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin默认使用的PATH变量,不在其中的命令无法执行,可为其修改</span><br><span class="line">MAILTO=root默认比哦准输出和错误发送邮件给root,可以指向其他用户</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">For details see man 4 crontabs</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Example of job definition:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.---------------- minute (0 - 59)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">|  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">|  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">|  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">|  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">|  |  |  |  |</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">*  *  *  *  * user-name  <span class="built_in">command</span> to be executed</span></span><br></pre></td></tr></table></figure><h4 id="33-3-2-cron-相关文件"><a href="#33-3-2-cron-相关文件" class="headerlink" title="33.3.2 cron 相关文件"></a>33.3.2 cron 相关文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@rocky9 ~]# rpm -ql crontabs</span><br><span class="line">/etc/cron.daily该目录下任务脚本,将每日运行</span><br><span class="line">/etc/cron.hourly该目录下任务脚本,将每小时运行,默认将在每小时第一分钟执行</span><br><span class="line">/etc/cron.monthly该目录下任务脚本,将每月运行</span><br><span class="line">/etc/cron.weekly该目录下任务脚本,将每周运行</span><br><span class="line">/etc/crontab系统范围的 cron 配置文件</span><br><span class="line">/etc/sysconfig/run-parts</span><br><span class="line">/usr/bin/run-partsrun-parts 工具的二进制可执行文件。它可以指定目录，并运行目录下所有可执行文件</span><br><span class="line">/usr/share/licenses/crontabs</span><br><span class="line">/usr/share/licenses/crontabs/COPYING</span><br><span class="line">/usr/share/man/man4/crontabs.4.gz</span><br><span class="line">/usr/share/man/man4/run-parts.4.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@rocky9 ~]# rpm -ql cronie</span><br><span class="line">/etc/cron.d该目录下的配置文件,都将被计划任务调度,模板参考/etc/cron.d/0hourly</span><br><span class="line">/etc/cron.d/0hourly</span><br><span class="line">/etc/cron.deny用于限制哪些用户可以将被禁止使用 cron。</span><br><span class="line">/etc/cron.allow用于限制那些用户可以使用 cron ,不在内的用户将被禁止,文件默认不存在</span><br><span class="line">/etc/pam.d/crond</span><br><span class="line">/etc/sysconfig/crond</span><br><span class="line">/usr/bin/cronnext</span><br><span class="line">/usr/bin/crontab</span><br><span class="line">/usr/lib/.build-id</span><br><span class="line">/usr/lib/.build-id/a7</span><br><span class="line">/usr/lib/.build-id/a7/7c55caedd2e23684df35300abf811b57fefb8a</span><br><span class="line">/usr/lib/.build-id/b4</span><br><span class="line">/usr/lib/.build-id/b4/d97b486d8886a5561b1185920175ebcfed2e33</span><br><span class="line">/usr/lib/.build-id/b7</span><br><span class="line">/usr/lib/.build-id/b7/fe9e700dc97ea6d1f7fcf0404f85026c21aa1a</span><br><span class="line">/usr/lib/systemd/system/crond.service</span><br><span class="line">/usr/sbin/crond</span><br><span class="line">/usr/share/doc/cronie</span><br><span class="line">/usr/share/doc/cronie/AUTHORS</span><br><span class="line">/usr/share/doc/cronie/ChangeLog</span><br><span class="line">/usr/share/doc/cronie/README</span><br><span class="line">/usr/share/licenses/cronie</span><br><span class="line">/usr/share/licenses/cronie/COPYING</span><br><span class="line">/usr/share/man/man1/cronnext.1.gz</span><br><span class="line">/usr/share/man/man1/crontab.1.gz</span><br><span class="line">/usr/share/man/man5/crontab.5.gz</span><br><span class="line">/usr/share/man/man8/cron.8.gz</span><br><span class="line">/usr/share/man/man8/crond.8.gz</span><br><span class="line">/var/spool/cron</span><br></pre></td></tr></table></figure><h4 id="33-3-2-修改-crontab-默认打开的编辑器"><a href="#33-3-2-修改-crontab-默认打开的编辑器" class="headerlink" title="33.3.2 修改 crontab 默认打开的编辑器"></a>33.3.2 修改 crontab 默认打开的编辑器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export EDITOR=vim</span><br></pre></td></tr></table></figure><h3 id="33-6-用户计划任务-crontab"><a href="#33-6-用户计划任务-crontab" class="headerlink" title="33.6 用户计划任务 crontab"></a>33.6 用户计划任务 crontab</h3><p><code>crontab</code>任务：</p><ul><li>每个用户都有自己专用的 cron 任务文件：  <code>/var/spool/cron/USERNAME</code></li><li>默认标准输出和错误会被发送邮件给对应的用户：如 <code>deployer</code> 创建的任务就发送至<code>deployer</code>的邮箱</li><li>root能够修改其他用户的作业</li><li>用户的 cron 中默认 PATH&#x3D;&#x2F;usr&#x2F;bin:&#x2F;bin，如果使用其他路径，在任务文件的第一行加 PATH&#x3D;&#x2F;path</li><li>cron 任务中 % 表示换行的特殊意义，且第一个%后的所有字符串会被当作命令的标准输出，如果要使用，需要 \ 转义，将 % 放置于单引号中也是不支持的</li></ul><p><code>crontab</code>命令格式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">crontab [ -u user ] [ -l | -r | -e | -i ]</span><br><span class="line"></span><br><span class="line">-l列出所有任务</span><br><span class="line">-e编辑任务</span><br><span class="line">-r移除所有任务</span><br><span class="line">-ri以交互式模式移除指定任务</span><br><span class="line">-u user 仅root可运行，管理指定用户cron任务</span><br></pre></td></tr></table></figure><h3 id="33-7-特殊的计划任务要求"><a href="#33-7-特殊的计划任务要求" class="headerlink" title="33.7 特殊的计划任务要求"></a>33.7 特殊的计划任务要求</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">实现秒级的计划任务</span></span><br><span class="line">for i in &#123;1..60&#125; ;do echo &quot;第$&#123;i&#125;次&quot; ;sleep 20 ;done </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如何实现7分钟执行一次任务</span></span><br><span class="line">sleep 2暂停2秒,默认</span><br><span class="line">sleep 2m暂停2分钟</span><br><span class="line">sleep 2h暂停2小时</span><br><span class="line">sleep 2d暂停2天</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">实现微秒级别的计划任务</span></span><br><span class="line">sleep  高版本支持</span><br><span class="line">usleep 支持</span><br></pre></td></tr></table></figure><h1 id="35-内核参数管理"><a href="#35-内核参数管理" class="headerlink" title="35. 内核参数管理"></a>35. 内核参数管理</h1><h3 id="35-1-内核参数配置文件"><a href="#35-1-内核参数配置文件" class="headerlink" title="35.1 内核参数配置文件"></a>35.1 内核参数配置文件</h3><ul><li><p>默认配置文件：<code>/etc/sysctl.conf</code></p></li><li><p>其他配置文件：<code>/usr/lib/sysctl.d/*.conf</code> <code>/run/sysctl.d/*.conf</code> <code>/etc/sysctl.d/*.conf </code></p></li></ul><h3 id="35-2-sysctl-管理命令"><a href="#35-2-sysctl-管理命令" class="headerlink" title="35.2 sysctl 管理命令"></a>35.2 sysctl 管理命令</h3><p><code>sysctl</code>命令用于查看或者设定此目录中诸多参数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sysctl </span><br><span class="line"></span><br><span class="line">-a查看所有生效的参数</span><br><span class="line">-w临时修改内核参数</span><br><span class="line">-p file使该配置文件内核参数生效</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">临时修改内核参数</span></span><br><span class="line">sysctl -w net.ipv4.ip_forward=1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">永久使内核参数生效</span></span><br><span class="line">echo net.ipv4.ip_forward=1 &gt;&gt; /etc/sysctl.conf &amp;&amp; sysctl -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看某个内核参数的值</span></span><br><span class="line">sysctl net.ipv4.ip_forward</span><br></pre></td></tr></table></figure><h3 id="35-3-常用内核参数"><a href="#35-3-常用内核参数" class="headerlink" title="35.3 常用内核参数"></a>35.3 常用内核参数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开启ip_forward转发</span></span><br><span class="line">echo net.ipv4.ip_forward = 1 &gt;&gt; /etc/sysctl.conf &amp;&amp; sysctl -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">忽略ping请求</span></span><br><span class="line">echo net.ipv4.icmp_echo_ignore_all = 1 &gt;&gt; /etc/sysctl.conf &amp;&amp; sysctl -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">允许应用程序监听本地不存在的IP</span></span><br><span class="line">echo net.ipv4.ip_nonlocal_bind = 1 &gt;&gt; /etc/sysctl.conf &amp;&amp; sysctl -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">限制操作系统打开的文件数量</span></span><br><span class="line">echo fs.file-man = 1020000 &gt;&gt; /etc/sysctl.conf &amp;&amp; sysctl -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">TCP连接关闭时等待套接字中的数据发送完毕的时间</span></span><br><span class="line">net.ipv4.tcp_fin_timeout = 2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">允许重新使用处于TIME_WAIT状态的套接字</span></span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启用TIME-WAIT状态的快速回收机制</span></span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启用TCP SYN cookies，防范SYN攻击</span></span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">TCP keepalive超时时间，单位秒，用于检测连接是否仍然活跃</span></span><br><span class="line">net.ipv4.tcp_keepalive_time = 600</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">本地端口范围，用于主动发起连接时的本地端口选择</span></span><br><span class="line">net.ipv4.ip_local_port_range = 2000 65000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">半连接队列的最大长度</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 16384</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">系统中TIME-WAIT状态的最大数量</span></span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 36000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">路由表项在没有被使用的时间间隔后被系统垃圾回收的时间，单位秒</span></span><br><span class="line">net.ipv4.route.gc_timeout = 100</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">放弃连接之前，TCP发送SYN包的最大重试次数</span></span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">放弃连接之前，TCP发送SYN+ACK包的最大重试次数</span></span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">系统中允许的最大孤立的套接字数量</span></span><br><span class="line">net.ipv4.tcp_max_orphans = 16384</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">系统中允许的最大套接字连接数，影响监听队列的大小</span></span><br><span class="line">net.core.somaxconn = 16384</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">网络设备队列的最大长度，影响传入数据包的处理速度</span></span><br><span class="line">net.core.netdev_max_backlog = 16384</span><br></pre></td></tr></table></figure><h1 id="36-内核模块管理"><a href="#36-内核模块管理" class="headerlink" title="36. 内核模块管理"></a>36. 内核模块管理</h1><h3 id="36-1-内核版本"><a href="#36-1-内核版本" class="headerlink" title="36.1 内核版本"></a>36.1 内核版本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uanme [选项]</span><br><span class="line"></span><br><span class="line">-r显示内核版本</span><br><span class="line">-n显示主机命</span><br><span class="line">-a显示系统的所有信息，包括内核名称、主机名、内核版本号、机器类型等</span><br></pre></td></tr></table></figure><h3 id="36-2-内核模命令"><a href="#36-2-内核模命令" class="headerlink" title="36.2 内核模命令"></a>36.2 内核模命令</h3><h4 id="36-2-1-查看内核模块"><a href="#36-2-1-查看内核模块" class="headerlink" title="36.2.1 查看内核模块"></a>36.2.1 查看内核模块</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">modinfo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看内核已经加载的模块</span></span><br><span class="line">lsmod </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示模块文件路径</span></span><br><span class="line">modinfo -n module_name</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示模块参数</span></span><br><span class="line">modinfo -p module_name</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示模块描述</span></span><br><span class="line">modinfo -d module_name</span><br></pre></td></tr></table></figure><h4 id="36-2-2-搜索内核模块"><a href="#36-2-2-搜索内核模块" class="headerlink" title="36.2.2 搜索内核模块"></a>36.2.2 搜索内核模块</h4><h4 id="36-2-3-加载内核模块"><a href="#36-2-3-加载内核模块" class="headerlink" title="36.2.3 加载内核模块"></a>36.2.3 加载内核模块</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">modprobe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载内核模块</span></span><br><span class="line">modprobe module_name</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载内核模块</span></span><br><span class="line">modprobe -r module_name</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">强制加载模块</span></span><br><span class="line">modprobe -f module_name</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示模块信息</span></span><br><span class="line">modprobe -c</span><br></pre></td></tr></table></figure><h4 id="36-2-4-卸载内核模块"><a href="#36-2-4-卸载内核模块" class="headerlink" title="36.2.4 卸载内核模块"></a>36.2.4 卸载内核模块</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rmmod</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载内核模块</span></span><br><span class="line">rmmod module_name</span><br></pre></td></tr></table></figure><h1 id="37-systemd"><a href="#37-systemd" class="headerlink" title="37. systemd"></a>37. systemd</h1><h3 id="37-1-Unit-分类"><a href="#37-1-Unit-分类" class="headerlink" title="37.1 Unit 分类"></a>37.1 Unit 分类</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7 ~]$ systemctl -t help</span><br><span class="line">Available unit types:</span><br><span class="line">service文件扩展名为.service,用于定义系统服务</span><br><span class="line">socket定义进程间通信用的socket文件，也可在系统启动时，延迟启动服务，实现按需功能</span><br><span class="line">busname</span><br><span class="line">target文件扩展名为.target，用于模拟实现运行级别</span><br><span class="line">snapshot管理系统快照</span><br><span class="line">device用于定义内核识别的设备</span><br><span class="line">mount定义文件系统挂载点</span><br><span class="line">automount文件系统的自动挂载点</span><br><span class="line">swap用于标识swap设备   </span><br><span class="line">timer</span><br><span class="line">path用于定义文件系统中的一个文件或目录使用，常用关于当文件系统变化时，延迟激活服务，如spool目录</span><br><span class="line">slice</span><br><span class="line">scope</span><br></pre></td></tr></table></figure><h3 id="37-2-Unit-的配置文件"><a href="#37-2-Unit-的配置文件" class="headerlink" title="37.2 Unit 的配置文件"></a>37.2 Unit 的配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/systemd/system每个服务最主要的启动脚本设置，类似于之前的/etc/init.d/</span><br><span class="line">/lib/systemd/systemubunt的对应目录</span><br><span class="line">/run/systemd/system系统执行过程中所产生的服务脚本，比上面目录优先运行</span><br><span class="line">/etc/systemd/system管理员建立的执行脚本，类似于/etc/rc*.d/S*的功能，比上面目录优先运行</span><br></pre></td></tr></table></figure><h3 id="37-3-systemctl-命令"><a href="#37-3-systemctl-命令" class="headerlink" title="37.3 systemctl 命令"></a>37.3 systemctl 命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">systemctl COMMAND name.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动：相当于service name start</span></span><br><span class="line">[root@Centos7 /]$ systemctl start name.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止：相当于service name stop</span></span><br><span class="line">[root@Centos7 /]$ systemctl stop name.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启：相当于service name restart</span></span><br><span class="line">[root@Centos7 /]$ systemctl restart name.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看状态：相当于service name status</span></span><br><span class="line">[root@Centos7 /]$ systemctl status name.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁止自动和手动启动</span></span><br><span class="line">systemctk mask name.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取消禁止</span></span><br><span class="line">systemctl unmask name.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看某服务当前激活与否的状态</span></span><br><span class="line">systemctl is-active name.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有已经激活的服务</span></span><br><span class="line">systemctl list-units --type service --all  | grep </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设定某服务开机自启，相当于chkconfig name on</span></span><br><span class="line">systemctl enable name.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设定服务开机启动，并马上启动服务</span></span><br><span class="line">systemctl enable --now name.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设定服务开机不启动，并马上关闭服务</span></span><br><span class="line">systemctl disable --now postfix.service </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看某服务是否开机启动<span class="built_in">enable</span>返回为0 <span class="built_in">disable</span>返回为1</span></span><br><span class="line">systemctl is-enabled postfix.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出失败的服务</span></span><br><span class="line">systemctl --failed --type=service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设定某服务开机禁止启动：相当于chkconfig name off</span></span><br><span class="line">systemctl disable name.sercice</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有服务的开机自启状态，相当于chkconfig --list</span></span><br><span class="line">systemctl list-unit-files --type service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看服务的依赖关系</span></span><br><span class="line">systemctl list-dependencies name.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">杀掉进程：</span></span><br><span class="line">systemctl kill unitname</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通知systemd重新载入配置文件，而后可以选择重启</span></span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure><h3 id="37-4-服务状态解释"><a href="#37-4-服务状态解释" class="headerlink" title="37.4 服务状态解释"></a>37.4 服务状态解释</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">loaded unit配置文件已处理</span><br><span class="line">active（running）一次或多次持续处理的运行</span><br><span class="line">active（exited）成功完成一次性配置</span><br><span class="line">active（waiting）运行中，等待一个时间</span><br><span class="line">inactive 不运行</span><br><span class="line">enabled 开机启动</span><br><span class="line">disabled 开机不启动</span><br><span class="line">static 开机不启动，但可被另外一个启动的服务激活</span><br><span class="line">indirect 重定向到别处</span><br><span class="line">deactivating (stop-sigterm)</span><br></pre></td></tr></table></figure><h3 id="37-5-Unit-文件格式"><a href="#37-5-Unit-文件格式" class="headerlink" title="37.5 Unit 文件格式"></a>37.5 Unit 文件格式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">范例：</span><br><span class="line">[Unit]</span><br><span class="line">Description=Mysql5.7 service  描述这个service的名字、信息</span><br><span class="line">After=network.target表示本服务在network.target服务之后启动，不涉及依赖</span><br><span class="line">Before=xxx.service表示本服务在xxx.service之前启动，不涉及依赖</span><br><span class="line">Wants=表示弱依赖关系，某个服务停止了，也不影响本服务</span><br><span class="line">Requires=表示强依赖关系，某个服务停止了，本服务必须停止</span><br><span class="line">ConditionPathExists=后面跟路径，表示只有指定路径存在，才可以启动</span><br><span class="line">[Service]</span><br><span class="line">User=可以设置服务的用户名</span><br><span class="line">Group=                        可以设置服务启动时的组</span><br><span class="line">Type=simple定义服务的类型</span><br><span class="line">                            simple：最简单常见的类型，指定服务在启动后直接开始运行，并保持状态，直到服务被终止</span><br><span class="line">                              forking：这种类型的服务会产生一个子进程来执行实际的服务操作，一旦子进程开始执行服务任务，父进程将立即退出</span><br><span class="line">                              oneshot: 一次性的服务，只需要在启动时执行一次，然后立即退出</span><br><span class="line">                            notify：与simple相同，但是约定服务会在就绪后向systemd发送一个信号，这一通知的实现由 libsystemd-daemon.so提供</span><br><span class="line">                            dbus：若以此方式启动，当指定的BusName出现在DBus系统总线上时，systemd认为服务就绪</span><br><span class="line">                            idle：systemd会等待所有任务处理完成后，才开始执行idle类型的单元，除此之外，其他行为和simple类似。</span><br><span class="line">                            . . . </span><br><span class="line">PIDFile=服务PID文件路径</span><br><span class="line">ExecStart=指定启动单元的命令或者脚本</span><br><span class="line">ExecStartPre=指定单元启动前执行的命令或脚本</span><br><span class="line">ExecStartPost=指定单元启动后执行的命令或脚本</span><br><span class="line">ExecReload=指定单元不停止服务，但是重新加载配置或状态</span><br><span class="line">ExecStop=指定单元停止时执行的命令或脚本</span><br><span class="line">PrivateTmp=True表示给服务分配独立的临时空间，不指定的话默认是/tmp</span><br><span class="line">Restart=no：默认值，表示不自动重启服务，如果服务意外终止，Systemd不会尝试自动重新启动它</span><br><span class="line">                              always：表示总是自动重新启动服务，无论服务以何种方式终止(包括正常和异常)，Systemd都会自动尝试重新启动该服务</span><br><span class="line">                            success：表示只有在服务以0返回码退出时，才会自动重新启动，如果服务以非零返回码退出或发生异常时，Systemd不会自动重新启动</span><br><span class="line">                              failure：表示只有服务以非0返回码退出时，才会自动重新启动，如果服务以0返回码退出或发生异常终止，Systemd不会自动重新启动</span><br><span class="line">                              </span><br><span class="line">RestartSec=10s定义服务自动重启间隔时间s:秒min:分钟 h:小时 ms:毫秒 us:微妙</span><br><span class="line">RemainAfterExit=如果设置这个选择为真，服务会被认为是在激活状态，即使所以的进程已经退出，默认的值为假，这个选项只有在Type=oneshot时需要被配置。</span><br><span class="line">WorkingDirectory=指定服务的安装目录</span><br><span class="line">EnvironmentFile=指定一个文本文件的路径，该文件包含了一系列环境变量的定义，每行一个。这些环境变量将在服务启动时加载，以供服务进程使用。</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">ALias=为服务添加一个别名，可以通过别名调用或者启动</span><br><span class="line">WantedBy=multi-user.target    指的是服务所在的Target是multi-user.target，也就是当系统运行级别为多用户时，系统应该启动该服务</span><br><span class="line">DefaultInstance=              指定一个默认单元</span><br></pre></td></tr></table></figure><h3 id="37-6-系统运行级别"><a href="#37-6-系统运行级别" class="headerlink" title="37.6 系统运行级别"></a>37.6 系统运行级别</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/lib/systemd/system/runlevel0.target -&gt; poweroff.target # 关机</span><br><span class="line">/lib/systemd/system/runlevel1.target -&gt; rescue.target# 救援模式</span><br><span class="line">/lib/systemd/system/runlevel3.target -&gt; multi-user.target # 多用户，命令行</span><br><span class="line">/lib/systemd/system/runlevel4.target -&gt; multi-user.target # 多用户，命令行</span><br><span class="line">/lib/systemd/system/runlevel5.target -&gt; graphical.target# 图形化</span><br><span class="line">/lib/systemd/system/runlevel6.target -&gt; reboot.target# 重新启动</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看某个target包含的资源</span></span><br><span class="line">systemctl list-dependencies reboot.target</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看目前支持的target列表</span></span><br><span class="line">systemctl list-units -t target</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换目前的target模式</span></span><br><span class="line">systemctl isolate reboot.target</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置默认的target模式</span></span><br><span class="line">systemctl set-default multi-user.target</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看默认的target模式</span></span><br><span class="line">systemctl get-default</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换到默认的target模式</span></span><br><span class="line">systemctl default</span><br></pre></td></tr></table></figure><h3 id="37-8-禁用-Ctrl-alt-delete"><a href="#37-8-禁用-Ctrl-alt-delete" class="headerlink" title="37.8 禁用 Ctrl+alt+delete"></a>37.8 禁用 Ctrl+alt+delete</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl mask ctrl-alt-del.target</span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure><h1 id="尾页"><a href="#尾页" class="headerlink" title="尾页"></a>尾页</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LANG=zh_CN.UTF-8</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文档 </tag>
            
            <tag> 基础 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
